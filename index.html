<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="The Dark Sole Enterprise Ltd ds@darksole.vip with contributions from the Klima and Carbonmark teams">

<title>Klima 2.0</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./brand/favicon.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link rel="icon" type="image/png" sizes="96x96" href="./brand/favicon-96x96.png">
<link rel="shortcut icon" href="./brand/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="./brand/apple-touch-icon.png">

  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Klima 2.0">
<meta property="og:description" content="This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.
The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.
The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.
This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.">
<meta property="og:image" content="https://whitepaper.klima.leodesouza.net/brand/klimaprotocol.svg">
<meta property="og:image:alt" content="Klima Protocol Logo.">
<meta name="twitter:title" content="Klima 2.0">
<meta name="twitter:description" content="This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.
The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.
The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.
This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.">
<meta name="twitter:image" content="https://whitepaper.klima.leodesouza.net/brand/klimaprotocol.svg">
<meta name="twitter:image:alt" content="Klima Protocol Logo.">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-prologue" id="toc-sec-prologue" class="nav-link active" data-scroll-target="#sec-prologue"><span class="header-section-number">1</span> Prologue</a></li>
  <li><a href="#sec-klima-2.0" id="toc-sec-klima-2.0" class="nav-link" data-scroll-target="#sec-klima-2.0"><span class="header-section-number">2</span> Klima&nbsp;2.0</a>
  <ul class="collapse">
  <li><a href="#sec-protocol-tokens" id="toc-sec-protocol-tokens" class="nav-link" data-scroll-target="#sec-protocol-tokens"><span class="header-section-number">2.1</span> Protocol Tokens</a></li>
  <li><a href="#sec-high-level-architecture" id="toc-sec-high-level-architecture" class="nav-link" data-scroll-target="#sec-high-level-architecture"><span class="header-section-number">2.2</span> High-Level Architecture</a></li>
  <li><a href="#sec-economics-and-incentives" id="toc-sec-economics-and-incentives" class="nav-link" data-scroll-target="#sec-economics-and-incentives"><span class="header-section-number">2.3</span> Economics and Incentives</a></li>
  <li><a href="#sec-portfolio-manager" id="toc-sec-portfolio-manager" class="nav-link" data-scroll-target="#sec-portfolio-manager"><span class="header-section-number">2.4</span> Portfolio Manager</a></li>
  <li><a href="#sec-tokens" id="toc-sec-tokens" class="nav-link" data-scroll-target="#sec-tokens"><span class="header-section-number">2.5</span> Tokens</a></li>
  <li><a href="#sec-initialisation-of-the-kvcm-token" id="toc-sec-initialisation-of-the-kvcm-token" class="nav-link" data-scroll-target="#sec-initialisation-of-the-kvcm-token"><span class="header-section-number">2.6</span> Initialisation of the kVCM Token</a></li>
  <li><a href="#sec-end-users" id="toc-sec-end-users" class="nav-link" data-scroll-target="#sec-end-users"><span class="header-section-number">2.7</span> End Users</a></li>
  <li><a href="#sec-automated-asset-manager-highlights" id="toc-sec-automated-asset-manager-highlights" class="nav-link" data-scroll-target="#sec-automated-asset-manager-highlights"><span class="header-section-number">2.8</span> Automated Asset Manager Highlights</a></li>
  </ul></li>
  <li><a href="#sec-core-economic-pillars" id="toc-sec-core-economic-pillars" class="nav-link" data-scroll-target="#sec-core-economic-pillars"><span class="header-section-number">3</span> Core Economic Pillars</a>
  <ul class="collapse">
  <li><a href="#sec-time-locked-market" id="toc-sec-time-locked-market" class="nav-link" data-scroll-target="#sec-time-locked-market"><span class="header-section-number">3.1</span> Time-Locked Market</a></li>
  <li><a href="#sec-portfolio-manager-detailed" id="toc-sec-portfolio-manager-detailed" class="nav-link" data-scroll-target="#sec-portfolio-manager-detailed"><span class="header-section-number">3.2</span> Portfolio Manager</a></li>
  <li><a href="#sec-liquidity-markets" id="toc-sec-liquidity-markets" class="nav-link" data-scroll-target="#sec-liquidity-markets"><span class="header-section-number">3.3</span> Liquidity Markets</a></li>
  <li><a href="#sec-interactive-model" id="toc-sec-interactive-model" class="nav-link" data-scroll-target="#sec-interactive-model"><span class="header-section-number">3.4</span> Interactive Model</a></li>
  </ul></li>
  <li><a href="#sec-klima-2.0-token-distribution" id="toc-sec-klima-2.0-token-distribution" class="nav-link" data-scroll-target="#sec-klima-2.0-token-distribution"><span class="header-section-number">4</span> Klima&nbsp;2.0 Token Distribution</a>
  <ul class="collapse">
  <li><a href="#sec-planned-allocations" id="toc-sec-planned-allocations" class="nav-link" data-scroll-target="#sec-planned-allocations"><span class="header-section-number">4.1</span> Planned Allocations</a></li>
  <li><a href="#sec-programmatic-incentive-curve" id="toc-sec-programmatic-incentive-curve" class="nav-link" data-scroll-target="#sec-programmatic-incentive-curve"><span class="header-section-number">4.2</span> Programmatic Incentive Curve</a></li>
  <li><a href="#sec-incentive-allocations" id="toc-sec-incentive-allocations" class="nav-link" data-scroll-target="#sec-incentive-allocations"><span class="header-section-number">4.3</span> Incentive Allocations</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="index.md"><i class="bi bi-file-text"></i>Markdown (for LLMs)</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Klima 2.0</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p></p><p>The Dark Sole Enterprise Ltd <a href="mailto:ds@darksole.vip" class="email">ds@darksole.vip</a><br>
with contributions from the Klima and Carbonmark teams</p> <p></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">16 Jan 2026 (Version 1.48)</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Notice to Readers</div>
    <p>This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.<br>
    The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.<br>
    The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.<br>
    This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.</p>
  </div>
</div>


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="brand/klimaprotocol.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%" alt="Klima Protocol Logo."></p>
</figure>
</div>
<p><strong>Copyright Notice</strong></p>
<p>This document represents original work by dark_sole <a href="mailto:ds@darksole.vip" class="email">ds@darksole.vip</a>. While contributions from others are gratefully acknowledged, all intellectual property rights remain with the author. The models, algorithms, processes, products, methodologies, and concepts described herein are licenced exclusively for commercial use by the Klima Protocol. No other party may implement, copy, modify, or derive works from these materials without explicit written permission from the author.</p>
<p>© 2025 dark_sole. All rights reserved.</p>
<section id="sec-prologue" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="sec-prologue"><span class="header-section-number">1</span> Prologue</h2>
<p>Klima&nbsp;2.0 is an autonomous, rules-based coordination protocol designed to support the retirement of carbon credits through transparent pricing, continuous execution, and onchain settlement.</p>
<p>It is not a financial product, investment vehicle, or asset management system, but a piece of market infrastructure that enables carbon supply and retirement demand to interact under predefined conditions.</p>
<p>The protocol operates through a dual-token architecture that facilitates coordination without discretionary control: <strong>kVCM</strong> functions as the internal unit of account and pricing reference for protocol-facilitated carbon retirement, while <strong>K2</strong> provides signalling inputs related to system capacity. Together, these tokens inform protocol parameters through deterministic smart-contract logic. This architecture enables the protocol to:</p>
<ul>
<li><p>price and intake eligible, tokenised carbon credits according to transparent, onchain rules;</p></li>
<li><p>make acquired credits available exclusively for irreversible retirement;</p></li>
<li><p>coordinate liquidity provision and participation incentives required for continuous operation.</p></li>
</ul>
<p>Participant actions such as locking tokens, signalling preferences, or providing liquidity serve as non-custodial inputs into a coordination mechanism that adjusts protocol parameters within predefined bounds. These inputs do not confer ownership rights, redemption rights, or claims on protocol-held carbon, nor do they constitute discretionary management of assets.</p>
<p>The protocol consists of three interdependent functional layers:</p>
<ul>
<li><p>a carbon inventory layer that holds credits solely for the purpose of facilitating retirement;</p></li>
<li><p>a governance layer that aggregates participant signals to inform pricing and intake parameters; and</p></li>
<li><p>a liquidity layer that supports entry and exit from the system through external markets.</p></li>
</ul>
<p>These layers are designed to operate together as a self-contained system, adjusting to observable supply and retirement demand without reliance on external oracles, manual intervention, or fee-extractive intermediaries.</p>
<p>Klima&nbsp;2.0 abstracts complex carbon market interactions into a transparent and auditable execution framework, enabling participants to interact with carbon retirement infrastructure directly, programmatically, and on equal terms.</p>
<p>Any economic effects arising from protocol activity result from predefined rules and market interaction, rather than from asset ownership, portfolio management, or profit extraction.</p>
</section>
<section id="sec-klima-2.0" class="level2 page-columns page-full" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="sec-klima-2.0"><span class="header-section-number">2</span> Klima&nbsp;2.0</h2>
<p>KlimaDAO launched in 2021 on the Polygon blockchain as an early experiment in applying tokenisation and onchain liquidity to voluntary carbon markets. The initial design centred on the KLIMA token and a treasury-based mechanism intended to bootstrap liquidity and participation in a nascent onchain carbon ecosystem.</p>
<p>That first iteration played a meaningful role in demonstrating that carbon credits could be represented, transferred, and retired using blockchain infrastructure. It also catalysed the development of a broader ecosystem of tools and services, including integrations with multiple carbon registries, marketplaces and point-of-sale interfaces, APIs for third-party applications, and direct onchain issuance by project developers.</p>
<p>Over time, it became clear that the original architecture was not well suited to serving large-scale, enterprise carbon buyers or to supporting continuous, rules-based market operation without manual intervention. In particular, treasury-centric designs introduced complexity, opacity, and governance challenges that limited scalability and operational clarity.</p>
<p>Klima&nbsp;2.0 is a ground-up redesign informed by these lessons. Rather than relying on treasury management or discretionary allocation, the new protocol is structured as neutral, non-extractive market infrastructure focused exclusively on facilitating carbon retirement through transparent pricing, programmatic settlement, and open participation.</p>
<p>The Klima&nbsp;2.0 protocol replaces treasury-backed mechanisms with a rules-based coordination model that uses protocol-native tokens to parameterise pricing bounds, intake capacity, and participation incentives. Carbon credits handled by the protocol are acquired solely to fulfil retirement demand and are not held, traded, or managed for financial gain.</p>
<p>This shift reflects a deliberate move away from capital-centric designs toward infrastructure that prioritises auditability, predictability, and long-term operational resilience. Klima&nbsp;2.0 is intended to function as a shared execution layer for carbon markets, enabling suppliers, buyers, and integrators to interact under predefined conditions without reliance on discretionary intermediaries.</p>
<section id="sec-protocol-tokens" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="sec-protocol-tokens"><span class="header-section-number">2.1</span> Protocol Tokens</h3>
<p>Klima&nbsp;2.0 operates using two protocol-native tokens, <strong>kVCM</strong> and <strong>K2</strong>, which together enable rules-based coordination of pricing, capacity, and participation within the system. These tokens do not confer ownership rights, redemption rights, or claims on protocol-handled carbon, and do not represent investment interests.</p>
<p><strong>kVCM</strong> functions as the internal unit of account and pricing reference for protocol-facilitated carbon retirement, while <strong>K2</strong> provides signalling inputs related to system capacity. Both tokens are used exclusively to parameterise protocol behaviour through deterministic smart-contract logic.</p>
<p><strong>kVCM</strong> tokens set core allocation choices, whereas <strong>K2</strong> acts as the calibration mechanism for inventory development.</p>
</section>
<section id="sec-high-level-architecture" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="sec-high-level-architecture"><span class="header-section-number">2.2</span> High-Level Architecture</h3>
<p>Klima&nbsp;2.0 is composed of three interdependent functional layers that together support continuous, non-discretionary operation:</p>
<ol type="1">
<li><p><strong>Carbon Inventory Layer</strong>:</p>
<ul>
<li>Accumulates carbon credits by minting <strong>kVCM</strong>.</li>
<li>Sells carbon certificates by burning <strong>kVCM</strong>.</li>
<li>Prices carbon based on the system’s code.</li>
</ul>
<p>Carbon credits handled by the protocol cannot be withdrawn, transferred, or resold.</p></li>
<li><p><strong>Governance Layer</strong>:</p>
<ul>
<li><strong>kVCM</strong> holders may <strong>time-lock</strong> their <strong>kVCM</strong> for a fixed time period and become eligible to select carbon assets for the inventory.</li>
<li>This action creates a <strong>kVCM</strong> Base Accrual curve, which is distributed to the time-locked holders. This is utilised to derive discount rates and governance weightings.</li>
</ul></li>
<li><p><strong>Liquidity Layer</strong>:</p>
<ul>
<li><strong>kVCM</strong> and <strong>K2</strong> holders are able to pair their tokens together, or in the case of <strong>kVCM</strong> with USDC, in order to generate liquidity fees.</li>
<li>Staking the resulting liquidity provider tokens may generate a share of protocol incentives.</li>
<li>Liquidity locked in the <strong>kVCM</strong>/<strong>K2</strong> liquidity pool participates in general governance alongside time-locked <strong>kVCM</strong> holders.</li>
</ul></li>
</ol>
<p>These layers operate together as a self-contained system that responds only to its own observable state, without reliance on external oracles or manual intervention.</p>
</section>
<section id="sec-economics-and-incentives" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="sec-economics-and-incentives"><span class="header-section-number">2.3</span> Economics and Incentives</h3>
<section id="sec-kvcm-synthetic-yield" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="sec-kvcm-synthetic-yield"><span class="header-section-number">2.3.1</span> kVCM Synthetic Yield</h4>
<p><strong>kVCM</strong> emits a continuous yield rewarding:</p>
<ol type="1">
<li><p>Time-locked <strong>kVCM</strong> holders (‘<strong>kVCM</strong> Base Accrual’).</p></li>
<li><p>User-locked <strong>K2</strong> holders (‘<strong>kVCM</strong> Risk Premium’).</p></li>
<li><p>Both <strong>kVCM</strong> and <strong>K2</strong> stakers, i.e.&nbsp;liquidity providers who staked their liquidity provider tokens (‘<strong>kVCM</strong> Risk Premium’).</p></li>
</ol>
<p>The proportions and quantities are dynamic depending on the system state.</p>
</section>
<section id="sec-k2-incentives" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="sec-k2-incentives"><span class="header-section-number">2.3.2</span> K2 Incentives</h4>
<p>The expansion of the <strong>K2</strong> token supply is allocated to stakeholders below in varying quantities depending on system balances.</p>
<ol type="1">
<li><p>Time-locked <strong>kVCM</strong> holders.</p></li>
<li><p>User-locked <strong>K2</strong> holders.</p></li>
<li><p>Both <strong>kVCM</strong> and <strong>K2</strong> stakers.</p></li>
</ol>
</section>
</section>
<section id="sec-portfolio-manager" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="sec-portfolio-manager"><span class="header-section-number">2.4</span> Portfolio Manager</h3>
<p>At the core of the platform, the Portfolio Manager accumulates, trades and distributes its carbon portfolio driven by parameters determined from collective token holder actions&nbsp;(and inaction).</p>
<div id="fig-portfolio-manager" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 Portfolio Manager.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-portfolio-manager-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/portfolio-manager.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-portfolio-manager-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Klima&nbsp;2.0 Portfolio Manager.
</figcaption>
</figure>
</div>
<p>The Portfolio Manager <strong>purchases</strong> carbon credits and <strong>sells</strong> offset certificates by pre-defined classification called <strong>carbon class</strong>. It does <u>not</u> sell carbon credits.</p>
<p>Token holders collectively set the risk parameters for the pricing of <strong>each class</strong> by defining:</p>
<ul>
<li><p>Portfolio weighting.</p></li>
<li><p>Capacity curve and spreads.</p></li>
</ul>
<p>Additional <strong>global</strong> parameters are similarly determined:</p>
<ul>
<li><p>Forward-delivery discount rates.</p></li>
<li><p><strong>kVCM</strong> synthetic yield curve creating incentives for portfolio selection, liquidity provision and risk management contributions.</p></li>
</ul>
<p>There are no oracles or external inputs required for Klima&nbsp;2.0 as it is fully autonomous and responds to its own native state of token balances.</p>
</section>
<section id="sec-tokens" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="sec-tokens"><span class="header-section-number">2.5</span> Tokens</h3>
<section id="sec-risk-balanced-asset-token-kvcm" class="level4" data-number="2.5.1">
<h4 data-number="2.5.1" class="anchored" data-anchor-id="sec-risk-balanced-asset-token-kvcm"><span class="header-section-number">2.5.1</span> Risk-Balanced Asset Token: kVCM</h4>
<p><strong>kVCM</strong> represents core ownership of the portfolio assets, and is designed to flex between asset and growth value drivers depending on token-holder activity.</p>
<p><strong>kVCM</strong> has <u>no maximum supply</u> but inflates upon carbon credit accumulation, and contracts upon issuance of carbon offset certificates.</p>
<ul>
<li><p>When <strong>time-locked</strong> for fixed maturities:</p>
<ul>
<li><p><em>Optionally</em> selects carbon classes for portfolio weighting and pricing&nbsp;(‘active’).</p></li>
<li><p>Sets the forward discount rate for carbon portfolio acquisition from the collective time locking pattern over time.</p></li>
<li><p>Generates a <strong>synthetic yield</strong> of <strong>kVCM</strong> based on the forward curve.</p></li>
<li><p>Participates in governance for whitelisting carbon assets.</p></li>
</ul></li>
<li><p><strong>Transactional</strong> usage:</p>
<ul>
<li><p><strong>Mint</strong>: New <strong>kVCM</strong> is issued by the Portfolio Manager to purchase new carbon credits for the portfolio.</p></li>
<li><p><strong>Burn</strong>: <strong>kVCM</strong> are retired by the Portfolio Manager to issue carbon offset certificates.</p></li>
</ul></li>
<li><p><strong>Staked</strong> liquidity:</p>
<ul>
<li>Generates a <strong>kVCM</strong> Risk Premium, which is a time-based relative share of the <strong>kVCM</strong> synthetic yield reflecting the risks taken to support the price of platform capital.</li>
</ul></li>
</ul>
<p>Noting that the tokens can delegate utility as required.</p>
<div id="fig-aam-token-utility" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Automated Asset Manager token utility.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-aam-token-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/aam-token-utility.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-aam-token-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Automated Asset Manager token utility.
</figcaption>
</figure>
</div>
</section>
<section id="sec-risk-governance-token-k2" class="level4" data-number="2.5.2">
<h4 data-number="2.5.2" class="anchored" data-anchor-id="sec-risk-governance-token-k2"><span class="header-section-number">2.5.2</span> Risk Governance Token: K2</h4>
<p><strong>K2</strong> is a <u>fixed-supply</u> token issued programmatically over time with a dynamic allocation for <strong>K2</strong> <strong>Incentives</strong>.</p>
<ul>
<li><p>When <strong>user-locked</strong>:</p>
<ul>
<li>Shapes the pricing curve and spread of <strong>kVCM</strong>.</li>
<li>Determines the <strong>kVCM</strong> Risk Premium for staked liquidity providers.</li>
<li>Generates a share of the <strong>kVCM</strong> Risk Premium.</li>
<li>Receives <strong>K2</strong> Incentives.</li>
</ul></li>
<li><p><strong>Staked</strong> Liquidity:</p>
<ul>
<li>Generates a share of the <strong>kVCM</strong> Risk Premium.</li>
<li>Participates in governance.</li>
<li>Receives <strong>K2</strong> Incentives.</li>
</ul></li>
</ul>
</section>
<section id="sec-staking-functions" class="level4" data-number="2.5.3">
<h4 data-number="2.5.3" class="anchored" data-anchor-id="sec-staking-functions"><span class="header-section-number">2.5.3</span> Utility Functions</h4>
<p>The <strong>kVCM</strong> token has <u>two</u> utility functions which are not independent:</p>
<div id="fig-kvcm-staking" class="quarto-float quarto-figure quarto-figure-center anchored" alt="kVCM utility functions.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kvcm-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/kvcm-staking.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kvcm-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: <strong>kVCM</strong> utility functions.
</figcaption>
</figure>
</div>
<ol type="1">
<li><p><strong>Time lock</strong>: The <strong>kVCM</strong> token is locked for a specific period of time representing a liquidity preference for the holder in return for yield (‘<strong>kVCM</strong> base accrual’). This cannot be amended.</p></li>
<li><p><strong>Price allocation</strong>: Collective selection of carbon classes by <strong>kVCM</strong> allocations determines the <strong>instantaneous</strong> price ratio for <strong>kVCM</strong> token issuance. This selection can be amended and withdrawn at any time to allow price modulation for the platform of its carbon assets.</p></li>
</ol>
<p>The <strong>K2</strong> token also has <u>two</u> utility functions:</p>
<ol type="1">
<li><p><strong>User lock</strong>: The <strong>K2</strong> token remains locked for at least 24 hours.</p></li>
<li><p><strong>Risk allocation</strong>: collective selection of carbon classes by <strong>K2</strong> allocations determines the rate of issuance or price curve of <strong>kVCM</strong> for the specified carbon class, as well as the retirement burning rate.</p></li>
</ol>
<p>Both tokens facilitate the carbon market to function efficiently with the <strong>kVCM</strong> token responsible for portfolio selection and pricing, and the <strong>K2</strong> token modulating capacity and risk.</p>
</section>
</section>
<section id="sec-initialisation-of-the-kvcm-token" class="level3 page-columns page-full" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="sec-initialisation-of-the-kvcm-token"><span class="header-section-number">2.6</span> Initialisation of the kVCM Token</h3>
<p>The Klima Protocol has approximately <strong>20 million tonnes</strong> of carbon credits in its treasury as assets, a part of which will be used to create the initial issuance of <strong>kVCM</strong> tokens upon launch of Klima&nbsp;2.0.</p>
<div id="tbl-token-summary" class="column-body-outset quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[10,15,75]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-token-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Token</th>
<th style="text-align: left;">Amount</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>kVCM</strong><br>
<strong>A</strong> Token</td>
<td style="text-align: left;">20 million</td>
<td style="text-align: left;"><ul>
<li>Supply expands and contracts perpetually.</li>
<li>87.5% of initial supply available to existing KLIMA holders.</li>
<li>Initially created approximately on a 1:1 basis with carbon tonnes held.</li>
<li>Issues on carbon received, and burns on barbon retired.</li>
</ul></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>K2</strong><br>
<strong>G</strong> Token</td>
<td style="text-align: left;">100 million</td>
<td style="text-align: left;"><ul>
<li>Fixed supply.</li>
<li>40% put into programmatic issuance as <strong>K2</strong> Incentives yield over time.</li>
<li>40% for existing KLIMA holders.</li>
</ul></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-token-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Token Summary
</figcaption>
</figure>
</div>
</section>
<section id="sec-end-users" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="sec-end-users"><span class="header-section-number">2.7</span> End Users</h3>
<ol type="1">
<li><p><strong>Carbon Credit Sellers</strong></p>
<p>Those wishing to monetise spot- or forward-delivery classes of carbon.</p>
<p><em><strong>Portfolio Manager</strong>: Continuously acquires carbon credits using an autonomous pricing strategy based on carbon class, delivery and token balances, issuing new <strong>kVCM</strong> tokens as consideration to build the carbon portfolio.</em></p></li>
<li><p><strong>Offset Buyers</strong></p>
<p>Those wishing to obtain carbon offset certificates by retiring carbon credits from the portfolio.</p>
<p><em><strong>Portfolio Manager</strong>: Continuously sells carbon offset certificates, by burning <strong>kVCM</strong> tokens and issuing carbon offset certificates by retiring the quantity in the registry.</em></p></li>
<li><p><strong>Investors</strong></p>
<p>Those who wish to own a liquid or yielding locked fixed-maturity financial exposure to a basket of carbon assets.</p>
<p><em><strong>Time-Locked Market</strong>: Provides a daily time-based yield for those time-locking <strong>kVCM</strong> tokens called Base Accrual.</em></p></li>
<li><p><strong>Liquidity Providers</strong></p>
<p>Those who wish to generate liquidity fees on their portfolio of Klima&nbsp;2.0 assets coupled together or with USDC.</p>
<p><em><strong>Liquidity Market</strong>: Staked liquidity providers are incentivised by the <strong>kVCM</strong> Risk Premium calculated from system metrics to compensate them for risk.</em></p></li>
<li><p><strong>Active Portfolio Optimisation</strong></p>
<p><em><strong>K2 and kVCM asset selection</strong>: The incentives and allocations are designed for those who wish to participate in overall risk management to collectively resolve for the optimal portfolio risks.</em></p></li>
</ol>
</section>
<section id="sec-automated-asset-manager-highlights" class="level3" data-number="2.8">
<h3 data-number="2.8" class="anchored" data-anchor-id="sec-automated-asset-manager-highlights"><span class="header-section-number">2.8</span> Automated Asset Manager Highlights</h3>
<ul>
<li><p><strong>Decentralised architecture</strong>:</p>
<p>The Automated Asset Manager is smart-contract based, fully autonomous as to pricing and distribution of its assets with governance power held by risk-based capital.</p></li>
<li><p><strong>Adverse selection</strong>:</p>
<p>The Automated Asset Manager does not permit the direct purchase of carbon credits from its portfolio&nbsp;(only carbon offset certificates).</p></li>
<li><p><strong>Liquid carbon</strong>:</p>
<p>Users with liquid carbon credits can always access carbon offset certificates through the registry, hold the specific carbon credits or sell back to the Automated Asset Manager if required. Secondary markets and utility for liquid carbon credits may emerge over time.</p></li>
<li><p><strong>Implied spreads</strong>:</p>
<p>The Automated Asset Manager purchases carbon at relative discounts based on capacity pricing and forward discount rates folding natural returns into the portfolio capital.</p></li>
<li><p><strong>Dual token structure</strong>:</p>
<p>Whilst the <strong>kVCM</strong> token reflects asset economics, the <strong>K2</strong> token is essential for optimising pricing capacity and in return <strong>maximising risk-adjusted spreads</strong> for the portfolio. Since its earnings power is a function of the <strong>kVCM</strong> token value, its role as this spread optimiser is truly economically aligned and as such fundamental values of <strong>kVCM</strong> and <strong>K2</strong> are highly correlated.</p></li>
</ul>
</section>
</section>
<section id="sec-core-economic-pillars" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="sec-core-economic-pillars"><span class="header-section-number">3</span> Core Economic Pillars</h2>
<p>From this Section, we refer to <strong>kVCM</strong> and <strong>K2</strong> tokens as <strong>A</strong> and <strong>G</strong> respectively.</p>
<p>The three tenets of Klima&nbsp;2.0 enable the model to find equilibrium through continuous dynamic feedback loops and system balances. There is no oversight or centralised management entity with discretionary powers.</p>
<ol type="1">
<li><p><strong>Time-Locked Market</strong>: <strong>A</strong> token holders stake tokens until a set expiry to create floating yield time locks and have the ability to select carbon classes for portfolio weighting.</p>
<ul>
<li><p>The collective temporal staking pattern produces a <strong>Synthetic Yield</strong> curve in <strong>A</strong> tokens to reward time-locked token holders, as well as price the forward curve for the AAM.</p></li>
<li><p>Only <strong>A</strong> tokens participate in the Time-Locked Market.</p></li>
</ul></li>
<li><p><strong>Portfolio Manager</strong>: The Portfolio Manager swaps its own token <strong>A</strong> for carbon credits <strong>C</strong>&nbsp;(in) or carbon offset certificates <strong>C*</strong>&nbsp;(out) to build a portfolio of carbon credits.</p>
<ul>
<li><p>Both <strong>time-locked</strong> <strong>A</strong> and <strong>user-locked</strong> <strong>G</strong> are used in the portfolio manager whereby allocating <strong>A</strong> determines the pricing of any given carbon class, and allocating <strong>G</strong> determines the rate of acquisition&nbsp;(and disposal).</p>
<p><em>Only time-locked <strong>A</strong> tokens can participate in portfolio weighting although it is not mandatory.</em></p></li>
<li><p>Forward-delivery carbon&nbsp;(for a set of fixed dates out to 10 years) is transacted simultaneously with spot liquid carbon.</p></li>
</ul></li>
<li><p><strong>Liquidity Market</strong>: Here the tokens are traded in two core liquidity pairs with various incentives available to staked liquidity providers&nbsp;(<strong>LPs</strong>), including a <strong>Risk Premium</strong> generated by the Time-Locked Market synthetic yield.</p>
<ul>
<li><p><span class="overline"><strong>AG</strong></span>: Native token swap <strong>A</strong> and <strong>G</strong>.</p></li>
<li><p><span class="overline"><strong>AQ</strong></span>: The asset token <strong>A</strong> with USDC <strong>Q</strong>.</p></li>
</ul>
<p>The Liquidity Market provides the complementary facility to the Time-Locked Market and the critical relationship between the native tokens and the hard currency of USDC.</p></li>
</ol>
<p>The Klima&nbsp;2.0 system enables each participant in the various economic pillars to act in the interests of their own capital and utility, which through the harmonic model, enables price discovery, liquidity and stability for carbon trading which creates positive reinforcement cycles as catalysts for growth and scale.</p>
<section id="sec-time-locked-market" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="sec-time-locked-market"><span class="header-section-number">3.1</span> Time-Locked Market</h3>
<p>Holders of <strong>A</strong> can time-lock their token until a maturity from the set of <strong>standard maturities</strong>. Time locks expire every 90 days on a rolling basis. There are always 40 maturities extending out to approximately 10 years.</p>
<ul>
<li><p><strong>Forward curve</strong>: Aggregate time-locking determines the shape of the discount curve of the <strong>A</strong> token with regards to its purchasing rate of forward-delivery carbon.</p></li>
<li><p><strong>Synthetic yield</strong>: Time-locked <strong>A</strong> token holders receive a floating yield of new <strong>A</strong> tokens following the shape of this discount curve called <strong>Base Accrual</strong>. Base Accrual is calculated daily and accumulates to the principal.</p></li>
<li><p><strong>Liquidity</strong>: There is no early unlocking; all principal and accumulated yield is released only at time lock expiration.</p></li>
</ul>
<p><strong>G</strong> tokens are <u>not</u> involved in the Time-Locked Market. The forward curve is agnostic to carbon class although only time-locked <strong>A</strong> token holders can allocate their token to carbon classes for portfolio pricing.</p>
<section id="sec-synthetic-yield-and-forward-delivery-curve" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="sec-synthetic-yield-and-forward-delivery-curve"><span class="header-section-number">3.1.1</span> Synthetic Yield and Forward-Delivery Curve</h4>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">S</span>: Total time-locked <strong>A</strong> tokens expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
<li><p><span class="math inline">S_t</span>: Total <strong>A</strong> tokens time-locked in maturity bucket <span class="math inline">t</span>, expressed as a proportion of the outstanding supply of <strong>A</strong>, where <span class="math inline">{\sum S_t = S}</span>, and <span class="math inline">t</span> is the index of standard maturities <span class="math inline">t \in \{1, 2, 3, \dots, 40\}</span>.</p></li>
<li><p><span class="math inline">E_t</span>: Time to expiry expressed in years.</p></li>
</ul>
<p>Calculating curve parameters <span class="math inline">D</span> and <span class="math inline">C</span>:</p>
<p><span id="eq-curve-parameter-d"><span class="math display">
D = \frac{1}{S} \sum_{t=1}^{40} S_t \, E_t
\tag{1}</span></span></p>
<p><span id="eq-curve-parameter-c"><span class="math display">
C = \frac{1}{S} \sum_{t=1}^{40} S_t \, E_t^2
\tag{2}</span></span></p>
<p>The shape of the synthetic yield curve is produced:</p>
<p><span id="eq-yield-curve-shape"><span class="math display">
\gamma_t = \max \left( \frac{E_t}{D} - \frac{E_t^2}{2 \, C}, \, 0 \right)
\tag{3}</span></span></p>
<p>Normalising <span class="math inline">\gamma_t</span> to <span class="math inline">\hat \gamma_t</span>:</p>
<p><span id="eq-yield-curve-shape-normalised"><span class="math display">
\hat \gamma_t = \frac{\gamma_t}{\sum_{t=1}^{40} \gamma_t}
\tag{4}</span></span></p>
<p>With the cumulative sum of the normalised values expressed as <span class="math inline">\Gamma_t</span>:</p>
<p><span id="eq-yield-curve-shape-normalized-sum"><span class="math display">
\Gamma_t = \sum_{i=1}^t \hat \gamma_i \quad \text{for } t = 1, \dots, 40
\tag{5}</span></span></p>
<p>The zero-coupon yield curve <span class="math inline">Z_t</span> is solved:</p>
<p><span id="eq-yield-curve"><span class="math display">
Z_t = (1 - S) \, \frac{\Gamma_t}{E_t}
\tag{6}</span></span></p>
<p>Whereupon, the discount rate <span class="math inline">B_t</span> that forms the forward-delivery curve is derived:</p>
<p><span id="eq-discount-rate"><span class="math display">
B_t = \exp(-Z_t \, E_t)
\tag{7}</span></span></p>
<p>The yield due on time-locked <strong>A</strong> tokens is calculated daily and added to the staked principal, hence the daily yield for each time bucket is calculated:</p>
<p><span id="eq-daily-yield"><span class="math display">
Y_t = \exp \left( \frac{Z_t}{365} \right) - 1
\tag{8}</span></span></p>
<p>Hence, any time-locked <strong>A</strong> stake <span class="math inline">S_t</span> will increase by <span class="math inline">\Delta S_t</span>:</p>
<p><span id="eq-base-accrual"><span class="math display">
\Delta S_t = S_t \, Y_t
\tag{9}</span></span></p>
<p>With the total <strong>A</strong> tokens created on a daily basis for time-locked inflation as</p>
<p><span id="eq-inflation"><span class="math display">
R = \sum_{t=1}^{40} \Delta S_t
\tag{10}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="627" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 626;"><span id="cb1-627"><a href="#cb1-627" aria-hidden="true" tabindex="-1"></a>viewof inputS <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-4</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb1-628"><a href="#cb1-628" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Time-Locked } S`</span><span class="op">,</span></span>
<span id="cb1-629"><a href="#cb1-629" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-4</span><span class="op">,</span></span>
<span id="cb1-630"><a href="#cb1-630" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.55</span><span class="op">,</span></span>
<span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a>viewof inputD <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.25</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {</span>
<span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Parameter } D`</span><span class="op">,</span></span>
<span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">4.69</span><span class="op">,</span></span>
<span id="cb1-636"><a href="#cb1-636" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-time-locked-market-state" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-time-locked-market-state-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="647" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 646;"><span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">constAreaLinear</span>(range<span class="op">,</span> area<span class="op">,</span> inputSlope<span class="op">,</span> slopeFactor <span class="op">=</span> <span class="fl">0.007</span>) {</span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (range<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [area]<span class="op">;</span></span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y2 <span class="op">=</span> range<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> slope <span class="op">=</span> slopeFactor <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atanh</span>(inputSlope)<span class="op">;</span></span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> intercept <span class="op">=</span> area <span class="op">/</span> range<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(slope) <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">*</span> intercept <span class="op">/</span> (y2 <span class="op">-</span> y1 <span class="op">-</span> <span class="dv">1</span>)) {</span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yExactShift <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="dv">2</span> <span class="op">*</span> area <span class="op">/</span> slope))<span class="op">;</span></span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yRoundShift <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(yExactShift))<span class="op">;</span></span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (slope <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>      y1 <span class="op">=</span> y2 <span class="op">-</span> yRoundShift<span class="op">;</span></span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>      y2 <span class="op">=</span> y1 <span class="op">+</span> yRoundShift<span class="op">;</span></span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a>    slope <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(slope) <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> area <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>((y2 <span class="op">-</span> y1)<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>    intercept <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(slope) <span class="op">*</span> (y2 <span class="op">-</span> y1 <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yConstArea <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> range<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> i <span class="op">-</span> (y1 <span class="op">+</span> y2) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a>    yConstArea<span class="op">.</span><span class="fu">push</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> slope <span class="op">*</span> y <span class="op">+</span> intercept))<span class="op">;</span></span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> yConstArea<span class="op">;</span></span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="681" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 680;"><span id="cb3-681"><a href="#cb3-681" aria-hidden="true" tabindex="-1"></a>vecE <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.1</span><span class="op">,</span> <span class="fl">0.25</span>)<span class="op">;</span></span>
<span id="cb3-682"><a href="#cb3-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-683"><a href="#cb3-683" aria-hidden="true" tabindex="-1"></a>scaleE <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(d3<span class="op">.</span><span class="fu">extent</span>(vecE)<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb3-684"><a href="#cb3-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-685"><a href="#cb3-685" aria-hidden="true" tabindex="-1"></a>vecS <span class="op">=</span> <span class="fu">constAreaLinear</span>(vecE<span class="op">,</span> <span class="fl">0.55</span><span class="op">,</span> <span class="fu">scaleE</span>(inputD))<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb3-686"><a href="#cb3-686" aria-hidden="true" tabindex="-1"></a>  x <span class="kw">=&gt;</span> x <span class="op">*</span> inputS <span class="op">/</span> <span class="fl">0.55</span><span class="op">,</span></span>
<span id="cb3-687"><a href="#cb3-687" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb3-688"><a href="#cb3-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-689"><a href="#cb3-689" aria-hidden="true" tabindex="-1"></a>vecReverseCumsumS <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecS<span class="op">.</span><span class="fu">slice</span>()<span class="op">.</span><span class="fu">reverse</span>())<span class="op">.</span><span class="fu">reverse</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="693" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 692;"><span id="cb4-693"><a href="#cb4-693" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dotProduct</span>(v<span class="op">,</span> w) {</span>
<span id="cb4-694"><a href="#cb4-694" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (v<span class="op">.</span><span class="at">length</span> <span class="op">!==</span> w<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb4-695"><a href="#cb4-695" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"Vectors must have the same length"</span>)<span class="op">;</span></span>
<span id="cb4-696"><a href="#cb4-696" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-697"><a href="#cb4-697" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> val<span class="op">,</span> i) <span class="kw">=&gt;</span> acc <span class="op">+</span> val <span class="op">*</span> w[i]<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb4-698"><a href="#cb4-698" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-699"><a href="#cb4-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-700"><a href="#cb4-700" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">weightedArithmeticMean</span>(v<span class="op">,</span> weights) {</span>
<span id="cb4-701"><a href="#cb4-701" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">dotProduct</span>(v<span class="op">,</span> weights) <span class="op">/</span> d3<span class="op">.</span><span class="fu">sum</span>(weights)<span class="op">;</span></span>
<span id="cb4-702"><a href="#cb4-702" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="705" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 704;"><span id="cb5-705"><a href="#cb5-705" aria-hidden="true" tabindex="-1"></a>paramD <span class="op">=</span> <span class="fu">weightedArithmeticMean</span>(vecE<span class="op">,</span> vecS)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="709" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 708;"><span id="cb6-709"><a href="#cb6-709" aria-hidden="true" tabindex="-1"></a>paramC <span class="op">=</span> <span class="fu">weightedArithmeticMean</span>(vecE<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> e <span class="op">*</span> e)<span class="op">,</span> vecS)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="713" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 712;"><span id="cb7-713"><a href="#cb7-713" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeGamma</span>(vecE<span class="op">,</span> paramD<span class="op">,</span> paramC) {</span>
<span id="cb7-714"><a href="#cb7-714" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> twoC <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> paramC<span class="op">;</span></span>
<span id="cb7-715"><a href="#cb7-715" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecE<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> e<span class="op">/</span>paramD <span class="op">-</span> e<span class="op">*</span>e<span class="op">/</span>twoC))<span class="op">;</span></span>
<span id="cb7-716"><a href="#cb7-716" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="720" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 719;"><span id="cb8-720"><a href="#cb8-720" aria-hidden="true" tabindex="-1"></a>vecGamma <span class="op">=</span> <span class="fu">computeGamma</span>(vecE<span class="op">,</span> paramD<span class="op">,</span> paramC)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="724" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 723;"><span id="cb9-724"><a href="#cb9-724" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">normalize</span>(v) {</span>
<span id="cb9-725"><a href="#cb9-725" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sum <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(v)<span class="op">;</span></span>
<span id="cb9-726"><a href="#cb9-726" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">.</span><span class="fu">map</span>(val <span class="kw">=&gt;</span> val <span class="op">/</span> sum)<span class="op">;</span></span>
<span id="cb9-727"><a href="#cb9-727" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="731" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 730;"><span id="cb10-731"><a href="#cb10-731" aria-hidden="true" tabindex="-1"></a>vecNormGamma <span class="op">=</span> <span class="fu">normalize</span>(vecGamma)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="735" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 734;"><span id="cb11-735"><a href="#cb11-735" aria-hidden="true" tabindex="-1"></a>vecCumSumGamma <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecNormGamma)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="739" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 738;"><span id="cb12-739"><a href="#cb12-739" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeZ</span>(paramS<span class="op">,</span> vecCumSumGamma<span class="op">,</span> vecE) {</span>
<span id="cb12-740"><a href="#cb12-740" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecCumSumGamma<span class="op">.</span><span class="fu">map</span>((g<span class="op">,</span> t) <span class="kw">=&gt;</span> (<span class="dv">1</span> <span class="op">-</span> paramS) <span class="op">*</span> g <span class="op">/</span> vecE[t])<span class="op">;</span></span>
<span id="cb12-741"><a href="#cb12-741" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="745" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 744;"><span id="cb13-745"><a href="#cb13-745" aria-hidden="true" tabindex="-1"></a>vecZ <span class="op">=</span> <span class="fu">computeZ</span>(inputS<span class="op">,</span> vecCumSumGamma<span class="op">,</span> vecE)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="749" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 748;"><span id="cb14-749"><a href="#cb14-749" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeB</span>(vecZ<span class="op">,</span> vecE) {</span>
<span id="cb14-750"><a href="#cb14-750" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecZ<span class="op">.</span><span class="fu">map</span>((z<span class="op">,</span> t) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>z <span class="op">*</span> vecE[t]))<span class="op">;</span></span>
<span id="cb14-751"><a href="#cb14-751" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="755" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 754;"><span id="cb15-755"><a href="#cb15-755" aria-hidden="true" tabindex="-1"></a>vecB <span class="op">=</span> <span class="fu">computeB</span>(vecZ<span class="op">,</span> vecE)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="759" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 758;"><span id="cb16-759"><a href="#cb16-759" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeY</span>(vecZ) {</span>
<span id="cb16-760"><a href="#cb16-760" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecZ<span class="op">.</span><span class="fu">map</span>(z <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>(z))<span class="op">;</span></span>
<span id="cb16-761"><a href="#cb16-761" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="765" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 764;"><span id="cb17-765"><a href="#cb17-765" aria-hidden="true" tabindex="-1"></a>vecY <span class="op">=</span> <span class="fu">computeY</span>(vecZ)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="769" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 768;"><span id="cb18-769"><a href="#cb18-769" aria-hidden="true" tabindex="-1"></a>paramI <span class="op">=</span> <span class="fu">dotProduct</span>(vecS<span class="op">,</span> vecY)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="774" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 773;"><span id="cb19-774"><a href="#cb19-774" aria-hidden="true" tabindex="-1"></a>yieldData <span class="op">=</span> {</span>
<span id="cb19-775"><a href="#cb19-775" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> yieldData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb19-776"><a href="#cb19-776" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb19-777"><a href="#cb19-777" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-778"><a href="#cb19-778" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Stake A"</span><span class="op">,</span></span>
<span id="cb19-779"><a href="#cb19-779" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecS<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb19-780"><a href="#cb19-780" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-781"><a href="#cb19-781" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-782"><a href="#cb19-782" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-783"><a href="#cb19-783" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Yield Term Structure"</span><span class="op">,</span></span>
<span id="cb19-784"><a href="#cb19-784" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecZ[t]<span class="op">,</span></span>
<span id="cb19-785"><a href="#cb19-785" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-786"><a href="#cb19-786" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-787"><a href="#cb19-787" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-788"><a href="#cb19-788" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Real Yield"</span><span class="op">,</span></span>
<span id="cb19-789"><a href="#cb19-789" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> (vecZ[t] <span class="op">-</span> paramI)<span class="op">,</span></span>
<span id="cb19-790"><a href="#cb19-790" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-791"><a href="#cb19-791" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-792"><a href="#cb19-792" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-793"><a href="#cb19-793" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb19-794"><a href="#cb19-794" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb19-795"><a href="#cb19-795" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-796"><a href="#cb19-796" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-797"><a href="#cb19-797" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-798"><a href="#cb19-798" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Cumulative Stake A"</span><span class="op">,</span></span>
<span id="cb19-799"><a href="#cb19-799" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecReverseCumsumS[t <span class="op">-</span> <span class="dv">3</span>]<span class="op">,</span></span>
<span id="cb19-800"><a href="#cb19-800" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-801"><a href="#cb19-801" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-802"><a href="#cb19-802" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb19-803"><a href="#cb19-803" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> yieldData<span class="op">;</span></span>
<span id="cb19-804"><a href="#cb19-804" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb19-805"><a href="#cb19-805" aria-hidden="true" tabindex="-1"></a>getStake <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Stake A"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-806"><a href="#cb19-806" aria-hidden="true" tabindex="-1"></a>getYieldTerm <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Yield Term Structure"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-807"><a href="#cb19-807" aria-hidden="true" tabindex="-1"></a>getRealYield <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Real Yield"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-808"><a href="#cb19-808" aria-hidden="true" tabindex="-1"></a>getDiscount <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Discount Curve"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-809"><a href="#cb19-809" aria-hidden="true" tabindex="-1"></a>getCumStake <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Cumulative Stake A"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-810"><a href="#cb19-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-811"><a href="#cb19-811" aria-hidden="true" tabindex="-1"></a>stringS <span class="op">=</span> <span class="st">"Total Stake = "</span> <span class="op">+</span> inputS<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-812"><a href="#cb19-812" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-813"><a href="#cb19-813" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-814"><a href="#cb19-814" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb19-815"><a href="#cb19-815" aria-hidden="true" tabindex="-1"></a>stringI <span class="op">=</span> <span class="st">"Inflation = "</span> <span class="op">+</span> paramI<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-816"><a href="#cb19-816" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-817"><a href="#cb19-817" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-818"><a href="#cb19-818" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb19-819"><a href="#cb19-819" aria-hidden="true" tabindex="-1"></a>stringD <span class="op">=</span> <span class="vs">`D = </span><span class="sc">${</span>paramD<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-820"><a href="#cb19-820" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-821"><a href="#cb19-821" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-822"><a href="#cb19-822" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> years`</span><span class="op">;</span></span>
<span id="cb19-823"><a href="#cb19-823" aria-hidden="true" tabindex="-1"></a>stringC <span class="op">=</span> <span class="vs">`√C = </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(paramC)<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-824"><a href="#cb19-824" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-825"><a href="#cb19-825" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-826"><a href="#cb19-826" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> years`</span><span class="op">;</span></span>
<span id="cb19-827"><a href="#cb19-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-828"><a href="#cb19-828" aria-hidden="true" tabindex="-1"></a>yieldParams <span class="op">=</span> [</span>
<span id="cb19-829"><a href="#cb19-829" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringD<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> paramD }<span class="op">,</span></span>
<span id="cb19-830"><a href="#cb19-830" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringC<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(paramC) }<span class="op">,</span></span>
<span id="cb19-831"><a href="#cb19-831" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="835" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 834;"><span id="cb20-835"><a href="#cb20-835" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb20-836"><a href="#cb20-836" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb20-837"><a href="#cb20-837" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-838"><a href="#cb20-838" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span></span>
<span id="cb20-839"><a href="#cb20-839" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Stake A"</span><span class="op">,</span> <span class="st">"Yield Term Structure"</span><span class="op">,</span> <span class="st">"Real Yield"</span><span class="op">,</span> stringD<span class="op">,</span> stringC]<span class="op">,</span></span>
<span id="cb20-840"><a href="#cb20-840" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-841"><a href="#cb20-841" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb20-842"><a href="#cb20-842" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">,</span></span>
<span id="cb20-843"><a href="#cb20-843" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.45</span>]<span class="op">,</span></span>
<span id="cb20-844"><a href="#cb20-844" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span><span class="op">,</span></span>
<span id="cb20-845"><a href="#cb20-845" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-846"><a href="#cb20-846" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb20-847"><a href="#cb20-847" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb20-848"><a href="#cb20-848" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span></span>
<span id="cb20-849"><a href="#cb20-849" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(yieldData<span class="op">,</span> getStake)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(yieldData<span class="op">,</span> getYieldTerm))<span class="op">,</span></span>
<span id="cb20-850"><a href="#cb20-850" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb20-851"><a href="#cb20-851" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-852"><a href="#cb20-852" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-853"><a href="#cb20-853" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb20-854"><a href="#cb20-854" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb20-855"><a href="#cb20-855" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb20-856"><a href="#cb20-856" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-857"><a href="#cb20-857" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb20-858"><a href="#cb20-858" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb20-859"><a href="#cb20-859" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake A by Maturity (%)"</span> })<span class="op">,</span></span>
<span id="cb20-860"><a href="#cb20-860" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Yield Rates (%)"</span> })<span class="op">,</span></span>
<span id="cb20-861"><a href="#cb20-861" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(yieldData<span class="op">,</span> {</span>
<span id="cb20-862"><a href="#cb20-862" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb20-863"><a href="#cb20-863" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb20-864"><a href="#cb20-864" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getStake<span class="op">,</span></span>
<span id="cb20-865"><a href="#cb20-865" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb20-866"><a href="#cb20-866" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-867"><a href="#cb20-867" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(yieldParams<span class="op">,</span> {</span>
<span id="cb20-868"><a href="#cb20-868" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span></span>
<span id="cb20-869"><a href="#cb20-869" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb20-870"><a href="#cb20-870" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb20-871"><a href="#cb20-871" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb20-872"><a href="#cb20-872" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-873"><a href="#cb20-873" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getYieldTerm<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-874"><a href="#cb20-874" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getYieldTerm<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-875"><a href="#cb20-875" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getRealYield<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-876"><a href="#cb20-876" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getRealYield<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-877"><a href="#cb20-877" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb20-878"><a href="#cb20-878" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-20" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-20" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Yield <span>(<span id="ojs-element-id-1"></span>,</span> <span><span id="ojs-element-id-2"></span>).</span>
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="883" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 882;"><span id="cb21-883"><a href="#cb21-883" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb21-884"><a href="#cb21-884" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb21-885"><a href="#cb21-885" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-886"><a href="#cb21-886" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">8</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb21-887"><a href="#cb21-887" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Cumulative Stake A"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringD<span class="op">,</span> stringC]<span class="op">,</span></span>
<span id="cb21-888"><a href="#cb21-888" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-889"><a href="#cb21-889" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb21-890"><a href="#cb21-890" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">,</span></span>
<span id="cb21-891"><a href="#cb21-891" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.45</span>]<span class="op">,</span></span>
<span id="cb21-892"><a href="#cb21-892" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span></span>
<span id="cb21-893"><a href="#cb21-893" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-894"><a href="#cb21-894" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb21-895"><a href="#cb21-895" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-896"><a href="#cb21-896" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb21-897"><a href="#cb21-897" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb21-898"><a href="#cb21-898" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb21-899"><a href="#cb21-899" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb21-900"><a href="#cb21-900" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb21-901"><a href="#cb21-901" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Cumulative Stake (%)"</span> })<span class="op">,</span></span>
<span id="cb21-902"><a href="#cb21-902" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb21-903"><a href="#cb21-903" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(yieldData<span class="op">,</span> {</span>
<span id="cb21-904"><a href="#cb21-904" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb21-905"><a href="#cb21-905" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb21-906"><a href="#cb21-906" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCumStake<span class="op">,</span></span>
<span id="cb21-907"><a href="#cb21-907" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb21-908"><a href="#cb21-908" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb21-909"><a href="#cb21-909" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(yieldParams<span class="op">,</span> {</span>
<span id="cb21-910"><a href="#cb21-910" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span></span>
<span id="cb21-911"><a href="#cb21-911" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb21-912"><a href="#cb21-912" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb21-913"><a href="#cb21-913" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb21-914"><a href="#cb21-914" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb21-915"><a href="#cb21-915" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb21-916"><a href="#cb21-916" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb21-917"><a href="#cb21-917" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb21-918"><a href="#cb21-918" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-21" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-21" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Discount rate.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-time-locked-market-state-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Example of a Time-Locked Market state.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>For visualising the sensitivity of overall <strong>A</strong> inflation rates with respect to staking and duration, <a href="#fig-inflation-rate" class="quarto-xref">Figure&nbsp;5</a> assumes a single maturity over the staking range to provide an approximation of inflation <span class="math inline">\Delta S \approx Z \, S</span>.</p>
<div id="fig-inflation-rate" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A inflation rate from time-locked token yields Delta S.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-inflation-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="947" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 946;"><span id="cb22-947"><a href="#cb22-947" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">contrastingTextColor</span>(backgroundColor) {</span>
<span id="cb22-948"><a href="#cb22-948" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d3<span class="op">.</span><span class="fu">hsl</span>(backgroundColor)<span class="op">.</span><span class="at">l</span> <span class="op">&lt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb22-949"><a href="#cb22-949" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"white"</span><span class="op">;</span></span>
<span id="cb22-950"><a href="#cb22-950" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-951"><a href="#cb22-951" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb22-952"><a href="#cb22-952" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-953"><a href="#cb22-953" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="957" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 956;"><span id="cb23-957"><a href="#cb23-957" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeApproxDeltaA</span>(paramS<span class="op">,</span> paramE) {</span>
<span id="cb23-958"><a href="#cb23-958" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> paramS <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> paramS) <span class="op">/</span> paramE<span class="op">;</span></span>
<span id="cb23-959"><a href="#cb23-959" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="963" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 962;"><span id="cb24-963"><a href="#cb24-963" aria-hidden="true" tabindex="-1"></a>inflationData <span class="op">=</span> {</span>
<span id="cb24-964"><a href="#cb24-964" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inflationData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb24-965"><a href="#cb24-965" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramS <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramS <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramS <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb24-966"><a href="#cb24-966" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramE <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> paramE <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">;</span> paramE<span class="op">++</span>) {</span>
<span id="cb24-967"><a href="#cb24-967" aria-hidden="true" tabindex="-1"></a>      inflationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb24-968"><a href="#cb24-968" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb24-969"><a href="#cb24-969" aria-hidden="true" tabindex="-1"></a>        <span class="dt">e</span><span class="op">:</span> paramE<span class="op">,</span></span>
<span id="cb24-970"><a href="#cb24-970" aria-hidden="true" tabindex="-1"></a>        <span class="dt">s</span><span class="op">:</span> paramS<span class="op">,</span></span>
<span id="cb24-971"><a href="#cb24-971" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeApproxDeltaA</span>(paramS<span class="op">,</span> paramE)<span class="op">,</span></span>
<span id="cb24-972"><a href="#cb24-972" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb24-973"><a href="#cb24-973" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-974"><a href="#cb24-974" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-975"><a href="#cb24-975" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> inflationData<span class="op">;</span></span>
<span id="cb24-976"><a href="#cb24-976" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="980" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 979;"><span id="cb25-980"><a href="#cb25-980" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb25-981"><a href="#cb25-981" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"ΔS"</span> }<span class="op">,</span></span>
<span id="cb25-982"><a href="#cb25-982" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="fl">10.1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">10.5</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Expiry Time E"</span> }<span class="op">,</span></span>
<span id="cb25-983"><a href="#cb25-983" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Staking S"</span> }<span class="op">,</span></span>
<span id="cb25-984"><a href="#cb25-984" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb25-985"><a href="#cb25-985" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb25-986"><a href="#cb25-986" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(inflationData<span class="op">,</span> {</span>
<span id="cb25-987"><a href="#cb25-987" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">e</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-988"><a href="#cb25-988" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">e</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-989"><a href="#cb25-989" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb25-990"><a href="#cb25-990" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb25-991"><a href="#cb25-991" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb25-992"><a href="#cb25-992" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-993"><a href="#cb25-993" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(inflationData<span class="op">,</span> {</span>
<span id="cb25-994"><a href="#cb25-994" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"e"</span><span class="op">,</span></span>
<span id="cb25-995"><a href="#cb25-995" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"s"</span><span class="op">,</span></span>
<span id="cb25-996"><a href="#cb25-996" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb25-997"><a href="#cb25-997" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb25-998"><a href="#cb25-998" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb25-999"><a href="#cb25-999" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb25-1000"><a href="#cb25-1000" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb25-1001"><a href="#cb25-1001" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb25-1002"><a href="#cb25-1002" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeApproxDeltaA</span>(<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span></span>
<span id="cb25-1003"><a href="#cb25-1003" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb25-1004"><a href="#cb25-1004" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb25-1005"><a href="#cb25-1005" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb25-1006"><a href="#cb25-1006" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-1007"><a href="#cb25-1007" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb25-1008"><a href="#cb25-1008" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-25" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inflation-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: <strong>A</strong> inflation rate from time-locked token yields <span class="math inline">\Delta S</span>.
</figcaption>
</figure>
</div>
</section>
<section id="sec-governance-weightings" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="sec-governance-weightings"><span class="header-section-number">3.1.2</span> Governance Weightings</h4>
<p>Governance rights, for example the whitelisting&nbsp;(and blacklisting) of carbon classes, and any other matter requiring token stakeholder voting, are allocated to two cohorts:</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong> tokens: <span class="math inline">S_t</span></p></li>
<li><p>Staked liquidity in the <strong>A</strong>-<strong>G</strong> pair <span class="overline"><strong>AG</strong></span>&nbsp;(see <a href="#sec-liquidity-markets" class="quarto-xref">Section&nbsp;3.3</a>), defined here as <span class="math inline">A_{Gt}</span>, representing the quantity of <strong>A</strong> tokens held in the liquidity pool expressed as a proportion of circulating supply.</p></li>
</ol>
<p>Voting power is allocated by time and applied to the respective balance of <strong>A</strong>:</p>
<ol type="1">
<li><p>Initial voting weights for time-locked <strong>A</strong> tokens <span class="math inline">v_t</span>:</p>
<p><span id="eq-voting-weights-time-locks-initial"><span class="math display">
v_t = Z_t \, S_t
  \tag{11}</span></span></p></li>
<li><p>Initial voting weights for staked liquidity <span class="math inline">w_t</span>:</p>
<p><span id="eq-voting-weights-lps-initial"><span class="math display">
w_t = Z_t \, A_{Gt}
  \tag{12}</span></span></p></li>
<li><p>Final voting weights for time-locked <strong>A</strong> tokens <span class="math inline">V_t</span>:</p>
<p><span id="eq-voting-weights-time-locks"><span class="math display">
V_t = \frac{v_t}{\sum_{j=1}^{40} (v_j + 2 w_j)}
  \tag{13}</span></span></p></li>
<li><p>Final voting weights for staked liquidity <span class="math inline">W_t</span>:</p>
<p><span id="eq-voting-weights-lps"><span class="math display">
W_t = \frac{w_t}{\sum_{j=1}^{40} \left( \frac 1 2 v_j + w_j \right)}
  \tag{14}</span></span></p></li>
</ol>
</section>
</section>
<section id="sec-portfolio-manager-detailed" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="sec-portfolio-manager-detailed"><span class="header-section-number">3.2</span> Portfolio Manager</h3>
<p>The Portfolio Manager’s role of swapping <strong>A</strong> for carbon is managed through a set of smart contracts driven by allocation choices from the token system, the balances of assets held, and the discount rates generated by the Time-Locked Market.</p>
<p>The combined allocations of <strong>A</strong> and <strong>G</strong> tokens creates a dynamic pricing matrix by carbon class and by time, enabling spot and forward trading of carbon.</p>
<div id="fig-portfolio-manager-detailed" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 Portfolio Manager.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-portfolio-manager-detailed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/portfolio-manager-detailed.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-portfolio-manager-detailed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Klima&nbsp;2.0 Portfolio Manager.
</figcaption>
</figure>
</div>
<section id="sec-purchase-carbon" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="sec-purchase-carbon"><span class="header-section-number">3.2.1</span> Purchase Carbon</h4>
<p><em>User swaps carbon credits for <strong>A</strong> tokens.</em></p>
<section id="sec-existing-carbon-in-the-portfolio" class="level5" data-number="3.2.1.1">
<h5 data-number="3.2.1.1" class="anchored" data-anchor-id="sec-existing-carbon-in-the-portfolio"><span class="header-section-number">3.2.1.1</span> Existing Carbon in the Portfolio</h5>
<p>Carbon classes <span class="math inline">{i \in \{1, 2, 3, \dots, n\}}</span> are whitelisted through governance by time-locked <strong>A</strong> token and staked <span class="overline"><strong>AG</strong></span> liquidity providers&nbsp;(see <a href="#sec-governance-weightings" class="quarto-xref">Section&nbsp;3.1.2</a>).</p>
<p>For carbon pricing, both <strong>A</strong> tokens and <strong>G</strong> tokens may be allocated to specific carbon classes <span class="math inline">i</span> and these are independent allocations between the two-token systems.</p>
<div id="fig-token-staking-class-structure" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token staking class structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-staking-class-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-staking-class-structure.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-staking-class-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Token staking class structure.
</figcaption>
</figure>
</div>
<p>For a carbon class quantity to be sold to the Automated Asset Manager, it must have a strictly positive quantity of <strong>A</strong> tokens allocated to that carbon class, otherwise there is no price, and the carbon cannot be sold.</p>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">C_i</span>: Total tonnes of carbon class <span class="math inline">i</span> currently held in the portfolio.</p></li>
<li><p><span class="math inline">A_i</span>: <strong>A</strong> tokens allocated to carbon class <span class="math inline">i</span> expressed as a proportion of the outstanding supply of <strong>A</strong> tokens, where <span class="math inline">{\sum A_i = A}</span>.</p></li>
<li><p><span class="math inline">G_i</span>: <strong>G</strong> tokens allocated to carbon class <span class="math inline">i</span> expressed as a proportion of the outstanding supply of <strong>G</strong> Tokens.</p></li>
<li><p><span class="math inline">C_{it}</span>: The quantity of carbon class <span class="math inline">i</span> held in the Automated Asset Manager deliverable per maturity <span class="math inline">t</span> where <span class="math inline">C_{i0}</span> reflects the liquid quantity.</p></li>
</ul>
<p>In order to determine the present-value quantity of carbon, <span class="math inline">\bar C_i</span>, we apply the discount curve from <a href="#eq-discount-rate" class="quarto-xref">Equation&nbsp;7</a> to the liquidity schedule and sum the discounted holdings:</p>
<p><span id="eq-present-value-carbon"><span class="math display">
\bar C_i = C_{i0} + \sum_{t=1}^{40} B_t \, C_{it}
\tag{15}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="1144" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1143;"><span id="cb26-1144"><a href="#cb26-1144" aria-hidden="true" tabindex="-1"></a>viewof inputCi0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb26-1145"><a href="#cb26-1145" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } C_{i0}`</span><span class="op">,</span></span>
<span id="cb26-1146"><a href="#cb26-1146" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb26-1147"><a href="#cb26-1147" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb26-1148"><a href="#cb26-1148" aria-hidden="true" tabindex="-1"></a>viewof inputLiqShape <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb26-1149"><a href="#cb26-1149" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Schedule shape}`</span><span class="op">,</span></span>
<span id="cb26-1150"><a href="#cb26-1150" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb26-1151"><a href="#cb26-1151" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-26-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-26-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-held-in-the-aam" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon held in the portfolio.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-held-in-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="1163" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1162;"><span id="cb27-1163"><a href="#cb27-1163" aria-hidden="true" tabindex="-1"></a>vecCi <span class="op">=</span> <span class="fu">constAreaLinear</span>(vecE<span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> inputCi0<span class="op">,</span> inputLiqShape<span class="op">,</span> <span class="fl">0.01</span>)<span class="op">;</span></span>
<span id="cb27-1164"><a href="#cb27-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1165"><a href="#cb27-1165" aria-hidden="true" tabindex="-1"></a>paramBarCi <span class="op">=</span> inputCi0 <span class="op">+</span> <span class="fu">dotProduct</span>(vecB<span class="op">,</span> vecCi)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-27-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-27-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="1169" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1168;"><span id="cb28-1169"><a href="#cb28-1169" aria-hidden="true" tabindex="-1"></a>carbonHeldData <span class="op">=</span> {</span>
<span id="cb28-1170"><a href="#cb28-1170" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> carbonHeldData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb28-1171"><a href="#cb28-1171" aria-hidden="true" tabindex="-1"></a>  carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1172"><a href="#cb28-1172" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"Liquidity Schedule"</span><span class="op">,</span></span>
<span id="cb28-1173"><a href="#cb28-1173" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> inputCi0<span class="op">,</span></span>
<span id="cb28-1174"><a href="#cb28-1174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb28-1175"><a href="#cb28-1175" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb28-1176"><a href="#cb28-1176" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb28-1177"><a href="#cb28-1177" aria-hidden="true" tabindex="-1"></a>    carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1178"><a href="#cb28-1178" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Liquidity Schedule"</span><span class="op">,</span></span>
<span id="cb28-1179"><a href="#cb28-1179" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecCi<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb28-1180"><a href="#cb28-1180" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb28-1181"><a href="#cb28-1181" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-1182"><a href="#cb28-1182" aria-hidden="true" tabindex="-1"></a>    carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1183"><a href="#cb28-1183" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb28-1184"><a href="#cb28-1184" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb28-1185"><a href="#cb28-1185" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb28-1186"><a href="#cb28-1186" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-1187"><a href="#cb28-1187" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-1188"><a href="#cb28-1188" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> carbonHeldData<span class="op">;</span></span>
<span id="cb28-1189"><a href="#cb28-1189" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb28-1190"><a href="#cb28-1190" aria-hidden="true" tabindex="-1"></a>getLiqSchedule <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Liquidity Schedule"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb28-1191"><a href="#cb28-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1192"><a href="#cb28-1192" aria-hidden="true" tabindex="-1"></a>stringBarCi <span class="op">=</span> <span class="vs">`Present-Value Carbon C̄ᵢ = </span><span class="sc">${</span>paramBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb28-1193"><a href="#cb28-1193" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb28-1194"><a href="#cb28-1194" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb28-1195"><a href="#cb28-1195" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb28-1196"><a href="#cb28-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1197"><a href="#cb28-1197" aria-hidden="true" tabindex="-1"></a>heldCarbonParam <span class="op">=</span> [{ <span class="dt">key</span><span class="op">:</span> stringBarCi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramBarCi }]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="1200" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1199;"><span id="cb29-1200"><a href="#cb29-1200" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb29-1201"><a href="#cb29-1201" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb29-1202"><a href="#cb29-1202" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1203"><a href="#cb29-1203" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb29-1204"><a href="#cb29-1204" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Liquidity Schedule"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringBarCi]<span class="op">,</span></span>
<span id="cb29-1205"><a href="#cb29-1205" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb29-1206"><a href="#cb29-1206" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb29-1207"><a href="#cb29-1207" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span><span class="op">,</span></span>
<span id="cb29-1208"><a href="#cb29-1208" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb29-1209"><a href="#cb29-1209" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelArrow</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1210"><a href="#cb29-1210" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb29-1211"><a href="#cb29-1211" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb29-1212"><a href="#cb29-1212" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb29-1213"><a href="#cb29-1213" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb29-1214"><a href="#cb29-1214" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb29-1215"><a href="#cb29-1215" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1216"><a href="#cb29-1216" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb29-1217"><a href="#cb29-1217" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb29-1218"><a href="#cb29-1218" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Quantity of Carbon (%)"</span> })<span class="op">,</span></span>
<span id="cb29-1219"><a href="#cb29-1219" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb29-1220"><a href="#cb29-1220" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(carbonHeldData<span class="op">,</span> {</span>
<span id="cb29-1221"><a href="#cb29-1221" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb29-1222"><a href="#cb29-1222" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb29-1223"><a href="#cb29-1223" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLiqSchedule<span class="op">,</span></span>
<span id="cb29-1224"><a href="#cb29-1224" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb29-1225"><a href="#cb29-1225" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-1226"><a href="#cb29-1226" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(heldCarbonParam<span class="op">,</span> {</span>
<span id="cb29-1227"><a href="#cb29-1227" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb29-1228"><a href="#cb29-1228" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb29-1229"><a href="#cb29-1229" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb29-1230"><a href="#cb29-1230" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb29-1231"><a href="#cb29-1231" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-1232"><a href="#cb29-1232" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(carbonHeldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb29-1233"><a href="#cb29-1233" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(carbonHeldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb29-1234"><a href="#cb29-1234" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb29-1235"><a href="#cb29-1235" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-29" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-held-in-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Carbon held in the portfolio.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Similarly, taking <span class="math inline">\Delta C_{it}</span> as the quantity of carbon <span class="math inline">i</span> to be sold with a specific maturity index <span class="math inline">t</span>:</p>
<p><span id="eq-present-value-carbon-change"><span class="math display">
\Delta \bar C_i = \Delta C_{i0} + \sum_{t=1}^{40} B_t \, \Delta C_{it}
\tag{16}</span></span></p>
<p>Once standardised by the discount curve, trades can be aggregated in the same class for the defined trade or auction period.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="1262" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1261;"><span id="cb30-1262"><a href="#cb30-1262" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaCi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb30-1263"><a href="#cb30-1263" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta C_i`</span><span class="op">,</span></span>
<span id="cb30-1264"><a href="#cb30-1264" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb30-1265"><a href="#cb30-1265" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb30-1266"><a href="#cb30-1266" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb30-1267"><a href="#cb30-1267" aria-hidden="true" tabindex="-1"></a>viewof inputEt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {</span>
<span id="cb30-1268"><a href="#cb30-1268" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Expiry } E_t </span><span class="sc">\t</span><span class="vs">ext{ (years)}`</span><span class="op">,</span></span>
<span id="cb30-1269"><a href="#cb30-1269" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb30-1270"><a href="#cb30-1270" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb30-1271"><a href="#cb30-1271" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-30-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-30-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-bought-by-the-aam" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon bought by the Portfolio Manager.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-bought-by-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="1283" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1282;"><span id="cb31-1283"><a href="#cb31-1283" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaCi0</span>(deltaCi<span class="op">,</span> t) {</span>
<span id="cb31-1284"><a href="#cb31-1284" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> deltaCi <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb31-1285"><a href="#cb31-1285" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-1286"><a href="#cb31-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1287"><a href="#cb31-1287" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeVecDeltaCi</span>(deltaCi<span class="op">,</span> t) {</span>
<span id="cb31-1288"><a href="#cb31-1288" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecDeltaCi <span class="op">=</span> <span class="bu">Array</span>(<span class="dv">40</span>)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb31-1289"><a href="#cb31-1289" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="op">!==</span> <span class="dv">0</span>) {</span>
<span id="cb31-1290"><a href="#cb31-1290" aria-hidden="true" tabindex="-1"></a>    vecDeltaCi[t <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> deltaCi<span class="op">;</span></span>
<span id="cb31-1291"><a href="#cb31-1291" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-1292"><a href="#cb31-1292" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecDeltaCi<span class="op">;</span></span>
<span id="cb31-1293"><a href="#cb31-1293" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-31-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-31-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="1297" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1296;"><span id="cb32-1297"><a href="#cb32-1297" aria-hidden="true" tabindex="-1"></a>paramMaturityIdx <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> inputEt<span class="op">;</span></span>
<span id="cb32-1298"><a href="#cb32-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1299"><a href="#cb32-1299" aria-hidden="true" tabindex="-1"></a>paramDeltaCi0 <span class="op">=</span> <span class="fu">computeDeltaCi0</span>(inputDeltaCi<span class="op">,</span> paramMaturityIdx)<span class="op">;</span></span>
<span id="cb32-1300"><a href="#cb32-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1301"><a href="#cb32-1301" aria-hidden="true" tabindex="-1"></a>vecDeltaCi <span class="op">=</span> <span class="fu">computeVecDeltaCi</span>(inputDeltaCi<span class="op">,</span> paramMaturityIdx)<span class="op">;</span></span>
<span id="cb32-1302"><a href="#cb32-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1303"><a href="#cb32-1303" aria-hidden="true" tabindex="-1"></a>paramDeltaBarCi <span class="op">=</span> paramDeltaCi0 <span class="op">+</span> <span class="fu">dotProduct</span>(vecB<span class="op">,</span> vecDeltaCi)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="1307" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1306;"><span id="cb33-1307"><a href="#cb33-1307" aria-hidden="true" tabindex="-1"></a>carbonBuyData <span class="op">=</span> {</span>
<span id="cb33-1308"><a href="#cb33-1308" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> carbonBuyData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb33-1309"><a href="#cb33-1309" aria-hidden="true" tabindex="-1"></a>  carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1310"><a href="#cb33-1310" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"Carbon Bought by AAM"</span><span class="op">,</span></span>
<span id="cb33-1311"><a href="#cb33-1311" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDeltaCi0<span class="op">,</span></span>
<span id="cb33-1312"><a href="#cb33-1312" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb33-1313"><a href="#cb33-1313" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1314"><a href="#cb33-1314" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb33-1315"><a href="#cb33-1315" aria-hidden="true" tabindex="-1"></a>    carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1316"><a href="#cb33-1316" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Carbon Bought by AAM"</span><span class="op">,</span></span>
<span id="cb33-1317"><a href="#cb33-1317" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecDeltaCi<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb33-1318"><a href="#cb33-1318" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb33-1319"><a href="#cb33-1319" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb33-1320"><a href="#cb33-1320" aria-hidden="true" tabindex="-1"></a>    carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1321"><a href="#cb33-1321" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb33-1322"><a href="#cb33-1322" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb33-1323"><a href="#cb33-1323" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb33-1324"><a href="#cb33-1324" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb33-1325"><a href="#cb33-1325" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-1326"><a href="#cb33-1326" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> carbonBuyData<span class="op">;</span></span>
<span id="cb33-1327"><a href="#cb33-1327" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb33-1328"><a href="#cb33-1328" aria-hidden="true" tabindex="-1"></a>getCarbonBought <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Carbon Bought by AAM"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb33-1329"><a href="#cb33-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1330"><a href="#cb33-1330" aria-hidden="true" tabindex="-1"></a>stringDeltaBarCi <span class="op">=</span> <span class="st">"Present-Value Carbon Bought by AAM ΔC̄ᵢ = "</span> <span class="op">+</span></span>
<span id="cb33-1331"><a href="#cb33-1331" aria-hidden="true" tabindex="-1"></a>        paramDeltaBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb33-1332"><a href="#cb33-1332" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb33-1333"><a href="#cb33-1333" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb33-1334"><a href="#cb33-1334" aria-hidden="true" tabindex="-1"></a>            <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span></span>
<span id="cb33-1335"><a href="#cb33-1335" aria-hidden="true" tabindex="-1"></a>            <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb33-1336"><a href="#cb33-1336" aria-hidden="true" tabindex="-1"></a>            <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb33-1337"><a href="#cb33-1337" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb33-1338"><a href="#cb33-1338" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb33-1339"><a href="#cb33-1339" aria-hidden="true" tabindex="-1"></a>boughtCarbonParam <span class="op">=</span> [{ <span class="dt">key</span><span class="op">:</span> stringDeltaBarCi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDeltaBarCi }]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="1342" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1341;"><span id="cb34-1342"><a href="#cb34-1342" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb34-1343"><a href="#cb34-1343" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb34-1344"><a href="#cb34-1344" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1345"><a href="#cb34-1345" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">7</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb34-1346"><a href="#cb34-1346" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Carbon Bought by AAM"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringDeltaBarCi]<span class="op">,</span></span>
<span id="cb34-1347"><a href="#cb34-1347" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1348"><a href="#cb34-1348" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb34-1349"><a href="#cb34-1349" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span><span class="op">,</span></span>
<span id="cb34-1350"><a href="#cb34-1350" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb34-1351"><a href="#cb34-1351" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelArrow</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1352"><a href="#cb34-1352" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1353"><a href="#cb34-1353" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb34-1354"><a href="#cb34-1354" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb34-1355"><a href="#cb34-1355" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb34-1356"><a href="#cb34-1356" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb34-1357"><a href="#cb34-1357" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1358"><a href="#cb34-1358" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb34-1359"><a href="#cb34-1359" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb34-1360"><a href="#cb34-1360" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Quantity of Carbon (%)"</span> })<span class="op">,</span></span>
<span id="cb34-1361"><a href="#cb34-1361" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb34-1362"><a href="#cb34-1362" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(carbonBuyData<span class="op">,</span> {</span>
<span id="cb34-1363"><a href="#cb34-1363" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb34-1364"><a href="#cb34-1364" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb34-1365"><a href="#cb34-1365" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCarbonBought<span class="op">,</span></span>
<span id="cb34-1366"><a href="#cb34-1366" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb34-1367"><a href="#cb34-1367" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-1368"><a href="#cb34-1368" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(boughtCarbonParam<span class="op">,</span> {</span>
<span id="cb34-1369"><a href="#cb34-1369" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb34-1370"><a href="#cb34-1370" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb34-1371"><a href="#cb34-1371" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb34-1372"><a href="#cb34-1372" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-1373"><a href="#cb34-1373" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-1374"><a href="#cb34-1374" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(carbonBuyData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb34-1375"><a href="#cb34-1375" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(carbonBuyData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb34-1376"><a href="#cb34-1376" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb34-1377"><a href="#cb34-1377" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-34" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-bought-by-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Carbon bought by the Portfolio Manager.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Where <span class="math inline">\Delta \bar C_i</span> is expressed as the relative increment to its respective pool balance, the amount of <strong>A</strong> tokens issued to pay for carbon, <span class="math inline">\Delta A</span>, expressed as a proportion of current supply, is determined as:</p>
<p><span id="eq-a-change-intermediary-step"><span class="math display">
\ln(1 + \Delta A) =
  \left( A_i - \frac{A_i^2 \, (1 - G_i)^2}{2} \right) \ln(1 + \Delta \bar C_i)
\tag{17}</span></span></p>
<p>Denoting the expression on the right hand side of <a href="#eq-a-change-intermediary-step" class="quarto-xref">Equation&nbsp;17</a> as <span class="math inline">\mathsf{RHS}</span>:</p>
<p><span id="eq-a-change"><span class="math display">
\Delta A = \exp(\mathsf{RHS}) - 1
\tag{18}</span></span></p>
<p>Finally, <span class="math inline">\Delta A</span> is applied to the outstanding supply of <strong>A</strong> to solve for token quantities.</p>
<p><a href="#fig-a-price-curves" class="quarto-xref">Figure&nbsp;10</a> illustrates the <strong>G</strong> token’s capacity to maintain the initial portfolio pricing of the <strong>A</strong> token. The data has been normalised in <a href="#fig-a-price-curves-normalised" class="quarto-xref">Figure&nbsp;11</a> to <span class="math inline">\Delta \bar C_i \, A_i</span>.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="1416" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1415;"><span id="cb35-1416"><a href="#cb35-1416" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaBarCi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb35-1417"><a href="#cb35-1417" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta </span><span class="sc">\b</span><span class="vs">ar C_i`</span><span class="op">,</span></span>
<span id="cb35-1418"><a href="#cb35-1418" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb35-1419"><a href="#cb35-1419" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb35-1420"><a href="#cb35-1420" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-35" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-a-price-curves" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A price curves.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="1432" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1431;"><span id="cb36-1432"><a href="#cb36-1432" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCi) {</span>
<span id="cb36-1433"><a href="#cb36-1433" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>((Ai <span class="op">-</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>)) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log1p</span>(deltaCi))<span class="op">;</span></span>
<span id="cb36-1434"><a href="#cb36-1434" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="1439" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1438;"><span id="cb37-1439"><a href="#cb37-1439" aria-hidden="true" tabindex="-1"></a>pricingData <span class="op">=</span> {</span>
<span id="cb37-1440"><a href="#cb37-1440" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pricingData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb37-1441"><a href="#cb37-1441" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb37-1442"><a href="#cb37-1442" aria-hidden="true" tabindex="-1"></a>    pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1443"><a href="#cb37-1443" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb37-1444"><a href="#cb37-1444" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb37-1445"><a href="#cb37-1445" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1446"><a href="#cb37-1446" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb37-1447"><a href="#cb37-1447" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb37-1448"><a href="#cb37-1448" aria-hidden="true" tabindex="-1"></a>    pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1449"><a href="#cb37-1449" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb37-1450"><a href="#cb37-1450" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb37-1451"><a href="#cb37-1451" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1452"><a href="#cb37-1452" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb37-1453"><a href="#cb37-1453" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb37-1454"><a href="#cb37-1454" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb37-1455"><a href="#cb37-1455" aria-hidden="true" tabindex="-1"></a>      pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1456"><a href="#cb37-1456" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb37-1457"><a href="#cb37-1457" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb37-1458"><a href="#cb37-1458" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1459"><a href="#cb37-1459" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb37-1460"><a href="#cb37-1460" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb37-1461"><a href="#cb37-1461" aria-hidden="true" tabindex="-1"></a>      pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1462"><a href="#cb37-1462" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb37-1463"><a href="#cb37-1463" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb37-1464"><a href="#cb37-1464" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1465"><a href="#cb37-1465" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCi) <span class="op">/</span></span>
<span id="cb37-1466"><a href="#cb37-1466" aria-hidden="true" tabindex="-1"></a>                (inputDeltaBarCi <span class="op">*</span> paramAi)<span class="op">,</span></span>
<span id="cb37-1467"><a href="#cb37-1467" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb37-1468"><a href="#cb37-1468" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-1469"><a href="#cb37-1469" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-1470"><a href="#cb37-1470" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pricingData<span class="op">;</span></span>
<span id="cb37-1471"><a href="#cb37-1471" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb37-1472"><a href="#cb37-1472" aria-hidden="true" tabindex="-1"></a>getDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"ΔA"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb37-1473"><a href="#cb37-1473" aria-hidden="true" tabindex="-1"></a>getNormDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Normalised ΔA"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb37-1474"><a href="#cb37-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1475"><a href="#cb37-1475" aria-hidden="true" tabindex="-1"></a>stringInputDeltaBarCi <span class="op">=</span> inputDeltaBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb37-1476"><a href="#cb37-1476" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb37-1477"><a href="#cb37-1477" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb37-1478"><a href="#cb37-1478" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="1481" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1480;"><span id="cb38-1481"><a href="#cb38-1481" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb38-1482"><a href="#cb38-1482" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb38-1483"><a href="#cb38-1483" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-1484"><a href="#cb38-1484" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb38-1485"><a href="#cb38-1485" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb38-1486"><a href="#cb38-1486" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`ΔA, where ΔC̄ᵢ = </span><span class="sc">${</span>stringInputDeltaBarCi<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb38-1487"><a href="#cb38-1487" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb38-1488"><a href="#cb38-1488" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb38-1489"><a href="#cb38-1489" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb38-1490"><a href="#cb38-1490" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb38-1491"><a href="#cb38-1491" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb38-1492"><a href="#cb38-1492" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(pricingData<span class="op">,</span> {</span>
<span id="cb38-1493"><a href="#cb38-1493" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1494"><a href="#cb38-1494" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1495"><a href="#cb38-1495" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1496"><a href="#cb38-1496" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1497"><a href="#cb38-1497" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getDeltaA<span class="op">,</span></span>
<span id="cb38-1498"><a href="#cb38-1498" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb38-1499"><a href="#cb38-1499" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(pricingData<span class="op">,</span> {</span>
<span id="cb38-1500"><a href="#cb38-1500" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb38-1501"><a href="#cb38-1501" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb38-1502"><a href="#cb38-1502" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb38-1503"><a href="#cb38-1503" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb38-1504"><a href="#cb38-1504" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb38-1505"><a href="#cb38-1505" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb38-1506"><a href="#cb38-1506" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb38-1507"><a href="#cb38-1507" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb38-1508"><a href="#cb38-1508" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb38-1509"><a href="#cb38-1509" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb38-1510"><a href="#cb38-1510" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb38-1511"><a href="#cb38-1511" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb38-1512"><a href="#cb38-1512" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb38-1513"><a href="#cb38-1513" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb38-1514"><a href="#cb38-1514" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb38-1515"><a href="#cb38-1515" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb38-1516"><a href="#cb38-1516" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb38-1517"><a href="#cb38-1517" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-38" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: <strong>A</strong> price curves (<span class="math inline">\Delta A</span>).
</figcaption>
</figure>
</div>
<div id="fig-a-price-curves-normalised" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Normalised A price curves.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1531" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1530;"><span id="cb39-1531"><a href="#cb39-1531" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb39-1532"><a href="#cb39-1532" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb39-1533"><a href="#cb39-1533" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb39-1534"><a href="#cb39-1534" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb39-1535"><a href="#cb39-1535" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb39-1536"><a href="#cb39-1536" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Normalised ΔA, where ΔC̄ᵢ = </span><span class="sc">${</span>stringInputDeltaBarCi<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb39-1537"><a href="#cb39-1537" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb39-1538"><a href="#cb39-1538" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb39-1539"><a href="#cb39-1539" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb39-1540"><a href="#cb39-1540" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb39-1541"><a href="#cb39-1541" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb39-1542"><a href="#cb39-1542" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(pricingData<span class="op">,</span> {</span>
<span id="cb39-1543"><a href="#cb39-1543" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1544"><a href="#cb39-1544" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1545"><a href="#cb39-1545" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1546"><a href="#cb39-1546" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1547"><a href="#cb39-1547" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getNormDeltaA<span class="op">,</span></span>
<span id="cb39-1548"><a href="#cb39-1548" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb39-1549"><a href="#cb39-1549" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(pricingData<span class="op">,</span> {</span>
<span id="cb39-1550"><a href="#cb39-1550" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb39-1551"><a href="#cb39-1551" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb39-1552"><a href="#cb39-1552" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getNormDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb39-1553"><a href="#cb39-1553" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb39-1554"><a href="#cb39-1554" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb39-1555"><a href="#cb39-1555" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb39-1556"><a href="#cb39-1556" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb39-1557"><a href="#cb39-1557" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb39-1558"><a href="#cb39-1558" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb39-1559"><a href="#cb39-1559" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaBarCi) <span class="op">/</span> inputDeltaBarCi<span class="op">,</span></span>
<span id="cb39-1560"><a href="#cb39-1560" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi) <span class="op">/</span> inputDeltaBarCi<span class="op">,</span></span>
<span id="cb39-1561"><a href="#cb39-1561" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb39-1562"><a href="#cb39-1562" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb39-1563"><a href="#cb39-1563" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb39-1564"><a href="#cb39-1564" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb39-1565"><a href="#cb39-1565" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb39-1566"><a href="#cb39-1566" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb39-1567"><a href="#cb39-1567" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-39" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Normalised <strong>A</strong> price curves.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Noting that the sensitivity to <span class="math inline">G_i</span> increases as <span class="math inline">A_i</span> increases and the effects become more pronounced as <span class="math inline">\Delta \bar C_i</span> increases.</p>
</section>
<section id="sec-zero-carbon-scenario" class="level5" data-number="3.2.1.2">
<h5 data-number="3.2.1.2" class="anchored" data-anchor-id="sec-zero-carbon-scenario"><span class="header-section-number">3.2.1.2</span> Zero Carbon Scenario</h5>
<p>There are circumstances when there is zero carbon held in the portfolio for a particular class, i.e.&nbsp;<span class="math inline">{C_i = 0}</span>, which invalidates the calculation of <span class="math inline">\Delta \bar C_i</span> and a different approach is required.</p>
<p>Taking <span class="math inline">\Delta \bar C_\emptyset</span> as the tonnes of carbon tokens (implying an existing balance of 1 tonne), adjusted for forward discounting, to be sold for any carbon class that has a strictly positive <strong>A</strong> allocation <span class="math inline">A_\emptyset</span>, together with <strong>G</strong> allocation <span class="math inline">G_\emptyset</span>:</p>
<p><span id="eq-a-change-zero-carbon"><span class="math display">
\Delta A =
  \frac{\Delta \bar C_\emptyset}{1 + \Delta \bar C_\emptyset} \,
  \left( A_\emptyset - \frac{A_\emptyset^2 (1 - G_\emptyset)^2}{2} \right)^2
\tag{19}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1603" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1602;"><span id="cb40-1603"><a href="#cb40-1603" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaBarCnull <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-1</span><span class="op">,</span> <span class="fl">1e5</span>]<span class="op">,</span> {</span>
<span id="cb40-1604"><a href="#cb40-1604" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta </span><span class="sc">\b</span><span class="vs">ar C_</span><span class="sc">\e</span><span class="vs">mptyset`</span><span class="op">,</span></span>
<span id="cb40-1605"><a href="#cb40-1605" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-1</span><span class="op">,</span></span>
<span id="cb40-1606"><a href="#cb40-1606" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">1e2</span><span class="op">,</span></span>
<span id="cb40-1607"><a href="#cb40-1607" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb40-1608"><a href="#cb40-1608" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-40" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-a-price-curves-zero-carbon" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A price curves in the zero carbon scenario.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-zero-carbon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1621" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1620;"><span id="cb41-1621"><a href="#cb41-1621" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeZeroCarbonDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCnull) {</span>
<span id="cb41-1622"><a href="#cb41-1622" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (deltaCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> deltaCnull)) <span class="op">*</span> (Ai <span class="op">-</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>))<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb41-1623"><a href="#cb41-1623" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-1624"><a href="#cb41-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1625"><a href="#cb41-1625" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeTrueDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> barCiTonnes<span class="op">,</span> deltaBarCiTonnes) {</span>
<span id="cb41-1626"><a href="#cb41-1626" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (barCiTonnes <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb41-1627"><a href="#cb41-1627" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">computeZeroCarbonDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaBarCiTonnes)<span class="op">;</span></span>
<span id="cb41-1628"><a href="#cb41-1628" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb41-1629"><a href="#cb41-1629" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> deltaBarCi <span class="op">=</span> deltaBarCiTonnes <span class="op">/</span> barCiTonnes<span class="op">;</span></span>
<span id="cb41-1630"><a href="#cb41-1630" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaBarCi)<span class="op">;</span></span>
<span id="cb41-1631"><a href="#cb41-1631" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-1632"><a href="#cb41-1632" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-1633"><a href="#cb41-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1634"><a href="#cb41-1634" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">numberOfDigits</span>(x) {</span>
<span id="cb41-1635"><a href="#cb41-1635" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> (<span class="dv">1</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(x)))<span class="op">;</span></span>
<span id="cb41-1636"><a href="#cb41-1636" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1640" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1639;"><span id="cb42-1640"><a href="#cb42-1640" aria-hidden="true" tabindex="-1"></a>zeroCarbonData <span class="op">=</span> {</span>
<span id="cb42-1641"><a href="#cb42-1641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> zeroCarbonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb42-1642"><a href="#cb42-1642" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb42-1643"><a href="#cb42-1643" aria-hidden="true" tabindex="-1"></a>    zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1644"><a href="#cb42-1644" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb42-1645"><a href="#cb42-1645" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb42-1646"><a href="#cb42-1646" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1647"><a href="#cb42-1647" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb42-1648"><a href="#cb42-1648" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb42-1649"><a href="#cb42-1649" aria-hidden="true" tabindex="-1"></a>    zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1650"><a href="#cb42-1650" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb42-1651"><a href="#cb42-1651" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb42-1652"><a href="#cb42-1652" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1653"><a href="#cb42-1653" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb42-1654"><a href="#cb42-1654" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb42-1655"><a href="#cb42-1655" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb42-1656"><a href="#cb42-1656" aria-hidden="true" tabindex="-1"></a>      zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1657"><a href="#cb42-1657" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb42-1658"><a href="#cb42-1658" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1659"><a href="#cb42-1659" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1660"><a href="#cb42-1660" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeZeroCarbonDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb42-1661"><a href="#cb42-1661" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1662"><a href="#cb42-1662" aria-hidden="true" tabindex="-1"></a>      zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1663"><a href="#cb42-1663" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb42-1664"><a href="#cb42-1664" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1665"><a href="#cb42-1665" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1666"><a href="#cb42-1666" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeZeroCarbonDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb42-1667"><a href="#cb42-1667" aria-hidden="true" tabindex="-1"></a>                ((inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull)) <span class="op">*</span> paramAi<span class="op">**</span><span class="dv">2</span>)<span class="op">,</span></span>
<span id="cb42-1668"><a href="#cb42-1668" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1669"><a href="#cb42-1669" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-1670"><a href="#cb42-1670" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-1671"><a href="#cb42-1671" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> zeroCarbonData<span class="op">;</span></span>
<span id="cb42-1672"><a href="#cb42-1672" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb42-1673"><a href="#cb42-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1674"><a href="#cb42-1674" aria-hidden="true" tabindex="-1"></a>stringDeltaBarCnull <span class="op">=</span> inputDeltaBarCnull<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb42-1675"><a href="#cb42-1675" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb42-1676"><a href="#cb42-1676" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb42-1677"><a href="#cb42-1677" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="fu">numberOfDigits</span>(inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb42-1678"><a href="#cb42-1678" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="fu">numberOfDigits</span>(inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb42-1679"><a href="#cb42-1679" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb42-1680"><a href="#cb42-1680" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1683" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1682;"><span id="cb43-1683"><a href="#cb43-1683" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb43-1684"><a href="#cb43-1684" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb43-1685"><a href="#cb43-1685" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-1686"><a href="#cb43-1686" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb43-1687"><a href="#cb43-1687" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb43-1688"><a href="#cb43-1688" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`ΔA, where ΔC̄∅ = </span><span class="sc">${</span>stringDeltaBarCnull<span class="sc">}</span><span class="vs"> tCO2eq`</span><span class="op">,</span></span>
<span id="cb43-1689"><a href="#cb43-1689" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb43-1690"><a href="#cb43-1690" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb43-1691"><a href="#cb43-1691" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb43-1692"><a href="#cb43-1692" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb43-1693"><a href="#cb43-1693" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb43-1694"><a href="#cb43-1694" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb43-1695"><a href="#cb43-1695" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1696"><a href="#cb43-1696" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1697"><a href="#cb43-1697" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1698"><a href="#cb43-1698" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1699"><a href="#cb43-1699" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getDeltaA<span class="op">,</span></span>
<span id="cb43-1700"><a href="#cb43-1700" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb43-1701"><a href="#cb43-1701" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb43-1702"><a href="#cb43-1702" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb43-1703"><a href="#cb43-1703" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb43-1704"><a href="#cb43-1704" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb43-1705"><a href="#cb43-1705" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb43-1706"><a href="#cb43-1706" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb43-1707"><a href="#cb43-1707" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1708"><a href="#cb43-1708" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb43-1709"><a href="#cb43-1709" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb43-1710"><a href="#cb43-1710" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb43-1711"><a href="#cb43-1711" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb43-1712"><a href="#cb43-1712" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb43-1713"><a href="#cb43-1713" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb43-1714"><a href="#cb43-1714" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb43-1715"><a href="#cb43-1715" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb43-1716"><a href="#cb43-1716" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1717"><a href="#cb43-1717" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb43-1718"><a href="#cb43-1718" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb43-1719"><a href="#cb43-1719" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-43" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-zero-carbon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: <strong>A</strong> price curves (<span class="math inline">\Delta A</span>) in the zero carbon scenario.
</figcaption>
</figure>
</div>
<div id="fig-a-price-curves-zero-carbon-normalised" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Normalised A price curves in the zero carbon scenario.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-zero-carbon-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1734" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1733;"><span id="cb44-1734"><a href="#cb44-1734" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb44-1735"><a href="#cb44-1735" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb44-1736"><a href="#cb44-1736" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb44-1737"><a href="#cb44-1737" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb44-1738"><a href="#cb44-1738" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb44-1739"><a href="#cb44-1739" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Normalised ΔA, where ΔC̄∅ = </span><span class="sc">${</span>stringDeltaBarCnull<span class="sc">}</span><span class="vs"> tCO2eq`</span><span class="op">,</span></span>
<span id="cb44-1740"><a href="#cb44-1740" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb44-1741"><a href="#cb44-1741" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb44-1742"><a href="#cb44-1742" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb44-1743"><a href="#cb44-1743" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb44-1744"><a href="#cb44-1744" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb44-1745"><a href="#cb44-1745" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb44-1746"><a href="#cb44-1746" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1747"><a href="#cb44-1747" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1748"><a href="#cb44-1748" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1749"><a href="#cb44-1749" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1750"><a href="#cb44-1750" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getNormDeltaA<span class="op">,</span></span>
<span id="cb44-1751"><a href="#cb44-1751" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb44-1752"><a href="#cb44-1752" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb44-1753"><a href="#cb44-1753" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb44-1754"><a href="#cb44-1754" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb44-1755"><a href="#cb44-1755" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getNormDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb44-1756"><a href="#cb44-1756" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb44-1757"><a href="#cb44-1757" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb44-1758"><a href="#cb44-1758" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb44-1759"><a href="#cb44-1759" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb44-1760"><a href="#cb44-1760" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb44-1761"><a href="#cb44-1761" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb44-1762"><a href="#cb44-1762" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb44-1763"><a href="#cb44-1763" aria-hidden="true" tabindex="-1"></a>                    (inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb44-1764"><a href="#cb44-1764" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb44-1765"><a href="#cb44-1765" aria-hidden="true" tabindex="-1"></a>                    (inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb44-1766"><a href="#cb44-1766" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb44-1767"><a href="#cb44-1767" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb44-1768"><a href="#cb44-1768" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb44-1769"><a href="#cb44-1769" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb44-1770"><a href="#cb44-1770" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb44-1771"><a href="#cb44-1771" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb44-1772"><a href="#cb44-1772" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-44" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-zero-carbon-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Normalised <strong>A</strong> price curves in the zero carbon scenario.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-sell-offset-certificates" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="sec-sell-offset-certificates"><span class="header-section-number">3.2.2</span> Sell Offset Certificates</h4>
<p><em>User swaps <strong>A</strong> tokens for carbon offset certificates.</em></p>
<section id="sec-weighted-carbon-class" class="level5" data-number="3.2.2.1">
<h5 data-number="3.2.2.1" class="anchored" data-anchor-id="sec-weighted-carbon-class"><span class="header-section-number">3.2.2.1</span> Weighted Carbon Class</h5>
<p>For retiring carbon that is <em>weighted</em>, that is for which there is a strictly positive <strong>A</strong> token allocation, an <strong>A</strong> token holder can extract the carbon class offset certificate of their choice <span class="math inline">C_i</span> but the available pool is only the liquid carbon balance, namely the element <span class="math inline">C_{i0}</span>:</p>
<p><span id="eq-carbon-change-intermediary-step"><span class="math display">
\ln(1 + \Delta C_i) =
  \frac{-\ln(1 + \Delta A)}{A_i + \frac 1 2 A_i^2 \, (1 - G_i)^2}
\tag{20}</span></span></p>
<p>As before, denoting the expression on the right hand side of <a href="#eq-carbon-change-intermediary-step" class="quarto-xref">Equation&nbsp;20</a> as <span class="math inline">\mathsf{RHS}</span>:</p>
<p><span id="eq-carbon-change"><span class="math display">
\Delta C_i = \exp(\mathsf{RHS}) - 1
\tag{21}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1811" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1810;"><span id="cb45-1811"><a href="#cb45-1811" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaA <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="fl">0.999</span>]<span class="op">,</span> {</span>
<span id="cb45-1812"><a href="#cb45-1812" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Burnt } </span><span class="sc">\D</span><span class="vs">elta A`</span><span class="op">,</span></span>
<span id="cb45-1813"><a href="#cb45-1813" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb45-1814"><a href="#cb45-1814" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb45-1815"><a href="#cb45-1815" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-45" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-proportion-of-carbon-retired" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Proportion of carbon retired.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-proportion-of-carbon-retired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1827" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1826;"><span id="cb46-1827"><a href="#cb46-1827" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaCi</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaA) {</span>
<span id="cb46-1828"><a href="#cb46-1828" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log1p</span>(deltaA) <span class="op">/</span> (Ai <span class="op">+</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>)))<span class="op">;</span></span>
<span id="cb46-1829"><a href="#cb46-1829" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-46" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1834" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1833;"><span id="cb47-1834"><a href="#cb47-1834" aria-hidden="true" tabindex="-1"></a>retirementData <span class="op">=</span> {</span>
<span id="cb47-1835"><a href="#cb47-1835" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> retirementData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb47-1836"><a href="#cb47-1836" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb47-1837"><a href="#cb47-1837" aria-hidden="true" tabindex="-1"></a>    retirementData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb47-1838"><a href="#cb47-1838" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"-ΔCᵢ"</span><span class="op">,</span></span>
<span id="cb47-1839"><a href="#cb47-1839" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb47-1840"><a href="#cb47-1840" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb47-1841"><a href="#cb47-1841" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb47-1842"><a href="#cb47-1842" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb47-1843"><a href="#cb47-1843" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb47-1844"><a href="#cb47-1844" aria-hidden="true" tabindex="-1"></a>      retirementData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb47-1845"><a href="#cb47-1845" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"-ΔCᵢ"</span><span class="op">,</span></span>
<span id="cb47-1846"><a href="#cb47-1846" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb47-1847"><a href="#cb47-1847" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb47-1848"><a href="#cb47-1848" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="op">-</span><span class="fu">computeDeltaCi</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb47-1849"><a href="#cb47-1849" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb47-1850"><a href="#cb47-1850" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-1851"><a href="#cb47-1851" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-1852"><a href="#cb47-1852" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> retirementData<span class="op">;</span></span>
<span id="cb47-1853"><a href="#cb47-1853" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb47-1854"><a href="#cb47-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1855"><a href="#cb47-1855" aria-hidden="true" tabindex="-1"></a>stringInputDeltaA <span class="op">=</span> inputDeltaA<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb47-1856"><a href="#cb47-1856" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb47-1857"><a href="#cb47-1857" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb47-1858"><a href="#cb47-1858" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-47-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-47-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1861" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1860;"><span id="cb48-1861"><a href="#cb48-1861" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb48-1862"><a href="#cb48-1862" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb48-1863"><a href="#cb48-1863" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb48-1864"><a href="#cb48-1864" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb48-1865"><a href="#cb48-1865" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb48-1866"><a href="#cb48-1866" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`-ΔCᵢ, where ΔA = </span><span class="sc">${</span>stringInputDeltaA<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb48-1867"><a href="#cb48-1867" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb48-1868"><a href="#cb48-1868" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb48-1869"><a href="#cb48-1869" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb48-1870"><a href="#cb48-1870" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb48-1871"><a href="#cb48-1871" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb48-1872"><a href="#cb48-1872" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(retirementData<span class="op">,</span> {</span>
<span id="cb48-1873"><a href="#cb48-1873" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1874"><a href="#cb48-1874" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1875"><a href="#cb48-1875" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1876"><a href="#cb48-1876" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1877"><a href="#cb48-1877" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb48-1878"><a href="#cb48-1878" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb48-1879"><a href="#cb48-1879" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(retirementData<span class="op">,</span> {</span>
<span id="cb48-1880"><a href="#cb48-1880" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb48-1881"><a href="#cb48-1881" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb48-1882"><a href="#cb48-1882" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb48-1883"><a href="#cb48-1883" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb48-1884"><a href="#cb48-1884" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb48-1885"><a href="#cb48-1885" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb48-1886"><a href="#cb48-1886" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb48-1887"><a href="#cb48-1887" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb48-1888"><a href="#cb48-1888" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb48-1889"><a href="#cb48-1889" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fu">computeDeltaCi</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb48-1890"><a href="#cb48-1890" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fu">computeDeltaCi</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb48-1891"><a href="#cb48-1891" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb48-1892"><a href="#cb48-1892" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb48-1893"><a href="#cb48-1893" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb48-1894"><a href="#cb48-1894" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb48-1895"><a href="#cb48-1895" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb48-1896"><a href="#cb48-1896" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb48-1897"><a href="#cb48-1897" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-48" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-proportion-of-carbon-retired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Proportion of carbon retired.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-proportion-of-carbon-retired" class="quarto-xref">Figure&nbsp;14</a> shows the cost of carbon increasing with <span class="math inline">A_i</span> and decreasing on <span class="math inline">G_i</span>.</p>
</section>
<section id="sec-unweighted-carbon-class" class="level5" data-number="3.2.2.2">
<h5 data-number="3.2.2.2" class="anchored" data-anchor-id="sec-unweighted-carbon-class"><span class="header-section-number">3.2.2.2</span> Unweighted Carbon Class</h5>
<p>An offset certificate for a carbon class with a zero <strong>A</strong> allocation cannot be extracted from the portfolio by swapping in <strong>A</strong> tokens.</p>
</section>
<section id="sec-liquidation-delta-a-1" class="level5" data-number="3.2.2.3">
<h5 data-number="3.2.2.3" class="anchored" data-anchor-id="sec-liquidation-delta-a-1"><span class="header-section-number">3.2.2.3</span> Liquidation: <span class="math inline">\Delta A = 1</span></h5>
<p>In the event that 100% of <strong>A</strong> tokens are placed into the burn mechanism for carbon offset certificates, the balances of all carbon held in the portfolio post-trade are distributed to all <strong>G</strong> token holders.</p>
<p><a href="#fig-carbon-spread" class="quarto-xref">Figure&nbsp;15</a> below shows the spread captured on a ‘round trip’ by the system where <span class="math inline">\varepsilon</span> is the proportion retained:</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1930" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1929;"><span id="cb49-1930"><a href="#cb49-1930" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaCinitial <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb49-1931"><a href="#cb49-1931" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial }</span><span class="sc">\D</span><span class="vs">elta C`</span><span class="op">,</span></span>
<span id="cb49-1932"><a href="#cb49-1932" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb49-1933"><a href="#cb49-1933" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb49-1934"><a href="#cb49-1934" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-49" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-spread" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon spread.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-spread-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1946" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1945;"><span id="cb50-1946"><a href="#cb50-1946" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeSpread</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCinitial) {</span>
<span id="cb50-1947"><a href="#cb50-1947" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaA <span class="op">=</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCinitial)<span class="op">;</span></span>
<span id="cb50-1948"><a href="#cb50-1948" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaCfinal <span class="op">=</span> <span class="op">-</span><span class="fu">computeDeltaCi</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaA)<span class="op">;</span></span>
<span id="cb50-1949"><a href="#cb50-1949" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (deltaCinitial <span class="op">-</span> deltaCfinal) <span class="op">/</span> deltaCinitial<span class="op">;</span></span>
<span id="cb50-1950"><a href="#cb50-1950" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-50" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1955" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1954;"><span id="cb51-1955"><a href="#cb51-1955" aria-hidden="true" tabindex="-1"></a>liquidationData <span class="op">=</span> {</span>
<span id="cb51-1956"><a href="#cb51-1956" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> liquidationData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb51-1957"><a href="#cb51-1957" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb51-1958"><a href="#cb51-1958" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"deltaa"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-1959"><a href="#cb51-1959" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"deltac"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-1960"><a href="#cb51-1960" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"spread"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-1961"><a href="#cb51-1961" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb51-1962"><a href="#cb51-1962" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> deltaA <span class="op">=</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial)</span>
<span id="cb51-1963"><a href="#cb51-1963" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1964"><a href="#cb51-1964" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"deltaa"</span><span class="op">,</span></span>
<span id="cb51-1965"><a href="#cb51-1965" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-1966"><a href="#cb51-1966" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-1967"><a href="#cb51-1967" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial) <span class="op">/</span></span>
<span id="cb51-1968"><a href="#cb51-1968" aria-hidden="true" tabindex="-1"></a>                inputDeltaCinitial<span class="op">,</span></span>
<span id="cb51-1969"><a href="#cb51-1969" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-1970"><a href="#cb51-1970" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1971"><a href="#cb51-1971" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"deltac"</span><span class="op">,</span></span>
<span id="cb51-1972"><a href="#cb51-1972" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-1973"><a href="#cb51-1973" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-1974"><a href="#cb51-1974" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaCi</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> deltaA) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb51-1975"><a href="#cb51-1975" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-1976"><a href="#cb51-1976" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1977"><a href="#cb51-1977" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"spread"</span><span class="op">,</span></span>
<span id="cb51-1978"><a href="#cb51-1978" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-1979"><a href="#cb51-1979" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-1980"><a href="#cb51-1980" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeSpread</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial)<span class="op">,</span></span>
<span id="cb51-1981"><a href="#cb51-1981" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-1982"><a href="#cb51-1982" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-1983"><a href="#cb51-1983" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-1984"><a href="#cb51-1984" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> liquidationData<span class="op">;</span></span>
<span id="cb51-1985"><a href="#cb51-1985" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb51-1986"><a href="#cb51-1986" aria-hidden="true" tabindex="-1"></a>getLiqDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"deltaa"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-1987"><a href="#cb51-1987" aria-hidden="true" tabindex="-1"></a>getLiqDeltaCi <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"deltac"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-1988"><a href="#cb51-1988" aria-hidden="true" tabindex="-1"></a>getLiqSpread <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"spread"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-1989"><a href="#cb51-1989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1990"><a href="#cb51-1990" aria-hidden="true" tabindex="-1"></a>stringInputDeltaCinitial <span class="op">=</span> inputDeltaCinitial<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb51-1991"><a href="#cb51-1991" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb51-1992"><a href="#cb51-1992" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb51-1993"><a href="#cb51-1993" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="1996" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1995;"><span id="cb52-1996"><a href="#cb52-1996" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb52-1997"><a href="#cb52-1997" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb52-1998"><a href="#cb52-1998" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb52-1999"><a href="#cb52-1999" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb52-2000"><a href="#cb52-2000" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeSpread</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span></span>
<span id="cb52-2001"><a href="#cb52-2001" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb52-2002"><a href="#cb52-2002" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Carbon Spread ε, where initial ΔC = </span><span class="sc">${</span>stringInputDeltaCinitial<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb52-2003"><a href="#cb52-2003" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb52-2004"><a href="#cb52-2004" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb52-2005"><a href="#cb52-2005" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb52-2006"><a href="#cb52-2006" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb52-2007"><a href="#cb52-2007" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb52-2008"><a href="#cb52-2008" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb52-2009"><a href="#cb52-2009" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2010"><a href="#cb52-2010" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2011"><a href="#cb52-2011" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2012"><a href="#cb52-2012" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2013"><a href="#cb52-2013" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqSpread<span class="op">,</span></span>
<span id="cb52-2014"><a href="#cb52-2014" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb52-2015"><a href="#cb52-2015" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb52-2016"><a href="#cb52-2016" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb52-2017"><a href="#cb52-2017" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb52-2018"><a href="#cb52-2018" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqSpread</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb52-2019"><a href="#cb52-2019" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb52-2020"><a href="#cb52-2020" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb52-2021"><a href="#cb52-2021" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb52-2022"><a href="#cb52-2022" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb52-2023"><a href="#cb52-2023" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb52-2024"><a href="#cb52-2024" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeSpread</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial)]<span class="op">,</span></span>
<span id="cb52-2025"><a href="#cb52-2025" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb52-2026"><a href="#cb52-2026" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb52-2027"><a href="#cb52-2027" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb52-2028"><a href="#cb52-2028" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb52-2029"><a href="#cb52-2029" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb52-2030"><a href="#cb52-2030" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-52" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-spread-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Carbon ‘spread’.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-carbon-spread-components" class="quarto-xref">Figure&nbsp;16</a> shows the component ‘spread’ contributions on a carbon sale and purchase round trip of a carbon offset certificate.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="2049" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2048;"><span id="cb53-2049"><a href="#cb53-2049" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb53-2050"><a href="#cb53-2050" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb53-2051"><a href="#cb53-2051" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial }</span><span class="sc">\D</span><span class="vs">elta C`</span><span class="op">,</span></span>
<span id="cb53-2052"><a href="#cb53-2052" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb53-2053"><a href="#cb53-2053" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb53-2054"><a href="#cb53-2054" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb53-2055"><a href="#cb53-2055" aria-hidden="true" tabindex="-1"></a>  viewof inputDeltaCinitial<span class="op">,</span></span>
<span id="cb53-2056"><a href="#cb53-2056" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-53" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-spread-components" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-spread-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="2069" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2068;"><span id="cb54-2069"><a href="#cb54-2069" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb54-2070"><a href="#cb54-2070" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb54-2071"><a href="#cb54-2071" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb54-2072"><a href="#cb54-2072" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb54-2073"><a href="#cb54-2073" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb54-2074"><a href="#cb54-2074" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb54-2075"><a href="#cb54-2075" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Component ΔA, where initial ΔC = </span><span class="sc">${</span></span>
<span id="cb54-2076"><a href="#cb54-2076" aria-hidden="true" tabindex="-1"></a>      stringInputDeltaCinitial</span>
<span id="cb54-2077"><a href="#cb54-2077" aria-hidden="true" tabindex="-1"></a>    <span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb54-2078"><a href="#cb54-2078" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb54-2079"><a href="#cb54-2079" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb54-2080"><a href="#cb54-2080" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb54-2081"><a href="#cb54-2081" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb54-2082"><a href="#cb54-2082" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb54-2083"><a href="#cb54-2083" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb54-2084"><a href="#cb54-2084" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2085"><a href="#cb54-2085" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2086"><a href="#cb54-2086" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2087"><a href="#cb54-2087" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2088"><a href="#cb54-2088" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqDeltaA<span class="op">,</span></span>
<span id="cb54-2089"><a href="#cb54-2089" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb54-2090"><a href="#cb54-2090" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb54-2091"><a href="#cb54-2091" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb54-2092"><a href="#cb54-2092" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb54-2093"><a href="#cb54-2093" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb54-2094"><a href="#cb54-2094" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb54-2095"><a href="#cb54-2095" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb54-2096"><a href="#cb54-2096" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb54-2097"><a href="#cb54-2097" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(d3<span class="op">.</span><span class="fu">interpolateSpectral</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">,</span></span>
<span id="cb54-2098"><a href="#cb54-2098" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb54-2099"><a href="#cb54-2099" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb54-2100"><a href="#cb54-2100" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-54" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-54-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-54" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-54-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Carbon ‘spread’ component ΔA.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="2105" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2104;"><span id="cb55-2105"><a href="#cb55-2105" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb55-2106"><a href="#cb55-2106" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb55-2107"><a href="#cb55-2107" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb55-2108"><a href="#cb55-2108" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Greys"</span><span class="op">,</span></span>
<span id="cb55-2109"><a href="#cb55-2109" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb55-2110"><a href="#cb55-2110" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2111"><a href="#cb55-2111" aria-hidden="true" tabindex="-1"></a>      <span class="fu">computeDeltaCi</span>(</span>
<span id="cb55-2112"><a href="#cb55-2112" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2113"><a href="#cb55-2113" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span></span>
<span id="cb55-2114"><a href="#cb55-2114" aria-hidden="true" tabindex="-1"></a>        <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb55-2115"><a href="#cb55-2115" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2116"><a href="#cb55-2116" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb55-2117"><a href="#cb55-2117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Component ΔC, where initial ΔC = </span><span class="sc">${</span></span>
<span id="cb55-2118"><a href="#cb55-2118" aria-hidden="true" tabindex="-1"></a>      stringInputDeltaCinitial</span>
<span id="cb55-2119"><a href="#cb55-2119" aria-hidden="true" tabindex="-1"></a>    <span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb55-2120"><a href="#cb55-2120" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb55-2121"><a href="#cb55-2121" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb55-2122"><a href="#cb55-2122" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb55-2123"><a href="#cb55-2123" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb55-2124"><a href="#cb55-2124" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb55-2125"><a href="#cb55-2125" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb55-2126"><a href="#cb55-2126" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2127"><a href="#cb55-2127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2128"><a href="#cb55-2128" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2129"><a href="#cb55-2129" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2130"><a href="#cb55-2130" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqDeltaCi<span class="op">,</span></span>
<span id="cb55-2131"><a href="#cb55-2131" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb55-2132"><a href="#cb55-2132" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb55-2133"><a href="#cb55-2133" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb55-2134"><a href="#cb55-2134" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb55-2135"><a href="#cb55-2135" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqDeltaCi</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb55-2136"><a href="#cb55-2136" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb55-2137"><a href="#cb55-2137" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb55-2138"><a href="#cb55-2138" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2139"><a href="#cb55-2139" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb55-2140"><a href="#cb55-2140" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb55-2141"><a href="#cb55-2141" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb55-2142"><a href="#cb55-2142" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2143"><a href="#cb55-2143" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaCi</span>(</span>
<span id="cb55-2144"><a href="#cb55-2144" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2145"><a href="#cb55-2145" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span><span class="op">,</span></span>
<span id="cb55-2146"><a href="#cb55-2146" aria-hidden="true" tabindex="-1"></a>              <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb55-2147"><a href="#cb55-2147" aria-hidden="true" tabindex="-1"></a>            )<span class="op">,</span></span>
<span id="cb55-2148"><a href="#cb55-2148" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb55-2149"><a href="#cb55-2149" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateGreys</span><span class="op">,</span></span>
<span id="cb55-2150"><a href="#cb55-2150" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb55-2151"><a href="#cb55-2151" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2152"><a href="#cb55-2152" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb55-2153"><a href="#cb55-2153" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb55-2154"><a href="#cb55-2154" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-55" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-55-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-55" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-55-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Carbon ‘spread’ component ΔC.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-spread-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Carbon ‘spread’ components.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-liquidity-markets" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="sec-liquidity-markets"><span class="header-section-number">3.3</span> Liquidity Markets</h3>
<p>Both <strong>A</strong> and <strong>G</strong> tokens can be used for providing liquidity.</p>
<div id="fig-token-liquidity" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token liquidity and pricing structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-liquidity.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Token liquidity and pricing structure.
</figcaption>
</figure>
</div>
<p>There are two core liquidity pools:</p>
<ol type="1">
<li><p>An AAM 50:50 pairing of <strong>A</strong> and <strong>G</strong>&nbsp;tokens: pool <span class="overline"><strong>AG</strong></span>.</p></li>
<li><p>A hard currency USDC denoted as <strong>Q</strong> paired with <strong>A</strong>: pool <span class="overline"><strong>AQ</strong></span>.</p></li>
</ol>
<section id="sec-liquidity-fees" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="sec-liquidity-fees"><span class="header-section-number">3.3.1</span> Liquidity Fees</h4>
<p>The <span class="overline"><strong>AQ</strong></span> pool will have its own set of fees in the normal way.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The <span class="overline"><strong>AG</strong></span> pool has different economics as the assets are highly correlated since they represent the same economy. For this reason, the fees are extremely low.</p>
<p>By staking liquidity&nbsp;(liquidity provider tokens) to the <strong>standard maturities</strong>, both pools may receive a distribution of <strong>A</strong> tokens determined from the Risk Premium calculation below. This is an <u>additional</u> primary issuance to the Base Accrual already discussed.</p>
</section>
<section id="sec-risk-premium-beta-determination" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="sec-risk-premium-beta-determination"><span class="header-section-number">3.3.2</span> Risk Premium: Beta Determination</h4>
<p>We can consider the Time-Locked Market yield as the system’s <em>risk-free</em> rate. In addition to this mechanism, a <em>risky</em> spread is determined that is ultimately paid to the staked liquidity providers of the <strong>A</strong> and <strong>G</strong> tokens as compensation for the risk levels assumed.</p>
<p>As we have seen, the <strong>G</strong> token has an impact on risk-pricing of <strong>A</strong>. As <strong>G</strong> staking increases, the relationship between the carbon class selected under <span class="math inline">G_i</span> and the portfolio token <strong>A</strong> strengthens. We can consider <span class="math inline">G_i</span> staking as an estimate of residual or idiosyncratic risk in the carbon class and this allows us to calculate a portfolio beta <span class="math inline">\beta</span> from the implied betas of each carbon class <span class="math inline">i</span>.</p>
<p><span id="eq-beta"><span class="math display">
\beta = \sqrt{\sum_{i=1}^n A_i - A_i \, (1 - G_i)^2}
\tag{22}</span></span></p>
<p>The portfolio <span class="math inline">\beta</span> determines a yield factor for the liquidity pools of <strong>A</strong> to compensate for the implied risk levels.</p>
<p>For intuition, the map in <a href="#fig-range-of-beta-i" class="quarto-xref">Figure&nbsp;18</a> shows the various outputs of the function per carbon class.</p>
<div id="fig-range-of-beta-i" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Range of Beta i.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-range-of-beta-i-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="2259" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2258;"><span id="cb56-2259"><a href="#cb56-2259" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeBeta</span>(vecAi<span class="op">,</span> vecGi) {</span>
<span id="cb56-2260"><a href="#cb56-2260" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> beta2 <span class="op">=</span> vecAi<span class="op">.</span><span class="fu">reduce</span>(</span>
<span id="cb56-2261"><a href="#cb56-2261" aria-hidden="true" tabindex="-1"></a>    (acc<span class="op">,</span> Ai<span class="op">,</span> i) <span class="kw">=&gt;</span> acc <span class="op">+</span> Ai <span class="op">-</span> Ai <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> vecGi[i])<span class="op">**</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb56-2262"><a href="#cb56-2262" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span><span class="op">,</span></span>
<span id="cb56-2263"><a href="#cb56-2263" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb56-2264"><a href="#cb56-2264" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(beta2)<span class="op">;</span></span>
<span id="cb56-2265"><a href="#cb56-2265" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-56" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb57" data-startfrom="2269" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2268;"><span id="cb57-2269"><a href="#cb57-2269" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> Gi) {</span>
<span id="cb57-2270"><a href="#cb57-2270" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(Ai <span class="op">-</span> Ai <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb57-2271"><a href="#cb57-2271" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-57" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb58" data-startfrom="2275" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2274;"><span id="cb58-2275"><a href="#cb58-2275" aria-hidden="true" tabindex="-1"></a>betaData <span class="op">=</span> {</span>
<span id="cb58-2276"><a href="#cb58-2276" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> betaData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb58-2277"><a href="#cb58-2277" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb58-2278"><a href="#cb58-2278" aria-hidden="true" tabindex="-1"></a>    betaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb58-2279"><a href="#cb58-2279" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb58-2280"><a href="#cb58-2280" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb58-2281"><a href="#cb58-2281" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb58-2282"><a href="#cb58-2282" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb58-2283"><a href="#cb58-2283" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb58-2284"><a href="#cb58-2284" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb58-2285"><a href="#cb58-2285" aria-hidden="true" tabindex="-1"></a>      betaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb58-2286"><a href="#cb58-2286" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb58-2287"><a href="#cb58-2287" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb58-2288"><a href="#cb58-2288" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb58-2289"><a href="#cb58-2289" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeBetai</span>(paramAi<span class="op">,</span> paramGi)<span class="op">,</span></span>
<span id="cb58-2290"><a href="#cb58-2290" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb58-2291"><a href="#cb58-2291" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-2292"><a href="#cb58-2292" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-2293"><a href="#cb58-2293" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> betaData<span class="op">;</span></span>
<span id="cb58-2294"><a href="#cb58-2294" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-58" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb59" data-startfrom="2298" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2297;"><span id="cb59-2298"><a href="#cb59-2298" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb59-2299"><a href="#cb59-2299" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb59-2300"><a href="#cb59-2300" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb59-2301"><a href="#cb59-2301" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb59-2302"><a href="#cb59-2302" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb59-2303"><a href="#cb59-2303" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb59-2304"><a href="#cb59-2304" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb59-2305"><a href="#cb59-2305" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb59-2306"><a href="#cb59-2306" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb59-2307"><a href="#cb59-2307" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb59-2308"><a href="#cb59-2308" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb59-2309"><a href="#cb59-2309" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(betaData<span class="op">,</span> {</span>
<span id="cb59-2310"><a href="#cb59-2310" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2311"><a href="#cb59-2311" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2312"><a href="#cb59-2312" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2313"><a href="#cb59-2313" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2314"><a href="#cb59-2314" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb59-2315"><a href="#cb59-2315" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb59-2316"><a href="#cb59-2316" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(betaData<span class="op">,</span> {</span>
<span id="cb59-2317"><a href="#cb59-2317" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb59-2318"><a href="#cb59-2318" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb59-2319"><a href="#cb59-2319" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb59-2320"><a href="#cb59-2320" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb59-2321"><a href="#cb59-2321" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb59-2322"><a href="#cb59-2322" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb59-2323"><a href="#cb59-2323" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(d3<span class="op">.</span><span class="fu">interpolateSpectral</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">,</span></span>
<span id="cb59-2324"><a href="#cb59-2324" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb59-2325"><a href="#cb59-2325" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb59-2326"><a href="#cb59-2326" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-59" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-range-of-beta-i-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Range of <span class="math inline">\beta_i</span>.
</figcaption>
</figure>
</div>
<p>The table and figure below show an example of the effects on <span class="math inline">\beta</span> of allocating large <span class="math inline">G_i</span> values to small <span class="math inline">A_i</span> values where the shift in <span class="math inline">G_i</span> results in a lower <span class="math inline">\beta</span>&nbsp;(0.27 from 0.55) with no change to total <strong>G</strong> and <strong>A</strong> allocations.</p>
<div id="tbl-effect-on-beta-from-outsized-g-staking" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[15,10,10,10,10,10]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-effect-on-beta-from-outsized-g-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Class</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
<th style="text-align: left;">3</th>
<th style="text-align: left;">4</th>
<th style="text-align: left;"><span class="math inline">\beta</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">A_i</span></td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">0.20</td>
<td style="text-align: left;">0.10</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Initial <span class="math inline">G_i</span></td>
<td style="text-align: left;"><span class="blue">0.30</span></td>
<td style="text-align: left;"><span class="blue">0.10</span></td>
<td style="text-align: left;"><span class="blue">0.05</span></td>
<td style="text-align: left;"><span class="blue">0.01</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Initial <span class="math inline">\beta_i^2</span></td>
<td style="text-align: left;">0.2550</td>
<td style="text-align: left;">0.0380</td>
<td style="text-align: left;">0.0098</td>
<td style="text-align: left;">0.0010</td>
<td style="text-align: left;"><span class="blue">0.5511</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">New <span class="math inline">G_i</span></td>
<td style="text-align: left;"><span class="red">0.01</span></td>
<td style="text-align: left;"><span class="red">0.05</span></td>
<td style="text-align: left;"><span class="red">0.10</span></td>
<td style="text-align: left;"><span class="red">0.30</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">New <span class="math inline">\beta_i^2</span></td>
<td style="text-align: left;">0.0100</td>
<td style="text-align: left;">0.0195</td>
<td style="text-align: left;">0.0190</td>
<td style="text-align: left;">0.0255</td>
<td style="text-align: left;"><span class="red">0.2719</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\Delta G_i</span></td>
<td style="text-align: left;">(0.29)</td>
<td style="text-align: left;">(0.05)</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;">0.29</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\Delta \beta_i^2</span></td>
<td style="text-align: left;">(0.2451)</td>
<td style="text-align: left;">(0.0185)</td>
<td style="text-align: left;">0.0092</td>
<td style="text-align: left;">0.0245</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-effect-on-beta-from-outsized-g-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Effect on <span class="math inline">\beta</span> from outsized <strong>G</strong> allocation.
</figcaption>
</figure>
</div>
<div id="fig-example-of-g-stake-on-beta" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Example of G allocation on Beta.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-example-of-g-stake-on-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb60" data-startfrom="2374" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2373;"><span id="cb60-2374"><a href="#cb60-2374" aria-hidden="true" tabindex="-1"></a>arrayAi <span class="op">=</span> [<span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.05</span>]<span class="op">;</span></span>
<span id="cb60-2375"><a href="#cb60-2375" aria-hidden="true" tabindex="-1"></a>arrayInitialGi <span class="op">=</span> [<span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.01</span>]<span class="op">;</span></span>
<span id="cb60-2376"><a href="#cb60-2376" aria-hidden="true" tabindex="-1"></a>arrayNewGi <span class="op">=</span> arrayInitialGi<span class="op">.</span><span class="fu">toReversed</span>()<span class="op">;</span></span>
<span id="cb60-2377"><a href="#cb60-2377" aria-hidden="true" tabindex="-1"></a>betaContribData <span class="op">=</span> {</span>
<span id="cb60-2378"><a href="#cb60-2378" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> betaContribData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb60-2379"><a href="#cb60-2379" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> arrayAi<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb60-2380"><a href="#cb60-2380" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> Ai <span class="op">=</span> arrayAi[i]<span class="op">;</span></span>
<span id="cb60-2381"><a href="#cb60-2381" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialGi <span class="op">=</span> arrayInitialGi[i]<span class="op">;</span></span>
<span id="cb60-2382"><a href="#cb60-2382" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialBeta2 <span class="op">=</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> initialGi)<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb60-2383"><a href="#cb60-2383" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newGi <span class="op">=</span> arrayNewGi[i]<span class="op">;</span></span>
<span id="cb60-2384"><a href="#cb60-2384" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newBeta2 <span class="op">=</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> newGi)<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb60-2385"><a href="#cb60-2385" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Initial Gᵢ"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> initialGi })<span class="op">;</span></span>
<span id="cb60-2386"><a href="#cb60-2386" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Initial βᵢ²"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> initialBeta2 })<span class="op">;</span></span>
<span id="cb60-2387"><a href="#cb60-2387" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"New Gᵢ"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> newGi })<span class="op">;</span></span>
<span id="cb60-2388"><a href="#cb60-2388" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"New βᵢ²"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> newBeta2 })<span class="op">;</span></span>
<span id="cb60-2389"><a href="#cb60-2389" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-2390"><a href="#cb60-2390" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> betaContribData<span class="op">;</span></span>
<span id="cb60-2391"><a href="#cb60-2391" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb60-2392"><a href="#cb60-2392" aria-hidden="true" tabindex="-1"></a>getInitialG <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Initial Gᵢ"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2393"><a href="#cb60-2393" aria-hidden="true" tabindex="-1"></a>getInitialBeta2 <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Initial βᵢ²"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2394"><a href="#cb60-2394" aria-hidden="true" tabindex="-1"></a>getNewG <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"New Gᵢ"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2395"><a href="#cb60-2395" aria-hidden="true" tabindex="-1"></a>getNewBeta2 <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"New βᵢ²"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2396"><a href="#cb60-2396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2397"><a href="#cb60-2397" aria-hidden="true" tabindex="-1"></a>domainG <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(arrayInitialGi)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(arrayNewGi))]<span class="op">;</span></span>
<span id="cb60-2398"><a href="#cb60-2398" aria-hidden="true" tabindex="-1"></a>rangeBeta2 <span class="op">=</span> [</span>
<span id="cb60-2399"><a href="#cb60-2399" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb60-2400"><a href="#cb60-2400" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(</span>
<span id="cb60-2401"><a href="#cb60-2401" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">max</span>(betaContribData<span class="op">,</span> getInitialBeta2)<span class="op">,</span></span>
<span id="cb60-2402"><a href="#cb60-2402" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">max</span>(betaContribData<span class="op">,</span> getNewBeta2)<span class="op">,</span></span>
<span id="cb60-2403"><a href="#cb60-2403" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb60-2404"><a href="#cb60-2404" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb60-2405"><a href="#cb60-2405" aria-hidden="true" tabindex="-1"></a>scaleG <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(domainG<span class="op">,</span> rangeBeta2)<span class="op">;</span></span>
<span id="cb60-2406"><a href="#cb60-2406" aria-hidden="true" tabindex="-1"></a>mapScaleG <span class="op">=</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>(scaleG)<span class="op">;</span></span>
<span id="cb60-2407"><a href="#cb60-2407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2408"><a href="#cb60-2408" aria-hidden="true" tabindex="-1"></a>paramInitialBeta <span class="op">=</span> <span class="fu">computeBeta</span>(arrayAi<span class="op">,</span> arrayInitialGi)<span class="op">;</span></span>
<span id="cb60-2409"><a href="#cb60-2409" aria-hidden="true" tabindex="-1"></a>paramNewBeta <span class="op">=</span> <span class="fu">computeBeta</span>(arrayAi<span class="op">,</span> arrayNewGi)<span class="op">;</span></span>
<span id="cb60-2410"><a href="#cb60-2410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2411"><a href="#cb60-2411" aria-hidden="true" tabindex="-1"></a>stringInitialBeta <span class="op">=</span> <span class="st">"Initial β = "</span> <span class="op">+</span> paramInitialBeta<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb60-2412"><a href="#cb60-2412" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb60-2413"><a href="#cb60-2413" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb60-2414"><a href="#cb60-2414" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb60-2415"><a href="#cb60-2415" aria-hidden="true" tabindex="-1"></a>stringNewBeta <span class="op">=</span> <span class="st">"New β = "</span> <span class="op">+</span> paramNewBeta<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb60-2416"><a href="#cb60-2416" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb60-2417"><a href="#cb60-2417" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb60-2418"><a href="#cb60-2418" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-16" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb61" data-startfrom="2421" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2420;"><span id="cb61-2421"><a href="#cb61-2421" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb61-2422"><a href="#cb61-2422" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb61-2423"><a href="#cb61-2423" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb61-2424"><a href="#cb61-2424" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="st">"gray"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"red"</span>]<span class="op">,</span></span>
<span id="cb61-2425"><a href="#cb61-2425" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Initial βᵢ²"</span><span class="op">,</span> <span class="st">"New βᵢ²"</span><span class="op">,</span> <span class="st">"Initial Gᵢ"</span><span class="op">,</span> <span class="st">"New Gᵢ"</span>]<span class="op">,</span></span>
<span id="cb61-2426"><a href="#cb61-2426" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb61-2427"><a href="#cb61-2427" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb61-2428"><a href="#cb61-2428" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">4</span>)<span class="op">,</span></span>
<span id="cb61-2429"><a href="#cb61-2429" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ Over 4 Classes"</span><span class="op">,</span></span>
<span id="cb61-2430"><a href="#cb61-2430" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> arrayAi[d]<span class="op">,</span></span>
<span id="cb61-2431"><a href="#cb61-2431" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb61-2432"><a href="#cb61-2432" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> rangeBeta2 }<span class="op">,</span></span>
<span id="cb61-2433"><a href="#cb61-2433" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb61-2434"><a href="#cb61-2434" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb61-2435"><a href="#cb61-2435" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb61-2436"><a href="#cb61-2436" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb61-2437"><a href="#cb61-2437" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb61-2438"><a href="#cb61-2438" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"βᵢ²"</span> })<span class="op">,</span></span>
<span id="cb61-2439"><a href="#cb61-2439" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>(scaleG<span class="op">.</span><span class="fu">ticks</span>()<span class="op">,</span> { <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> scaleG })<span class="op">,</span></span>
<span id="cb61-2440"><a href="#cb61-2440" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(betaContribData<span class="op">,</span> {</span>
<span id="cb61-2441"><a href="#cb61-2441" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb61-2442"><a href="#cb61-2442" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span><span class="op">,</span></span>
<span id="cb61-2443"><a href="#cb61-2443" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialBeta2<span class="op">,</span></span>
<span id="cb61-2444"><a href="#cb61-2444" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2445"><a href="#cb61-2445" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb61-2446"><a href="#cb61-2446" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(betaContribData<span class="op">,</span> {</span>
<span id="cb61-2447"><a href="#cb61-2447" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span><span class="op">,</span></span>
<span id="cb61-2448"><a href="#cb61-2448" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb61-2449"><a href="#cb61-2449" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewBeta2<span class="op">,</span></span>
<span id="cb61-2450"><a href="#cb61-2450" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2451"><a href="#cb61-2451" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb61-2452"><a href="#cb61-2452" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2453"><a href="#cb61-2453" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2454"><a href="#cb61-2454" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialG<span class="op">,</span></span>
<span id="cb61-2455"><a href="#cb61-2455" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2456"><a href="#cb61-2456" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb61-2457"><a href="#cb61-2457" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2458"><a href="#cb61-2458" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2459"><a href="#cb61-2459" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2460"><a href="#cb61-2460" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialG<span class="op">,</span></span>
<span id="cb61-2461"><a href="#cb61-2461" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2462"><a href="#cb61-2462" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2463"><a href="#cb61-2463" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2464"><a href="#cb61-2464" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2465"><a href="#cb61-2465" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewG<span class="op">,</span></span>
<span id="cb61-2466"><a href="#cb61-2466" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2467"><a href="#cb61-2467" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb61-2468"><a href="#cb61-2468" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2469"><a href="#cb61-2469" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2470"><a href="#cb61-2470" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2471"><a href="#cb61-2471" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewG<span class="op">,</span></span>
<span id="cb61-2472"><a href="#cb61-2472" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2473"><a href="#cb61-2473" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2474"><a href="#cb61-2474" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([stringInitialBeta]<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fl">0.23</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="st">"blue"</span> })<span class="op">,</span></span>
<span id="cb61-2475"><a href="#cb61-2475" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([stringNewBeta]<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fl">0.23</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="st">"red"</span> })<span class="op">,</span></span>
<span id="cb61-2476"><a href="#cb61-2476" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb61-2477"><a href="#cb61-2477" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-61" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-example-of-g-stake-on-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Example of <strong>G</strong> allocation on <span class="math inline">\beta</span>.
</figcaption>
</figure>
</div>
<p><a href="#fig-example-of-g-stake-on-beta" class="quarto-xref">Figure&nbsp;19</a> shows <span class="math inline">\beta</span>’s sensitivity to <strong>G</strong> allocation as a function of <strong>A</strong> allocation; that is to say that a large <span class="math inline">G_i</span> stake on a small <span class="math inline">A_i</span> stake has limited effects&nbsp;(notwithstanding other consequential factors).</p>
</section>
<section id="sec-allocation-of-risk-premium" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="sec-allocation-of-risk-premium"><span class="header-section-number">3.3.3</span> Allocation of Risk Premium</h4>
<p>The full issuance of <strong>A</strong> tokens is depicted below including now the Risk Premium for the liquidity pools accordingly.</p>
<div id="fig-a-token-flow-structure" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A token flow structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-token-flow-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/a-token-flow-structure.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-token-flow-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: <strong>A</strong> token flow structure.
</figcaption>
</figure>
</div>
</section>
<section id="sec-share-of-risk-premium" class="level4" data-number="3.3.4">
<h4 data-number="3.3.4" class="anchored" data-anchor-id="sec-share-of-risk-premium"><span class="header-section-number">3.3.4</span> Share of Risk Premium</h4>
<p>The Risk Premium allocation is shared between user-locked <strong>G</strong> tokens, <span class="overline"><strong>AG</strong></span>. and <span class="overline"><strong>AQ</strong></span> pools, with shares <span class="math inline">\lambda_{GG}</span>, <span class="math inline">\lambda_G</span>, and <span class="math inline">\lambda_Q</span> respectively.</p>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">G_G</span>: Total <strong>G</strong> tokens in the <span class="overline"><strong>AG</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>G</strong>.</p></li>
<li><p><span class="math inline">A_G</span>: Total <strong>A</strong>&nbsp;tokens in the <span class="overline"><strong>AG</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
<li><p><span class="math inline">A_Q</span>: Total <strong>A</strong>&nbsp;tokens in the <span class="overline"><strong>AQ</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
</ul>
<p>The allocation to user-locked <strong>G</strong> tokens, <span class="math inline">\lambda_{GG}</span>:</p>
<p><span id="eq-lambda-gg"><span class="math display">
\lambda_{GG} = \frac{1 - A_Q}{1 + \left( \frac{\sum_{i=1}^{n}{G_i}}{G_G} \right)^2}
\tag{23}</span></span></p>
<div id="fig-g-stake-allocation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="G stake allocation.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-g-stake-allocation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb62" data-startfrom="2558" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2557;"><span id="cb62-2558"><a href="#cb62-2558" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaGG</span>(AQ<span class="op">,</span> Gi<span class="op">,</span> GG) {</span>
<span id="cb62-2559"><a href="#cb62-2559" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> AQ) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> (Gi <span class="op">/</span> GG)<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb62-2560"><a href="#cb62-2560" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-2561"><a href="#cb62-2561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2562"><a href="#cb62-2562" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">changeTranslation</span>(dx<span class="op">,</span> dy) {</span>
<span id="cb62-2563"><a href="#cb62-2563" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">function</span> () {</span>
<span id="cb62-2564"><a href="#cb62-2564" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svgTransformList <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">transform</span><span class="op">.</span><span class="at">baseVal</span><span class="op">;</span></span>
<span id="cb62-2565"><a href="#cb62-2565" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (svgTransformList<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb62-2566"><a href="#cb62-2566" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"SVGTransformList must only contain one translation"</span>)<span class="op">;</span></span>
<span id="cb62-2567"><a href="#cb62-2567" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-2568"><a href="#cb62-2568" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {e<span class="op">,</span> f} <span class="op">=</span> svgTransformList<span class="op">.</span><span class="fu">consolidate</span>()<span class="op">.</span><span class="at">matrix</span><span class="op">;</span></span>
<span id="cb62-2569"><a href="#cb62-2569" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`translate(</span><span class="sc">${</span>e <span class="op">+</span> dx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>f <span class="op">+</span> dy<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb62-2570"><a href="#cb62-2570" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-2571"><a href="#cb62-2571" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-62-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-62-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb63" data-startfrom="2574" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2573;"><span id="cb63-2574"><a href="#cb63-2574" aria-hidden="true" tabindex="-1"></a>lambdaGGData <span class="op">=</span> {</span>
<span id="cb63-2575"><a href="#cb63-2575" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambdaGGData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb63-2576"><a href="#cb63-2576" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb63-2577"><a href="#cb63-2577" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAQ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAQ <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb63-2578"><a href="#cb63-2578" aria-hidden="true" tabindex="-1"></a>      lambdaGGData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb63-2579"><a href="#cb63-2579" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb63-2580"><a href="#cb63-2580" aria-hidden="true" tabindex="-1"></a>        <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb63-2581"><a href="#cb63-2581" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb63-2582"><a href="#cb63-2582" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaGG</span>(paramAQ<span class="op">,</span> paramGi<span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> paramGi)<span class="op">,</span></span>
<span id="cb63-2583"><a href="#cb63-2583" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb63-2584"><a href="#cb63-2584" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-2585"><a href="#cb63-2585" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-2586"><a href="#cb63-2586" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> lambdaGGData<span class="op">;</span></span>
<span id="cb63-2587"><a href="#cb63-2587" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-63" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb64" data-startfrom="2591" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2590;"><span id="cb64-2591"><a href="#cb64-2591" aria-hidden="true" tabindex="-1"></a>plotLambdaGG <span class="op">=</span> {</span>
<span id="cb64-2592"><a href="#cb64-2592" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotLambdaGG <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb64-2593"><a href="#cb64-2593" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb64-2594"><a href="#cb64-2594" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb64-2595"><a href="#cb64-2595" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb64-2596"><a href="#cb64-2596" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb64-2597"><a href="#cb64-2597" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb64-2598"><a href="#cb64-2598" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb64-2599"><a href="#cb64-2599" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb64-2600"><a href="#cb64-2600" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"A  "</span> }<span class="op">,</span></span>
<span id="cb64-2601"><a href="#cb64-2601" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb64-2602"><a href="#cb64-2602" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb64-2603"><a href="#cb64-2603" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb64-2604"><a href="#cb64-2604" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(lambdaGGData<span class="op">,</span> {</span>
<span id="cb64-2605"><a href="#cb64-2605" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2606"><a href="#cb64-2606" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2607"><a href="#cb64-2607" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2608"><a href="#cb64-2608" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2609"><a href="#cb64-2609" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb64-2610"><a href="#cb64-2610" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb64-2611"><a href="#cb64-2611" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(lambdaGGData<span class="op">,</span> {</span>
<span id="cb64-2612"><a href="#cb64-2612" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"aq"</span><span class="op">,</span></span>
<span id="cb64-2613"><a href="#cb64-2613" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb64-2614"><a href="#cb64-2614" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2615"><a href="#cb64-2615" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2616"><a href="#cb64-2616" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb64-2617"><a href="#cb64-2617" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb64-2618"><a href="#cb64-2618" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb64-2619"><a href="#cb64-2619" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb64-2620"><a href="#cb64-2620" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb64-2621"><a href="#cb64-2621" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb64-2622"><a href="#cb64-2622" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb64-2623"><a href="#cb64-2623" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb64-2624"><a href="#cb64-2624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2625"><a href="#cb64-2625" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGG)</span>
<span id="cb64-2626"><a href="#cb64-2626" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='x-axis label']"</span>)</span>
<span id="cb64-2627"><a href="#cb64-2627" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb64-2628"><a href="#cb64-2628" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb64-2629"><a href="#cb64-2629" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="fl">1.5</span>))</span>
<span id="cb64-2630"><a href="#cb64-2630" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb64-2631"><a href="#cb64-2631" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb64-2632"><a href="#cb64-2632" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb64-2633"><a href="#cb64-2633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2634"><a href="#cb64-2634" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotLambdaGG<span class="op">;</span></span>
<span id="cb64-2635"><a href="#cb64-2635" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-64" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-g-stake-allocation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: <strong>G</strong> stake allocation&nbsp;(assuming <span class="math inline">G_G = 1 - G_i</span>).
</figcaption>
</figure>
</div>
<p>Noting the relationship between <span class="math inline">G</span> and <span class="math inline">\beta</span>, and particularly if <span class="math inline">G = 0</span>, <span class="math inline">\beta = 0</span>.</p>
<p>The residual share, <span class="math inline">1 - \lambda_{GG}</span>, is split between the liquidity pools:</p>
<p><span id="eq-lambda-g"><span class="math display">
\lambda_G = (1 - \lambda_{GG}) \frac{2 A_G}{2 A_G + A_Q \sqrt 2}
\tag{24}</span></span></p>
<p>For completeness:</p>
<p><span id="eq-lambda-q"><span class="math display">
\lambda_Q = 1 - \lambda_{GG} - \lambda_G
\tag{25}</span></span></p>
<div id="fig-liquidity-pool-split" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Liquidity pool split.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-liquidity-pool-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb65" data-startfrom="2664" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2663;"><span id="cb65-2664"><a href="#cb65-2664" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaG</span>(AQ<span class="op">,</span> AG) {</span>
<span id="cb65-2665"><a href="#cb65-2665" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> AG <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> AG <span class="op">+</span> AQ <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb65-2666"><a href="#cb65-2666" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-65" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb66" data-startfrom="2670" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2669;"><span id="cb66-2670"><a href="#cb66-2670" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaQ</span>(AQ<span class="op">,</span> AG) {</span>
<span id="cb66-2671"><a href="#cb66-2671" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> <span class="fu">computeLambdaG</span>(AQ<span class="op">,</span> AG)<span class="op">;</span></span>
<span id="cb66-2672"><a href="#cb66-2672" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-66" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb67" data-startfrom="2676" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2675;"><span id="cb67-2676"><a href="#cb67-2676" aria-hidden="true" tabindex="-1"></a>lambdaGQData <span class="op">=</span> {</span>
<span id="cb67-2677"><a href="#cb67-2677" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambdaGQData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb67-2678"><a href="#cb67-2678" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramAG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb67-2679"><a href="#cb67-2679" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAQ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAQ <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb67-2680"><a href="#cb67-2680" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramAG <span class="op">+</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb67-2681"><a href="#cb67-2681" aria-hidden="true" tabindex="-1"></a>        lambdaGQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb67-2682"><a href="#cb67-2682" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"Relative 𝗔𝗚 Liquidity Pool Share"</span><span class="op">,</span></span>
<span id="cb67-2683"><a href="#cb67-2683" aria-hidden="true" tabindex="-1"></a>          <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb67-2684"><a href="#cb67-2684" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ag</span><span class="op">:</span> paramAG<span class="op">,</span></span>
<span id="cb67-2685"><a href="#cb67-2685" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaG</span>(paramAQ<span class="op">,</span> paramAG)<span class="op">,</span></span>
<span id="cb67-2686"><a href="#cb67-2686" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb67-2687"><a href="#cb67-2687" aria-hidden="true" tabindex="-1"></a>        lambdaGQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb67-2688"><a href="#cb67-2688" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"Relative 𝗔𝗤 Liquidity Pool Share"</span><span class="op">,</span></span>
<span id="cb67-2689"><a href="#cb67-2689" aria-hidden="true" tabindex="-1"></a>          <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb67-2690"><a href="#cb67-2690" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ag</span><span class="op">:</span> paramAG<span class="op">,</span></span>
<span id="cb67-2691"><a href="#cb67-2691" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaQ</span>(paramAQ<span class="op">,</span> paramAG)<span class="op">,</span></span>
<span id="cb67-2692"><a href="#cb67-2692" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb67-2693"><a href="#cb67-2693" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-2694"><a href="#cb67-2694" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb67-2695"><a href="#cb67-2695" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb67-2696"><a href="#cb67-2696" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> lambdaGQData<span class="op">;</span></span>
<span id="cb67-2697"><a href="#cb67-2697" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-67" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb68" data-startfrom="2701" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2700;"><span id="cb68-2701"><a href="#cb68-2701" aria-hidden="true" tabindex="-1"></a>plotLambdaGQ <span class="op">=</span> {</span>
<span id="cb68-2702"><a href="#cb68-2702" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotLambdaGQ <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb68-2703"><a href="#cb68-2703" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb68-2704"><a href="#cb68-2704" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb68-2705"><a href="#cb68-2705" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb68-2706"><a href="#cb68-2706" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb68-2707"><a href="#cb68-2707" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb68-2708"><a href="#cb68-2708" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb68-2709"><a href="#cb68-2709" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb68-2710"><a href="#cb68-2710" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb68-2711"><a href="#cb68-2711" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"A  "</span> }<span class="op">,</span></span>
<span id="cb68-2712"><a href="#cb68-2712" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb68-2713"><a href="#cb68-2713" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb68-2714"><a href="#cb68-2714" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb68-2715"><a href="#cb68-2715" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"A"</span><span class="op">,</span></span>
<span id="cb68-2716"><a href="#cb68-2716" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb68-2717"><a href="#cb68-2717" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb68-2718"><a href="#cb68-2718" aria-hidden="true" tabindex="-1"></a>    <span class="dt">className</span><span class="op">:</span> <span class="st">"LambdaGQ"</span><span class="op">,</span></span>
<span id="cb68-2719"><a href="#cb68-2719" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb68-2720"><a href="#cb68-2720" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb68-2721"><a href="#cb68-2721" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(lambdaGQData<span class="op">,</span> {</span>
<span id="cb68-2722"><a href="#cb68-2722" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2723"><a href="#cb68-2723" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2724"><a href="#cb68-2724" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ag</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2725"><a href="#cb68-2725" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ag</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2726"><a href="#cb68-2726" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb68-2727"><a href="#cb68-2727" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb68-2728"><a href="#cb68-2728" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb68-2729"><a href="#cb68-2729" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(lambdaGQData<span class="op">,</span> {</span>
<span id="cb68-2730"><a href="#cb68-2730" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"aq"</span><span class="op">,</span></span>
<span id="cb68-2731"><a href="#cb68-2731" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"ag"</span><span class="op">,</span></span>
<span id="cb68-2732"><a href="#cb68-2732" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb68-2733"><a href="#cb68-2733" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb68-2734"><a href="#cb68-2734" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb68-2735"><a href="#cb68-2735" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb68-2736"><a href="#cb68-2736" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb68-2737"><a href="#cb68-2737" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb68-2738"><a href="#cb68-2738" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb68-2739"><a href="#cb68-2739" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb68-2740"><a href="#cb68-2740" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb68-2741"><a href="#cb68-2741" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb68-2742"><a href="#cb68-2742" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb68-2743"><a href="#cb68-2743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2744"><a href="#cb68-2744" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGQ)</span>
<span id="cb68-2745"><a href="#cb68-2745" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='x-axis label']"</span>)</span>
<span id="cb68-2746"><a href="#cb68-2746" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb68-2747"><a href="#cb68-2747" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb68-2748"><a href="#cb68-2748" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="fl">1.5</span>))</span>
<span id="cb68-2749"><a href="#cb68-2749" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb68-2750"><a href="#cb68-2750" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb68-2751"><a href="#cb68-2751" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb68-2752"><a href="#cb68-2752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2753"><a href="#cb68-2753" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGQ)</span>
<span id="cb68-2754"><a href="#cb68-2754" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb68-2755"><a href="#cb68-2755" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb68-2756"><a href="#cb68-2756" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb68-2757"><a href="#cb68-2757" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb68-2758"><a href="#cb68-2758" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">14</span><span class="op">,</span> <span class="fl">4.1</span>))</span>
<span id="cb68-2759"><a href="#cb68-2759" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb68-2760"><a href="#cb68-2760" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb68-2761"><a href="#cb68-2761" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"G"</span>)<span class="op">;</span></span>
<span id="cb68-2762"><a href="#cb68-2762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2763"><a href="#cb68-2763" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotLambdaGQ<span class="op">;</span></span>
<span id="cb68-2764"><a href="#cb68-2764" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-68" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-liquidity-pool-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22: Liquidity pool split <span class="math inline">\lambda_G, \lambda_Q</span>.
</figcaption>
</figure>
</div>
</section>
<section id="sec-risk-premium-distribution" class="level4" data-number="3.3.5">
<h4 data-number="3.3.5" class="anchored" data-anchor-id="sec-risk-premium-distribution"><span class="header-section-number">3.3.5</span> Risk Premium Distribution</h4>
<p>For <span class="math inline">\lambda_{GG}</span>, <span class="math inline">\lambda_G</span>, <span class="math inline">\lambda_Q</span> we apply <span class="math inline">\beta</span>:</p>
<p><span id="eq-capital-lambda"><span class="math display">
\Lambda_X = \lambda_X \, \beta, \quad \text{for } X \in \{GG, G, Q\}
\tag{26}</span></span></p>
<p>Taking <span class="math inline">b</span> as a discount parameter:</p>
<p><span id="eq-discount-parameter"><span class="math display">
b = \frac{\sum_1^{40} Z_t \, S_t \, B_t}{\sum_1^{40} Z_t \, S_t }
\tag{27}</span></span></p>
<p>The total Risk Premium tokens <span class="math inline">R_\lambda</span>:</p>
<p><span id="eq-risk-premium"><span class="math display">
R_\lambda = b \, R \, (\Lambda_{GG} + \Lambda_G + \Lambda_Q)
\tag{28}</span></span></p>
<p>The allocations of <span class="math inline">R_\lambda</span> are pro-rata to <span class="math inline">\Lambda_{GG}</span>, <span class="math inline">\Lambda_G</span>, <span class="math inline">\Lambda_Q</span>, and thereafter:</p>
<ol type="1">
<li><p>Locked <strong>G</strong>: <span class="math inline">\Lambda_{GG}</span> in proportion to <strong>G</strong>.</p></li>
<li><p>Locked <span class="overline"><strong>AG</strong></span>, <span class="overline"><strong>AQ</strong></span> tokens are allocated a weighting <span class="math inline">G_t</span>, <span class="math inline">Q_t</span> depending on their time bucket <span class="math inline">t</span>:</p>
<p><span id="eq-risky-premium-weighting-ag-pool"><span class="math display">
G_t = \frac{Z_t \, L_{Gt} \, B_t}{\sum Z_t \, L_{Gt} \, B_t}
  \tag{29}</span></span></p>
<p><span id="eq-risky-premium-weighting-aq-pool"><span class="math display">
Q_t = \frac{Z_t \, L_{Qt} \, B_t}{\sum Z_t \, L_{Qt} \, B_t}
  \tag{30}</span></span></p>
<p>Where <span class="math inline">L_{Gt}</span>, <span class="math inline">L_{Qt}</span> are the proportion of all liquidity locked in each time bucket for <span class="overline"><strong>AG</strong></span> and <span class="overline"><strong>AQ</strong></span> respectively.</p></li>
</ol>
<p>Thereafter each time bucket allocation is proportionate to staked liquidity provider token holdings.</p>
</section>
</section>
<section id="sec-interactive-model" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="sec-interactive-model"><span class="header-section-number">3.4</span> Interactive Model</h3>
<p>This additional section is only in the interactive version of the whitepaper. It presents an interactive model of the AAM where each parameter of interest can be adjusted by the reader.</p>
<p>In <a href="#sec-kvcm-tokens-minted-when-the-aam-purchases-carbon" class="quarto-xref">Section&nbsp;3.4.1</a>, a carbon holder sells carbon to the AAM in exchange for <strong>A</strong> tokens; from the point of view of the AAM, this represents a carbon purchase. In <a href="#sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens" class="quarto-xref">Section&nbsp;3.4.2</a>, a holder of <strong>A</strong> tokens burns them to buy carbon from the AAM; from the point of view of the AAM, this represents a carbon sale.</p>
<section id="sec-kvcm-tokens-minted-when-the-aam-purchases-carbon" class="level4" data-number="3.4.1">
<h4 data-number="3.4.1" class="anchored" data-anchor-id="sec-kvcm-tokens-minted-when-the-aam-purchases-carbon"><span class="header-section-number">3.4.1</span> kVCM Tokens Minted When the AAM Purchases Carbon</h4>
<p>In this section, the reader controls how many present-value tonnes of carbon class <span class="math inline">i</span> are purchased by the AAM. The number of <strong>A</strong> tokens emitted in exchange is calculated in real time. The price of carbon class <span class="math inline">i</span> is calculated by dividing the number of <strong>A</strong> tokens emitted by the AAM by the number of present-value tonnes of carbon class <span class="math inline">i</span> purchased by the AAM.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb69" data-startfrom="2862" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2861;"><span id="cb69-2862"><a href="#cb69-2862" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">piecewiseLogTransform</span>(xTran <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb69-2863"><a href="#cb69-2863" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="kw">=&gt;</span> x <span class="op">&gt;</span> xTran <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x) <span class="op">:</span> x <span class="op">-</span> xTran <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(xTran)<span class="op">;</span></span>
<span id="cb69-2864"><a href="#cb69-2864" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2865"><a href="#cb69-2865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2866"><a href="#cb69-2866" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">piecewiseLogInvert</span>(xTran <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb69-2867"><a href="#cb69-2867" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> y <span class="kw">=&gt;</span> y <span class="op">&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(xTran) <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(y) <span class="op">:</span> y <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(xTran) <span class="op">+</span> xTran<span class="op">;</span></span>
<span id="cb69-2868"><a href="#cb69-2868" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2869"><a href="#cb69-2869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2870"><a href="#cb69-2870" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setInput</span>(input<span class="op">,</span> value) {</span>
<span id="cb69-2871"><a href="#cb69-2871" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb69-2872"><a href="#cb69-2872" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb69-2873"><a href="#cb69-2873" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2874"><a href="#cb69-2874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2875"><a href="#cb69-2875" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">numDigits</span>(x) {</span>
<span id="cb69-2876"><a href="#cb69-2876" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> (<span class="dv">1</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(x)))<span class="op">;</span></span>
<span id="cb69-2877"><a href="#cb69-2877" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb70" data-startfrom="2881" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2880;"><span id="cb70-2881"><a href="#cb70-2881" aria-hidden="true" tabindex="-1"></a>defaultAValue <span class="op">=</span> <span class="fl">2e6</span><span class="op">;</span></span>
<span id="cb70-2882"><a href="#cb70-2882" aria-hidden="true" tabindex="-1"></a>defaultASupply <span class="op">=</span> <span class="fl">2e7</span><span class="op">;</span></span>
<span id="cb70-2883"><a href="#cb70-2883" aria-hidden="true" tabindex="-1"></a>defaultPresentTonnes <span class="op">=</span> <span class="fl">1e7</span><span class="op">;</span></span>
<span id="cb70-2884"><a href="#cb70-2884" aria-hidden="true" tabindex="-1"></a>defaultDeltaTonnes <span class="op">=</span> <span class="fl">1e2</span><span class="op">;</span></span>
<span id="cb70-2885"><a href="#cb70-2885" aria-hidden="true" tabindex="-1"></a>defaultAi <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb70-2886"><a href="#cb70-2886" aria-hidden="true" tabindex="-1"></a>defaultGi <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb71" data-startfrom="2889" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2888;"><span id="cb71-2889"><a href="#cb71-2889" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>(</span>
<span id="cb71-2890"><a href="#cb71-2890" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">"Reset"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb71-2891"><a href="#cb71-2891" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAValue<span class="op">,</span> defaultAValue)<span class="op">;</span></span>
<span id="cb71-2892"><a href="#cb71-2892" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputASupply<span class="op">,</span> defaultASupply)<span class="op">;</span></span>
<span id="cb71-2893"><a href="#cb71-2893" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputPresentTonnes<span class="op">,</span> defaultPresentTonnes)<span class="op">;</span></span>
<span id="cb71-2894"><a href="#cb71-2894" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputDeltaTonnes<span class="op">,</span> defaultDeltaTonnes)<span class="op">;</span></span>
<span id="cb71-2895"><a href="#cb71-2895" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAi<span class="op">,</span> defaultAi)<span class="op">;</span></span>
<span id="cb71-2896"><a href="#cb71-2896" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputGi<span class="op">,</span> defaultGi)<span class="op">;</span></span>
<span id="cb71-2897"><a href="#cb71-2897" aria-hidden="true" tabindex="-1"></a>  }]]<span class="op">,</span></span>
<span id="cb71-2898"><a href="#cb71-2898" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-71" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb72" data-startfrom="2903" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2902;"><span id="cb72-2903"><a href="#cb72-2903" aria-hidden="true" tabindex="-1"></a>viewof inputAValue <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e5</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb72-2904"><a href="#cb72-2904" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Market cap. of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb72-2905"><a href="#cb72-2905" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb72-2906"><a href="#cb72-2906" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAValue<span class="op">,</span></span>
<span id="cb72-2907"><a href="#cb72-2907" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2908"><a href="#cb72-2908" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2909"><a href="#cb72-2909" aria-hidden="true" tabindex="-1"></a>viewof inputASupply <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e6</span><span class="op">,</span> <span class="fl">1e10</span>]<span class="op">,</span> {</span>
<span id="cb72-2910"><a href="#cb72-2910" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Supply of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb72-2911"><a href="#cb72-2911" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb72-2912"><a href="#cb72-2912" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultASupply<span class="op">,</span></span>
<span id="cb72-2913"><a href="#cb72-2913" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2914"><a href="#cb72-2914" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2915"><a href="#cb72-2915" aria-hidden="true" tabindex="-1"></a>viewof inputPresentTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb72-2916"><a href="#cb72-2916" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } </span><span class="sc">\b</span><span class="vs">ar C_i`</span><span class="op">,</span></span>
<span id="cb72-2917"><a href="#cb72-2917" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb72-2918"><a href="#cb72-2918" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultPresentTonnes<span class="op">,</span></span>
<span id="cb72-2919"><a href="#cb72-2919" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-3</span>)<span class="op">,</span></span>
<span id="cb72-2920"><a href="#cb72-2920" aria-hidden="true" tabindex="-1"></a>  <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-3</span>)<span class="op">,</span></span>
<span id="cb72-2921"><a href="#cb72-2921" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2922"><a href="#cb72-2922" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-3</span><span class="op">,</span> <span class="fl">1e7</span>]<span class="op">,</span> {</span>
<span id="cb72-2923"><a href="#cb72-2923" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased tonnes}`</span><span class="op">,</span></span>
<span id="cb72-2924"><a href="#cb72-2924" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb72-2925"><a href="#cb72-2925" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultDeltaTonnes<span class="op">,</span></span>
<span id="cb72-2926"><a href="#cb72-2926" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2927"><a href="#cb72-2927" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2928"><a href="#cb72-2928" aria-hidden="true" tabindex="-1"></a>viewof inputAi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb72-2929"><a href="#cb72-2929" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } A_i`</span><span class="op">,</span></span>
<span id="cb72-2930"><a href="#cb72-2930" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb72-2931"><a href="#cb72-2931" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAi<span class="op">,</span></span>
<span id="cb72-2932"><a href="#cb72-2932" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb72-2933"><a href="#cb72-2933" aria-hidden="true" tabindex="-1"></a>  <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb72-2934"><a href="#cb72-2934" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2935"><a href="#cb72-2935" aria-hidden="true" tabindex="-1"></a>viewof inputGi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb72-2936"><a href="#cb72-2936" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } G_i`</span><span class="op">,</span></span>
<span id="cb72-2937"><a href="#cb72-2937" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb72-2938"><a href="#cb72-2938" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultGi<span class="op">,</span></span>
<span id="cb72-2939"><a href="#cb72-2939" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb73" data-startfrom="2943" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2942;"><span id="cb73-2943"><a href="#cb73-2943" aria-hidden="true" tabindex="-1"></a>paramDeltaA <span class="op">=</span> <span class="fu">computeTrueDeltaA</span>(</span>
<span id="cb73-2944"><a href="#cb73-2944" aria-hidden="true" tabindex="-1"></a>  inputAi<span class="op">,</span></span>
<span id="cb73-2945"><a href="#cb73-2945" aria-hidden="true" tabindex="-1"></a>  inputGi<span class="op">,</span></span>
<span id="cb73-2946"><a href="#cb73-2946" aria-hidden="true" tabindex="-1"></a>  inputPresentTonnes<span class="op">,</span></span>
<span id="cb73-2947"><a href="#cb73-2947" aria-hidden="true" tabindex="-1"></a>  inputDeltaTonnes<span class="op">,</span></span>
<span id="cb73-2948"><a href="#cb73-2948" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb73-2949"><a href="#cb73-2949" aria-hidden="true" tabindex="-1"></a>paramDeltaTonnes <span class="op">=</span> paramDeltaA <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputDeltaTonnes<span class="op">;</span></span>
<span id="cb73-2950"><a href="#cb73-2950" aria-hidden="true" tabindex="-1"></a>paramAEmitted <span class="op">=</span> paramDeltaA <span class="op">*</span> inputASupply<span class="op">;</span></span>
<span id="cb73-2951"><a href="#cb73-2951" aria-hidden="true" tabindex="-1"></a>paramAPrice <span class="op">=</span> inputAValue <span class="op">/</span> inputASupply<span class="op">;</span></span>
<span id="cb73-2952"><a href="#cb73-2952" aria-hidden="true" tabindex="-1"></a>paramBarCiPrice <span class="op">=</span> inputAValue <span class="op">*</span> paramDeltaA <span class="op">/</span> inputDeltaTonnes<span class="op">;</span></span>
<span id="cb73-2953"><a href="#cb73-2953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-2954"><a href="#cb73-2954" aria-hidden="true" tabindex="-1"></a>stringASupply <span class="op">=</span> inputASupply<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2955"><a href="#cb73-2955" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2956"><a href="#cb73-2956" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2957"><a href="#cb73-2957" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-2958"><a href="#cb73-2958" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-2959"><a href="#cb73-2959" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2960"><a href="#cb73-2960" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb73-2961"><a href="#cb73-2961" aria-hidden="true" tabindex="-1"></a>stringPresentTonnes <span class="op">=</span> inputPresentTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2962"><a href="#cb73-2962" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2963"><a href="#cb73-2963" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2964"><a href="#cb73-2964" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-2965"><a href="#cb73-2965" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-2966"><a href="#cb73-2966" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2967"><a href="#cb73-2967" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb73-2968"><a href="#cb73-2968" aria-hidden="true" tabindex="-1"></a>stringAEmitted <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> paramAEmitted<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2969"><a href="#cb73-2969" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2970"><a href="#cb73-2970" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2971"><a href="#cb73-2971" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-2972"><a href="#cb73-2972" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-2973"><a href="#cb73-2973" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2974"><a href="#cb73-2974" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb73-2975"><a href="#cb73-2975" aria-hidden="true" tabindex="-1"></a>stringDeltaTonnes <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> paramDeltaTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2976"><a href="#cb73-2976" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2977"><a href="#cb73-2977" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2978"><a href="#cb73-2978" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">3</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-2979"><a href="#cb73-2979" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">3</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-2980"><a href="#cb73-2980" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2981"><a href="#cb73-2981" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb73-2982"><a href="#cb73-2982" aria-hidden="true" tabindex="-1"></a>stringAPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramAPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2983"><a href="#cb73-2983" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2984"><a href="#cb73-2984" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2985"><a href="#cb73-2985" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice))<span class="op">,</span></span>
<span id="cb73-2986"><a href="#cb73-2986" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice))<span class="op">,</span></span>
<span id="cb73-2987"><a href="#cb73-2987" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2988"><a href="#cb73-2988" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb73-2989"><a href="#cb73-2989" aria-hidden="true" tabindex="-1"></a>stringBarCiPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramBarCiPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2990"><a href="#cb73-2990" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2991"><a href="#cb73-2991" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2992"><a href="#cb73-2992" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramBarCiPrice))<span class="op">,</span></span>
<span id="cb73-2993"><a href="#cb73-2993" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramBarCiPrice))<span class="op">,</span></span>
<span id="cb73-2994"><a href="#cb73-2994" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2995"><a href="#cb73-2995" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Supply of <strong>A</strong> Tokens</th>
<th style="text-align: right;">Portfolio Carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-3"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-4"></span></span></td>
</tr>
<tr class="even">
<td><strong>Variation</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-5"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-6"></span></span></td>
</tr>
<tr class="odd">
<td><strong>Unit Price</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-7"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-8"></span></span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens" class="level4" data-number="3.4.2">
<h4 data-number="3.4.2" class="anchored" data-anchor-id="sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens"><span class="header-section-number">3.4.2</span> Carbon Sold by the AAM When it Burns kVCM Tokens</h4>
<p>In this section, the reader controls how many <strong>A</strong> tokens are burnt by the AAM. The number of liquid tonnes of carbon class <span class="math inline">i</span> sold by the AAM in exchange is calculated in real time. The price of carbon is calculated by dividing the number of <strong>A</strong> tokens burnt by the AAM by the number of liquid tonnes of carbon class <span class="math inline">i</span> sold by the AAM.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb74" data-startfrom="3021" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3020;"><span id="cb74-3021"><a href="#cb74-3021" aria-hidden="true" tabindex="-1"></a>defaultLiquidTonnes <span class="op">=</span> <span class="fl">1e7</span><span class="op">;</span></span>
<span id="cb74-3022"><a href="#cb74-3022" aria-hidden="true" tabindex="-1"></a>defaultABurnt <span class="op">=</span> <span class="fl">1e2</span><span class="op">;</span></span>
<span id="cb74-3023"><a href="#cb74-3023" aria-hidden="true" tabindex="-1"></a>defaultGnull <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb74-3024"><a href="#cb74-3024" aria-hidden="true" tabindex="-1"></a>defaultA <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb74-3025"><a href="#cb74-3025" aria-hidden="true" tabindex="-1"></a>defaultS <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb75" data-startfrom="3028" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3027;"><span id="cb75-3028"><a href="#cb75-3028" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>(</span>
<span id="cb75-3029"><a href="#cb75-3029" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">"Reset"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb75-3030"><a href="#cb75-3030" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAValue_<span class="op">,</span> defaultAValue)<span class="op">;</span></span>
<span id="cb75-3031"><a href="#cb75-3031" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputASupply_<span class="op">,</span> defaultASupply)<span class="op">;</span></span>
<span id="cb75-3032"><a href="#cb75-3032" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputLiquidTonnes<span class="op">,</span> defaultLiquidTonnes)<span class="op">;</span></span>
<span id="cb75-3033"><a href="#cb75-3033" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputABurnt<span class="op">,</span> defaultABurnt)<span class="op">;</span></span>
<span id="cb75-3034"><a href="#cb75-3034" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAi<span class="op">,</span> defaultAi)<span class="op">;</span></span>
<span id="cb75-3035"><a href="#cb75-3035" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputGi<span class="op">,</span> defaultGi)<span class="op">;</span></span>
<span id="cb75-3036"><a href="#cb75-3036" aria-hidden="true" tabindex="-1"></a>  }]]<span class="op">,</span></span>
<span id="cb75-3037"><a href="#cb75-3037" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-75" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb76" data-startfrom="3042" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3041;"><span id="cb76-3042"><a href="#cb76-3042" aria-hidden="true" tabindex="-1"></a>viewof inputAValue_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e5</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb76-3043"><a href="#cb76-3043" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Market cap. of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb76-3044"><a href="#cb76-3044" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb76-3045"><a href="#cb76-3045" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAValue<span class="op">,</span></span>
<span id="cb76-3046"><a href="#cb76-3046" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3047"><a href="#cb76-3047" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3048"><a href="#cb76-3048" aria-hidden="true" tabindex="-1"></a>viewof inputASupply_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e6</span><span class="op">,</span> <span class="fl">1e10</span>]<span class="op">,</span> {</span>
<span id="cb76-3049"><a href="#cb76-3049" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Supply of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb76-3050"><a href="#cb76-3050" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb76-3051"><a href="#cb76-3051" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultASupply<span class="op">,</span></span>
<span id="cb76-3052"><a href="#cb76-3052" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3053"><a href="#cb76-3053" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3054"><a href="#cb76-3054" aria-hidden="true" tabindex="-1"></a>viewof inputLiquidTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-3</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb76-3055"><a href="#cb76-3055" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } C_{i0}`</span><span class="op">,</span></span>
<span id="cb76-3056"><a href="#cb76-3056" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb76-3057"><a href="#cb76-3057" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultLiquidTonnes<span class="op">,</span></span>
<span id="cb76-3058"><a href="#cb76-3058" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3059"><a href="#cb76-3059" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3060"><a href="#cb76-3060" aria-hidden="true" tabindex="-1"></a>viewof inputABurnt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-1</span><span class="op">,</span> <span class="fl">1e6</span>]<span class="op">,</span> {</span>
<span id="cb76-3061"><a href="#cb76-3061" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{</span><span class="sc">\t</span><span class="vs">extbf{A} tokens burnt}`</span><span class="op">,</span></span>
<span id="cb76-3062"><a href="#cb76-3062" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-1</span><span class="op">,</span></span>
<span id="cb76-3063"><a href="#cb76-3063" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultABurnt<span class="op">,</span></span>
<span id="cb76-3064"><a href="#cb76-3064" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3065"><a href="#cb76-3065" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3066"><a href="#cb76-3066" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb76-3067"><a href="#cb76-3067" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb76-3068"><a href="#cb76-3068" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } A_i`</span><span class="op">,</span></span>
<span id="cb76-3069"><a href="#cb76-3069" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb76-3070"><a href="#cb76-3070" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> defaultAi<span class="op">,</span></span>
<span id="cb76-3071"><a href="#cb76-3071" aria-hidden="true" tabindex="-1"></a>    <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb76-3072"><a href="#cb76-3072" aria-hidden="true" tabindex="-1"></a>    <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb76-3073"><a href="#cb76-3073" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb76-3074"><a href="#cb76-3074" aria-hidden="true" tabindex="-1"></a>  viewof inputAi<span class="op">,</span></span>
<span id="cb76-3075"><a href="#cb76-3075" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-5" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb77" data-startfrom="3076" data-source-offset="-867"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3075;"><span id="cb77-3076"><a href="#cb77-3076" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb77-3077"><a href="#cb77-3077" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb77-3078"><a href="#cb77-3078" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } G_i`</span><span class="op">,</span></span>
<span id="cb77-3079"><a href="#cb77-3079" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb77-3080"><a href="#cb77-3080" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> defaultGi<span class="op">,</span></span>
<span id="cb77-3081"><a href="#cb77-3081" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb77-3082"><a href="#cb77-3082" aria-hidden="true" tabindex="-1"></a>  viewof inputGi<span class="op">,</span></span>
<span id="cb77-3083"><a href="#cb77-3083" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-6" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb78" data-startfrom="3087" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3086;"><span id="cb78-3087"><a href="#cb78-3087" aria-hidden="true" tabindex="-1"></a>paramABurnt <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputABurnt</span>
<span id="cb78-3088"><a href="#cb78-3088" aria-hidden="true" tabindex="-1"></a>paramDeltaA_ <span class="op">=</span> paramABurnt <span class="op">/</span> inputASupply_<span class="op">;</span></span>
<span id="cb78-3089"><a href="#cb78-3089" aria-hidden="true" tabindex="-1"></a>paramDeltaCi <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="op">-</span><span class="dv">0</span> <span class="op">:</span> <span class="fu">computeDeltaCi</span>(</span>
<span id="cb78-3090"><a href="#cb78-3090" aria-hidden="true" tabindex="-1"></a>  inputAi<span class="op">,</span></span>
<span id="cb78-3091"><a href="#cb78-3091" aria-hidden="true" tabindex="-1"></a>  inputGi<span class="op">,</span></span>
<span id="cb78-3092"><a href="#cb78-3092" aria-hidden="true" tabindex="-1"></a>  paramDeltaA_<span class="op">,</span></span>
<span id="cb78-3093"><a href="#cb78-3093" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb78-3094"><a href="#cb78-3094" aria-hidden="true" tabindex="-1"></a>paramDeltaCiTonnes <span class="op">=</span> <span class="op">-</span>paramDeltaCi <span class="op">*</span> inputLiquidTonnes<span class="op">;</span></span>
<span id="cb78-3095"><a href="#cb78-3095" aria-hidden="true" tabindex="-1"></a>paramAPrice_ <span class="op">=</span> inputAValue_ <span class="op">/</span> inputASupply_<span class="op">;</span></span>
<span id="cb78-3096"><a href="#cb78-3096" aria-hidden="true" tabindex="-1"></a>paramCiPrice <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputAValue_ <span class="op">*</span> paramDeltaA_ <span class="op">/</span> paramDeltaCiTonnes<span class="op">;</span></span>
<span id="cb78-3097"><a href="#cb78-3097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3098"><a href="#cb78-3098" aria-hidden="true" tabindex="-1"></a>stringASupply_ <span class="op">=</span> inputASupply_<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3099"><a href="#cb78-3099" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3100"><a href="#cb78-3100" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3101"><a href="#cb78-3101" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3102"><a href="#cb78-3102" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3103"><a href="#cb78-3103" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3104"><a href="#cb78-3104" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb78-3105"><a href="#cb78-3105" aria-hidden="true" tabindex="-1"></a>stringLiquidTonnes <span class="op">=</span> inputLiquidTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3106"><a href="#cb78-3106" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3107"><a href="#cb78-3107" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3108"><a href="#cb78-3108" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3109"><a href="#cb78-3109" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3110"><a href="#cb78-3110" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3111"><a href="#cb78-3111" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb78-3112"><a href="#cb78-3112" aria-hidden="true" tabindex="-1"></a>stringABurnt <span class="op">=</span> <span class="st">"−"</span> <span class="op">+</span> paramABurnt<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3113"><a href="#cb78-3113" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3114"><a href="#cb78-3114" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3115"><a href="#cb78-3115" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3116"><a href="#cb78-3116" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3117"><a href="#cb78-3117" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3118"><a href="#cb78-3118" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb78-3119"><a href="#cb78-3119" aria-hidden="true" tabindex="-1"></a>stringDeltaCiTonnes <span class="op">=</span> <span class="st">"−"</span> <span class="op">+</span> paramDeltaCiTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3120"><a href="#cb78-3120" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3121"><a href="#cb78-3121" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3122"><a href="#cb78-3122" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3123"><a href="#cb78-3123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3124"><a href="#cb78-3124" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3125"><a href="#cb78-3125" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb78-3126"><a href="#cb78-3126" aria-hidden="true" tabindex="-1"></a>stringAPrice_ <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramAPrice_<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3127"><a href="#cb78-3127" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3128"><a href="#cb78-3128" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3129"><a href="#cb78-3129" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice_))<span class="op">,</span></span>
<span id="cb78-3130"><a href="#cb78-3130" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice_))<span class="op">,</span></span>
<span id="cb78-3131"><a href="#cb78-3131" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3132"><a href="#cb78-3132" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb78-3133"><a href="#cb78-3133" aria-hidden="true" tabindex="-1"></a>stringCiPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramCiPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3134"><a href="#cb78-3134" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3135"><a href="#cb78-3135" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3136"><a href="#cb78-3136" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramCiPrice))<span class="op">,</span></span>
<span id="cb78-3137"><a href="#cb78-3137" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramCiPrice))<span class="op">,</span></span>
<span id="cb78-3138"><a href="#cb78-3138" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3139"><a href="#cb78-3139" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-12" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Supply of <strong>A</strong> Tokens</th>
<th style="text-align: right;">Portfolio Carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-9"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-10"></span></span></td>
</tr>
<tr class="even">
<td><strong>Variation</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-11"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-12"></span></span></td>
</tr>
<tr class="odd">
<td><strong>Unit Price</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-13"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-14"></span></span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-klima-2.0-token-distribution" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="sec-klima-2.0-token-distribution"><span class="header-section-number">4</span> Klima&nbsp;2.0 Token Distribution</h2>
<section id="sec-planned-allocations" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="sec-planned-allocations"><span class="header-section-number">4.1</span> Planned Allocations</h3>
<div id="tbl-kvcm-token" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-kvcm-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Cohort</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Quantity (m)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klima Holders</td>
<td style="text-align: right;">87.5%</td>
<td style="text-align: right;">17.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">DAO/Treasury</td>
<td style="text-align: right;">10.0%</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">01X</td>
<td style="text-align: right;">2.5%</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: right;"><strong>100.0%</strong></td>
<td style="text-align: right;"><strong>20.0</strong></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-kvcm-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: <strong>kVCM</strong> token.
</figcaption>
</figure>
</div>
<div id="tbl-k2-token" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[40,10,15,30]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-k2-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 40%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Cohort</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Quantity (m)</th>
<th style="text-align: left;">Liquidity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klima Holders</td>
<td style="text-align: right;">40.0%</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ecosystem Grant</td>
<td style="text-align: right;">5.0%</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Programmatic Incentives</td>
<td style="text-align: right;">40.0%</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: left;">Incentive Curve</td>
</tr>
<tr class="even">
<td style="text-align: left;">pKlima Holders</td>
<td style="text-align: right;">3.0%</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DAO/Treasury</td>
<td style="text-align: right;">4.5%</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: left;">24 month locked LP of <span class="overline"><strong>AG</strong></span></td>
</tr>
<tr class="even">
<td style="text-align: left;">01X</td>
<td style="text-align: right;">2.5%</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: left;">24 month locked LP of <span class="overline"><strong>AG</strong></span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Product Design and Development</td>
<td style="text-align: right;">5.0%</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: right;"><strong>100.0%</strong></td>
<td style="text-align: right;"><strong>100.0</strong></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-k2-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: <strong>K2</strong> token.
</figcaption>
</figure>
</div>
<div id="fig-k2-token-allocations" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token allocations.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-allocations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb79" data-startfrom="3187" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3186;"><span id="cb79-3187"><a href="#cb79-3187" aria-hidden="true" tabindex="-1"></a>allocInitGData <span class="op">=</span> {</span>
<span id="cb79-3188"><a href="#cb79-3188" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocInitGData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb79-3189"><a href="#cb79-3189" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="fl">100.01</span><span class="op">;</span> i <span class="op">+=</span> <span class="fl">0.25</span>) {</span>
<span id="cb79-3190"><a href="#cb79-3190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="op">&lt;</span> <span class="fl">2.51</span>) {</span>
<span id="cb79-3191"><a href="#cb79-3191" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3192"><a href="#cb79-3192" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3193"><a href="#cb79-3193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">2.49</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">5.51</span>) {</span>
<span id="cb79-3194"><a href="#cb79-3194" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3195"><a href="#cb79-3195" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3196"><a href="#cb79-3196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">5.49</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">10.01</span>) {</span>
<span id="cb79-3197"><a href="#cb79-3197" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3198"><a href="#cb79-3198" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3199"><a href="#cb79-3199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">9.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">15.01</span>) {</span>
<span id="cb79-3200"><a href="#cb79-3200" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3201"><a href="#cb79-3201" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3202"><a href="#cb79-3202" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">14.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">20.01</span>) {</span>
<span id="cb79-3203"><a href="#cb79-3203" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3204"><a href="#cb79-3204" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3205"><a href="#cb79-3205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">19.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">60.01</span>) {</span>
<span id="cb79-3206"><a href="#cb79-3206" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3207"><a href="#cb79-3207" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3208"><a href="#cb79-3208" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">59.99</span> <span class="op">&lt;</span> i) {</span>
<span id="cb79-3209"><a href="#cb79-3209" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3210"><a href="#cb79-3210" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3211"><a href="#cb79-3211" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-3212"><a href="#cb79-3212" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocInitGData<span class="op">;</span></span>
<span id="cb79-3213"><a href="#cb79-3213" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb79-3214"><a href="#cb79-3214" aria-hidden="true" tabindex="-1"></a>longitudeScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>([<span class="dv">180</span><span class="op">,</span> <span class="op">-</span><span class="dv">180</span>])<span class="op">;</span></span>
<span id="cb79-3215"><a href="#cb79-3215" aria-hidden="true" tabindex="-1"></a>getCenter <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb79-3216"><a href="#cb79-3216" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">1.25</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="fl">7.75</span><span class="op">,</span> <span class="fl">12.5</span><span class="op">,</span> <span class="fl">17.5</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">80</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb79-3217"><a href="#cb79-3217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3218"><a href="#cb79-3218" aria-hidden="true" tabindex="-1"></a>cohortsDomain <span class="op">=</span> [</span>
<span id="cb79-3219"><a href="#cb79-3219" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb79-3220"><a href="#cb79-3220" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb79-3221"><a href="#cb79-3221" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb79-3222"><a href="#cb79-3222" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb79-3223"><a href="#cb79-3223" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb79-3224"><a href="#cb79-3224" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb79-3225"><a href="#cb79-3225" aria-hidden="true" tabindex="-1"></a>  <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb79-3226"><a href="#cb79-3226" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb80" data-startfrom="3229" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3228;"><span id="cb80-3229"><a href="#cb80-3229" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb80-3230"><a href="#cb80-3230" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"azimuthal-equidistant"</span><span class="op">,</span> <span class="dt">rotate</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb80-3231"><a href="#cb80-3231" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb80-3232"><a href="#cb80-3232" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb80-3233"><a href="#cb80-3233" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">area</span>(allocInitGData<span class="op">,</span> {</span>
<span id="cb80-3234"><a href="#cb80-3234" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> ({ value }) <span class="kw">=&gt;</span> <span class="fu">longitudeScale</span>(value <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb80-3235"><a href="#cb80-3235" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="op">-</span><span class="dv">20</span><span class="op">,</span></span>
<span id="cb80-3236"><a href="#cb80-3236" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> ({ value }) <span class="kw">=&gt;</span> <span class="fu">longitudeScale</span>(value <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb80-3237"><a href="#cb80-3237" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> <span class="op">-</span><span class="dv">70</span><span class="op">,</span></span>
<span id="cb80-3238"><a href="#cb80-3238" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb80-3239"><a href="#cb80-3239" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb80-3240"><a href="#cb80-3240" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb80-3241"><a href="#cb80-3241" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-79" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-allocations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23: <strong>K2</strong> token allocations.
</figcaption>
</figure>
</div>
</section>
<section id="sec-programmatic-incentive-curve" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="sec-programmatic-incentive-curve"><span class="header-section-number">4.2</span> Programmatic Incentive Curve</h3>
<p>The incentive issuance is built on a logistic function, <span class="math inline">\operatorname{P}</span>, to generate total proportion of supply in issue. It is calibrated from the initial issuance at TGE <span class="math inline">P_0</span> and the inflection point time <span class="math inline">T</span> where 50% of <strong>G</strong> token incentives have been released.</p>
<p>Setting <span class="math inline">x_0</span> from the initial supply parameter:</p>
<p><span id="eq-incentives-issuance-x-0"><span class="math display">
x_0 = \ln\left( \frac{P_0}{1 - P_0} \right)
\tag{31}</span></span></p>
<p>With <span class="math inline">x_t</span> at time point <span class="math inline">t \in (0, \infty)</span>:</p>
<p><span id="eq-incentives-issuance-x-t"><span class="math display">
x_t = x_0 \, \left( 1 - \frac t T \right)
\tag{32}</span></span></p>
<p>Giving supply function <span class="math inline">\operatorname{P}(t)</span> as:</p>
<p><span id="eq-incentives-issuance-curve"><span class="math display">
\operatorname{P}(t) = \frac{\exp(x_t)}{\exp(x_t) + 1}
\tag{33}</span></span></p>
<p><span class="math inline">P_0</span> set at <span><span id="ojs-element-id-15"></span></span> and <span class="math inline">T</span> at <span><span id="ojs-element-id-16"></span></span> months:</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb81" data-startfrom="3289" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3288;"><span id="cb81-3289"><a href="#cb81-3289" aria-hidden="true" tabindex="-1"></a>viewof inputP0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> {</span>
<span id="cb81-3290"><a href="#cb81-3290" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial issuance } P_0`</span><span class="op">,</span></span>
<span id="cb81-3291"><a href="#cb81-3291" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb81-3292"><a href="#cb81-3292" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.07</span><span class="op">,</span></span>
<span id="cb81-3293"><a href="#cb81-3293" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb81-3294"><a href="#cb81-3294" aria-hidden="true" tabindex="-1"></a>viewof inputT <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">2</span><span class="op">,</span> <span class="dv">60</span>]<span class="op">,</span> {</span>
<span id="cb81-3295"><a href="#cb81-3295" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`T </span><span class="sc">\t</span><span class="vs">ext{ (months)}`</span><span class="op">,</span></span>
<span id="cb81-3296"><a href="#cb81-3296" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb81-3297"><a href="#cb81-3297" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span></span>
<span id="cb81-3298"><a href="#cb81-3298" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb81-3299"><a href="#cb81-3299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3300"><a href="#cb81-3300" aria-hidden="true" tabindex="-1"></a>stringInputP0 <span class="op">=</span> inputP0<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb81-3301"><a href="#cb81-3301" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb81-3302"><a href="#cb81-3302" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb81-3303"><a href="#cb81-3303" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb81-3304"><a href="#cb81-3304" aria-hidden="true" tabindex="-1"></a>stringInputT <span class="op">=</span> inputT<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"en-GB"</span><span class="op">,</span> { <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-incentive-issuance" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Incentive Issuance.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentive-issuance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb82" data-startfrom="3316" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3315;"><span id="cb82-3316"><a href="#cb82-3316" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeP</span>(t<span class="op">,</span> P0<span class="op">,</span> T) {</span>
<span id="cb82-3317"><a href="#cb82-3317" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(P0 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> P0))<span class="op">;</span></span>
<span id="cb82-3318"><a href="#cb82-3318" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xt <span class="op">=</span> x0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> t <span class="op">/</span> T)<span class="op">;</span></span>
<span id="cb82-3319"><a href="#cb82-3319" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> exp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(xt)<span class="op">;</span></span>
<span id="cb82-3320"><a href="#cb82-3320" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> exp <span class="op">/</span> (exp <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb82-3321"><a href="#cb82-3321" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-3322"><a href="#cb82-3322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3323"><a href="#cb82-3323" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDerivP</span>(t<span class="op">,</span> P0<span class="op">,</span> T) {</span>
<span id="cb82-3324"><a href="#cb82-3324" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(P0 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> P0))<span class="op">;</span></span>
<span id="cb82-3325"><a href="#cb82-3325" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xt <span class="op">=</span> x0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> t <span class="op">/</span> T)<span class="op">;</span></span>
<span id="cb82-3326"><a href="#cb82-3326" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> exp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(xt)<span class="op">;</span></span>
<span id="cb82-3327"><a href="#cb82-3327" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> P <span class="op">=</span> exp <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp)<span class="op">;</span></span>
<span id="cb82-3328"><a href="#cb82-3328" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">-</span>(x0 <span class="op">/</span> T) <span class="op">*</span> P <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> P)<span class="op">;</span></span>
<span id="cb82-3329"><a href="#cb82-3329" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-3330"><a href="#cb82-3330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3331"><a href="#cb82-3331" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getVesting</span>(vecVesting<span class="op">,</span> t<span class="op">,</span> tStart<span class="op">,</span> tEnd) {</span>
<span id="cb82-3332"><a href="#cb82-3332" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="op">&lt;</span> tStart)</span>
<span id="cb82-3333"><a href="#cb82-3333" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb82-3334"><a href="#cb82-3334" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (t <span class="op">&lt;</span> tEnd) {</span>
<span id="cb82-3335"><a href="#cb82-3335" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vecVesting[t <span class="op">-</span> tStart]<span class="op">;</span></span>
<span id="cb82-3336"><a href="#cb82-3336" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb82-3337"><a href="#cb82-3337" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vecVesting[tEnd <span class="op">-</span> tStart <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb82-3338"><a href="#cb82-3338" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-3339"><a href="#cb82-3339" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb83" data-startfrom="3343" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3342;"><span id="cb83-3343"><a href="#cb83-3343" aria-hidden="true" tabindex="-1"></a>tVestStart <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb83-3344"><a href="#cb83-3344" aria-hidden="true" tabindex="-1"></a>tVestEnd <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> inputT<span class="op">;</span></span>
<span id="cb83-3345"><a href="#cb83-3345" aria-hidden="true" tabindex="-1"></a>tVesting <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(tVestStart<span class="op">,</span> tVestEnd)<span class="op">;</span></span>
<span id="cb83-3346"><a href="#cb83-3346" aria-hidden="true" tabindex="-1"></a>vecVestingDeriv <span class="op">=</span> <span class="fu">normalize</span>(tVesting<span class="op">.</span><span class="fu">map</span>(t <span class="kw">=&gt;</span></span>
<span id="cb83-3347"><a href="#cb83-3347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">computeDerivP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)</span>
<span id="cb83-3348"><a href="#cb83-3348" aria-hidden="true" tabindex="-1"></a>))<span class="op">;</span></span>
<span id="cb83-3349"><a href="#cb83-3349" aria-hidden="true" tabindex="-1"></a>vecVesting <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecVestingDeriv)<span class="op">;</span></span>
<span id="cb83-3350"><a href="#cb83-3350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3351"><a href="#cb83-3351" aria-hidden="true" tabindex="-1"></a>supplyDataAll <span class="op">=</span> {</span>
<span id="cb83-3352"><a href="#cb83-3352" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> paramVestingPrevious <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3353"><a href="#cb83-3353" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecSupplyIncentives <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3354"><a href="#cb83-3354" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecSupplyCirculating <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3355"><a href="#cb83-3355" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> supplyData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3356"><a href="#cb83-3356" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">&lt;=</span> <span class="dv">72</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb83-3357"><a href="#cb83-3357" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramP <span class="op">=</span> <span class="fu">computeP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)<span class="op">;</span></span>
<span id="cb83-3358"><a href="#cb83-3358" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramDerivP <span class="op">=</span> <span class="fu">computeDerivP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)<span class="op">;</span></span>
<span id="cb83-3359"><a href="#cb83-3359" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramVesting <span class="op">=</span> <span class="fu">getVesting</span>(vecVesting<span class="op">,</span> t<span class="op">,</span> tVestStart<span class="op">,</span> tVestEnd)<span class="op">;</span></span>
<span id="cb83-3360"><a href="#cb83-3360" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramVestingDiff <span class="op">=</span> paramVesting <span class="op">-</span> paramVestingPrevious<span class="op">;</span></span>
<span id="cb83-3361"><a href="#cb83-3361" aria-hidden="true" tabindex="-1"></a>    paramVestingPrevious <span class="op">=</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3362"><a href="#cb83-3362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3363"><a href="#cb83-3363" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supply01X <span class="op">=</span> <span class="fl">2.5</span><span class="op">;</span></span>
<span id="cb83-3364"><a href="#cb83-3364" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyPKlima <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3365"><a href="#cb83-3365" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyTreasury <span class="op">=</span> <span class="fl">4.5</span><span class="op">;</span></span>
<span id="cb83-3366"><a href="#cb83-3366" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyGrant <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3367"><a href="#cb83-3367" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyProduct <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3368"><a href="#cb83-3368" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyKlima <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3369"><a href="#cb83-3369" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyIncentives <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramP<span class="op">;</span></span>
<span id="cb83-3370"><a href="#cb83-3370" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives<span class="op">.</span><span class="fu">push</span>(supplyIncentives)<span class="op">;</span></span>
<span id="cb83-3371"><a href="#cb83-3371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3372"><a href="#cb83-3372" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supply01XStacked <span class="op">=</span> supply01X<span class="op">;</span></span>
<span id="cb83-3373"><a href="#cb83-3373" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyPKlimaStacked <span class="op">=</span> supplyPKlima <span class="op">+</span> supply01XStacked<span class="op">;</span></span>
<span id="cb83-3374"><a href="#cb83-3374" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyTreasuryStacked <span class="op">=</span> supplyTreasury <span class="op">+</span> supplyPKlimaStacked<span class="op">;</span></span>
<span id="cb83-3375"><a href="#cb83-3375" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyGrantStacked <span class="op">=</span> supplyGrant <span class="op">+</span> supplyTreasuryStacked<span class="op">;</span></span>
<span id="cb83-3376"><a href="#cb83-3376" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyProductStacked <span class="op">=</span> supplyProduct <span class="op">+</span> supplyGrantStacked<span class="op">;</span></span>
<span id="cb83-3377"><a href="#cb83-3377" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyKlimaStacked <span class="op">=</span> supplyKlima <span class="op">+</span> supplyProductStacked<span class="op">;</span></span>
<span id="cb83-3378"><a href="#cb83-3378" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyIncentivesStacked <span class="op">=</span> supplyIncentives <span class="op">+</span> supplyKlimaStacked<span class="op">;</span></span>
<span id="cb83-3379"><a href="#cb83-3379" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyCirculating <span class="op">=</span> supplyIncentivesStacked <span class="op">/</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb83-3380"><a href="#cb83-3380" aria-hidden="true" tabindex="-1"></a>    vecSupplyCirculating<span class="op">.</span><span class="fu">push</span>(supplyIncentivesStacked)<span class="op">;</span></span>
<span id="cb83-3381"><a href="#cb83-3381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3382"><a href="#cb83-3382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (t <span class="op">&lt;=</span> <span class="dv">60</span>) {</span>
<span id="cb83-3383"><a href="#cb83-3383" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffIncentives <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> (t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> inputP0 <span class="op">:</span> paramDerivP)<span class="op">;</span></span>
<span id="cb83-3384"><a href="#cb83-3384" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffKlima <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3385"><a href="#cb83-3385" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffProduct <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3386"><a href="#cb83-3386" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffGrant <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3387"><a href="#cb83-3387" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffPKlima <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3388"><a href="#cb83-3388" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffTreasury <span class="op">=</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">4.5</span><span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3389"><a href="#cb83-3389" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diff01X <span class="op">=</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">2.5</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3390"><a href="#cb83-3390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3391"><a href="#cb83-3391" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffIncentivesStacked <span class="op">=</span> diffIncentives<span class="op">;</span></span>
<span id="cb83-3392"><a href="#cb83-3392" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffKlimaStacked <span class="op">=</span> diffKlima <span class="op">+</span> diffIncentivesStacked<span class="op">;</span></span>
<span id="cb83-3393"><a href="#cb83-3393" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffProductStacked <span class="op">=</span> diffProduct <span class="op">+</span> diffKlimaStacked<span class="op">;</span></span>
<span id="cb83-3394"><a href="#cb83-3394" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffGrantStacked <span class="op">=</span> diffGrant <span class="op">+</span> diffProductStacked<span class="op">;</span></span>
<span id="cb83-3395"><a href="#cb83-3395" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffPKlimaStacked <span class="op">=</span> diffPKlima <span class="op">+</span> diffGrantStacked<span class="op">;</span></span>
<span id="cb83-3396"><a href="#cb83-3396" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffTreasuryStacked <span class="op">=</span> diffTreasury <span class="op">+</span> diffPKlimaStacked<span class="op">;</span></span>
<span id="cb83-3397"><a href="#cb83-3397" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diff01XStacked <span class="op">=</span> diff01X <span class="op">+</span> diffTreasuryStacked<span class="op">;</span></span>
<span id="cb83-3398"><a href="#cb83-3398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3399"><a href="#cb83-3399" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3400"><a href="#cb83-3400" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Proportion of Supply"</span><span class="op">,</span></span>
<span id="cb83-3401"><a href="#cb83-3401" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3402"><a href="#cb83-3402" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramP<span class="op">,</span></span>
<span id="cb83-3403"><a href="#cb83-3403" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3404"><a href="#cb83-3404" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3405"><a href="#cb83-3405" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Rate of Change"</span><span class="op">,</span></span>
<span id="cb83-3406"><a href="#cb83-3406" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3407"><a href="#cb83-3407" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDerivP<span class="op">,</span></span>
<span id="cb83-3408"><a href="#cb83-3408" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3409"><a href="#cb83-3409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3410"><a href="#cb83-3410" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3411"><a href="#cb83-3411" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3412"><a href="#cb83-3412" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3413"><a href="#cb83-3413" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3414"><a href="#cb83-3414" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01XStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3415"><a href="#cb83-3415" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3416"><a href="#cb83-3416" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3417"><a href="#cb83-3417" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3418"><a href="#cb83-3418" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3419"><a href="#cb83-3419" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3420"><a href="#cb83-3420" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlimaStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3421"><a href="#cb83-3421" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3422"><a href="#cb83-3422" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3423"><a href="#cb83-3423" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3424"><a href="#cb83-3424" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3425"><a href="#cb83-3425" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3426"><a href="#cb83-3426" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasuryStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3427"><a href="#cb83-3427" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3428"><a href="#cb83-3428" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3429"><a href="#cb83-3429" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3430"><a href="#cb83-3430" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3431"><a href="#cb83-3431" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3432"><a href="#cb83-3432" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrantStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3433"><a href="#cb83-3433" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3434"><a href="#cb83-3434" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3435"><a href="#cb83-3435" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3436"><a href="#cb83-3436" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3437"><a href="#cb83-3437" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3438"><a href="#cb83-3438" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProductStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3439"><a href="#cb83-3439" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3440"><a href="#cb83-3440" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3441"><a href="#cb83-3441" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3442"><a href="#cb83-3442" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3443"><a href="#cb83-3443" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3444"><a href="#cb83-3444" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlimaStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3445"><a href="#cb83-3445" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3446"><a href="#cb83-3446" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3447"><a href="#cb83-3447" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3448"><a href="#cb83-3448" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3449"><a href="#cb83-3449" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3450"><a href="#cb83-3450" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentivesStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3451"><a href="#cb83-3451" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3452"><a href="#cb83-3452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3453"><a href="#cb83-3453" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3454"><a href="#cb83-3454" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3455"><a href="#cb83-3455" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3456"><a href="#cb83-3456" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3457"><a href="#cb83-3457" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01X <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3458"><a href="#cb83-3458" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3459"><a href="#cb83-3459" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3460"><a href="#cb83-3460" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3461"><a href="#cb83-3461" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3462"><a href="#cb83-3462" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3463"><a href="#cb83-3463" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlima <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3464"><a href="#cb83-3464" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3465"><a href="#cb83-3465" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3466"><a href="#cb83-3466" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3467"><a href="#cb83-3467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3468"><a href="#cb83-3468" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3469"><a href="#cb83-3469" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasury <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3470"><a href="#cb83-3470" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3471"><a href="#cb83-3471" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3472"><a href="#cb83-3472" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3473"><a href="#cb83-3473" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3474"><a href="#cb83-3474" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3475"><a href="#cb83-3475" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrant <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3476"><a href="#cb83-3476" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3477"><a href="#cb83-3477" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3478"><a href="#cb83-3478" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3479"><a href="#cb83-3479" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3480"><a href="#cb83-3480" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3481"><a href="#cb83-3481" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProduct <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3482"><a href="#cb83-3482" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3483"><a href="#cb83-3483" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3484"><a href="#cb83-3484" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3485"><a href="#cb83-3485" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3486"><a href="#cb83-3486" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3487"><a href="#cb83-3487" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlima <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3488"><a href="#cb83-3488" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3489"><a href="#cb83-3489" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3490"><a href="#cb83-3490" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3491"><a href="#cb83-3491" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3492"><a href="#cb83-3492" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3493"><a href="#cb83-3493" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentives <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3494"><a href="#cb83-3494" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3495"><a href="#cb83-3495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3496"><a href="#cb83-3496" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3497"><a href="#cb83-3497" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3498"><a href="#cb83-3498" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3499"><a href="#cb83-3499" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3500"><a href="#cb83-3500" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01XStacked<span class="op">,</span></span>
<span id="cb83-3501"><a href="#cb83-3501" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3502"><a href="#cb83-3502" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3503"><a href="#cb83-3503" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3504"><a href="#cb83-3504" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3505"><a href="#cb83-3505" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3506"><a href="#cb83-3506" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlimaStacked<span class="op">,</span></span>
<span id="cb83-3507"><a href="#cb83-3507" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3508"><a href="#cb83-3508" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3509"><a href="#cb83-3509" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3510"><a href="#cb83-3510" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3511"><a href="#cb83-3511" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3512"><a href="#cb83-3512" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasuryStacked<span class="op">,</span></span>
<span id="cb83-3513"><a href="#cb83-3513" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3514"><a href="#cb83-3514" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3515"><a href="#cb83-3515" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3516"><a href="#cb83-3516" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3517"><a href="#cb83-3517" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3518"><a href="#cb83-3518" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrantStacked<span class="op">,</span></span>
<span id="cb83-3519"><a href="#cb83-3519" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3520"><a href="#cb83-3520" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3521"><a href="#cb83-3521" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3522"><a href="#cb83-3522" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3523"><a href="#cb83-3523" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3524"><a href="#cb83-3524" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProductStacked<span class="op">,</span></span>
<span id="cb83-3525"><a href="#cb83-3525" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3526"><a href="#cb83-3526" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3527"><a href="#cb83-3527" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3528"><a href="#cb83-3528" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3529"><a href="#cb83-3529" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3530"><a href="#cb83-3530" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlimaStacked<span class="op">,</span></span>
<span id="cb83-3531"><a href="#cb83-3531" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3532"><a href="#cb83-3532" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3533"><a href="#cb83-3533" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3534"><a href="#cb83-3534" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3535"><a href="#cb83-3535" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3536"><a href="#cb83-3536" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentivesStacked<span class="op">,</span></span>
<span id="cb83-3537"><a href="#cb83-3537" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3538"><a href="#cb83-3538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3539"><a href="#cb83-3539" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3540"><a href="#cb83-3540" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3541"><a href="#cb83-3541" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3542"><a href="#cb83-3542" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3543"><a href="#cb83-3543" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01X<span class="op">,</span></span>
<span id="cb83-3544"><a href="#cb83-3544" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3545"><a href="#cb83-3545" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3546"><a href="#cb83-3546" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3547"><a href="#cb83-3547" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3548"><a href="#cb83-3548" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3549"><a href="#cb83-3549" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlima<span class="op">,</span></span>
<span id="cb83-3550"><a href="#cb83-3550" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3551"><a href="#cb83-3551" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3552"><a href="#cb83-3552" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3553"><a href="#cb83-3553" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3554"><a href="#cb83-3554" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3555"><a href="#cb83-3555" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasury<span class="op">,</span></span>
<span id="cb83-3556"><a href="#cb83-3556" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3557"><a href="#cb83-3557" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3558"><a href="#cb83-3558" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3559"><a href="#cb83-3559" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3560"><a href="#cb83-3560" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3561"><a href="#cb83-3561" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrant<span class="op">,</span></span>
<span id="cb83-3562"><a href="#cb83-3562" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3563"><a href="#cb83-3563" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3564"><a href="#cb83-3564" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3565"><a href="#cb83-3565" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3566"><a href="#cb83-3566" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3567"><a href="#cb83-3567" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProduct<span class="op">,</span></span>
<span id="cb83-3568"><a href="#cb83-3568" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3569"><a href="#cb83-3569" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3570"><a href="#cb83-3570" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3571"><a href="#cb83-3571" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3572"><a href="#cb83-3572" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3573"><a href="#cb83-3573" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlima<span class="op">,</span></span>
<span id="cb83-3574"><a href="#cb83-3574" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3575"><a href="#cb83-3575" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3576"><a href="#cb83-3576" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3577"><a href="#cb83-3577" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3578"><a href="#cb83-3578" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3579"><a href="#cb83-3579" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentives<span class="op">,</span></span>
<span id="cb83-3580"><a href="#cb83-3580" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3581"><a href="#cb83-3581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3582"><a href="#cb83-3582" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3583"><a href="#cb83-3583" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3584"><a href="#cb83-3584" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3585"><a href="#cb83-3585" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3586"><a href="#cb83-3586" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffIncentives<span class="op">,</span></span>
<span id="cb83-3587"><a href="#cb83-3587" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3588"><a href="#cb83-3588" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3589"><a href="#cb83-3589" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3590"><a href="#cb83-3590" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3591"><a href="#cb83-3591" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3592"><a href="#cb83-3592" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffKlima<span class="op">,</span></span>
<span id="cb83-3593"><a href="#cb83-3593" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3594"><a href="#cb83-3594" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3595"><a href="#cb83-3595" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3596"><a href="#cb83-3596" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3597"><a href="#cb83-3597" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3598"><a href="#cb83-3598" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffProduct<span class="op">,</span></span>
<span id="cb83-3599"><a href="#cb83-3599" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3600"><a href="#cb83-3600" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3601"><a href="#cb83-3601" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3602"><a href="#cb83-3602" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3603"><a href="#cb83-3603" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3604"><a href="#cb83-3604" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffGrant<span class="op">,</span></span>
<span id="cb83-3605"><a href="#cb83-3605" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3606"><a href="#cb83-3606" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3607"><a href="#cb83-3607" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3608"><a href="#cb83-3608" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3609"><a href="#cb83-3609" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3610"><a href="#cb83-3610" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffPKlima<span class="op">,</span></span>
<span id="cb83-3611"><a href="#cb83-3611" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3612"><a href="#cb83-3612" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3613"><a href="#cb83-3613" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3614"><a href="#cb83-3614" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3615"><a href="#cb83-3615" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3616"><a href="#cb83-3616" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffTreasury<span class="op">,</span></span>
<span id="cb83-3617"><a href="#cb83-3617" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3618"><a href="#cb83-3618" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3619"><a href="#cb83-3619" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3620"><a href="#cb83-3620" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3621"><a href="#cb83-3621" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3622"><a href="#cb83-3622" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diff01X<span class="op">,</span></span>
<span id="cb83-3623"><a href="#cb83-3623" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3624"><a href="#cb83-3624" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-3625"><a href="#cb83-3625" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-3626"><a href="#cb83-3626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3627"><a href="#cb83-3627" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecNextYearIncentives <span class="op">=</span> vecSupplyIncentives<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3628"><a href="#cb83-3628" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> val)<span class="op">;</span></span>
<span id="cb83-3629"><a href="#cb83-3629" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecAPY <span class="op">=</span> vecSupplyCirculating<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3630"><a href="#cb83-3630" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">*</span> (vecSupplyCirculating[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> val) <span class="op">/</span> val)<span class="op">;</span></span>
<span id="cb83-3631"><a href="#cb83-3631" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecAPR <span class="op">=</span> vecSupplyCirculating<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3632"><a href="#cb83-3632" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">*</span> (vecSupplyCirculating[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> vecNextYearIncentives[t] <span class="op">-</span> val) <span class="op">/</span> val)<span class="op">;</span></span>
<span id="cb83-3633"><a href="#cb83-3633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3634"><a href="#cb83-3634" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">&lt;=</span> <span class="dv">60</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb83-3635"><a href="#cb83-3635" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"APY"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> vecAPY[t] })<span class="op">;</span></span>
<span id="cb83-3636"><a href="#cb83-3636" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"APR"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> vecAPR[t] })<span class="op">;</span></span>
<span id="cb83-3637"><a href="#cb83-3637" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-3638"><a href="#cb83-3638" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb83-3639"><a href="#cb83-3639" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives<span class="op">,</span></span>
<span id="cb83-3640"><a href="#cb83-3640" aria-hidden="true" tabindex="-1"></a>    vecSupplyCirculating<span class="op">,</span></span>
<span id="cb83-3641"><a href="#cb83-3641" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">,</span></span>
<span id="cb83-3642"><a href="#cb83-3642" aria-hidden="true" tabindex="-1"></a>    vecAPY<span class="op">,</span></span>
<span id="cb83-3643"><a href="#cb83-3643" aria-hidden="true" tabindex="-1"></a>    vecAPR<span class="op">,</span></span>
<span id="cb83-3644"><a href="#cb83-3644" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb83-3645"><a href="#cb83-3645" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-3646"><a href="#cb83-3646" aria-hidden="true" tabindex="-1"></a>vecSupplyIncentives <span class="op">=</span> supplyDataAll[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb83-3647"><a href="#cb83-3647" aria-hidden="true" tabindex="-1"></a>vecSupplyCirculating <span class="op">=</span> supplyDataAll[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb83-3648"><a href="#cb83-3648" aria-hidden="true" tabindex="-1"></a>supplyData <span class="op">=</span> supplyDataAll[<span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb83-3649"><a href="#cb83-3649" aria-hidden="true" tabindex="-1"></a>vecAPY <span class="op">=</span> supplyDataAll[<span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb83-3650"><a href="#cb83-3650" aria-hidden="true" tabindex="-1"></a>vecAPR <span class="op">=</span> supplyDataAll[<span class="dv">4</span>]<span class="op">;</span></span>
<span id="cb83-3651"><a href="#cb83-3651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3652"><a href="#cb83-3652" aria-hidden="true" tabindex="-1"></a>getLogisticCurve <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Proportion of Supply"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3653"><a href="#cb83-3653" aria-hidden="true" tabindex="-1"></a>getRateOfChange <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Rate of Change"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3654"><a href="#cb83-3654" aria-hidden="true" tabindex="-1"></a>getCirculatingStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3655"><a href="#cb83-3655" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3656"><a href="#cb83-3656" aria-hidden="true" tabindex="-1"></a>getCirculatingUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3657"><a href="#cb83-3657" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3658"><a href="#cb83-3658" aria-hidden="true" tabindex="-1"></a>getTotalStacked <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3659"><a href="#cb83-3659" aria-hidden="true" tabindex="-1"></a>getTotalUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3660"><a href="#cb83-3660" aria-hidden="true" tabindex="-1"></a>getDiffUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3661"><a href="#cb83-3661" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply Differential (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3662"><a href="#cb83-3662" aria-hidden="true" tabindex="-1"></a>getCohortCirculatingStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3663"><a href="#cb83-3663" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3664"><a href="#cb83-3664" aria-hidden="true" tabindex="-1"></a>getCohortCirculatingUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3665"><a href="#cb83-3665" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3666"><a href="#cb83-3666" aria-hidden="true" tabindex="-1"></a>getCohortTotalStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3667"><a href="#cb83-3667" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3668"><a href="#cb83-3668" aria-hidden="true" tabindex="-1"></a>getCohortTotalUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3669"><a href="#cb83-3669" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3670"><a href="#cb83-3670" aria-hidden="true" tabindex="-1"></a>getCohortDiffUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3671"><a href="#cb83-3671" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply Differential (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3672"><a href="#cb83-3672" aria-hidden="true" tabindex="-1"></a>getAPY <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"APY"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3673"><a href="#cb83-3673" aria-hidden="true" tabindex="-1"></a>getAPR <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"APR"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3674"><a href="#cb83-3674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3675"><a href="#cb83-3675" aria-hidden="true" tabindex="-1"></a>domainRateOfChange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(supplyData<span class="op">,</span> getRateOfChange)]<span class="op">;</span></span>
<span id="cb83-3676"><a href="#cb83-3676" aria-hidden="true" tabindex="-1"></a>scaleRateOfChange <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(domainRateOfChange<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb83-3677"><a href="#cb83-3677" aria-hidden="true" tabindex="-1"></a>mapScaleRateOfChange <span class="op">=</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>(scaleRateOfChange)<span class="op">;</span></span>
<span id="cb83-3678"><a href="#cb83-3678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3679"><a href="#cb83-3679" aria-hidden="true" tabindex="-1"></a>stringP0 <span class="op">=</span> <span class="st">"Initial Issuance P₀ = "</span> <span class="op">+</span> inputP0<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb83-3680"><a href="#cb83-3680" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb83-3681"><a href="#cb83-3681" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb83-3682"><a href="#cb83-3682" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb83-3683"><a href="#cb83-3683" aria-hidden="true" tabindex="-1"></a>stringT <span class="op">=</span> <span class="st">"Inflection Point Time T = "</span> <span class="op">+</span> inputT<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb83-3684"><a href="#cb83-3684" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb83-3685"><a href="#cb83-3685" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb83-3686"><a href="#cb83-3686" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" months"</span><span class="op">;</span></span>
<span id="cb83-3687"><a href="#cb83-3687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3688"><a href="#cb83-3688" aria-hidden="true" tabindex="-1"></a>supplyParams <span class="op">=</span> [</span>
<span id="cb83-3689"><a href="#cb83-3689" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringP0<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> inputP0 }<span class="op">,</span></span>
<span id="cb83-3690"><a href="#cb83-3690" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringT<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> inputT<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">50</span> }<span class="op">,</span></span>
<span id="cb83-3691"><a href="#cb83-3691" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-31" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb84" data-startfrom="3694" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3693;"><span id="cb84-3694"><a href="#cb84-3694" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb84-3695"><a href="#cb84-3695" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb84-3696"><a href="#cb84-3696" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3697"><a href="#cb84-3697" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb84-3698"><a href="#cb84-3698" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Proportion of Supply"</span><span class="op">,</span> <span class="st">"Rate of Change"</span><span class="op">,</span> stringP0<span class="op">,</span> stringT]<span class="op">,</span></span>
<span id="cb84-3699"><a href="#cb84-3699" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb84-3700"><a href="#cb84-3700" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb84-3701"><a href="#cb84-3701" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span></span>
<span id="cb84-3702"><a href="#cb84-3702" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"‘Life’ Span (Months)"</span><span class="op">,</span></span>
<span id="cb84-3703"><a href="#cb84-3703" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3704"><a href="#cb84-3704" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb84-3705"><a href="#cb84-3705" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>] }<span class="op">,</span></span>
<span id="cb84-3706"><a href="#cb84-3706" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb84-3707"><a href="#cb84-3707" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3708"><a href="#cb84-3708" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb84-3709"><a href="#cb84-3709" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb84-3710"><a href="#cb84-3710" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Proportion of Supply (%)"</span> })<span class="op">,</span></span>
<span id="cb84-3711"><a href="#cb84-3711" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>(scaleRateOfChange<span class="op">.</span><span class="fu">ticks</span>()<span class="op">,</span> {</span>
<span id="cb84-3712"><a href="#cb84-3712" aria-hidden="true" tabindex="-1"></a>      <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb84-3713"><a href="#cb84-3713" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> scaleRateOfChange<span class="op">.</span><span class="fu">tickFormat</span>()<span class="op">,</span></span>
<span id="cb84-3714"><a href="#cb84-3714" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Rate of Change (%/Month)"</span><span class="op">,</span></span>
<span id="cb84-3715"><a href="#cb84-3715" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> scaleRateOfChange</span>
<span id="cb84-3716"><a href="#cb84-3716" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3717"><a href="#cb84-3717" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleRateOfChange<span class="op">,</span> {</span>
<span id="cb84-3718"><a href="#cb84-3718" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3719"><a href="#cb84-3719" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getRateOfChange<span class="op">,</span></span>
<span id="cb84-3720"><a href="#cb84-3720" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3721"><a href="#cb84-3721" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3722"><a href="#cb84-3722" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb84-3723"><a href="#cb84-3723" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb84-3724"><a href="#cb84-3724" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb84-3725"><a href="#cb84-3725" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3726"><a href="#cb84-3726" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLogisticCurve<span class="op">,</span></span>
<span id="cb84-3727"><a href="#cb84-3727" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3728"><a href="#cb84-3728" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3729"><a href="#cb84-3729" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3730"><a href="#cb84-3730" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleRateOfChange<span class="op">,</span> {</span>
<span id="cb84-3731"><a href="#cb84-3731" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3732"><a href="#cb84-3732" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getRateOfChange<span class="op">,</span></span>
<span id="cb84-3733"><a href="#cb84-3733" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3734"><a href="#cb84-3734" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb84-3735"><a href="#cb84-3735" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb84-3736"><a href="#cb84-3736" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb84-3737"><a href="#cb84-3737" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3738"><a href="#cb84-3738" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLogisticCurve<span class="op">,</span></span>
<span id="cb84-3739"><a href="#cb84-3739" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3740"><a href="#cb84-3740" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb84-3741"><a href="#cb84-3741" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3742"><a href="#cb84-3742" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(supplyParams<span class="op">,</span> {</span>
<span id="cb84-3743"><a href="#cb84-3743" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> stringT <span class="op">?</span> d<span class="op">.</span><span class="at">x</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb84-3744"><a href="#cb84-3744" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb84-3745"><a href="#cb84-3745" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3746"><a href="#cb84-3746" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3747"><a href="#cb84-3747" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb84-3748"><a href="#cb84-3748" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3749"><a href="#cb84-3749" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(supplyParams<span class="op">,</span> {</span>
<span id="cb84-3750"><a href="#cb84-3750" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3751"><a href="#cb84-3751" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb84-3752"><a href="#cb84-3752" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb84-3753"><a href="#cb84-3753" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3754"><a href="#cb84-3754" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3755"><a href="#cb84-3755" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb84-3756"><a href="#cb84-3756" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-83" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentive-issuance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24: Incentive Issuance
</figcaption>
</figure>
</div>
<div id="fig-k2-token-supply-circulating" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token circulating supply over time.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-supply-circulating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb85" data-startfrom="3770" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3769;"><span id="cb85-3770"><a href="#cb85-3770" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb85-3771"><a href="#cb85-3771" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb85-3772"><a href="#cb85-3772" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb85-3773"><a href="#cb85-3773" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Circulating Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb85-3774"><a href="#cb85-3774" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb85-3775"><a href="#cb85-3775" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb85-3776"><a href="#cb85-3776" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb85-3777"><a href="#cb85-3777" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb85-3778"><a href="#cb85-3778" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb85-3779"><a href="#cb85-3779" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCirculatingStacked<span class="op">,</span></span>
<span id="cb85-3780"><a href="#cb85-3780" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortCirculatingStacked<span class="op">,</span></span>
<span id="cb85-3781"><a href="#cb85-3781" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb85-3782"><a href="#cb85-3782" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb85-3783"><a href="#cb85-3783" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb85-3784"><a href="#cb85-3784" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb85-3785"><a href="#cb85-3785" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCirculatingUnstacked<span class="op">,</span></span>
<span id="cb85-3786"><a href="#cb85-3786" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortCirculatingUnstacked<span class="op">,</span></span>
<span id="cb85-3787"><a href="#cb85-3787" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb85-3788"><a href="#cb85-3788" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb85-3789"><a href="#cb85-3789" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb85-3790"><a href="#cb85-3790" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-84" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-supply-circulating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25: <strong>K2</strong> token circulating supply over time.
</figcaption>
</figure>
</div>
<div id="fig-k2-token-supply-total" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-supply-total-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb86" data-startfrom="3805" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3804;"><span id="cb86-3805"><a href="#cb86-3805" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb86-3806"><a href="#cb86-3806" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb86-3807"><a href="#cb86-3807" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb86-3808"><a href="#cb86-3808" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Total Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb86-3809"><a href="#cb86-3809" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb86-3810"><a href="#cb86-3810" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb86-3811"><a href="#cb86-3811" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb86-3812"><a href="#cb86-3812" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb86-3813"><a href="#cb86-3813" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb86-3814"><a href="#cb86-3814" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalStacked<span class="op">,</span></span>
<span id="cb86-3815"><a href="#cb86-3815" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortTotalStacked<span class="op">,</span></span>
<span id="cb86-3816"><a href="#cb86-3816" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb86-3817"><a href="#cb86-3817" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb86-3818"><a href="#cb86-3818" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb86-3819"><a href="#cb86-3819" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb86-3820"><a href="#cb86-3820" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb86-3821"><a href="#cb86-3821" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb86-3822"><a href="#cb86-3822" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb86-3823"><a href="#cb86-3823" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb86-3824"><a href="#cb86-3824" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb86-3825"><a href="#cb86-3825" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-85" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-85-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-85" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-85-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Total supply (stacked).
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb87" data-startfrom="3830" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3829;"><span id="cb87-3830"><a href="#cb87-3830" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb87-3831"><a href="#cb87-3831" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb87-3832"><a href="#cb87-3832" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb87-3833"><a href="#cb87-3833" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Total Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb87-3834"><a href="#cb87-3834" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb87-3835"><a href="#cb87-3835" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb87-3836"><a href="#cb87-3836" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb87-3837"><a href="#cb87-3837" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb87-3838"><a href="#cb87-3838" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb87-3839"><a href="#cb87-3839" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb87-3840"><a href="#cb87-3840" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3841"><a href="#cb87-3841" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3842"><a href="#cb87-3842" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb87-3843"><a href="#cb87-3843" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb87-3844"><a href="#cb87-3844" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb87-3845"><a href="#cb87-3845" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb87-3846"><a href="#cb87-3846" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb87-3847"><a href="#cb87-3847" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3848"><a href="#cb87-3848" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3849"><a href="#cb87-3849" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb87-3850"><a href="#cb87-3850" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb87-3851"><a href="#cb87-3851" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb87-3852"><a href="#cb87-3852" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-86" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-86-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-86" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-86-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Total supply (unstacked).
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-supply-total-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26: <strong>K2</strong> token total supply over time.
</figcaption>
</figure>
</div>
<div id="fig-k2-risk-metrics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-risk-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb88" data-startfrom="3875" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3874;"><span id="cb88-3875"><a href="#cb88-3875" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb88-3876"><a href="#cb88-3876" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb88-3877"><a href="#cb88-3877" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb88-3878"><a href="#cb88-3878" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Rate of Growth (%/Month)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb88-3879"><a href="#cb88-3879" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb88-3880"><a href="#cb88-3880" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb88-3881"><a href="#cb88-3881" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb88-3882"><a href="#cb88-3882" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb88-3883"><a href="#cb88-3883" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb88-3884"><a href="#cb88-3884" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb88-3885"><a href="#cb88-3885" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb88-3886"><a href="#cb88-3886" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb88-3887"><a href="#cb88-3887" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb88-3888"><a href="#cb88-3888" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getDiffUnstacked<span class="op">,</span></span>
<span id="cb88-3889"><a href="#cb88-3889" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortDiffUnstacked<span class="op">,</span></span>
<span id="cb88-3890"><a href="#cb88-3890" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb88-3891"><a href="#cb88-3891" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb88-3892"><a href="#cb88-3892" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-87" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-87-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-87" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-87-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Total supply differential (stacked).
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb89" data-startfrom="3897" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3896;"><span id="cb89-3897"><a href="#cb89-3897" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb89-3898"><a href="#cb89-3898" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb89-3899"><a href="#cb89-3899" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3900"><a href="#cb89-3900" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">9</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb89-3901"><a href="#cb89-3901" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"APY"</span><span class="op">,</span> <span class="st">"APR"</span>]<span class="op">,</span></span>
<span id="cb89-3902"><a href="#cb89-3902" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb89-3903"><a href="#cb89-3903" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb89-3904"><a href="#cb89-3904" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb89-3905"><a href="#cb89-3905" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(vecAPR)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(vecAPY))]<span class="op">,</span></span>
<span id="cb89-3906"><a href="#cb89-3906" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Annual Percentage (%)"</span><span class="op">,</span></span>
<span id="cb89-3907"><a href="#cb89-3907" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3908"><a href="#cb89-3908" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb89-3909"><a href="#cb89-3909" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb89-3910"><a href="#cb89-3910" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3911"><a href="#cb89-3911" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb89-3912"><a href="#cb89-3912" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb89-3913"><a href="#cb89-3913" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3914"><a href="#cb89-3914" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3915"><a href="#cb89-3915" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getAPY<span class="op">,</span></span>
<span id="cb89-3916"><a href="#cb89-3916" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3917"><a href="#cb89-3917" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb89-3918"><a href="#cb89-3918" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3919"><a href="#cb89-3919" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3920"><a href="#cb89-3920" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3921"><a href="#cb89-3921" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb89-3922"><a href="#cb89-3922" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> getAPY<span class="op">,</span></span>
<span id="cb89-3923"><a href="#cb89-3923" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3924"><a href="#cb89-3924" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb89-3925"><a href="#cb89-3925" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3926"><a href="#cb89-3926" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3927"><a href="#cb89-3927" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3928"><a href="#cb89-3928" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getAPR<span class="op">,</span></span>
<span id="cb89-3929"><a href="#cb89-3929" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3930"><a href="#cb89-3930" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb89-3931"><a href="#cb89-3931" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb89-3932"><a href="#cb89-3932" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3933"><a href="#cb89-3933" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb89-3934"><a href="#cb89-3934" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-88" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-88-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-88" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-88-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Utility incentive yield.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-risk-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27: <strong>K2</strong> token supply risk metrics.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-incentive-allocations" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="sec-incentive-allocations"><span class="header-section-number">4.3</span> Incentive Allocations</h3>
<div id="fig-k2-incentive-distribution" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token incentive distribution structure">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-incentive-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/k2-incentive-distribution.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-incentive-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28: <strong>K2</strong> token incentive distribution structure.
</figcaption>
</figure>
</div>
<p>The <strong>relative utilisation</strong> measurement factor <span class="math inline">\upsilon</span> is calculated as follows.</p>
<p>Defining initially:</p>
<ul>
<li><p><span class="math inline">G</span>: Total <strong>G</strong> tokens staked expressed as a proportion of the circulating supply, <span class="math inline">G \in [0, 1]</span>.</p></li>
<li><p><span class="math inline">L</span>: Total <strong>G</strong> tokens held in the <span class="overline"><strong>AG</strong></span> pool expressed as a proportion of circulating supply, <span class="math inline">L \in (0, 1]</span>.</p></li>
</ul>
<p>Where <span class="math inline">\upsilon = 0</span> if <span class="math inline">G + L = 0</span>, otherwise:</p>
<p><span id="eq-relative-utilisation"><span class="math display">
\upsilon = \left( \frac{2 G L}{G^2 + L^2} \right)^2
\tag{34}</span></span></p>
<div id="fig-relative-utilisation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Upsilon range of values.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-relative-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb90" data-startfrom="3993" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3992;"><span id="cb90-3993"><a href="#cb90-3993" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeUpsilon</span>(G<span class="op">,</span> L) {</span>
<span id="cb90-3994"><a href="#cb90-3994" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb90-3995"><a href="#cb90-3995" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-3996"><a href="#cb90-3996" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb90-3997"><a href="#cb90-3997" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">2</span> <span class="op">*</span> G <span class="op">*</span> L <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>))<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-3998"><a href="#cb90-3998" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-3999"><a href="#cb90-3999" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-89" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb91" data-startfrom="4003" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4002;"><span id="cb91-4003"><a href="#cb91-4003" aria-hidden="true" tabindex="-1"></a>upsilonData <span class="op">=</span> {</span>
<span id="cb91-4004"><a href="#cb91-4004" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> upsilonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb91-4005"><a href="#cb91-4005" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb91-4006"><a href="#cb91-4006" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb91-4007"><a href="#cb91-4007" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb91-4008"><a href="#cb91-4008" aria-hidden="true" tabindex="-1"></a>        upsilonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb91-4009"><a href="#cb91-4009" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"υ"</span><span class="op">,</span></span>
<span id="cb91-4010"><a href="#cb91-4010" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb91-4011"><a href="#cb91-4011" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb91-4012"><a href="#cb91-4012" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeUpsilon</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb91-4013"><a href="#cb91-4013" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb91-4014"><a href="#cb91-4014" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb91-4015"><a href="#cb91-4015" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb91-4016"><a href="#cb91-4016" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-4017"><a href="#cb91-4017" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> upsilonData<span class="op">;</span></span>
<span id="cb91-4018"><a href="#cb91-4018" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-90" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb92" data-startfrom="4022" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4021;"><span id="cb92-4022"><a href="#cb92-4022" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb92-4023"><a href="#cb92-4023" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb92-4024"><a href="#cb92-4024" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb92-4025"><a href="#cb92-4025" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb92-4026"><a href="#cb92-4026" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb92-4027"><a href="#cb92-4027" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb92-4028"><a href="#cb92-4028" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb92-4029"><a href="#cb92-4029" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Relative Utilisation υ"</span><span class="op">,</span></span>
<span id="cb92-4030"><a href="#cb92-4030" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb92-4031"><a href="#cb92-4031" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb92-4032"><a href="#cb92-4032" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb92-4033"><a href="#cb92-4033" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb92-4034"><a href="#cb92-4034" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb92-4035"><a href="#cb92-4035" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb92-4036"><a href="#cb92-4036" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb92-4037"><a href="#cb92-4037" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb92-4038"><a href="#cb92-4038" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb92-4039"><a href="#cb92-4039" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(upsilonData<span class="op">,</span> {</span>
<span id="cb92-4040"><a href="#cb92-4040" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4041"><a href="#cb92-4041" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4042"><a href="#cb92-4042" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4043"><a href="#cb92-4043" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4044"><a href="#cb92-4044" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb92-4045"><a href="#cb92-4045" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb92-4046"><a href="#cb92-4046" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(upsilonData<span class="op">,</span> {</span>
<span id="cb92-4047"><a href="#cb92-4047" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb92-4048"><a href="#cb92-4048" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb92-4049"><a href="#cb92-4049" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb92-4050"><a href="#cb92-4050" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb92-4051"><a href="#cb92-4051" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb92-4052"><a href="#cb92-4052" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb92-4053"><a href="#cb92-4053" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb92-4054"><a href="#cb92-4054" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb92-4055"><a href="#cb92-4055" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb92-4056"><a href="#cb92-4056" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb92-4057"><a href="#cb92-4057" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb92-4058"><a href="#cb92-4058" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-91" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-relative-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;29: Upsilon <span class="math inline">\upsilon</span> range of values.
</figcaption>
</figure>
</div>
<p>The <strong>absolute utilisation</strong> parameter <span class="math inline">\eta</span> is defined as <span class="math inline">\eta = 0</span> if <span class="math inline">G + L = 0</span>, otherwise:</p>
<p><span id="eq-absolute-utilisation"><span class="math display">
\eta = \frac{2 G L}{G (1 - G) + L ( 1 - L)}
\tag{35}</span></span></p>
<div id="fig-absolute-utilisation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Eta range of values.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-absolute-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb93" data-startfrom="4079" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4078;"><span id="cb93-4079"><a href="#cb93-4079" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeEta</span>(G<span class="op">,</span> L) {</span>
<span id="cb93-4080"><a href="#cb93-4080" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb93-4081"><a href="#cb93-4081" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb93-4082"><a href="#cb93-4082" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb93-4083"><a href="#cb93-4083" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> G <span class="op">*</span> L <span class="op">/</span> (G <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> G) <span class="op">+</span> L <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> L))<span class="op">;</span></span>
<span id="cb93-4084"><a href="#cb93-4084" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-4085"><a href="#cb93-4085" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-92" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb94" data-startfrom="4089" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4088;"><span id="cb94-4089"><a href="#cb94-4089" aria-hidden="true" tabindex="-1"></a>etaData <span class="op">=</span> {</span>
<span id="cb94-4090"><a href="#cb94-4090" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> etaData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb94-4091"><a href="#cb94-4091" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb94-4092"><a href="#cb94-4092" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb94-4093"><a href="#cb94-4093" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb94-4094"><a href="#cb94-4094" aria-hidden="true" tabindex="-1"></a>        etaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb94-4095"><a href="#cb94-4095" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"η"</span><span class="op">,</span></span>
<span id="cb94-4096"><a href="#cb94-4096" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb94-4097"><a href="#cb94-4097" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb94-4098"><a href="#cb94-4098" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeEta</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb94-4099"><a href="#cb94-4099" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb94-4100"><a href="#cb94-4100" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb94-4101"><a href="#cb94-4101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-4102"><a href="#cb94-4102" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb94-4103"><a href="#cb94-4103" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> etaData<span class="op">;</span></span>
<span id="cb94-4104"><a href="#cb94-4104" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-93" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb95" data-startfrom="4108" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4107;"><span id="cb95-4108"><a href="#cb95-4108" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb95-4109"><a href="#cb95-4109" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb95-4110"><a href="#cb95-4110" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb95-4111"><a href="#cb95-4111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb95-4112"><a href="#cb95-4112" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb95-4113"><a href="#cb95-4113" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb95-4114"><a href="#cb95-4114" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb95-4115"><a href="#cb95-4115" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Absolute Utilisation η"</span><span class="op">,</span></span>
<span id="cb95-4116"><a href="#cb95-4116" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb95-4117"><a href="#cb95-4117" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb95-4118"><a href="#cb95-4118" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb95-4119"><a href="#cb95-4119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb95-4120"><a href="#cb95-4120" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb95-4121"><a href="#cb95-4121" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb95-4122"><a href="#cb95-4122" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb95-4123"><a href="#cb95-4123" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb95-4124"><a href="#cb95-4124" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb95-4125"><a href="#cb95-4125" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(etaData<span class="op">,</span> {</span>
<span id="cb95-4126"><a href="#cb95-4126" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4127"><a href="#cb95-4127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4128"><a href="#cb95-4128" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4129"><a href="#cb95-4129" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4130"><a href="#cb95-4130" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb95-4131"><a href="#cb95-4131" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb95-4132"><a href="#cb95-4132" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(etaData<span class="op">,</span> {</span>
<span id="cb95-4133"><a href="#cb95-4133" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb95-4134"><a href="#cb95-4134" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb95-4135"><a href="#cb95-4135" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb95-4136"><a href="#cb95-4136" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb95-4137"><a href="#cb95-4137" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb95-4138"><a href="#cb95-4138" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb95-4139"><a href="#cb95-4139" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb95-4140"><a href="#cb95-4140" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb95-4141"><a href="#cb95-4141" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb95-4142"><a href="#cb95-4142" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb95-4143"><a href="#cb95-4143" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb95-4144"><a href="#cb95-4144" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-94" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-absolute-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;30: Eta <span class="math inline">\eta</span> range of values.
</figcaption>
</figure>
</div>
<p>Incentives <span class="math inline">I</span> are allocated as follows:</p>
<section id="treasury" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="treasury"><span class="header-section-number">4.3.1</span> Treasury</h4>
<p>The allocation to the Treasury <span class="math inline">I_T</span> is the imbalance generated from <span class="math inline">\upsilon</span>:</p>
<p><span id="eq-allocation-treasury"><span class="math display">
I_T = 1 - \upsilon \, \eta
\tag{36}</span></span></p>
</section>
<section id="post-treasury" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="post-treasury"><span class="header-section-number">4.3.2</span> Post Treasury</h4>
<p>The residual post-treasury allocation is shared four ways within 2 buckets:</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong> &amp; user-locked <strong>G</strong> tokens</p>
<p>Where <span class="math inline">S</span> is the proportion of time-locked <strong>A</strong> tokens&nbsp;(as defined previously in <a href="#sec-time-locked-market" class="quarto-xref">Section&nbsp;3.1</a>):</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong>, <span class="math inline">I_S</span>:</p>
<p><span id="eq-allocation-locked-a"><span class="math display">
I_S = S \, \frac{L^2}{G^2 + L^2}
  \tag{37}</span></span></p></li>
<li><p>User-locked <strong>G</strong>, <span class="math inline">I_G</span>:</p>
<p><span id="eq-allocation-locked-g"><span class="math display">
I_G = (1 - S) \, \frac{L^2}{G^2 + L^2}
  \tag{38}</span></span></p></li>
</ol></li>
<li><p>Liquidity</p>
<p>With <span class="math inline">\lambda_G</span>, <span class="math inline">\lambda_Q</span>, <span class="math inline">\lambda_{GG}</span> as defined in <a href="#sec-share-of-risk-premium" class="quarto-xref">Section&nbsp;3.3.4</a>:</p>
<ol start="3" type="1">
<li><p><span class="overline"><strong>AG</strong></span> pool <span class="math inline">I_{AG}</span>:</p>
<p><span id="eq-allocation-pool-ag"><span class="math display">
I_{AG} = \frac{\lambda_G}{1 - \lambda_{GG}} \, \frac{G^2}{G^2 + L^2}
  \tag{39}</span></span></p></li>
<li><p><span class="overline"><strong>AQ</strong></span> pool <span class="math inline">I_{AQ}</span>:</p>
<p><span id="eq-allocation-pool-aq"><span class="math display">
I_{AQ} = \frac{\lambda_Q}{1 - \lambda_{GG}} \, \frac{G^2}{G^2 + L^2}
  \tag{40}</span></span></p></li>
</ol></li>
</ol>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb96" data-startfrom="4217" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4216;"><span id="cb96-4217"><a href="#cb96-4217" aria-hidden="true" tabindex="-1"></a>viewof inputS_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb96-4218"><a href="#cb96-4218" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Time-Locked } S`</span><span class="op">,</span></span>
<span id="cb96-4219"><a href="#cb96-4219" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb96-4220"><a href="#cb96-4220" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb96-4221"><a href="#cb96-4221" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb96-4222"><a href="#cb96-4222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4223"><a href="#cb96-4223" aria-hidden="true" tabindex="-1"></a>viewof inputWeightAG <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb96-4224"><a href="#cb96-4224" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{LP split}`</span><span class="op">,</span></span>
<span id="cb96-4225"><a href="#cb96-4225" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb96-4226"><a href="#cb96-4226" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb96-4227"><a href="#cb96-4227" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb96-4228"><a href="#cb96-4228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4229"><a href="#cb96-4229" aria-hidden="true" tabindex="-1"></a>paramWeightAQ <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> inputWeightAG<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-incentives-non-treasury" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentives-non-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb97" data-startfrom="4240" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4239;"><span id="cb97-4240"><a href="#cb97-4240" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeTreasury</span>(G<span class="op">,</span> L) {</span>
<span id="cb97-4241"><a href="#cb97-4241" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> <span class="fu">computeUpsilon</span>(G<span class="op">,</span> L) <span class="op">*</span> <span class="fu">computeEta</span>(G<span class="op">,</span> L))<span class="op">;</span></span>
<span id="cb97-4242"><a href="#cb97-4242" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-96" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb98" data-startfrom="4247" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4246;"><span id="cb98-4247"><a href="#cb98-4247" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIBonds</span>(G<span class="op">,</span> L<span class="op">,</span> S) {</span>
<span id="cb98-4248"><a href="#cb98-4248" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb98-4249"><a href="#cb98-4249" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb98-4250"><a href="#cb98-4250" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb98-4251"><a href="#cb98-4251" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S <span class="op">*</span> L<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb98-4252"><a href="#cb98-4252" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-4253"><a href="#cb98-4253" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-4254"><a href="#cb98-4254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4255"><a href="#cb98-4255" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIStaking</span>(G<span class="op">,</span> L<span class="op">,</span> S) {</span>
<span id="cb98-4256"><a href="#cb98-4256" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb98-4257"><a href="#cb98-4257" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb98-4258"><a href="#cb98-4258" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb98-4259"><a href="#cb98-4259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> S) <span class="op">*</span> L<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb98-4260"><a href="#cb98-4260" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-4261"><a href="#cb98-4261" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-97-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-97-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb99" data-startfrom="4264" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4263;"><span id="cb99-4264"><a href="#cb99-4264" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIPool</span>(G<span class="op">,</span> L<span class="op">,</span> weight) {</span>
<span id="cb99-4265"><a href="#cb99-4265" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb99-4266"><a href="#cb99-4266" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb99-4267"><a href="#cb99-4267" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb99-4268"><a href="#cb99-4268" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weight <span class="op">*</span> G<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb99-4269"><a href="#cb99-4269" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb99-4270"><a href="#cb99-4270" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-98" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb100" data-startfrom="4274" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4273;"><span id="cb100-4274"><a href="#cb100-4274" aria-hidden="true" tabindex="-1"></a>allocationSQData <span class="op">=</span> {</span>
<span id="cb100-4275"><a href="#cb100-4275" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocationSQData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb100-4276"><a href="#cb100-4276" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb100-4277"><a href="#cb100-4277" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb100-4278"><a href="#cb100-4278" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb100-4279"><a href="#cb100-4279" aria-hidden="true" tabindex="-1"></a>        allocationSQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb100-4280"><a href="#cb100-4280" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔 Time-locks Allocation"</span><span class="op">,</span></span>
<span id="cb100-4281"><a href="#cb100-4281" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb100-4282"><a href="#cb100-4282" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb100-4283"><a href="#cb100-4283" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIBonds</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputS_)<span class="op">,</span></span>
<span id="cb100-4284"><a href="#cb100-4284" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb100-4285"><a href="#cb100-4285" aria-hidden="true" tabindex="-1"></a>        allocationSQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb100-4286"><a href="#cb100-4286" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗚 User-locks Allocation"</span><span class="op">,</span></span>
<span id="cb100-4287"><a href="#cb100-4287" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb100-4288"><a href="#cb100-4288" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb100-4289"><a href="#cb100-4289" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIStaking</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputS_)<span class="op">,</span></span>
<span id="cb100-4290"><a href="#cb100-4290" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb100-4291"><a href="#cb100-4291" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb100-4292"><a href="#cb100-4292" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb100-4293"><a href="#cb100-4293" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb100-4294"><a href="#cb100-4294" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocationSQData<span class="op">;</span></span>
<span id="cb100-4295"><a href="#cb100-4295" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-99" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb101" data-startfrom="4300" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4299;"><span id="cb101-4300"><a href="#cb101-4300" aria-hidden="true" tabindex="-1"></a>plotAllocationSQ <span class="op">=</span> {</span>
<span id="cb101-4301"><a href="#cb101-4301" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotAllocationSQ <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb101-4302"><a href="#cb101-4302" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb101-4303"><a href="#cb101-4303" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb101-4304"><a href="#cb101-4304" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb101-4305"><a href="#cb101-4305" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb101-4306"><a href="#cb101-4306" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb101-4307"><a href="#cb101-4307" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb101-4308"><a href="#cb101-4308" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb101-4309"><a href="#cb101-4309" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb101-4310"><a href="#cb101-4310" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb101-4311"><a href="#cb101-4311" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb101-4312"><a href="#cb101-4312" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb101-4313"><a href="#cb101-4313" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb101-4314"><a href="#cb101-4314" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb101-4315"><a href="#cb101-4315" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb101-4316"><a href="#cb101-4316" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb101-4317"><a href="#cb101-4317" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb101-4318"><a href="#cb101-4318" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb101-4319"><a href="#cb101-4319" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(allocationSQData<span class="op">,</span> {</span>
<span id="cb101-4320"><a href="#cb101-4320" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4321"><a href="#cb101-4321" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4322"><a href="#cb101-4322" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4323"><a href="#cb101-4323" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4324"><a href="#cb101-4324" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb101-4325"><a href="#cb101-4325" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb101-4326"><a href="#cb101-4326" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb101-4327"><a href="#cb101-4327" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(allocationSQData<span class="op">,</span> {</span>
<span id="cb101-4328"><a href="#cb101-4328" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb101-4329"><a href="#cb101-4329" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb101-4330"><a href="#cb101-4330" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb101-4331"><a href="#cb101-4331" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb101-4332"><a href="#cb101-4332" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb101-4333"><a href="#cb101-4333" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb101-4334"><a href="#cb101-4334" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb101-4335"><a href="#cb101-4335" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb101-4336"><a href="#cb101-4336" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb101-4337"><a href="#cb101-4337" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb101-4338"><a href="#cb101-4338" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb101-4339"><a href="#cb101-4339" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb101-4340"><a href="#cb101-4340" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb101-4341"><a href="#cb101-4341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4342"><a href="#cb101-4342" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotAllocationSQ)</span>
<span id="cb101-4343"><a href="#cb101-4343" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb101-4344"><a href="#cb101-4344" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb101-4345"><a href="#cb101-4345" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb101-4346"><a href="#cb101-4346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4347"><a href="#cb101-4347" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotAllocationSQ<span class="op">;</span></span>
<span id="cb101-4348"><a href="#cb101-4348" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-100" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-100-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-100" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-100-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Time-locked <strong>A</strong> and user-locked <strong>G</strong> allocations.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb102" data-startfrom="4352" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4351;"><span id="cb102-4352"><a href="#cb102-4352" aria-hidden="true" tabindex="-1"></a>allocationPoolData <span class="op">=</span> {</span>
<span id="cb102-4353"><a href="#cb102-4353" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocationPoolData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb102-4354"><a href="#cb102-4354" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb102-4355"><a href="#cb102-4355" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb102-4356"><a href="#cb102-4356" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb102-4357"><a href="#cb102-4357" aria-hidden="true" tabindex="-1"></a>        allocationPoolData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb102-4358"><a href="#cb102-4358" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔𝗚 Pool Allocation"</span><span class="op">,</span></span>
<span id="cb102-4359"><a href="#cb102-4359" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb102-4360"><a href="#cb102-4360" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb102-4361"><a href="#cb102-4361" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIPool</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputWeightAG)<span class="op">,</span></span>
<span id="cb102-4362"><a href="#cb102-4362" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb102-4363"><a href="#cb102-4363" aria-hidden="true" tabindex="-1"></a>        allocationPoolData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb102-4364"><a href="#cb102-4364" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔𝗤 Pool Allocation"</span><span class="op">,</span></span>
<span id="cb102-4365"><a href="#cb102-4365" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb102-4366"><a href="#cb102-4366" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb102-4367"><a href="#cb102-4367" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIPool</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> paramWeightAQ)<span class="op">,</span></span>
<span id="cb102-4368"><a href="#cb102-4368" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb102-4369"><a href="#cb102-4369" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb102-4370"><a href="#cb102-4370" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb102-4371"><a href="#cb102-4371" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-4372"><a href="#cb102-4372" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocationPoolData<span class="op">;</span></span>
<span id="cb102-4373"><a href="#cb102-4373" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-101" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb103" data-startfrom="4378" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4377;"><span id="cb103-4378"><a href="#cb103-4378" aria-hidden="true" tabindex="-1"></a>plotAllocationPool <span class="op">=</span> {</span>
<span id="cb103-4379"><a href="#cb103-4379" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotAllocationPool <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb103-4380"><a href="#cb103-4380" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb103-4381"><a href="#cb103-4381" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb103-4382"><a href="#cb103-4382" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb103-4383"><a href="#cb103-4383" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb103-4384"><a href="#cb103-4384" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb103-4385"><a href="#cb103-4385" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb103-4386"><a href="#cb103-4386" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb103-4387"><a href="#cb103-4387" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb103-4388"><a href="#cb103-4388" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb103-4389"><a href="#cb103-4389" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb103-4390"><a href="#cb103-4390" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb103-4391"><a href="#cb103-4391" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb103-4392"><a href="#cb103-4392" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb103-4393"><a href="#cb103-4393" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb103-4394"><a href="#cb103-4394" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb103-4395"><a href="#cb103-4395" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb103-4396"><a href="#cb103-4396" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb103-4397"><a href="#cb103-4397" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(allocationPoolData<span class="op">,</span> {</span>
<span id="cb103-4398"><a href="#cb103-4398" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4399"><a href="#cb103-4399" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4400"><a href="#cb103-4400" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4401"><a href="#cb103-4401" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4402"><a href="#cb103-4402" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb103-4403"><a href="#cb103-4403" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb103-4404"><a href="#cb103-4404" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb103-4405"><a href="#cb103-4405" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(allocationPoolData<span class="op">,</span> {</span>
<span id="cb103-4406"><a href="#cb103-4406" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb103-4407"><a href="#cb103-4407" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb103-4408"><a href="#cb103-4408" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb103-4409"><a href="#cb103-4409" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb103-4410"><a href="#cb103-4410" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb103-4411"><a href="#cb103-4411" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb103-4412"><a href="#cb103-4412" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb103-4413"><a href="#cb103-4413" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb103-4414"><a href="#cb103-4414" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb103-4415"><a href="#cb103-4415" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb103-4416"><a href="#cb103-4416" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb103-4417"><a href="#cb103-4417" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb103-4418"><a href="#cb103-4418" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb103-4419"><a href="#cb103-4419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4420"><a href="#cb103-4420" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotAllocationPool)</span>
<span id="cb103-4421"><a href="#cb103-4421" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb103-4422"><a href="#cb103-4422" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb103-4423"><a href="#cb103-4423" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb103-4424"><a href="#cb103-4424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4425"><a href="#cb103-4425" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotAllocationPool<span class="op">;</span></span>
<span id="cb103-4426"><a href="#cb103-4426" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-102" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-102-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-102" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-102-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Liquidity pools allocations.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentives-non-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;31: Share of non-treasury incentives <span class="math inline">I_S</span>, <span class="math inline">I_G</span>, <span class="math inline">I_{AG}</span> and <span class="math inline">I_{AQ}</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<div id="fig-incentives-treasury" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Treasury incentives.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentives-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb104" data-startfrom="4451" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4450;"><span id="cb104-4451"><a href="#cb104-4451" aria-hidden="true" tabindex="-1"></a>treasuryData <span class="op">=</span> {</span>
<span id="cb104-4452"><a href="#cb104-4452" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> treasuryData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb104-4453"><a href="#cb104-4453" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb104-4454"><a href="#cb104-4454" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb104-4455"><a href="#cb104-4455" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb104-4456"><a href="#cb104-4456" aria-hidden="true" tabindex="-1"></a>        treasuryData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb104-4457"><a href="#cb104-4457" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"I_T"</span><span class="op">,</span></span>
<span id="cb104-4458"><a href="#cb104-4458" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb104-4459"><a href="#cb104-4459" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb104-4460"><a href="#cb104-4460" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeTreasury</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb104-4461"><a href="#cb104-4461" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb104-4462"><a href="#cb104-4462" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb104-4463"><a href="#cb104-4463" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb104-4464"><a href="#cb104-4464" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-4465"><a href="#cb104-4465" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> treasuryData<span class="op">;</span></span>
<span id="cb104-4466"><a href="#cb104-4466" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-103" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb105" data-startfrom="4470" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4469;"><span id="cb105-4470"><a href="#cb105-4470" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb105-4471"><a href="#cb105-4471" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb105-4472"><a href="#cb105-4472" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb105-4473"><a href="#cb105-4473" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb105-4474"><a href="#cb105-4474" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb105-4475"><a href="#cb105-4475" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb105-4476"><a href="#cb105-4476" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb105-4477"><a href="#cb105-4477" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb105-4478"><a href="#cb105-4478" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb105-4479"><a href="#cb105-4479" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb105-4480"><a href="#cb105-4480" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb105-4481"><a href="#cb105-4481" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb105-4482"><a href="#cb105-4482" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb105-4483"><a href="#cb105-4483" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb105-4484"><a href="#cb105-4484" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb105-4485"><a href="#cb105-4485" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb105-4486"><a href="#cb105-4486" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb105-4487"><a href="#cb105-4487" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(treasuryData<span class="op">,</span> {</span>
<span id="cb105-4488"><a href="#cb105-4488" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4489"><a href="#cb105-4489" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4490"><a href="#cb105-4490" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4491"><a href="#cb105-4491" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4492"><a href="#cb105-4492" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb105-4493"><a href="#cb105-4493" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb105-4494"><a href="#cb105-4494" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(treasuryData<span class="op">,</span> {</span>
<span id="cb105-4495"><a href="#cb105-4495" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb105-4496"><a href="#cb105-4496" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb105-4497"><a href="#cb105-4497" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb105-4498"><a href="#cb105-4498" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb105-4499"><a href="#cb105-4499" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb105-4500"><a href="#cb105-4500" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb105-4501"><a href="#cb105-4501" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb105-4502"><a href="#cb105-4502" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb105-4503"><a href="#cb105-4503" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb105-4504"><a href="#cb105-4504" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb105-4505"><a href="#cb105-4505" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb105-4506"><a href="#cb105-4506" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-104" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentives-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32: Treasury incentives <span class="math inline">I_T</span>.
</figcaption>
</figure>
</div>


<div class="ojs-auto-generated hidden">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nU308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0l9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdBU3VwcGx5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMyJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nUHJlc2VudFRvbm5lc308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0FFbWl0dGVkfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nRGVsdGFUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC02In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdBUHJpY2V9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdCYXJDaVByaWNlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQVN1cHBseV99PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC05In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdMaXF1aWRUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQUJ1cm50fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0RlbHRhQ2lUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQVByaWNlX308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEzIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdDaVByaWNlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0lucHV0UDB9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nSW5wdXRUfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTYifV19
</script>
</div>
</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note the development of liquidity pool pricing functionality may be applicable.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dFMgPSBJbnB1dHMucmFuZ2UoWzFlLTQsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1RpbWUtTG9ja2VkIH0gU2AsXG4gIHN0ZXA6IDFlLTQsXG4gIHZhbHVlOiAwLjU1LFxufSk7XG52aWV3b2YgaW5wdXREID0gSW5wdXRzLnJhbmdlKFswLjI1LCAxMF0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UGFyYW1ldGVyIH0gRGAsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiA0LjY5LFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb25zdEFyZWFMaW5lYXIocmFuZ2UsIGFyZWEsIGlucHV0U2xvcGUsIHNsb3BlRmFjdG9yID0gMC4wMDcpIHtcbiAgaWYgKHJhbmdlLmxlbmd0aCA9PT0gMSkge1xuICAgIHJldHVybiBbYXJlYV07XG4gIH1cblxuICBsZXQgeTEgPSAwO1xuICBsZXQgeTIgPSByYW5nZS5sZW5ndGggLSAxO1xuICBsZXQgc2xvcGUgPSBzbG9wZUZhY3RvciAqIE1hdGguYXRhbmgoaW5wdXRTbG9wZSk7XG4gIGxldCBpbnRlcmNlcHQgPSBhcmVhIC8gcmFuZ2UubGVuZ3RoO1xuXG4gIGlmIChNYXRoLmFicyhzbG9wZSkgPiAyICogaW50ZXJjZXB0IC8gKHkyIC0geTEgLSAxKSkge1xuICAgIGNvbnN0IHlFeGFjdFNoaWZ0ID0gTWF0aC5zcXJ0KE1hdGguYWJzKDIgKiBhcmVhIC8gc2xvcGUpKTtcbiAgICBjb25zdCB5Um91bmRTaGlmdCA9IE1hdGgubWF4KDEsIE1hdGgucm91bmQoeUV4YWN0U2hpZnQpKTtcbiAgICBpZiAoc2xvcGUgPiAwKSB7XG4gICAgICB5MSA9IHkyIC0geVJvdW5kU2hpZnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHkyID0geTEgKyB5Um91bmRTaGlmdDtcbiAgICB9XG4gICAgc2xvcGUgPSBNYXRoLnNpZ24oc2xvcGUpICogMiAqIGFyZWEgLyBNYXRoLnBvdygoeTIgLSB5MSksIDIpO1xuICAgIGludGVyY2VwdCA9IE1hdGguYWJzKHNsb3BlKSAqICh5MiAtIHkxIC0gMSkgLyAyO1xuICB9XG5cbiAgY29uc3QgeUNvbnN0QXJlYSA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHJhbmdlLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeSA9IGkgLSAoeTEgKyB5MikgLyAyO1xuICAgIHlDb25zdEFyZWEucHVzaChNYXRoLm1heCgwLCBzbG9wZSAqIHkgKyBpbnRlcmNlcHQpKTtcbiAgfVxuXG4gIHJldHVybiB5Q29uc3RBcmVhO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjRSA9IGQzLnJhbmdlKDAuMjUsIDEwLjEsIDAuMjUpO1xuXG5zY2FsZUUgPSBkMy5zY2FsZUxpbmVhcihkMy5leHRlbnQodmVjRSksIFstMSwgMV0pO1xuXG52ZWNTID0gY29uc3RBcmVhTGluZWFyKHZlY0UsIDAuNTUsIHNjYWxlRShpbnB1dEQpKS5tYXAoXG4gIHggPT4geCAqIGlucHV0UyAvIDAuNTUsXG4pO1xuXG52ZWNSZXZlcnNlQ3Vtc3VtUyA9IGQzLmN1bXN1bSh2ZWNTLnNsaWNlKCkucmV2ZXJzZSgpKS5yZXZlcnNlKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBkb3RQcm9kdWN0KHYsIHcpIHtcbiAgaWYgKHYubGVuZ3RoICE9PSB3Lmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlZlY3RvcnMgbXVzdCBoYXZlIHRoZSBzYW1lIGxlbmd0aFwiKTtcbiAgfVxuICByZXR1cm4gdi5yZWR1Y2UoKGFjYywgdmFsLCBpKSA9PiBhY2MgKyB2YWwgKiB3W2ldLCAwKTtcbn1cblxuZnVuY3Rpb24gd2VpZ2h0ZWRBcml0aG1ldGljTWVhbih2LCB3ZWlnaHRzKSB7XG4gIHJldHVybiBkb3RQcm9kdWN0KHYsIHdlaWdodHMpIC8gZDMuc3VtKHdlaWdodHMpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1EID0gd2VpZ2h0ZWRBcml0aG1ldGljTWVhbih2ZWNFLCB2ZWNTKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBhcmFtQyA9IHdlaWdodGVkQXJpdGhtZXRpY01lYW4odmVjRS5tYXAoZSA9PiBlICogZSksIHZlY1MpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUdhbW1hKHZlY0UsIHBhcmFtRCwgcGFyYW1DKSB7XG4gIGNvbnN0IHR3b0MgPSAyICogcGFyYW1DO1xuICByZXR1cm4gdmVjRS5tYXAoZSA9PiBNYXRoLm1heCgwLCBlL3BhcmFtRCAtIGUqZS90d29DKSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNHYW1tYSA9IGNvbXB1dGVHYW1tYSh2ZWNFLCBwYXJhbUQsIHBhcmFtQyk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBub3JtYWxpemUodikge1xuICBjb25zdCBzdW0gPSBkMy5zdW0odik7XG4gIHJldHVybiB2Lm1hcCh2YWwgPT4gdmFsIC8gc3VtKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNOb3JtR2FtbWEgPSBub3JtYWxpemUodmVjR2FtbWEpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZlY0N1bVN1bUdhbW1hID0gZDMuY3Vtc3VtKHZlY05vcm1HYW1tYSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVoocGFyYW1TLCB2ZWNDdW1TdW1HYW1tYSwgdmVjRSkge1xuICByZXR1cm4gdmVjQ3VtU3VtR2FtbWEubWFwKChnLCB0KSA9PiAoMSAtIHBhcmFtUykgKiBnIC8gdmVjRVt0XSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjWiA9IGNvbXB1dGVaKGlucHV0UywgdmVjQ3VtU3VtR2FtbWEsIHZlY0UpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVCKHZlY1osIHZlY0UpIHtcbiAgcmV0dXJuIHZlY1oubWFwKCh6LCB0KSA9PiBNYXRoLmV4cCgteiAqIHZlY0VbdF0pKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNCID0gY29tcHV0ZUIodmVjWiwgdmVjRSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVkodmVjWikge1xuICByZXR1cm4gdmVjWi5tYXAoeiA9PiBNYXRoLmV4cG0xKHopKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNZID0gY29tcHV0ZVkodmVjWik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1JID0gZG90UHJvZHVjdCh2ZWNTLCB2ZWNZKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ5aWVsZERhdGEgPSB7XG4gICBjb25zdCB5aWVsZERhdGEgPSBbXTtcbiAgIGZvciAobGV0IHQgPSAzOyB0IDwgdmVjRS5sZW5ndGg7IHQgKz0gNCkge1xuICAgICAgeWllbGREYXRhLnB1c2goe1xuICAgICAgICAga2V5OiBcIlN0YWtlIEFcIixcbiAgICAgICAgIHZhbHVlOiAxMDAgKiBkMy5zdW0odmVjUy5zbGljZSh0IC0gMywgdCArIDEpKSxcbiAgICAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgICB9KTtcbiAgICAgIHlpZWxkRGF0YS5wdXNoKHtcbiAgICAgICAgIGtleTogXCJZaWVsZCBUZXJtIFN0cnVjdHVyZVwiLFxuICAgICAgICAgdmFsdWU6IDEwMCAqIHZlY1pbdF0sXG4gICAgICAgICB0aW1lOiB2ZWNFW3RdLFxuICAgICAgfSk7XG4gICAgICB5aWVsZERhdGEucHVzaCh7XG4gICAgICAgICBrZXk6IFwiUmVhbCBZaWVsZFwiLFxuICAgICAgICAgdmFsdWU6IDEwMCAqICh2ZWNaW3RdIC0gcGFyYW1JKSxcbiAgICAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgICB9KTtcbiAgICAgIHlpZWxkRGF0YS5wdXNoKHtcbiAgICAgICAgIGtleTogXCJEaXNjb3VudCBDdXJ2ZVwiLFxuICAgICAgICAgdmFsdWU6IDEwMCAqIHZlY0JbdF0sXG4gICAgICAgICB0aW1lOiB2ZWNFW3RdLFxuICAgICAgfSk7XG4gICAgICB5aWVsZERhdGEucHVzaCh7XG4gICAgICAgICBrZXk6IFwiQ3VtdWxhdGl2ZSBTdGFrZSBBXCIsXG4gICAgICAgICB2YWx1ZTogMTAwICogdmVjUmV2ZXJzZUN1bXN1bVNbdCAtIDNdLFxuICAgICAgICAgdGltZTogdmVjRVt0XSxcbiAgICAgIH0pO1xuICAgfVxuICAgcmV0dXJuIHlpZWxkRGF0YTtcbn07XG5nZXRTdGFrZSA9IGQgPT4gZC5rZXkgPT09IFwiU3Rha2UgQVwiID8gZC52YWx1ZSA6IE5hTjtcbmdldFlpZWxkVGVybSA9IGQgPT4gZC5rZXkgPT09IFwiWWllbGQgVGVybSBTdHJ1Y3R1cmVcIiA/IGQudmFsdWUgOiBOYU47XG5nZXRSZWFsWWllbGQgPSBkID0+IGQua2V5ID09PSBcIlJlYWwgWWllbGRcIiA/IGQudmFsdWUgOiBOYU47XG5nZXREaXNjb3VudCA9IGQgPT4gZC5rZXkgPT09IFwiRGlzY291bnQgQ3VydmVcIiA/IGQudmFsdWUgOiBOYU47XG5nZXRDdW1TdGFrZSA9IGQgPT4gZC5rZXkgPT09IFwiQ3VtdWxhdGl2ZSBTdGFrZSBBXCIgPyBkLnZhbHVlIDogTmFOO1xuXG5zdHJpbmdTID0gXCJUb3RhbCBTdGFrZSA9IFwiICsgaW5wdXRTLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuKTtcbnN0cmluZ0kgPSBcIkluZmxhdGlvbiA9IFwiICsgcGFyYW1JLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuKTtcbnN0cmluZ0QgPSBgRCA9ICR7cGFyYW1ELnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbil9IHllYXJzYDtcbnN0cmluZ0MgPSBg4oiaQyA9ICR7TWF0aC5zcXJ0KHBhcmFtQykudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuKX0geWVhcnNgO1xuXG55aWVsZFBhcmFtcyA9IFtcbiAgeyBrZXk6IHN0cmluZ0QsIHRpbWU6IHBhcmFtRCB9LFxuICB7IGtleTogc3RyaW5nQywgdGltZTogTWF0aC5zcXJ0KHBhcmFtQykgfSxcbl07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsXG4gICAgZG9tYWluOiBbXCJTdGFrZSBBXCIsIFwiWWllbGQgVGVybSBTdHJ1Y3R1cmVcIiwgXCJSZWFsIFlpZWxkXCIsIHN0cmluZ0QsIHN0cmluZ0NdLFxuICB9LFxuICB4OiB7XG4gICAgdGlja3M6IGQzLnJhbmdlKDEsIDExKSxcbiAgICBkb21haW46IFswLjI1LCAxMC40NV0sXG4gICAgbGFiZWw6IFwiVGltZSB0byBFeHBpcnkgKFllYXJzKVwiLFxuICB9LFxuICB5OiB7XG4gICAgZG9tYWluOiBbXG4gICAgICAwLFxuICAgICAgTWF0aC5tYXgoZDMubWF4KHlpZWxkRGF0YSwgZ2V0U3Rha2UpLCBkMy5tYXgoeWllbGREYXRhLCBnZXRZaWVsZFRlcm0pKSxcbiAgICBdLFxuICAgIGdyaWQ6IHRydWUsXG4gIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcImxlZnRcIiwgbGFiZWw6IFwiU3Rha2UgQSBieSBNYXR1cml0eSAoJSlcIiB9KSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIllpZWxkIFJhdGVzICglKVwiIH0pLFxuICAgIFBsb3QucmVjdFkoeWllbGREYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLnRpbWUgLSAwLjQ1LFxuICAgICAgeDI6IGQgPT4gZC50aW1lICsgMC40NSxcbiAgICAgIHk6IGdldFN0YWtlLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgICBQbG90LnJ1bGVYKHlpZWxkUGFyYW1zLCB7XG4gICAgICB4OiBcInRpbWVcIixcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSxcbiAgICBQbG90LmxpbmVZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0WWllbGRUZXJtLCBzdHJva2U6IFwia2V5XCIgfSksXG4gICAgUGxvdC5kb3RZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0WWllbGRUZXJtLCBmaWxsOiBcImtleVwiIH0pLFxuICAgIFBsb3QubGluZVkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXRSZWFsWWllbGQsIHN0cm9rZTogXCJrZXlcIiB9KSxcbiAgICBQbG90LmRvdFkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXRSZWFsWWllbGQsIGZpbGw6IFwia2V5XCIgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogWzgsIDUsIDMsIDRdLm1hcChpID0+IGQzLnNjaGVtZUNhdGVnb3J5MTBbaV0pLFxuICAgIGRvbWFpbjogW1wiQ3VtdWxhdGl2ZSBTdGFrZSBBXCIsIFwiRGlzY291bnQgQ3VydmVcIiwgc3RyaW5nRCwgc3RyaW5nQ10sXG4gIH0sXG4gIHg6IHtcbiAgICB0aWNrczogZDMucmFuZ2UoMSwgMTEpLFxuICAgIGRvbWFpbjogWzAuMjUsIDEwLjQ1XSxcbiAgICBsYWJlbDogXCJUaW1lIHRvIEV4cGlyeSAoWWVhcnMpXCJcbiAgfSxcbiAgeTogeyBkb21haW46IFswLCAxMDBdLCBncmlkOiB0cnVlIH0sXG4gIGNsaXA6IHRydWUsXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcImxlZnRcIiwgbGFiZWw6IFwiQ3VtdWxhdGl2ZSBTdGFrZSAoJSlcIiB9KSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIkRpc2NvdW50ICglKVwiIH0pLFxuICAgIFBsb3QucmVjdFkoeWllbGREYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLnRpbWUgLSAwLjQ1LFxuICAgICAgeDI6IGQgPT4gZC50aW1lICsgMC40NSxcbiAgICAgIHk6IGdldEN1bVN0YWtlLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgICBQbG90LnJ1bGVYKHlpZWxkUGFyYW1zLCB7XG4gICAgICB4OiBcInRpbWVcIixcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSxcbiAgICBQbG90LmxpbmVZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0RGlzY291bnQsIHN0cm9rZTogXCJrZXlcIiB9KSxcbiAgICBQbG90LmRvdFkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXREaXNjb3VudCwgZmlsbDogXCJrZXlcIiB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbnRyYXN0aW5nVGV4dENvbG9yKGJhY2tncm91bmRDb2xvcikge1xuICBpZiAoZDMuaHNsKGJhY2tncm91bmRDb2xvcikubCA8IDAuNSkge1xuICAgIHJldHVybiBcIndoaXRlXCI7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFwiYmxhY2tcIjtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVBcHByb3hEZWx0YUEocGFyYW1TLCBwYXJhbUUpIHtcbiAgcmV0dXJuIHBhcmFtUyAqICgxIC0gcGFyYW1TKSAvIHBhcmFtRTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbmZsYXRpb25EYXRhID0ge1xuICBjb25zdCBpbmZsYXRpb25EYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtUyA9IDA7IHBhcmFtUyA8IDEuMDE7IHBhcmFtUyArPSAwLjEpIHtcbiAgICBmb3IgKGxldCBwYXJhbUUgPSAxOyBwYXJhbUUgPD0gMTA7IHBhcmFtRSsrKSB7XG4gICAgICBpbmZsYXRpb25EYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwizpRBXCIsXG4gICAgICAgIGU6IHBhcmFtRSxcbiAgICAgICAgczogcGFyYW1TLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZUFwcHJveERlbHRhQShwYXJhbVMsIHBhcmFtRSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGluZmxhdGlvbkRhdGE7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgc2NoZW1lOiBcIlNwZWN0cmFsXCIsIHR5cGU6IFwic2VxdWVudGlhbFwiLCBsYWJlbDogXCLOlFNcIiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgxLCAxMC4xLCAxKSwgZG9tYWluOiBbMTAuNSwgMC41XSwgbGFiZWw6IFwiRXhwaXJ5IFRpbWUgRVwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiU3Rha2luZyBTXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KGluZmxhdGlvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuZSAtIDAuNSxcbiAgICAgIHgyOiBkID0+IGQuZSArIDAuNSxcbiAgICAgIHkxOiBkID0+IGQucyAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLnMgKyAwLjA1LFxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChpbmZsYXRpb25EYXRhLCB7XG4gICAgICB4OiBcImVcIixcbiAgICAgIHk6IFwic1wiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFswLCBjb21wdXRlQXBwcm94RGVsdGFBKDAuNSwgMSldLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0Q2kwID0gSW5wdXRzLnJhbmdlKFswLCAxXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtQb3J0Zm9saW8gfSBDX3tpMH1gLFxuICBzdGVwOiAxZS0zLFxufSk7XG52aWV3b2YgaW5wdXRMaXFTaGFwZSA9IElucHV0cy5yYW5nZShbLTEsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1NjaGVkdWxlIHNoYXBlfWAsXG4gIHN0ZXA6IDFlLTMsXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNDaSA9IGNvbnN0QXJlYUxpbmVhcih2ZWNFLCAxIC0gaW5wdXRDaTAsIGlucHV0TGlxU2hhcGUsIDAuMDEpO1xuXG5wYXJhbUJhckNpID0gaW5wdXRDaTAgKyBkb3RQcm9kdWN0KHZlY0IsIHZlY0NpKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJjYXJib25IZWxkRGF0YSA9IHtcbiAgY29uc3QgY2FyYm9uSGVsZERhdGEgPSBbXTtcbiAgY2FyYm9uSGVsZERhdGEucHVzaCh7XG4gICAga2V5OiBcIkxpcXVpZGl0eSBTY2hlZHVsZVwiLFxuICAgIHZhbHVlOiAxMDAgKiBpbnB1dENpMCxcbiAgICB0aW1lOiAwLFxuICB9KTtcbiAgZm9yIChsZXQgdCA9IDM7IHQgPCB2ZWNFLmxlbmd0aDsgdCArPSA0KSB7XG4gICAgY2FyYm9uSGVsZERhdGEucHVzaCh7XG4gICAgICBrZXk6IFwiTGlxdWlkaXR5IFNjaGVkdWxlXCIsXG4gICAgICB2YWx1ZTogMTAwICogZDMuc3VtKHZlY0NpLnNsaWNlKHQgLSAzLCB0ICsgMSkpLFxuICAgICAgdGltZTogdmVjRVt0XSxcbiAgICB9KTtcbiAgICBjYXJib25IZWxkRGF0YS5wdXNoKHtcbiAgICAgIGtleTogXCJEaXNjb3VudCBDdXJ2ZVwiLFxuICAgICAgdmFsdWU6IDEwMCAqIHZlY0JbdF0sXG4gICAgICB0aW1lOiB2ZWNFW3RdLFxuICAgIH0pO1xuICB9XG4gIHJldHVybiBjYXJib25IZWxkRGF0YTtcbn07XG5nZXRMaXFTY2hlZHVsZSA9IGQgPT4gZC5rZXkgPT09IFwiTGlxdWlkaXR5IFNjaGVkdWxlXCIgPyBkLnZhbHVlIDogTmFOO1xuXG5zdHJpbmdCYXJDaSA9IGBQcmVzZW50LVZhbHVlIENhcmJvbiBDzIThtaIgPSAke3BhcmFtQmFyQ2kudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMCB9LFxuKX1gO1xuXG5oZWxkQ2FyYm9uUGFyYW0gPSBbeyBrZXk6IHN0cmluZ0JhckNpLCB2YWx1ZTogMTAwICogcGFyYW1CYXJDaSB9XTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogWzIsIDUsIDZdLm1hcChpID0+IGQzLnNjaGVtZUNhdGVnb3J5MTBbaV0pLFxuICAgIGRvbWFpbjogW1wiTGlxdWlkaXR5IFNjaGVkdWxlXCIsIFwiRGlzY291bnQgQ3VydmVcIiwgc3RyaW5nQmFyQ2ldLFxuICB9LFxuICB4OiB7XG4gICAgbGFiZWw6IFwiVGltZSB0byBFeHBpcnkgKFllYXJzKVwiLFxuICAgIGxhYmVsQW5jaG9yOiBcInJpZ2h0XCIsXG4gICAgbGFiZWxBcnJvdzogdHJ1ZSxcbiAgfSxcbiAgeTogeyBkb21haW46IFswLCAxMDBdLCBncmlkOiB0cnVlIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcImxlZnRcIiwgbGFiZWw6IFwiUXVhbnRpdHkgb2YgQ2FyYm9uICglKVwiIH0pLFxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwicmlnaHRcIiwgbGFiZWw6IFwiRGlzY291bnQgKCUpXCIgfSksXG4gICAgUGxvdC5yZWN0WShjYXJib25IZWxkRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC50aW1lIC0gMC40NSxcbiAgICAgIHgyOiBkID0+IGQudGltZSArIDAuNDUsXG4gICAgICB5OiBnZXRMaXFTY2hlZHVsZSxcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgfSksXG4gICAgUGxvdC5ydWxlWShoZWxkQ2FyYm9uUGFyYW0sIHtcbiAgICAgIHk6IFwidmFsdWVcIixcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSxcbiAgICBQbG90LmxpbmVZKGNhcmJvbkhlbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXREaXNjb3VudCwgc3Ryb2tlOiBcImtleVwiIH0pLFxuICAgIFBsb3QuZG90WShjYXJib25IZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0RGlzY291bnQsIGZpbGw6IFwia2V5XCIgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXREZWx0YUNpID0gSW5wdXRzLnJhbmdlKFswLCAxXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtQdXJjaGFzZWQgfSBcXERlbHRhIENfaWAsXG4gIHN0ZXA6IDFlLTMsXG4gIHZhbHVlOiAxLFxufSk7XG52aWV3b2YgaW5wdXRFdCA9IElucHV0cy5yYW5nZShbMCwgMTBdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0V4cGlyeSB9IEVfdCBcXHRleHR7ICh5ZWFycyl9YCxcbiAgc3RlcDogMSxcbiAgdmFsdWU6IDYsXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlRGVsdGFDaTAoZGVsdGFDaSwgdCkge1xuICByZXR1cm4gdCA9PT0gMCA/IGRlbHRhQ2kgOiAwO1xufVxuXG5mdW5jdGlvbiBjb21wdXRlVmVjRGVsdGFDaShkZWx0YUNpLCB0KSB7XG4gIGNvbnN0IHZlY0RlbHRhQ2kgPSBBcnJheSg0MCkuZmlsbCgwKTtcbiAgaWYgKHQgIT09IDApIHtcbiAgICB2ZWNEZWx0YUNpW3QgLSAxXSA9IGRlbHRhQ2k7XG4gIH1cbiAgcmV0dXJuIHZlY0RlbHRhQ2k7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1NYXR1cml0eUlkeCA9IDQgKiBpbnB1dEV0O1xuXG5wYXJhbURlbHRhQ2kwID0gY29tcHV0ZURlbHRhQ2kwKGlucHV0RGVsdGFDaSwgcGFyYW1NYXR1cml0eUlkeCk7XG5cbnZlY0RlbHRhQ2kgPSBjb21wdXRlVmVjRGVsdGFDaShpbnB1dERlbHRhQ2ksIHBhcmFtTWF0dXJpdHlJZHgpO1xuXG5wYXJhbURlbHRhQmFyQ2kgPSBwYXJhbURlbHRhQ2kwICsgZG90UHJvZHVjdCh2ZWNCLCB2ZWNEZWx0YUNpKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJjYXJib25CdXlEYXRhID0ge1xuICBjb25zdCBjYXJib25CdXlEYXRhID0gW107XG4gIGNhcmJvbkJ1eURhdGEucHVzaCh7XG4gICAga2V5OiBcIkNhcmJvbiBCb3VnaHQgYnkgQUFNXCIsXG4gICAgdmFsdWU6IDEwMCAqIHBhcmFtRGVsdGFDaTAsXG4gICAgdGltZTogMCxcbiAgfSk7XG4gIGZvciAobGV0IHQgPSAzOyB0IDwgdmVjRS5sZW5ndGg7IHQgKz0gNCkge1xuICAgIGNhcmJvbkJ1eURhdGEucHVzaCh7XG4gICAgICBrZXk6IFwiQ2FyYm9uIEJvdWdodCBieSBBQU1cIixcbiAgICAgIHZhbHVlOiAxMDAgKiBkMy5zdW0odmVjRGVsdGFDaS5zbGljZSh0IC0gMywgdCArIDEpKSxcbiAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgfSk7XG4gICAgY2FyYm9uQnV5RGF0YS5wdXNoKHtcbiAgICAgIGtleTogXCJEaXNjb3VudCBDdXJ2ZVwiLFxuICAgICAgdmFsdWU6IDEwMCAqIHZlY0JbdF0sXG4gICAgICB0aW1lOiB2ZWNFW3RdLFxuICAgIH0pO1xuICB9XG4gIHJldHVybiBjYXJib25CdXlEYXRhO1xufTtcbmdldENhcmJvbkJvdWdodCA9IGQgPT4gZC5rZXkgPT09IFwiQ2FyYm9uIEJvdWdodCBieSBBQU1cIiA/IGQudmFsdWUgOiBOYU47XG5cbnN0cmluZ0RlbHRhQmFyQ2kgPSBcIlByZXNlbnQtVmFsdWUgQ2FyYm9uIEJvdWdodCBieSBBQU0gzpRDzIThtaIgPSBcIiArXG4gICAgICAgIHBhcmFtRGVsdGFCYXJDaS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3R5bGU6IFwicGVyY2VudFwiLFxuICAgICAgICAgICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAxLFxuICAgICAgICAgICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAxLFxuICAgICAgICAgIH0sXG4gICAgICAgICk7XG5ib3VnaHRDYXJib25QYXJhbSA9IFt7IGtleTogc3RyaW5nRGVsdGFCYXJDaSwgdmFsdWU6IDEwMCAqIHBhcmFtRGVsdGFCYXJDaSB9XTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogWzMsIDUsIDddLm1hcChpID0+IGQzLnNjaGVtZUNhdGVnb3J5MTBbaV0pLFxuICAgIGRvbWFpbjogW1wiQ2FyYm9uIEJvdWdodCBieSBBQU1cIiwgXCJEaXNjb3VudCBDdXJ2ZVwiLCBzdHJpbmdEZWx0YUJhckNpXSxcbiAgfSxcbiAgeDoge1xuICAgIGxhYmVsOiBcIlRpbWUgdG8gRXhwaXJ5IChZZWFycylcIixcbiAgICBsYWJlbEFuY2hvcjogXCJyaWdodFwiLFxuICAgIGxhYmVsQXJyb3c6IHRydWUsXG4gIH0sXG4gIHk6IHsgZG9tYWluOiBbMCwgMTAwXSwgZ3JpZDogdHJ1ZSB9LFxuICBpbnNldFRvcDogMTYsXG4gIGluc2V0TGVmdDogOCxcbiAgaW5zZXRSaWdodDogOCxcbiAgY2xpcDogdHJ1ZSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJsZWZ0XCIsIGxhYmVsOiBcIlF1YW50aXR5IG9mIENhcmJvbiAoJSlcIiB9KSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIkRpc2NvdW50ICglKVwiIH0pLFxuICAgIFBsb3QucmVjdFkoY2FyYm9uQnV5RGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC50aW1lIC0gMC40NSxcbiAgICAgIHgyOiBkID0+IGQudGltZSArIDAuNDUsXG4gICAgICB5OiBnZXRDYXJib25Cb3VnaHQsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgIH0pLFxuICAgIFBsb3QucnVsZVkoYm91Z2h0Q2FyYm9uUGFyYW0sIHtcbiAgICAgIHk6IFwidmFsdWVcIixcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSxcbiAgICBQbG90LmxpbmVZKGNhcmJvbkJ1eURhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldERpc2NvdW50LCBzdHJva2U6IFwia2V5XCIgfSksXG4gICAgUGxvdC5kb3RZKGNhcmJvbkJ1eURhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldERpc2NvdW50LCBmaWxsOiBcImtleVwiIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0RGVsdGFCYXJDaSA9IElucHV0cy5yYW5nZShbMC4wMSwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UHVyY2hhc2VkIH0gXFxEZWx0YSBcXGJhciBDX2lgLFxuICBzdGVwOiAwLjAxLFxuICB2YWx1ZTogMSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVEZWx0YUEoQWksIEdpLCBkZWx0YUNpKSB7XG4gIHJldHVybiBNYXRoLmV4cG0xKChBaSAtIChBaSoqMiAqICgxIC0gR2kpKioyIC8gMikpICogTWF0aC5sb2cxcChkZWx0YUNpKSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicHJpY2luZ0RhdGEgPSB7XG4gIGNvbnN0IHByaWNpbmdEYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtR2kgPSAwOyBwYXJhbUdpIDwgMS4wMTsgcGFyYW1HaSArPSAwLjEpIHtcbiAgICBwcmljaW5nRGF0YS5wdXNoKHtcbiAgICAgIGtleTogXCLOlEFcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIHByaWNpbmdEYXRhLnB1c2goe1xuICAgICAga2V5OiBcIk5vcm1hbGlzZWQgzpRBXCIsXG4gICAgICBhaTogMCxcbiAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgdmFsdWU6IE5hTixcbiAgICB9KTtcbiAgICBmb3IgKGxldCBwYXJhbUFpID0gMC4xOyBwYXJhbUFpIDwgMS4wMTsgcGFyYW1BaSArPSAwLjEpIHtcbiAgICAgIHByaWNpbmdEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwizpRBXCIsXG4gICAgICAgIGFpOiBwYXJhbUFpLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVEZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUJhckNpKSxcbiAgICAgIH0pO1xuICAgICAgcHJpY2luZ0RhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJOb3JtYWxpc2VkIM6UQVwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlRGVsdGFBKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFCYXJDaSkgL1xuICAgICAgICAgICAgICAgIChpbnB1dERlbHRhQmFyQ2kgKiBwYXJhbUFpKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcHJpY2luZ0RhdGE7XG59O1xuZ2V0RGVsdGFBID0gZCA9PiBkLmtleSA9PT0gXCLOlEFcIiA/IGQudmFsdWUgOiBOYU47XG5nZXROb3JtRGVsdGFBID0gZCA9PiBkLmtleSA9PT0gXCJOb3JtYWxpc2VkIM6UQVwiID8gZC52YWx1ZSA6IE5hTjtcblxuc3RyaW5nSW5wdXREZWx0YUJhckNpID0gaW5wdXREZWx0YUJhckNpLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGDOlEEsIHdoZXJlIM6UQ8yE4bWiID0gJHtzdHJpbmdJbnB1dERlbHRhQmFyQ2l9YCxcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdChwcmljaW5nRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXG4gICAgICB4MjogZCA9PiBkLmFpICsgMC4wNSxcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXG4gICAgICBmaWxsOiBnZXREZWx0YUEsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KHByaWNpbmdEYXRhLCB7XG4gICAgICB4OiBcImFpXCIsXG4gICAgICB5OiBcImdpXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXREZWx0YUEoZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcbiAgICAgICAgICBbXG4gICAgICAgICAgICBjb21wdXRlRGVsdGFBKDAuMSwgMSwgaW5wdXREZWx0YUJhckNpKSxcbiAgICAgICAgICAgIGNvbXB1dGVEZWx0YUEoMSwgMSwgaW5wdXREZWx0YUJhckNpKSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGBOb3JtYWxpc2VkIM6UQSwgd2hlcmUgzpRDzIThtaIgPSAke3N0cmluZ0lucHV0RGVsdGFCYXJDaX1gLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KHByaWNpbmdEYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IGdldE5vcm1EZWx0YUEsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KHByaWNpbmdEYXRhLCB7XG4gICAgICB4OiBcImFpXCIsXG4gICAgICB5OiBcImdpXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXROb3JtRGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXG4gICAgICAgICAgW1xuICAgICAgICAgICAgY29tcHV0ZURlbHRhQSgxLCAwLCBpbnB1dERlbHRhQmFyQ2kpIC8gaW5wdXREZWx0YUJhckNpLFxuICAgICAgICAgICAgY29tcHV0ZURlbHRhQSgxLCAxLCBpbnB1dERlbHRhQmFyQ2kpIC8gaW5wdXREZWx0YUJhckNpLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCxcbiAgICAgICAgKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXREZWx0YUJhckNudWxsID0gSW5wdXRzLnJhbmdlKFsxZS0xLCAxZTVdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1B1cmNoYXNlZCB9IFxcRGVsdGEgXFxiYXIgQ19cXGVtcHR5c2V0YCxcbiAgc3RlcDogMWUtMSxcbiAgdmFsdWU6IDFlMixcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVaZXJvQ2FyYm9uRGVsdGFBKEFpLCBHaSwgZGVsdGFDbnVsbCkge1xuICByZXR1cm4gKGRlbHRhQ251bGwgLyAoMSArIGRlbHRhQ251bGwpKSAqIChBaSAtIChBaSoqMiAqICgxIC0gR2kpKioyIC8gMikpKioyO1xufVxuXG5mdW5jdGlvbiBjb21wdXRlVHJ1ZURlbHRhQShBaSwgR2ksIGJhckNpVG9ubmVzLCBkZWx0YUJhckNpVG9ubmVzKSB7XG4gIGlmIChiYXJDaVRvbm5lcyA9PT0gMCkge1xuICAgIHJldHVybiBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQShBaSwgR2ksIGRlbHRhQmFyQ2lUb25uZXMpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGRlbHRhQmFyQ2kgPSBkZWx0YUJhckNpVG9ubmVzIC8gYmFyQ2lUb25uZXM7XG4gICAgcmV0dXJuIGNvbXB1dGVEZWx0YUEoQWksIEdpLCBkZWx0YUJhckNpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBudW1iZXJPZkRpZ2l0cyh4KSB7XG4gIHJldHVybiB4ID09PSAwID8gMSA6ICgxICsgTWF0aC5mbG9vcihNYXRoLmxvZzEwKHgpKSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiemVyb0NhcmJvbkRhdGEgPSB7XG4gIGNvbnN0IHplcm9DYXJib25EYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtR2kgPSAwOyBwYXJhbUdpIDwgMS4wMTsgcGFyYW1HaSArPSAwLjEpIHtcbiAgICB6ZXJvQ2FyYm9uRGF0YS5wdXNoKHtcbiAgICAgIGtleTogXCLOlEFcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIHplcm9DYXJib25EYXRhLnB1c2goe1xuICAgICAga2V5OiBcIk5vcm1hbGlzZWQgzpRBXCIsXG4gICAgICBhaTogMCxcbiAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgdmFsdWU6IE5hTixcbiAgICB9KTtcbiAgICBmb3IgKGxldCBwYXJhbUFpID0gMC4xOyBwYXJhbUFpIDwgMS4wMTsgcGFyYW1BaSArPSAwLjEpIHtcbiAgICAgIHplcm9DYXJib25EYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwizpRBXCIsXG4gICAgICAgIGFpOiBwYXJhbUFpLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVaZXJvQ2FyYm9uRGVsdGFBKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFCYXJDbnVsbCksXG4gICAgICB9KTtcbiAgICAgIHplcm9DYXJib25EYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiTm9ybWFsaXNlZCDOlEFcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZVplcm9DYXJib25EZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUJhckNudWxsKSAvXG4gICAgICAgICAgICAgICAgKChpbnB1dERlbHRhQmFyQ251bGwgLyAoMSArIGlucHV0RGVsdGFCYXJDbnVsbCkpICogcGFyYW1BaSoqMiksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHplcm9DYXJib25EYXRhO1xufTtcblxuc3RyaW5nRGVsdGFCYXJDbnVsbCA9IGlucHV0RGVsdGFCYXJDbnVsbC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgxLCBudW1iZXJPZkRpZ2l0cyhpbnB1dERlbHRhQmFyQ251bGwpKSxcbiAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDEsIG51bWJlck9mRGlnaXRzKGlucHV0RGVsdGFCYXJDbnVsbCkpLFxuICB9LFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogYM6UQSwgd2hlcmUgzpRDzITiiIUgPSAke3N0cmluZ0RlbHRhQmFyQ251bGx9IHRDTzJlcWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QoemVyb0NhcmJvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0RGVsdGFBLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dCh6ZXJvQ2FyYm9uRGF0YSwge1xuICAgICAgeDogXCJhaVwiLFxuICAgICAgeTogXCJnaVwiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0RGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiA0LCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDQgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXG4gICAgICAgICAgW1xuICAgICAgICAgICAgY29tcHV0ZVplcm9DYXJib25EZWx0YUEoMC4xLCAxLCBpbnB1dERlbHRhQmFyQ251bGwpLFxuICAgICAgICAgICAgY29tcHV0ZVplcm9DYXJib25EZWx0YUEoMSwgMSwgaW5wdXREZWx0YUJhckNudWxsKSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGBOb3JtYWxpc2VkIM6UQSwgd2hlcmUgzpRDzITiiIUgPSAke3N0cmluZ0RlbHRhQmFyQ251bGx9IHRDTzJlcWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QoemVyb0NhcmJvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0Tm9ybURlbHRhQSxcbiAgICB9KSxcbiAgICBQbG90LnRleHQoemVyb0NhcmJvbkRhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldE5vcm1EZWx0YUEoZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcbiAgICAgICAgICBbXG4gICAgICAgICAgICBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQSgxLCAwLCBpbnB1dERlbHRhQmFyQ251bGwpIC9cbiAgICAgICAgICAgICAgICAgICAgKGlucHV0RGVsdGFCYXJDbnVsbCAvICgxICsgaW5wdXREZWx0YUJhckNudWxsKSksXG4gICAgICAgICAgICBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQSgxLCAxLCBpbnB1dERlbHRhQmFyQ251bGwpIC9cbiAgICAgICAgICAgICAgICAgICAgKGlucHV0RGVsdGFCYXJDbnVsbCAvICgxICsgaW5wdXREZWx0YUJhckNudWxsKSksXG4gICAgICAgICAgXSxcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxuICAgICAgICApKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQSA9IElucHV0cy5yYW5nZShbMC4wMDEsIDAuOTk5XSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtCdXJudCB9IFxcRGVsdGEgQWAsXG4gIHN0ZXA6IDAuMDAxLFxuICB2YWx1ZTogMC4xLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZURlbHRhQ2koQWksIEdpLCBkZWx0YUEpIHtcbiAgcmV0dXJuIE1hdGguZXhwbTEoLU1hdGgubG9nMXAoZGVsdGFBKSAvIChBaSArIChBaSoqMiAqICgxIC0gR2kpKioyIC8gMikpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZXRpcmVtZW50RGF0YSA9IHtcbiAgY29uc3QgcmV0aXJlbWVudERhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xuICAgIHJldGlyZW1lbnREYXRhLnB1c2goe1xuICAgICAga2V5OiBcIi3OlEPhtaJcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xuICAgICAgcmV0aXJlbWVudERhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCItzpRD4bWiXCIsXG4gICAgICAgIGFpOiBwYXJhbUFpLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IC1jb21wdXRlRGVsdGFDaShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJldGlyZW1lbnREYXRhO1xufTtcblxuc3RyaW5nSW5wdXREZWx0YUEgPSBpbnB1dERlbHRhQS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAxLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDEgfSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGAtzpRD4bWiLCB3aGVyZSDOlEEgPSAke3N0cmluZ0lucHV0RGVsdGFBfWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QocmV0aXJlbWVudERhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChyZXRpcmVtZW50RGF0YSwge1xuICAgICAgeDogXCJhaVwiLFxuICAgICAgeTogXCJnaVwiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIC1jb21wdXRlRGVsdGFDaSgxLCAwLCBpbnB1dERlbHRhQSksXG4gICAgICAgICAgICAtY29tcHV0ZURlbHRhQ2koMC4xLCAxLCBpbnB1dERlbHRhQSksXG4gICAgICAgICAgXSxcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxuICAgICAgICApKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQ2luaXRpYWwgPSBJbnB1dHMucmFuZ2UoWzAuMDAxLCAxXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtJbml0aWFsIH1cXERlbHRhIENgLFxuICBzdGVwOiAwLjAwMSxcbiAgdmFsdWU6IDAuMSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVTcHJlYWQoQWksIEdpLCBkZWx0YUNpbml0aWFsKSB7XG4gIGNvbnN0IGRlbHRhQSA9IGNvbXB1dGVEZWx0YUEoQWksIEdpLCBkZWx0YUNpbml0aWFsKTtcbiAgY29uc3QgZGVsdGFDZmluYWwgPSAtY29tcHV0ZURlbHRhQ2koQWksIEdpLCBkZWx0YUEpO1xuICByZXR1cm4gKGRlbHRhQ2luaXRpYWwgLSBkZWx0YUNmaW5hbCkgLyBkZWx0YUNpbml0aWFsO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImxpcXVpZGF0aW9uRGF0YSA9IHtcbiAgY29uc3QgbGlxdWlkYXRpb25EYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtR2kgPSAwOyBwYXJhbUdpIDwgMS4wMTsgcGFyYW1HaSArPSAwLjEpIHtcbiAgICBsaXF1aWRhdGlvbkRhdGEucHVzaCh7IGtleTogXCJkZWx0YWFcIiwgYWk6IDAsIGdpOiBwYXJhbUdpLCB2YWx1ZTogTmFOIH0pO1xuICAgIGxpcXVpZGF0aW9uRGF0YS5wdXNoKHsga2V5OiBcImRlbHRhY1wiLCBhaTogMCwgZ2k6IHBhcmFtR2ksIHZhbHVlOiBOYU4gfSk7XG4gICAgbGlxdWlkYXRpb25EYXRhLnB1c2goeyBrZXk6IFwic3ByZWFkXCIsIGFpOiAwLCBnaTogcGFyYW1HaSwgdmFsdWU6IE5hTiB9KTtcbiAgICBmb3IgKGxldCBwYXJhbUFpID0gMC4xOyBwYXJhbUFpIDwgMS4wMTsgcGFyYW1BaSArPSAwLjEpIHtcbiAgICAgIGNvbnN0IGRlbHRhQSA9IGNvbXB1dGVEZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUNpbml0aWFsKVxuICAgICAgbGlxdWlkYXRpb25EYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiZGVsdGFhXCIsXG4gICAgICAgIGFpOiBwYXJhbUFpLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVEZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUNpbml0aWFsKSAvXG4gICAgICAgICAgICAgICAgaW5wdXREZWx0YUNpbml0aWFsLFxuICAgICAgfSk7XG4gICAgICBsaXF1aWRhdGlvbkRhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJkZWx0YWNcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZURlbHRhQ2kocGFyYW1BaSwgcGFyYW1HaSwgZGVsdGFBKSAvIGlucHV0RGVsdGFDaW5pdGlhbCxcbiAgICAgIH0pO1xuICAgICAgbGlxdWlkYXRpb25EYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwic3ByZWFkXCIsXG4gICAgICAgIGFpOiBwYXJhbUFpLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVTcHJlYWQocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUNpbml0aWFsKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbGlxdWlkYXRpb25EYXRhO1xufTtcbmdldExpcURlbHRhQSA9IGQgPT4gZC5rZXkgPT09IFwiZGVsdGFhXCIgPyBkLnZhbHVlIDogTmFOO1xuZ2V0TGlxRGVsdGFDaSA9IGQgPT4gZC5rZXkgPT09IFwiZGVsdGFjXCIgPyBkLnZhbHVlIDogTmFOO1xuZ2V0TGlxU3ByZWFkID0gZCA9PiBkLmtleSA9PT0gXCJzcHJlYWRcIiA/IGQudmFsdWUgOiBOYU47XG5cbnN0cmluZ0lucHV0RGVsdGFDaW5pdGlhbCA9IGlucHV0RGVsdGFDaW5pdGlhbC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAxLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDEgfSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgZG9tYWluOiBbMCwgY29tcHV0ZVNwcmVhZCgxLCAwLCAxKV0sXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGBDYXJib24gU3ByZWFkIM61LCB3aGVyZSBpbml0aWFsIM6UQyA9ICR7c3RyaW5nSW5wdXREZWx0YUNpbml0aWFsfWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QobGlxdWlkYXRpb25EYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IGdldExpcVNwcmVhZCxcbiAgICB9KSxcbiAgICBQbG90LnRleHQobGlxdWlkYXRpb25EYXRhLCB7XG4gICAgICB4OiBcImFpXCIsXG4gICAgICB5OiBcImdpXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXRMaXFTcHJlYWQoZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcbiAgICAgICAgICBbMCwgY29tcHV0ZVNwcmVhZCgxLCAwLCBpbnB1dERlbHRhQ2luaXRpYWwpXSxcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxuICAgICAgICApKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IklucHV0cy5iaW5kKFxuICBJbnB1dHMucmFuZ2UoWzAuMDAxLCAxXSwge1xuICAgIGxhYmVsOiB0ZXhgXFx0ZXh0e0luaXRpYWwgfVxcRGVsdGEgQ2AsXG4gICAgc3RlcDogMC4wMDEsXG4gICAgdmFsdWU6IDAuMSxcbiAgfSksXG4gIHZpZXdvZiBpbnB1dERlbHRhQ2luaXRpYWwsXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIGRvbWFpbjogWzAsIDFdLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBgQ29tcG9uZW50IM6UQSwgd2hlcmUgaW5pdGlhbCDOlEMgPSAke1xuICAgICAgc3RyaW5nSW5wdXREZWx0YUNpbml0aWFsXG4gICAgfWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QobGlxdWlkYXRpb25EYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IGdldExpcURlbHRhQSxcbiAgICB9KSxcbiAgICBQbG90LnRleHQobGlxdWlkYXRpb25EYXRhLCB7XG4gICAgICB4OiBcImFpXCIsXG4gICAgICB5OiBcImdpXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXRMaXFEZWx0YUEoZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoZDMuaW50ZXJwb2xhdGVTcGVjdHJhbChkLnZhbHVlKSksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiR3JleXNcIixcbiAgICBkb21haW46IFtcbiAgICAgIC0xLFxuICAgICAgY29tcHV0ZURlbHRhQ2koXG4gICAgICAgIDEsXG4gICAgICAgIDAsXG4gICAgICAgIGNvbXB1dGVEZWx0YUEoMSwgMCwgaW5wdXREZWx0YUNpbml0aWFsKSAvIGlucHV0RGVsdGFDaW5pdGlhbCxcbiAgICAgICksXG4gICAgXSxcbiAgICBsYWJlbDogYENvbXBvbmVudCDOlEMsIHdoZXJlIGluaXRpYWwgzpRDID0gJHtcbiAgICAgIHN0cmluZ0lucHV0RGVsdGFDaW5pdGlhbFxuICAgIH1gLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KGxpcXVpZGF0aW9uRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXG4gICAgICB4MjogZCA9PiBkLmFpICsgMC4wNSxcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXG4gICAgICBmaWxsOiBnZXRMaXFEZWx0YUNpLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldExpcURlbHRhQ2koZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcbiAgICAgICAgICBbXG4gICAgICAgICAgICAtMSxcbiAgICAgICAgICAgIGNvbXB1dGVEZWx0YUNpKFxuICAgICAgICAgICAgICAxLFxuICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICBjb21wdXRlRGVsdGFBKDEsIDAsIGlucHV0RGVsdGFDaW5pdGlhbCkgLyBpbnB1dERlbHRhQ2luaXRpYWwsXG4gICAgICAgICAgICApLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVHcmV5cyxcbiAgICAgICAgKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlQmV0YSh2ZWNBaSwgdmVjR2kpIHtcbiAgY29uc3QgYmV0YTIgPSB2ZWNBaS5yZWR1Y2UoXG4gICAgKGFjYywgQWksIGkpID0+IGFjYyArIEFpIC0gQWkgKiAoMSAtIHZlY0dpW2ldKSoqMixcbiAgICAwLFxuICApO1xuICByZXR1cm4gTWF0aC5zcXJ0KGJldGEyKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlQmV0YWkoQWksIEdpKSB7XG4gIHJldHVybiBNYXRoLnNxcnQoQWkgLSBBaSAqICgxIC0gR2kpKioyKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJiZXRhRGF0YSA9IHtcbiAgY29uc3QgYmV0YURhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xuICAgIGJldGFEYXRhLnB1c2goe1xuICAgICAga2V5OiBcIs6y4bWiXCIsXG4gICAgICBhaTogMCxcbiAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgdmFsdWU6IE5hTixcbiAgICB9KTtcbiAgICBmb3IgKGxldCBwYXJhbUFpID0gMC4xOyBwYXJhbUFpIDwgMS4wMTsgcGFyYW1BaSArPSAwLjEpIHtcbiAgICAgIGJldGFEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwizrLhtaJcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZUJldGFpKHBhcmFtQWksIHBhcmFtR2kpLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBiZXRhRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IFwizrLhtaJcIixcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdChiZXRhRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXG4gICAgICB4MjogZCA9PiBkLmFpICsgMC4wNSxcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXG4gICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KGJldGFEYXRhLCB7XG4gICAgICB4OiBcImFpXCIsXG4gICAgICB5OiBcImdpXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKGQzLmludGVycG9sYXRlU3BlY3RyYWwoZC52YWx1ZSkpLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYXJyYXlBaSA9IFswLjUsIDAuMiwgMC4xLCAwLjA1XTtcbmFycmF5SW5pdGlhbEdpID0gWzAuMywgMC4xLCAwLjA1LCAwLjAxXTtcbmFycmF5TmV3R2kgPSBhcnJheUluaXRpYWxHaS50b1JldmVyc2VkKCk7XG5iZXRhQ29udHJpYkRhdGEgPSB7XG4gIGNvbnN0IGJldGFDb250cmliRGF0YSA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5QWkubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBBaSA9IGFycmF5QWlbaV07XG4gICAgY29uc3QgaW5pdGlhbEdpID0gYXJyYXlJbml0aWFsR2lbaV07XG4gICAgY29uc3QgaW5pdGlhbEJldGEyID0gY29tcHV0ZUJldGFpKEFpLCBpbml0aWFsR2kpKioyO1xuICAgIGNvbnN0IG5ld0dpID0gYXJyYXlOZXdHaVtpXTtcbiAgICBjb25zdCBuZXdCZXRhMiA9IGNvbXB1dGVCZXRhaShBaSwgbmV3R2kpKioyO1xuICAgIGJldGFDb250cmliRGF0YS5wdXNoKHsga2V5OiBcIkluaXRpYWwgR+G1olwiLCBjbGFzczogaSwgdmFsdWU6IGluaXRpYWxHaSB9KTtcbiAgICBiZXRhQ29udHJpYkRhdGEucHVzaCh7IGtleTogXCJJbml0aWFsIM6y4bWiwrJcIiwgY2xhc3M6IGksIHZhbHVlOiBpbml0aWFsQmV0YTIgfSk7XG4gICAgYmV0YUNvbnRyaWJEYXRhLnB1c2goeyBrZXk6IFwiTmV3IEfhtaJcIiwgY2xhc3M6IGksIHZhbHVlOiBuZXdHaSB9KTtcbiAgICBiZXRhQ29udHJpYkRhdGEucHVzaCh7IGtleTogXCJOZXcgzrLhtaLCslwiLCBjbGFzczogaSwgdmFsdWU6IG5ld0JldGEyIH0pO1xuICB9XG4gIHJldHVybiBiZXRhQ29udHJpYkRhdGE7XG59O1xuZ2V0SW5pdGlhbEcgPSBkID0+IGQua2V5ID09PSBcIkluaXRpYWwgR+G1olwiID8gZC52YWx1ZSA6IE5hTjtcbmdldEluaXRpYWxCZXRhMiA9IGQgPT4gZC5rZXkgPT09IFwiSW5pdGlhbCDOsuG1osKyXCIgPyBkLnZhbHVlIDogTmFOO1xuZ2V0TmV3RyA9IGQgPT4gZC5rZXkgPT09IFwiTmV3IEfhtaJcIiA/IGQudmFsdWUgOiBOYU47XG5nZXROZXdCZXRhMiA9IGQgPT4gZC5rZXkgPT09IFwiTmV3IM6y4bWiwrJcIiA/IGQudmFsdWUgOiBOYU47XG5cbmRvbWFpbkcgPSBbMCwgTWF0aC5tYXgoZDMubWF4KGFycmF5SW5pdGlhbEdpKSwgZDMubWF4KGFycmF5TmV3R2kpKV07XG5yYW5nZUJldGEyID0gW1xuICAwLFxuICBNYXRoLm1heChcbiAgICBkMy5tYXgoYmV0YUNvbnRyaWJEYXRhLCBnZXRJbml0aWFsQmV0YTIpLFxuICAgIGQzLm1heChiZXRhQ29udHJpYkRhdGEsIGdldE5ld0JldGEyKSxcbiAgKSxcbl07XG5zY2FsZUcgPSBkMy5zY2FsZUxpbmVhcihkb21haW5HLCByYW5nZUJldGEyKTtcbm1hcFNjYWxlRyA9IHggPT4geC5tYXAoc2NhbGVHKTtcblxucGFyYW1Jbml0aWFsQmV0YSA9IGNvbXB1dGVCZXRhKGFycmF5QWksIGFycmF5SW5pdGlhbEdpKTtcbnBhcmFtTmV3QmV0YSA9IGNvbXB1dGVCZXRhKGFycmF5QWksIGFycmF5TmV3R2kpO1xuXG5zdHJpbmdJbml0aWFsQmV0YSA9IFwiSW5pdGlhbCDOsiA9IFwiICsgcGFyYW1Jbml0aWFsQmV0YS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogNCwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiA0IH0sXG4pO1xuc3RyaW5nTmV3QmV0YSA9IFwiTmV3IM6yID0gXCIgKyBwYXJhbU5ld0JldGEudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDQsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogNCB9LFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogW1wiZ3JheVwiLCBcImJsYWNrXCIsIFwiYmx1ZVwiLCBcInJlZFwiXSxcbiAgICBkb21haW46IFtcIkluaXRpYWwgzrLhtaLCslwiLCBcIk5ldyDOsuG1osKyXCIsIFwiSW5pdGlhbCBH4bWiXCIsIFwiTmV3IEfhtaJcIl0sXG4gIH0sXG4gIHg6IHtcbiAgICB0aWNrczogZDMucmFuZ2UoNCksXG4gICAgbGFiZWw6IFwiQeG1oiBPdmVyIDQgQ2xhc3Nlc1wiLFxuICAgIHRpY2tGb3JtYXQ6IGQgPT4gYXJyYXlBaVtkXSxcbiAgfSxcbiAgeTogeyBkb21haW46IHJhbmdlQmV0YTIgfSxcbiAgaW5zZXRUb3A6IDE2LFxuICBpbnNldExlZnQ6IDgsXG4gIGluc2V0UmlnaHQ6IDgsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwibGVmdFwiLCBsYWJlbDogXCLOsuG1osKyXCIgfSksXG4gICAgUGxvdC5heGlzWShzY2FsZUcudGlja3MoKSwgeyBhbmNob3I6IFwicmlnaHRcIiwgbGFiZWw6IFwiR+G1olwiLCB5OiBzY2FsZUcgfSksXG4gICAgUGxvdC5yZWN0WShiZXRhQ29udHJpYkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuY2xhc3MgLSAwLjQ1LFxuICAgICAgeDI6IGQgPT4gZC5jbGFzcyxcbiAgICAgIHk6IGdldEluaXRpYWxCZXRhMixcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgfSksXG4gICAgUGxvdC5yZWN0WShiZXRhQ29udHJpYkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuY2xhc3MsXG4gICAgICB4MjogZCA9PiBkLmNsYXNzICsgMC40NSxcbiAgICAgIHk6IGdldE5ld0JldGEyLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgICBQbG90LmxpbmVZKGJldGFDb250cmliRGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlRywge1xuICAgICAgeDogXCJjbGFzc1wiLFxuICAgICAgeTogZ2V0SW5pdGlhbEcsXG4gICAgICBzdHJva2U6IFwia2V5XCIsXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXG4gICAgfSkpLFxuICAgIFBsb3QuZG90WShiZXRhQ29udHJpYkRhdGEsIFBsb3QubWFwWShtYXBTY2FsZUcsIHtcbiAgICAgIHg6IFwiY2xhc3NcIixcbiAgICAgIHk6IGdldEluaXRpYWxHLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSksXG4gICAgUGxvdC5saW5lWShiZXRhQ29udHJpYkRhdGEsIFBsb3QubWFwWShtYXBTY2FsZUcsIHtcbiAgICAgIHg6IFwiY2xhc3NcIixcbiAgICAgIHk6IGdldE5ld0csXG4gICAgICBzdHJva2U6IFwia2V5XCIsXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXG4gICAgfSkpLFxuICAgIFBsb3QuZG90WShiZXRhQ29udHJpYkRhdGEsIFBsb3QubWFwWShtYXBTY2FsZUcsIHtcbiAgICAgIHg6IFwiY2xhc3NcIixcbiAgICAgIHk6IGdldE5ld0csXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgIH0pKSxcbiAgICBQbG90LnRleHQoW3N0cmluZ0luaXRpYWxCZXRhXSwgeyB4OiAwLjUsIHk6IDAuMjMsIGZpbGw6IGQgPT4gXCJibHVlXCIgfSksXG4gICAgUGxvdC50ZXh0KFtzdHJpbmdOZXdCZXRhXSwgeyB4OiAyLjUsIHk6IDAuMjMsIGZpbGw6IGQgPT4gXCJyZWRcIiB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVMYW1iZGFHRyhBUSwgR2ksIEdHKSB7XG4gIHJldHVybiAoMSAtIEFRKSAvICgxICsgKEdpIC8gR0cpKioyKTtcbn1cblxuZnVuY3Rpb24gY2hhbmdlVHJhbnNsYXRpb24oZHgsIGR5KSB7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgc3ZnVHJhbnNmb3JtTGlzdCA9IHRoaXMudHJhbnNmb3JtLmJhc2VWYWw7XG4gICAgaWYgKHN2Z1RyYW5zZm9ybUxpc3QubGVuZ3RoID4gMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU1ZHVHJhbnNmb3JtTGlzdCBtdXN0IG9ubHkgY29udGFpbiBvbmUgdHJhbnNsYXRpb25cIik7XG4gICAgfVxuICAgIGNvbnN0IHtlLCBmfSA9IHN2Z1RyYW5zZm9ybUxpc3QuY29uc29saWRhdGUoKS5tYXRyaXg7XG4gICAgcmV0dXJuIGB0cmFuc2xhdGUoJHtlICsgZHh9LCR7ZiArIGR5fSlgO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibGFtYmRhR0dEYXRhID0ge1xuICBjb25zdCBsYW1iZGFHR0RhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xuICAgIGZvciAobGV0IHBhcmFtQVEgPSAwOyBwYXJhbUFRIDwgMS4wMTsgcGFyYW1BUSArPSAwLjEpIHtcbiAgICAgIGxhbWJkYUdHRGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIs67XCIsXG4gICAgICAgIGFxOiBwYXJhbUFRLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVMYW1iZGFHRyhwYXJhbUFRLCBwYXJhbUdpLCAxIC0gcGFyYW1HaSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGxhbWJkYUdHRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGxvdExhbWJkYUdHID0ge1xuICBjb25zdCBwbG90TGFtYmRhR0cgPSBQbG90LnBsb3Qoe1xuICAgIGNvbG9yOiB7XG4gICAgICBsZWdlbmQ6IHRydWUsXG4gICAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICAgIGRvbWFpbjogWzAsIDFdLFxuICAgICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgICBsYWJlbDogXCLOu1wiLFxuICAgIH0sXG4gICAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQSAgXCIgfSxcbiAgICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICAgIG1hcmtzOiBbXG4gICAgICBQbG90LmZyYW1lKCksXG4gICAgICBQbG90LnJlY3QobGFtYmRhR0dEYXRhLCB7XG4gICAgICAgIHgxOiBkID0+IGQuYXEgLSAwLjA1LFxuICAgICAgICB4MjogZCA9PiBkLmFxICsgMC4wNSxcbiAgICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgICB9KSxcbiAgICAgIFBsb3QudGV4dChsYW1iZGFHR0RhdGEsIHtcbiAgICAgICAgeDogXCJhcVwiLFxuICAgICAgICB5OiBcImdpXCIsXG4gICAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICAgKSxcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICAgKSxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIGQzLnNlbGVjdChwbG90TGFtYmRhR0cpXG4gICAgLnNlbGVjdChcImdbYXJpYS1sYWJlbD0neC1heGlzIGxhYmVsJ11cIilcbiAgICAuc2VsZWN0KFwidGV4dFwiKVxuICAgICAgLmNsb25lKGZhbHNlKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY2hhbmdlVHJhbnNsYXRpb24oLTEyLCAxLjUpKVxuICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIwLjZlbVwiKVxuICAgICAgLmF0dHIoXCJmb250LXdlaWdodFwiLCBcIjYwMFwiKVxuICAgICAgLnRleHQoXCJRXCIpO1xuXG4gIHJldHVybiBwbG90TGFtYmRhR0c7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVMYW1iZGFHKEFRLCBBRykge1xuICByZXR1cm4gMiAqIEFHIC8gKDIgKiBBRyArIEFRICogTWF0aC5zcXJ0KDIpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlTGFtYmRhUShBUSwgQUcpIHtcbiAgcmV0dXJuIDEgLSBjb21wdXRlTGFtYmRhRyhBUSwgQUcpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImxhbWJkYUdRRGF0YSA9IHtcbiAgY29uc3QgbGFtYmRhR1FEYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtQUcgPSAwOyBwYXJhbUFHIDwgMS4wMTsgcGFyYW1BRyArPSAwLjEpIHtcbiAgICBmb3IgKGxldCBwYXJhbUFRID0gMDsgcGFyYW1BUSA8IDEuMDE7IHBhcmFtQVEgKz0gMC4xKSB7XG4gICAgICBpZiAocGFyYW1BRyArIHBhcmFtQVEgPCAxLjAxKSB7XG4gICAgICAgIGxhbWJkYUdRRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwiUmVsYXRpdmUg8J2XlPCdl5ogTGlxdWlkaXR5IFBvb2wgU2hhcmVcIixcbiAgICAgICAgICBhcTogcGFyYW1BUSxcbiAgICAgICAgICBhZzogcGFyYW1BRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUxhbWJkYUcocGFyYW1BUSwgcGFyYW1BRyksXG4gICAgICAgIH0pO1xuICAgICAgICBsYW1iZGFHUURhdGEucHVzaCh7XG4gICAgICAgICAga2V5OiBcIlJlbGF0aXZlIPCdl5TwnZekIExpcXVpZGl0eSBQb29sIFNoYXJlXCIsXG4gICAgICAgICAgYXE6IHBhcmFtQVEsXG4gICAgICAgICAgYWc6IHBhcmFtQUcsXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVMYW1iZGFRKHBhcmFtQVEsIHBhcmFtQUcpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGxhbWJkYUdRRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGxvdExhbWJkYUdRID0ge1xuICBjb25zdCBwbG90TGFtYmRhR1EgPSBQbG90LnBsb3Qoe1xuICAgIGFzcGVjdFJhdGlvOiAxLFxuICAgIGNvbG9yOiB7XG4gICAgICBsZWdlbmQ6IHRydWUsXG4gICAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICAgIGRvbWFpbjogWzAsIDFdLFxuICAgICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgICBsYWJlbDogXCLOu1wiLFxuICAgIH0sXG4gICAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQSAgXCIgfSxcbiAgICB5OiB7XG4gICAgICB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSxcbiAgICAgIGRvbWFpbjogWzEuMDUsIC0wLjA1XSxcbiAgICAgIGxhYmVsOiBcIkFcIixcbiAgICB9LFxuICAgIGZ4OiB7IGxhYmVsOiBudWxsIH0sXG4gICAgY2xhc3NOYW1lOiBcIkxhbWJkYUdRXCIsXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QuZnJhbWUoKSxcbiAgICAgIFBsb3QucmVjdChsYW1iZGFHUURhdGEsIHtcbiAgICAgICAgeDE6IGQgPT4gZC5hcSAtIDAuMDUsXG4gICAgICAgIHgyOiBkID0+IGQuYXEgKyAwLjA1LFxuICAgICAgICB5MTogZCA9PiBkLmFnIC0gMC4wNSxcbiAgICAgICAgeTI6IGQgPT4gZC5hZyArIDAuMDUsXG4gICAgICAgIGZ4OiBcImtleVwiLFxuICAgICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgICB9KSxcbiAgICAgIFBsb3QudGV4dChsYW1iZGFHUURhdGEsIHtcbiAgICAgICAgeDogXCJhcVwiLFxuICAgICAgICB5OiBcImFnXCIsXG4gICAgICAgIGZ4OiBcImtleVwiLFxuICAgICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICAgICksXG4gICAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFswLCAxXSwgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCkoZC52YWx1ZSksXG4gICAgICAgICksXG4gICAgICB9KSxcbiAgICBdLFxuICB9KTtcblxuICBkMy5zZWxlY3QocGxvdExhbWJkYUdRKVxuICAgIC5zZWxlY3QoXCJnW2FyaWEtbGFiZWw9J3gtYXhpcyBsYWJlbCddXCIpXG4gICAgLnNlbGVjdChcInRleHRcIilcbiAgICAuY2xvbmUoZmFsc2UpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigtMTIsIDEuNSkpXG4gICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjAuNmVtXCIpXG4gICAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiNjAwXCIpXG4gICAgICAudGV4dChcIlFcIik7XG5cbiAgZDMuc2VsZWN0KHBsb3RMYW1iZGFHUSlcbiAgICAuc2VsZWN0KFwiZ1thcmlhLWxhYmVsPSd5LWF4aXMgbGFiZWwnXVwiKVxuICAgIC5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigwLCAxMCkpXG4gICAgLmNsb25lKGZhbHNlKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY2hhbmdlVHJhbnNsYXRpb24oMTQsIDQuMSkpXG4gICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjAuNmVtXCIpXG4gICAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiNjAwXCIpXG4gICAgICAudGV4dChcIkdcIik7XG5cbiAgcmV0dXJuIHBsb3RMYW1iZGFHUTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gcGllY2V3aXNlTG9nVHJhbnNmb3JtKHhUcmFuID0gMSkge1xuICByZXR1cm4geCA9PiB4ID4geFRyYW4gPyBNYXRoLmxvZyh4KSA6IHggLSB4VHJhbiArIE1hdGgubG9nKHhUcmFuKTtcbn1cblxuZnVuY3Rpb24gcGllY2V3aXNlTG9nSW52ZXJ0KHhUcmFuID0gMSkge1xuICByZXR1cm4geSA9PiB5ID4gTWF0aC5sb2coeFRyYW4pID8gTWF0aC5leHAoeSkgOiB5IC0gTWF0aC5sb2cxMCh4VHJhbikgKyB4VHJhbjtcbn1cblxuZnVuY3Rpb24gc2V0SW5wdXQoaW5wdXQsIHZhbHVlKSB7XG4gIGlucHV0LnZhbHVlID0gdmFsdWU7XG4gIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pKTtcbn1cblxuZnVuY3Rpb24gbnVtRGlnaXRzKHgpIHtcbiAgcmV0dXJuIHggPT09IDAgPyAxIDogKDEgKyBNYXRoLmZsb29yKE1hdGgubG9nMTAoeCkpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkZWZhdWx0QVZhbHVlID0gMmU2O1xuZGVmYXVsdEFTdXBwbHkgPSAyZTc7XG5kZWZhdWx0UHJlc2VudFRvbm5lcyA9IDFlNztcbmRlZmF1bHREZWx0YVRvbm5lcyA9IDFlMjtcbmRlZmF1bHRBaSA9IDAuNTtcbmRlZmF1bHRHaSA9IDAuNTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJJbnB1dHMuYnV0dG9uKFxuICBbW1wiUmVzZXRcIiwgKCkgPT4ge1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dEFWYWx1ZSwgZGVmYXVsdEFWYWx1ZSk7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QVN1cHBseSwgZGVmYXVsdEFTdXBwbHkpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dFByZXNlbnRUb25uZXMsIGRlZmF1bHRQcmVzZW50VG9ubmVzKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXREZWx0YVRvbm5lcywgZGVmYXVsdERlbHRhVG9ubmVzKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBaSwgZGVmYXVsdEFpKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRHaSwgZGVmYXVsdEdpKTtcbiAgfV1dLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXRBVmFsdWUgPSBJbnB1dHMucmFuZ2UoWzFlNSwgMWU5XSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtNYXJrZXQgY2FwLiBvZiBcXHRleHRiZntBfX1gLFxuICBzdGVwOiAxLFxuICB2YWx1ZTogZGVmYXVsdEFWYWx1ZSxcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcbn0pO1xudmlld29mIGlucHV0QVN1cHBseSA9IElucHV0cy5yYW5nZShbMWU2LCAxZTEwXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtTdXBwbHkgb2YgXFx0ZXh0YmZ7QX19YCxcbiAgc3RlcDogMSxcbiAgdmFsdWU6IGRlZmF1bHRBU3VwcGx5LFxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxufSk7XG52aWV3b2YgaW5wdXRQcmVzZW50VG9ubmVzID0gSW5wdXRzLnJhbmdlKFswLCAxZTldLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1BvcnRmb2xpbyB9IFxcYmFyIENfaWAsXG4gIHN0ZXA6IDFlLTMsXG4gIHZhbHVlOiBkZWZhdWx0UHJlc2VudFRvbm5lcyxcbiAgdHJhbnNmb3JtOiBwaWVjZXdpc2VMb2dUcmFuc2Zvcm0oMWUtMyksXG4gIGludmVydDogcGllY2V3aXNlTG9nSW52ZXJ0KDFlLTMpLFxufSk7XG52aWV3b2YgaW5wdXREZWx0YVRvbm5lcyA9IElucHV0cy5yYW5nZShbMWUtMywgMWU3XSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtQdXJjaGFzZWQgdG9ubmVzfWAsXG4gIHN0ZXA6IDFlLTMsXG4gIHZhbHVlOiBkZWZhdWx0RGVsdGFUb25uZXMsXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbnZpZXdvZiBpbnB1dEFpID0gSW5wdXRzLnJhbmdlKFswLCAxXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtBbGxvY2F0aW9uIH0gQV9pYCxcbiAgc3RlcDogMWUtNixcbiAgdmFsdWU6IGRlZmF1bHRBaSxcbiAgdHJhbnNmb3JtOiBwaWVjZXdpc2VMb2dUcmFuc2Zvcm0oMWUtNiksXG4gIGludmVydDogcGllY2V3aXNlTG9nSW52ZXJ0KDFlLTYpLFxufSk7XG52aWV3b2YgaW5wdXRHaSA9IElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7QWxsb2NhdGlvbiB9IEdfaWAsXG4gIHN0ZXA6IDFlLTYsXG4gIHZhbHVlOiBkZWZhdWx0R2ksXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwYXJhbURlbHRhQSA9IGNvbXB1dGVUcnVlRGVsdGFBKFxuICBpbnB1dEFpLFxuICBpbnB1dEdpLFxuICBpbnB1dFByZXNlbnRUb25uZXMsXG4gIGlucHV0RGVsdGFUb25uZXMsXG4pO1xucGFyYW1EZWx0YVRvbm5lcyA9IHBhcmFtRGVsdGFBID09PSAwID8gMCA6IGlucHV0RGVsdGFUb25uZXM7XG5wYXJhbUFFbWl0dGVkID0gcGFyYW1EZWx0YUEgKiBpbnB1dEFTdXBwbHk7XG5wYXJhbUFQcmljZSA9IGlucHV0QVZhbHVlIC8gaW5wdXRBU3VwcGx5O1xucGFyYW1CYXJDaVByaWNlID0gaW5wdXRBVmFsdWUgKiBwYXJhbURlbHRhQSAvIGlucHV0RGVsdGFUb25uZXM7XG5cbnN0cmluZ0FTdXBwbHkgPSBpbnB1dEFTdXBwbHkudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMiAtIG51bURpZ2l0cyhwYXJhbUFFbWl0dGVkKSksXG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAyIC0gbnVtRGlnaXRzKHBhcmFtQUVtaXR0ZWQpKSxcbiAgfSxcbikgKyBcIiBrVkNNXCI7XG5zdHJpbmdQcmVzZW50VG9ubmVzID0gaW5wdXRQcmVzZW50VG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDMgLSBudW1EaWdpdHMocGFyYW1EZWx0YVRvbm5lcykpLFxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMyAtIG51bURpZ2l0cyhwYXJhbURlbHRhVG9ubmVzKSksXG4gIH0sXG4pICsgXCIgdENPMmVxXCI7XG5zdHJpbmdBRW1pdHRlZCA9IFwiK1wiICsgcGFyYW1BRW1pdHRlZC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCBudW1EaWdpdHMocGFyYW1BRW1pdHRlZCkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtQUVtaXR0ZWQpKSxcbiAgfSxcbikgKyBcIiBrVkNNXCI7XG5zdHJpbmdEZWx0YVRvbm5lcyA9IFwiK1wiICsgcGFyYW1EZWx0YVRvbm5lcy50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgzLCBudW1EaWdpdHMocGFyYW1EZWx0YVRvbm5lcykpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMywgbnVtRGlnaXRzKHBhcmFtRGVsdGFUb25uZXMpKSxcbiAgfSxcbikgKyBcIiB0Q08yZXFcIjtcbnN0cmluZ0FQcmljZSA9IFwiJFwiICsgcGFyYW1BUHJpY2UudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgMiArIG51bURpZ2l0cyhwYXJhbUFQcmljZSkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgMiArIG51bURpZ2l0cyhwYXJhbUFQcmljZSkpLFxuICB9LFxuKTtcbnN0cmluZ0JhckNpUHJpY2UgPSBcIiRcIiArIHBhcmFtQmFyQ2lQcmljZS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQmFyQ2lQcmljZSkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgMiArIG51bURpZ2l0cyhwYXJhbUJhckNpUHJpY2UpKSxcbiAgfSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGVmYXVsdExpcXVpZFRvbm5lcyA9IDFlNztcbmRlZmF1bHRBQnVybnQgPSAxZTI7XG5kZWZhdWx0R251bGwgPSAwLjU7XG5kZWZhdWx0QSA9IDAuNTtcbmRlZmF1bHRTID0gMC41O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IklucHV0cy5idXR0b24oXG4gIFtbXCJSZXNldFwiLCAoKSA9PiB7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QVZhbHVlXywgZGVmYXVsdEFWYWx1ZSk7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QVN1cHBseV8sIGRlZmF1bHRBU3VwcGx5KTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRMaXF1aWRUb25uZXMsIGRlZmF1bHRMaXF1aWRUb25uZXMpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dEFCdXJudCwgZGVmYXVsdEFCdXJudCk7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QWksIGRlZmF1bHRBaSk7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0R2ksIGRlZmF1bHRHaSk7XG4gIH1dXSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0QVZhbHVlXyA9IElucHV0cy5yYW5nZShbMWU1LCAxZTldLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e01hcmtldCBjYXAuIG9mIFxcdGV4dGJme0F9fWAsXG4gIHN0ZXA6IDEsXG4gIHZhbHVlOiBkZWZhdWx0QVZhbHVlLFxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxufSk7XG52aWV3b2YgaW5wdXRBU3VwcGx5XyA9IElucHV0cy5yYW5nZShbMWU2LCAxZTEwXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtTdXBwbHkgb2YgXFx0ZXh0YmZ7QX19YCxcbiAgc3RlcDogMSxcbiAgdmFsdWU6IGRlZmF1bHRBU3VwcGx5LFxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxufSk7XG52aWV3b2YgaW5wdXRMaXF1aWRUb25uZXMgPSBJbnB1dHMucmFuZ2UoWzFlLTMsIDFlOV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UG9ydGZvbGlvIH0gQ197aTB9YCxcbiAgc3RlcDogMWUtMyxcbiAgdmFsdWU6IGRlZmF1bHRMaXF1aWRUb25uZXMsXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbnZpZXdvZiBpbnB1dEFCdXJudCA9IElucHV0cy5yYW5nZShbMWUtMSwgMWU2XSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtcXHRleHRiZntBfSB0b2tlbnMgYnVybnR9YCxcbiAgc3RlcDogMWUtMSxcbiAgdmFsdWU6IGRlZmF1bHRBQnVybnQsXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbklucHV0cy5iaW5kKFxuICBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XG4gICAgbGFiZWw6IHRleGBcXHRleHR7QWxsb2NhdGlvbiB9IEFfaWAsXG4gICAgc3RlcDogMWUtNixcbiAgICB2YWx1ZTogZGVmYXVsdEFpLFxuICAgIHRyYW5zZm9ybTogcGllY2V3aXNlTG9nVHJhbnNmb3JtKDFlLTYpLFxuICAgIGludmVydDogcGllY2V3aXNlTG9nSW52ZXJ0KDFlLTYpLFxuICB9KSxcbiAgdmlld29mIGlucHV0QWksXG4pO1xuSW5wdXRzLmJpbmQoXG4gIElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgICBsYWJlbDogdGV4YFxcdGV4dHtBbGxvY2F0aW9uIH0gR19pYCxcbiAgICBzdGVwOiAxZS02LFxuICAgIHZhbHVlOiBkZWZhdWx0R2ksXG4gIH0pLFxuICB2aWV3b2YgaW5wdXRHaSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1BQnVybnQgPSBpbnB1dEFpID09PSAwID8gMCA6IGlucHV0QUJ1cm50XG5wYXJhbURlbHRhQV8gPSBwYXJhbUFCdXJudCAvIGlucHV0QVN1cHBseV87XG5wYXJhbURlbHRhQ2kgPSBpbnB1dEFpID09PSAwID8gLTAgOiBjb21wdXRlRGVsdGFDaShcbiAgaW5wdXRBaSxcbiAgaW5wdXRHaSxcbiAgcGFyYW1EZWx0YUFfLFxuKTtcbnBhcmFtRGVsdGFDaVRvbm5lcyA9IC1wYXJhbURlbHRhQ2kgKiBpbnB1dExpcXVpZFRvbm5lcztcbnBhcmFtQVByaWNlXyA9IGlucHV0QVZhbHVlXyAvIGlucHV0QVN1cHBseV87XG5wYXJhbUNpUHJpY2UgPSBpbnB1dEFpID09PSAwID8gMCA6IGlucHV0QVZhbHVlXyAqIHBhcmFtRGVsdGFBXyAvIHBhcmFtRGVsdGFDaVRvbm5lcztcblxuc3RyaW5nQVN1cHBseV8gPSBpbnB1dEFTdXBwbHlfLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1BQnVybnQpKSxcbiAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1BQnVybnQpKSxcbiAgfSxcbikgKyBcIiBrVkNNXCI7XG5zdHJpbmdMaXF1aWRUb25uZXMgPSBpbnB1dExpcXVpZFRvbm5lcy50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAyIC0gbnVtRGlnaXRzKHBhcmFtRGVsdGFDaVRvbm5lcykpLFxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMiAtIG51bURpZ2l0cyhwYXJhbURlbHRhQ2lUb25uZXMpKSxcbiAgfSxcbikgKyBcIiB0Q08yZXFcIjtcbnN0cmluZ0FCdXJudCA9IFwi4oiSXCIgKyBwYXJhbUFCdXJudC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCBudW1EaWdpdHMocGFyYW1BQnVybnQpKSxcbiAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxuICB9LFxuKSArIFwiIGtWQ01cIjtcbnN0cmluZ0RlbHRhQ2lUb25uZXMgPSBcIuKIklwiICsgcGFyYW1EZWx0YUNpVG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbURlbHRhQ2lUb25uZXMpKSxcbiAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbURlbHRhQ2lUb25uZXMpKSxcbiAgfSxcbikgKyBcIiB0Q08yZXFcIjtcbnN0cmluZ0FQcmljZV8gPSBcIiRcIiArIHBhcmFtQVByaWNlXy50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQVByaWNlXykpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgMiArIG51bURpZ2l0cyhwYXJhbUFQcmljZV8pKSxcbiAgfSxcbik7XG5zdHJpbmdDaVByaWNlID0gXCIkXCIgKyBwYXJhbUNpUHJpY2UudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgMiArIG51bURpZ2l0cyhwYXJhbUNpUHJpY2UpKSxcbiAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1DaVByaWNlKSksXG4gIH0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFsbG9jSW5pdEdEYXRhID0ge1xuICBjb25zdCBhbGxvY0luaXRHRGF0YSA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMC4wMTsgaSArPSAwLjI1KSB7XG4gICAgaWYgKGkgPCAyLjUxKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIjAxWFwiLCB2YWx1ZTogaSB9KTtcbiAgICB9XG4gICAgaWYgKDIuNDkgPCBpICYmIGkgPCA1LjUxKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcInBLbGltYSBIb2xkZXJzXCIsIHZhbHVlOiBpIH0pO1xuICAgIH1cbiAgICBpZiAoNS40OSA8IGkgJiYgaSA8IDEwLjAxKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIkRBTy9UcmVhc3VyeVwiLCB2YWx1ZTogaSB9KTtcbiAgICB9XG4gICAgaWYgKDkuOTkgPCBpICYmIGkgPCAxNS4wMSkge1xuICAgICAgYWxsb2NJbml0R0RhdGEucHVzaCh7IGtleTogXCJFY29zeXN0ZW0gR3JhbnRcIiwgdmFsdWU6IGkgfSk7XG4gICAgfVxuICAgIGlmICgxNC45OSA8IGkgJiYgaSA8IDIwLjAxKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIlByb2R1Y3QgRGVzaWduXCIsIHZhbHVlOiBpIH0pO1xuICAgIH1cbiAgICBpZiAoMTkuOTkgPCBpICYmIGkgPCA2MC4wMSkge1xuICAgICAgYWxsb2NJbml0R0RhdGEucHVzaCh7IGtleTogXCJLbGltYSBIb2xkZXJzXCIsIHZhbHVlOiBpIH0pO1xuICAgIH1cbiAgICBpZiAoNTkuOTkgPCBpKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIkluY2VudGl2ZXNcIiwgdmFsdWU6IGkgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhbGxvY0luaXRHRGF0YTtcbn07XG5sb25naXR1ZGVTY2FsZSA9IGQzLnNjYWxlTGluZWFyKFsxODAsIC0xODBdKTtcbmdldENlbnRlciA9IGQgPT5cbiAgICAgICAgWzEuMjUsIDQsIDcuNzUsIDEyLjUsIDE3LjUsIDQwLCA4MF0uaW5jbHVkZXMoZC52YWx1ZSkgPyBkLnZhbHVlIDogTmFOO1xuXG5jb2hvcnRzRG9tYWluID0gW1xuICBcIkluY2VudGl2ZXNcIixcbiAgXCJLbGltYSBIb2xkZXJzXCIsXG4gIFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgXCJFY29zeXN0ZW0gR3JhbnRcIixcbiAgXCJEQU8vVHJlYXN1cnlcIixcbiAgXCJwS2xpbWEgSG9sZGVyc1wiLFxuICBcIjAxWFwiLFxuXTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBwcm9qZWN0aW9uOiB7IHR5cGU6IFwiYXppbXV0aGFsLWVxdWlkaXN0YW50XCIsIHJvdGF0ZTogWzAsIC05MF0sIHNjYWxlOiAyIH0sXG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuYXJlYShhbGxvY0luaXRHRGF0YSwge1xuICAgICAgeDE6ICh7IHZhbHVlIH0pID0+IGxvbmdpdHVkZVNjYWxlKHZhbHVlIC8gMTAwKSxcbiAgICAgIHkxOiAtMjAsXG4gICAgICB4MjogKHsgdmFsdWUgfSkgPT4gbG9uZ2l0dWRlU2NhbGUodmFsdWUgLyAxMDApLFxuICAgICAgeTI6IC03MCxcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgfSksXG4gIF1cbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dFAwID0gSW5wdXRzLnJhbmdlKFswLjAxLCAwLjVdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0luaXRpYWwgaXNzdWFuY2UgfSBQXzBgLFxuICBzdGVwOiAwLjAxLFxuICB2YWx1ZTogMC4wNyxcbn0pO1xudmlld29mIGlucHV0VCA9IElucHV0cy5yYW5nZShbMiwgNjBdLCB7XG4gIGxhYmVsOiB0ZXhgVCBcXHRleHR7IChtb250aHMpfWAsXG4gIHN0ZXA6IDEsXG4gIHZhbHVlOiAyNCxcbn0pO1xuXG5zdHJpbmdJbnB1dFAwID0gaW5wdXRQMC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwIH0sXG4pO1xuc3RyaW5nSW5wdXRUID0gaW5wdXRULnRvTG9jYWxlU3RyaW5nKFwiZW4tR0JcIiwgeyBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVAodCwgUDAsIFQpIHtcbiAgY29uc3QgeDAgPSBNYXRoLmxvZyhQMCAvICgxIC0gUDApKTtcbiAgY29uc3QgeHQgPSB4MCAqICgxIC0gdCAvIFQpO1xuICBjb25zdCBleHAgPSBNYXRoLmV4cCh4dCk7XG4gIHJldHVybiBleHAgLyAoZXhwICsgMSk7XG59XG5cbmZ1bmN0aW9uIGNvbXB1dGVEZXJpdlAodCwgUDAsIFQpIHtcbiAgY29uc3QgeDAgPSBNYXRoLmxvZyhQMCAvICgxIC0gUDApKTtcbiAgY29uc3QgeHQgPSB4MCAqICgxIC0gdCAvIFQpO1xuICBjb25zdCBleHAgPSBNYXRoLmV4cCh4dCk7XG4gIGNvbnN0IFAgPSBleHAgLyAoMSArIGV4cCk7XG4gIHJldHVybiAtKHgwIC8gVCkgKiBQICogKDEgLSBQKTtcbn1cblxuZnVuY3Rpb24gZ2V0VmVzdGluZyh2ZWNWZXN0aW5nLCB0LCB0U3RhcnQsIHRFbmQpIHtcbiAgaWYgKHQgPCB0U3RhcnQpXG4gICAgcmV0dXJuIDA7XG4gIGVsc2UgaWYgKHQgPCB0RW5kKSB7XG4gICAgcmV0dXJuIHZlY1Zlc3RpbmdbdCAtIHRTdGFydF07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHZlY1Zlc3RpbmdbdEVuZCAtIHRTdGFydCAtIDFdO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidFZlc3RTdGFydCA9IDM7XG50VmVzdEVuZCA9IDIgKiBpbnB1dFQ7XG50VmVzdGluZyA9IGQzLnJhbmdlKHRWZXN0U3RhcnQsIHRWZXN0RW5kKTtcbnZlY1Zlc3RpbmdEZXJpdiA9IG5vcm1hbGl6ZSh0VmVzdGluZy5tYXAodCA9PlxuICBjb21wdXRlRGVyaXZQKHQsIGlucHV0UDAsIGlucHV0VClcbikpO1xudmVjVmVzdGluZyA9IGQzLmN1bXN1bSh2ZWNWZXN0aW5nRGVyaXYpO1xuXG5zdXBwbHlEYXRhQWxsID0ge1xuICBsZXQgcGFyYW1WZXN0aW5nUHJldmlvdXMgPSAwO1xuICBjb25zdCB2ZWNTdXBwbHlJbmNlbnRpdmVzID0gW107XG4gIGNvbnN0IHZlY1N1cHBseUNpcmN1bGF0aW5nID0gW107XG4gIGNvbnN0IHN1cHBseURhdGEgPSBbXTtcbiAgZm9yIChsZXQgdCA9IDA7IHQgPD0gNzI7IHQrKykge1xuICAgIGNvbnN0IHBhcmFtUCA9IGNvbXB1dGVQKHQsIGlucHV0UDAsIGlucHV0VCk7XG4gICAgY29uc3QgcGFyYW1EZXJpdlAgPSBjb21wdXRlRGVyaXZQKHQsIGlucHV0UDAsIGlucHV0VCk7XG4gICAgY29uc3QgcGFyYW1WZXN0aW5nID0gZ2V0VmVzdGluZyh2ZWNWZXN0aW5nLCB0LCB0VmVzdFN0YXJ0LCB0VmVzdEVuZCk7XG4gICAgY29uc3QgcGFyYW1WZXN0aW5nRGlmZiA9IHBhcmFtVmVzdGluZyAtIHBhcmFtVmVzdGluZ1ByZXZpb3VzO1xuICAgIHBhcmFtVmVzdGluZ1ByZXZpb3VzID0gcGFyYW1WZXN0aW5nO1xuXG4gICAgY29uc3Qgc3VwcGx5MDFYID0gMi41O1xuICAgIGNvbnN0IHN1cHBseVBLbGltYSA9IDMgKiBwYXJhbVZlc3Rpbmc7XG4gICAgY29uc3Qgc3VwcGx5VHJlYXN1cnkgPSA0LjU7XG4gICAgY29uc3Qgc3VwcGx5R3JhbnQgPSA1ICogcGFyYW1WZXN0aW5nO1xuICAgIGNvbnN0IHN1cHBseVByb2R1Y3QgPSA1ICogcGFyYW1WZXN0aW5nO1xuICAgIGNvbnN0IHN1cHBseUtsaW1hID0gNDAgKiBwYXJhbVZlc3Rpbmc7XG4gICAgY29uc3Qgc3VwcGx5SW5jZW50aXZlcyA9IDQwICogcGFyYW1QO1xuICAgIHZlY1N1cHBseUluY2VudGl2ZXMucHVzaChzdXBwbHlJbmNlbnRpdmVzKTtcblxuICAgIGNvbnN0IHN1cHBseTAxWFN0YWNrZWQgPSBzdXBwbHkwMVg7XG4gICAgY29uc3Qgc3VwcGx5UEtsaW1hU3RhY2tlZCA9IHN1cHBseVBLbGltYSArIHN1cHBseTAxWFN0YWNrZWQ7XG4gICAgY29uc3Qgc3VwcGx5VHJlYXN1cnlTdGFja2VkID0gc3VwcGx5VHJlYXN1cnkgKyBzdXBwbHlQS2xpbWFTdGFja2VkO1xuICAgIGNvbnN0IHN1cHBseUdyYW50U3RhY2tlZCA9IHN1cHBseUdyYW50ICsgc3VwcGx5VHJlYXN1cnlTdGFja2VkO1xuICAgIGNvbnN0IHN1cHBseVByb2R1Y3RTdGFja2VkID0gc3VwcGx5UHJvZHVjdCArIHN1cHBseUdyYW50U3RhY2tlZDtcbiAgICBjb25zdCBzdXBwbHlLbGltYVN0YWNrZWQgPSBzdXBwbHlLbGltYSArIHN1cHBseVByb2R1Y3RTdGFja2VkO1xuICAgIGNvbnN0IHN1cHBseUluY2VudGl2ZXNTdGFja2VkID0gc3VwcGx5SW5jZW50aXZlcyArIHN1cHBseUtsaW1hU3RhY2tlZDtcbiAgICBjb25zdCBzdXBwbHlDaXJjdWxhdGluZyA9IHN1cHBseUluY2VudGl2ZXNTdGFja2VkIC8gMTAwO1xuICAgIHZlY1N1cHBseUNpcmN1bGF0aW5nLnB1c2goc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQpO1xuXG4gICAgaWYgKHQgPD0gNjApIHtcbiAgICAgIGNvbnN0IGRpZmZJbmNlbnRpdmVzID0gNDAgKiAodCA9PT0gMCA/IGlucHV0UDAgOiBwYXJhbURlcml2UCk7XG4gICAgICBjb25zdCBkaWZmS2xpbWEgPSA0MCAqIHBhcmFtVmVzdGluZ0RpZmY7XG4gICAgICBjb25zdCBkaWZmUHJvZHVjdCA9IDUgKiBwYXJhbVZlc3RpbmdEaWZmO1xuICAgICAgY29uc3QgZGlmZkdyYW50ID0gNSAqIHBhcmFtVmVzdGluZ0RpZmY7XG4gICAgICBjb25zdCBkaWZmUEtsaW1hID0gMyAqIHBhcmFtVmVzdGluZ0RpZmY7XG4gICAgICBjb25zdCBkaWZmVHJlYXN1cnkgPSB0ID09PSAwID8gNC41OiAwO1xuICAgICAgY29uc3QgZGlmZjAxWCA9IHQgPT09IDAgPyAyLjUgOiAwO1xuXG4gICAgICBjb25zdCBkaWZmSW5jZW50aXZlc1N0YWNrZWQgPSBkaWZmSW5jZW50aXZlcztcbiAgICAgIGNvbnN0IGRpZmZLbGltYVN0YWNrZWQgPSBkaWZmS2xpbWEgKyBkaWZmSW5jZW50aXZlc1N0YWNrZWQ7XG4gICAgICBjb25zdCBkaWZmUHJvZHVjdFN0YWNrZWQgPSBkaWZmUHJvZHVjdCArIGRpZmZLbGltYVN0YWNrZWQ7XG4gICAgICBjb25zdCBkaWZmR3JhbnRTdGFja2VkID0gZGlmZkdyYW50ICsgZGlmZlByb2R1Y3RTdGFja2VkO1xuICAgICAgY29uc3QgZGlmZlBLbGltYVN0YWNrZWQgPSBkaWZmUEtsaW1hICsgZGlmZkdyYW50U3RhY2tlZDtcbiAgICAgIGNvbnN0IGRpZmZUcmVhc3VyeVN0YWNrZWQgPSBkaWZmVHJlYXN1cnkgKyBkaWZmUEtsaW1hU3RhY2tlZDtcbiAgICAgIGNvbnN0IGRpZmYwMVhTdGFja2VkID0gZGlmZjAxWCArIGRpZmZUcmVhc3VyeVN0YWNrZWQ7XG5cbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJQcm9wb3J0aW9uIG9mIFN1cHBseVwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiAxMDAgKiBwYXJhbVAsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJSYXRlIG9mIENoYW5nZVwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiAxMDAgKiBwYXJhbURlcml2UCxcbiAgICAgIH0pO1xuXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiMDFYXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseTAxWFN0YWNrZWQgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcInBLbGltYSBIb2xkZXJzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVBLbGltYVN0YWNrZWQgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkRBTy9UcmVhc3VyeVwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlUcmVhc3VyeVN0YWNrZWQgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlHcmFudFN0YWNrZWQgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIlByb2R1Y3QgRGVzaWduXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVByb2R1Y3RTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJLbGltYSBIb2xkZXJzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUtsaW1hU3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlJbmNlbnRpdmVzU3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG5cbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIjAxWFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHkwMVggLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwicEtsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkRBTy9UcmVhc3VyeVwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlUcmVhc3VyeSAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJFY29zeXN0ZW0gR3JhbnRcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5R3JhbnQgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJLbGltYSBIb2xkZXJzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUtsaW1hIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkluY2VudGl2ZXNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5SW5jZW50aXZlcyAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG5cbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCIwMVhcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5MDFYU3RhY2tlZCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcInBLbGltYSBIb2xkZXJzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVBLbGltYVN0YWNrZWQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJEQU8vVHJlYXN1cnlcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5VHJlYXN1cnlTdGFja2VkLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiRWNvc3lzdGVtIEdyYW50XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUdyYW50U3RhY2tlZCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIlByb2R1Y3QgRGVzaWduXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVByb2R1Y3RTdGFja2VkLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlLbGltYVN0YWNrZWQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJJbmNlbnRpdmVzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUluY2VudGl2ZXNTdGFja2VkLFxuICAgICAgfSk7XG5cbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIjAxWFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHkwMVgsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcInBLbGltYSBIb2xkZXJzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVBLbGltYSxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVRyZWFzdXJ5LFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJFY29zeXN0ZW0gR3JhbnRcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5R3JhbnQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIlByb2R1Y3QgRGVzaWduXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVByb2R1Y3QsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5S2xpbWEsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkluY2VudGl2ZXNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5SW5jZW50aXZlcyxcbiAgICAgIH0pO1xuXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmSW5jZW50aXZlcyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogZGlmZktsaW1hLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogZGlmZlByb2R1Y3QsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJFY29zeXN0ZW0gR3JhbnRcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogZGlmZkdyYW50LFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwicEtsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogZGlmZlBLbGltYSxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkRBTy9UcmVhc3VyeVwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmVHJlYXN1cnksXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCIwMVhcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogZGlmZjAxWCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHZlY05leHRZZWFySW5jZW50aXZlcyA9IHZlY1N1cHBseUluY2VudGl2ZXMubWFwKCh2YWwsIHQpID0+XG4gICAgdmVjU3VwcGx5SW5jZW50aXZlc1t0ICsgMTJdIC0gdmFsKTtcbiAgY29uc3QgdmVjQVBZID0gdmVjU3VwcGx5Q2lyY3VsYXRpbmcubWFwKCh2YWwsIHQpID0+XG4gICAgMTAwICogKHZlY1N1cHBseUNpcmN1bGF0aW5nW3QgKyAxMl0gLSB2YWwpIC8gdmFsKTtcbiAgY29uc3QgdmVjQVBSID0gdmVjU3VwcGx5Q2lyY3VsYXRpbmcubWFwKCh2YWwsIHQpID0+XG4gICAgMTAwICogKHZlY1N1cHBseUNpcmN1bGF0aW5nW3QgKyAxMl0gLSB2ZWNOZXh0WWVhckluY2VudGl2ZXNbdF0gLSB2YWwpIC8gdmFsKTtcblxuICBmb3IgKGxldCB0ID0gMDsgdCA8PSA2MDsgdCsrKSB7XG4gICAgc3VwcGx5RGF0YS5wdXNoKHsga2V5OiBcIkFQWVwiLCB4OiB0LCB5OiB2ZWNBUFlbdF0gfSk7XG4gICAgc3VwcGx5RGF0YS5wdXNoKHsga2V5OiBcIkFQUlwiLCB4OiB0LCB5OiB2ZWNBUFJbdF0gfSk7XG4gIH1cbiAgcmV0dXJuIFtcbiAgICB2ZWNTdXBwbHlJbmNlbnRpdmVzLFxuICAgIHZlY1N1cHBseUNpcmN1bGF0aW5nLFxuICAgIHN1cHBseURhdGEsXG4gICAgdmVjQVBZLFxuICAgIHZlY0FQUixcbiAgXTtcbn1cbnZlY1N1cHBseUluY2VudGl2ZXMgPSBzdXBwbHlEYXRhQWxsWzBdO1xudmVjU3VwcGx5Q2lyY3VsYXRpbmcgPSBzdXBwbHlEYXRhQWxsWzFdO1xuc3VwcGx5RGF0YSA9IHN1cHBseURhdGFBbGxbMl07XG52ZWNBUFkgPSBzdXBwbHlEYXRhQWxsWzNdO1xudmVjQVBSID0gc3VwcGx5RGF0YUFsbFs0XTtcblxuZ2V0TG9naXN0aWNDdXJ2ZSA9IGQgPT4gZC5rZXkgPT09IFwiUHJvcG9ydGlvbiBvZiBTdXBwbHlcIiA/IGQueSA6IE5hTjtcbmdldFJhdGVPZkNoYW5nZSA9IGQgPT4gZC5rZXkgPT09IFwiUmF0ZSBvZiBDaGFuZ2VcIiA/IGQueSA6IE5hTjtcbmdldENpcmN1bGF0aW5nU3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiID8gZC55IDogTmFOO1xuZ2V0Q2lyY3VsYXRpbmdVbnN0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiID8gZC55IDogTmFOO1xuZ2V0VG90YWxTdGFja2VkID0gZCA9PiBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XG5nZXRUb3RhbFVuc3RhY2tlZCA9IGQgPT4gZC5rZXkgPT09IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XG5nZXREaWZmVW5zdGFja2VkID0gZCA9PlxuICAgICAgICBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XG5nZXRDb2hvcnRDaXJjdWxhdGluZ1N0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIiA/IGQuY29ob3J0IDogTmFOO1xuZ2V0Q29ob3J0Q2lyY3VsYXRpbmdVbnN0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiID8gZC5jb2hvcnQgOiBOYU47XG5nZXRDb2hvcnRUb3RhbFN0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIiA/IGQuY29ob3J0IDogTmFOO1xuZ2V0Q29ob3J0VG90YWxVbnN0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiID8gZC5jb2hvcnQgOiBOYU47XG5nZXRDb2hvcnREaWZmVW5zdGFja2VkID0gZCA9PlxuICAgICAgICBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIgPyBkLmNvaG9ydCA6IE5hTjtcbmdldEFQWSA9IGQgPT4gZC5rZXkgPT09IFwiQVBZXCIgPyBkLnkgOiBOYU47XG5nZXRBUFIgPSBkID0+IGQua2V5ID09PSBcIkFQUlwiID8gZC55IDogTmFOO1xuXG5kb21haW5SYXRlT2ZDaGFuZ2UgPSBbMCwgZDMubWF4KHN1cHBseURhdGEsIGdldFJhdGVPZkNoYW5nZSldO1xuc2NhbGVSYXRlT2ZDaGFuZ2UgPSBkMy5zY2FsZUxpbmVhcihkb21haW5SYXRlT2ZDaGFuZ2UsIFswLCAxMDBdKTtcbm1hcFNjYWxlUmF0ZU9mQ2hhbmdlID0geCA9PiB4Lm1hcChzY2FsZVJhdGVPZkNoYW5nZSk7XG5cbnN0cmluZ1AwID0gXCJJbml0aWFsIElzc3VhbmNlIFDigoAgPSBcIiArIGlucHV0UDAudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMCB9LFxuKTtcbnN0cmluZ1QgPSBcIkluZmxlY3Rpb24gUG9pbnQgVGltZSBUID0gXCIgKyBpbnB1dFQudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSxcbikgKyBcIiBtb250aHNcIjtcblxuc3VwcGx5UGFyYW1zID0gW1xuICB7IGtleTogc3RyaW5nUDAsIHg6IDAuNSwgeTogMTAwICogaW5wdXRQMCB9LFxuICB7IGtleTogc3RyaW5nVCwgeDogaW5wdXRULCB5OiA1MCB9LFxuXTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogWzUsIDcsIDAsIDJdLm1hcChpID0+IGQzLnNjaGVtZUNhdGVnb3J5MTBbaV0pLFxuICAgIGRvbWFpbjogW1wiUHJvcG9ydGlvbiBvZiBTdXBwbHlcIiwgXCJSYXRlIG9mIENoYW5nZVwiLCBzdHJpbmdQMCwgc3RyaW5nVF0sXG4gIH0sXG4gIHg6IHtcbiAgICB0aWNrczogZDMucmFuZ2UoMCwgNjAuMSwgMTIpLFxuICAgIGxhYmVsOiBcIuKAmExpZmXigJkgU3BhbiAoTW9udGhzKVwiLFxuICAgIGdyaWQ6IHRydWUsXG4gIH0sXG4gIHk6IHsgZG9tYWluOiBbMCwgMTAwXSB9LFxuICBpbnNldFRvcDogMTYsXG4gIGNsaXA6IHRydWUsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwibGVmdFwiLCBsYWJlbDogXCJQcm9wb3J0aW9uIG9mIFN1cHBseSAoJSlcIiB9KSxcbiAgICBQbG90LmF4aXNZKHNjYWxlUmF0ZU9mQ2hhbmdlLnRpY2tzKCksIHtcbiAgICAgIGFuY2hvcjogXCJyaWdodFwiLFxuICAgICAgdGlja0Zvcm1hdDogc2NhbGVSYXRlT2ZDaGFuZ2UudGlja0Zvcm1hdCgpLFxuICAgICAgbGFiZWw6IFwiUmF0ZSBvZiBDaGFuZ2UgKCUvTW9udGgpXCIsXG4gICAgICB5OiBzY2FsZVJhdGVPZkNoYW5nZVxuICAgIH0pLFxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlUmF0ZU9mQ2hhbmdlLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IGdldFJhdGVPZkNoYW5nZSxcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSksXG4gICAgUGxvdC5saW5lWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IGdldExvZ2lzdGljQ3VydmUsXG4gICAgICBzdHJva2U6IFwia2V5XCIsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgfSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCBQbG90Lm1hcFkobWFwU2NhbGVSYXRlT2ZDaGFuZ2UsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0UmF0ZU9mQ2hhbmdlLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICAgIGZpbGxPcGFjaXR5OiAwLjMsXG4gICAgfSkpLFxuICAgIFBsb3QuYXJlYVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRMb2dpc3RpY0N1cnZlLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICAgIGZpbGxPcGFjaXR5OiAwLjMsXG4gICAgfSksXG4gICAgUGxvdC5ydWxlWChzdXBwbHlQYXJhbXMsIHtcbiAgICAgIHg6IGQgPT4gZC5rZXkgPT09IHN0cmluZ1QgPyBkLnggOiBOYU4sXG4gICAgICB5OiBcInlcIixcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSxcbiAgICBQbG90LmRvdFkoc3VwcGx5UGFyYW1zLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IFwieVwiLFxuICAgICAgcjogNSxcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgfSksXG4gIF1cbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxuICB5OiB7IGRvbWFpbjogWzAsIDEwMF0sIGxhYmVsOiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoJSlcIiwgZ3JpZDogdHJ1ZSB9LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0Q2lyY3VsYXRpbmdTdGFja2VkLFxuICAgICAgc3Ryb2tlOiBnZXRDb2hvcnRDaXJjdWxhdGluZ1N0YWNrZWQsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgfSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IGdldENpcmN1bGF0aW5nVW5zdGFja2VkLFxuICAgICAgZmlsbDogZ2V0Q29ob3J0Q2lyY3VsYXRpbmdVbnN0YWNrZWQsXG4gICAgICBmaWxsT3BhY2l0eTogMC41LFxuICAgIH0pLFxuICBdXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjogeyBsZWdlbmQ6IHRydWUsIHJhbmdlOiBkMy5zY2hlbWVDYXRlZ29yeTEwLCBkb21haW46IGNvaG9ydHNEb21haW4gfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgNjAuMSwgMTIpLCBsYWJlbDogXCJUaW1lIChNb250aHMpXCIsIGdyaWQ6IHRydWUgfSxcbiAgeTogeyBkb21haW46IFswLCAxMDBdLCBsYWJlbDogXCJUb3RhbCBTdXBwbHkgKCUpXCIsIGdyaWQ6IHRydWUgfSxcbiAgY2xpcDogdHJ1ZSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5saW5lWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IGdldFRvdGFsU3RhY2tlZCxcbiAgICAgIHN0cm9rZTogZ2V0Q29ob3J0VG90YWxTdGFja2VkLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgIH0pLFxuICAgIFBsb3QuYXJlYVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRUb3RhbFVuc3RhY2tlZCxcbiAgICAgIGZpbGw6IGdldENvaG9ydFRvdGFsVW5zdGFja2VkLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuNSxcbiAgICB9KSxcbiAgXVxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjogeyBsZWdlbmQ6IHRydWUsIHJhbmdlOiBkMy5zY2hlbWVDYXRlZ29yeTEwLCBkb21haW46IGNvaG9ydHNEb21haW4gfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgNjAuMSwgMTIpLCBsYWJlbDogXCJUaW1lIChNb250aHMpXCIsIGdyaWQ6IHRydWUgfSxcbiAgeTogeyBsYWJlbDogXCJUb3RhbCBTdXBwbHkgKCUpXCIsIGdyaWQ6IHRydWUgfSxcbiAgaW5zZXRUb3A6IDE2LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0VG90YWxVbnN0YWNrZWQsXG4gICAgICBzdHJva2U6IGdldENvaG9ydFRvdGFsVW5zdGFja2VkLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgIH0pLFxuICAgIFBsb3QuYXJlYVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5MTogMCxcbiAgICAgIHkyOiBnZXRUb3RhbFVuc3RhY2tlZCxcbiAgICAgIGZpbGw6IGdldENvaG9ydFRvdGFsVW5zdGFja2VkLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuMixcbiAgICB9KSxcbiAgXVxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjogeyBsZWdlbmQ6IHRydWUsIHJhbmdlOiBkMy5zY2hlbWVDYXRlZ29yeTEwLCBkb21haW46IGNvaG9ydHNEb21haW4gfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgNjAuMSwgMTIpLCBsYWJlbDogXCJUaW1lIChNb250aHMpXCIsIGdyaWQ6IHRydWUgfSxcbiAgeTogeyBsYWJlbDogXCJSYXRlIG9mIEdyb3d0aCAoJS9Nb250aClcIiwgZ3JpZDogdHJ1ZSB9LFxuICBpbnNldFRvcDogMTYsXG4gIGluc2V0TGVmdDogOCxcbiAgaW5zZXRSaWdodDogOCxcbiAgY2xpcDogdHJ1ZSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0WShzdXBwbHlEYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLnggLSAwLjQ1LFxuICAgICAgeDI6IGQgPT4gZC54ICsgMC40NSxcbiAgICAgIHk6IGdldERpZmZVbnN0YWNrZWQsXG4gICAgICBmaWxsOiBnZXRDb2hvcnREaWZmVW5zdGFja2VkLFxuICAgIH0pLFxuICBdXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogWzksIDhdLm1hcChpID0+IGQzLnNjaGVtZUNhdGVnb3J5MTBbaV0pLFxuICAgIGRvbWFpbjogW1wiQVBZXCIsIFwiQVBSXCJdLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxuICB5OiB7XG4gICAgZG9tYWluOiBbMCwgTWF0aC5tYXgoZDMubWF4KHZlY0FQUiksIGQzLm1heCh2ZWNBUFkpKV0sXG4gICAgbGFiZWw6IFwiQW5udWFsIFBlcmNlbnRhZ2UgKCUpXCIsXG4gICAgZ3JpZDogdHJ1ZSxcbiAgfSxcbiAgaW5zZXRUb3A6IDE2LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0QVBZLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgIH0pLFxuICAgIFBsb3QuYXJlYVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5MTogMCxcbiAgICAgIHkyOiBnZXRBUFksXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuMixcbiAgICB9KSxcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0QVBSLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxuICAgIH0pLFxuICBdXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlVXBzaWxvbihHLCBMKSB7XG4gIGlmIChHID09PSAwICYmIEwgPT09IDApIHtcbiAgICByZXR1cm4gMDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gKDIgKiBHICogTCAvIChHKioyICsgTCoqMikpKioyO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidXBzaWxvbkRhdGEgPSB7XG4gIGNvbnN0IHVwc2lsb25EYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtRyA9IDA7IHBhcmFtRyA8IDEuMDE7IHBhcmFtRyArPSAwLjA1KSB7XG4gICAgZm9yIChsZXQgcGFyYW1MID0gMDsgcGFyYW1MIDwgMS4wMTsgcGFyYW1MICs9IDAuMDUpIHtcbiAgICAgIGlmIChwYXJhbUcgKyBwYXJhbUwgPCAxLjAxKSB7XG4gICAgICAgIHVwc2lsb25EYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCLPhVwiLFxuICAgICAgICAgIGw6IHBhcmFtTCxcbiAgICAgICAgICBnOiBwYXJhbUcsXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVVcHNpbG9uKHBhcmFtRywgcGFyYW1MKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB1cHNpbG9uRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgYXNwZWN0UmF0aW86IDEsXG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIGRvbWFpbjogWzAsIDFdLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBcIlJlbGF0aXZlIFV0aWxpc2F0aW9uIM+FXCIsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkxpcXVpZGl0eSBMXCIgfSxcbiAgeToge1xuICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxuICAgIGRvbWFpbjogWzEuMDI1LCAtMC4wMjVdLFxuICAgIGxhYmVsOiBcIlN0YWtlIEdcIixcbiAgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KHVwc2lsb25EYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmwgLSAwLjAyNSxcbiAgICAgIHgyOiBkID0+IGQubCArIDAuMDI1LFxuICAgICAgeTE6IGQgPT4gZC5nIC0gMC4wMjUsXG4gICAgICB5MjogZCA9PiBkLmcgKyAwLjAyNSxcbiAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICB9KSxcbiAgICBQbG90LnRleHQodXBzaWxvbkRhdGEsIHtcbiAgICAgIHg6IFwibFwiLFxuICAgICAgeTogXCJnXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlRXRhKEcsIEwpIHtcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAyICogRyAqIEwgLyAoRyAqICgxIC0gRykgKyBMICogKDEgLSBMKSk7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJldGFEYXRhID0ge1xuICBjb25zdCBldGFEYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtRyA9IDA7IHBhcmFtRyA8IDEuMDE7IHBhcmFtRyArPSAwLjA1KSB7XG4gICAgZm9yIChsZXQgcGFyYW1MID0gMDsgcGFyYW1MIDwgMS4wMTsgcGFyYW1MICs9IDAuMDUpIHtcbiAgICAgIGlmIChwYXJhbUcgKyBwYXJhbUwgPCAxLjAxKSB7XG4gICAgICAgIGV0YURhdGEucHVzaCh7XG4gICAgICAgICAga2V5OiBcIs63XCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUV0YShwYXJhbUcsIHBhcmFtTCksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZXRhRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTk0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgYXNwZWN0UmF0aW86IDEsXG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIGRvbWFpbjogWzAsIDFdLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBcIkFic29sdXRlIFV0aWxpc2F0aW9uIM63XCIsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkxpcXVpZGl0eSBMXCIgfSxcbiAgeToge1xuICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxuICAgIGRvbWFpbjogWzEuMDI1LCAtMC4wMjVdLFxuICAgIGxhYmVsOiBcIlN0YWtlIEdcIixcbiAgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KGV0YURhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQubCAtIDAuMDI1LFxuICAgICAgeDI6IGQgPT4gZC5sICsgMC4wMjUsXG4gICAgICB5MTogZCA9PiBkLmcgLSAwLjAyNSxcbiAgICAgIHkyOiBkID0+IGQuZyArIDAuMDI1LFxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChldGFEYXRhLCB7XG4gICAgICB4OiBcImxcIixcbiAgICAgIHk6IFwiZ1wiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFswLCAxXSwgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTk1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0U18gPSBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1RpbWUtTG9ja2VkIH0gU2AsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiAwLjUsXG59KTtcblxudmlld29mIGlucHV0V2VpZ2h0QUcgPSBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0xQIHNwbGl0fWAsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiAwLjUsXG59KTtcblxucGFyYW1XZWlnaHRBUSA9IDEgLSBpbnB1dFdlaWdodEFHO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVUcmVhc3VyeShHLCBMKSB7XG4gIHJldHVybiBNYXRoLm1heCgwLCAxIC0gY29tcHV0ZVVwc2lsb24oRywgTCkgKiBjb21wdXRlRXRhKEcsIEwpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlSUJvbmRzKEcsIEwsIFMpIHtcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBTICogTCoqMiAvIChHKioyICsgTCoqMik7XG4gIH1cbn1cblxuZnVuY3Rpb24gY29tcHV0ZUlTdGFraW5nKEcsIEwsIFMpIHtcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAoMSAtIFMpICogTCoqMiAvIChHKioyICsgTCoqMik7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlSVBvb2woRywgTCwgd2VpZ2h0KSB7XG4gIGlmIChHID09PSAwICYmIEwgPT09IDApIHtcbiAgICByZXR1cm4gMDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gd2VpZ2h0ICogRyoqMiAvIChHKioyICsgTCoqMik7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJhbGxvY2F0aW9uU1FEYXRhID0ge1xuICBjb25zdCBhbGxvY2F0aW9uU1FEYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtRyA9IDA7IHBhcmFtRyA8IDEuMDE7IHBhcmFtRyArPSAwLjEpIHtcbiAgICBmb3IgKGxldCBwYXJhbUwgPSAwOyBwYXJhbUwgPCAxLjAxOyBwYXJhbUwgKz0gMC4xKSB7XG4gICAgICBpZiAocGFyYW1HICsgcGFyYW1MIDwgMS4wMSkge1xuICAgICAgICBhbGxvY2F0aW9uU1FEYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCLwnZeUIFRpbWUtbG9ja3MgQWxsb2NhdGlvblwiLFxuICAgICAgICAgIGw6IHBhcmFtTCxcbiAgICAgICAgICBnOiBwYXJhbUcsXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVJQm9uZHMocGFyYW1HLCBwYXJhbUwsIGlucHV0U18pLFxuICAgICAgICB9KTtcbiAgICAgICAgYWxsb2NhdGlvblNRRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwi8J2XmiBVc2VyLWxvY2tzIEFsbG9jYXRpb25cIixcbiAgICAgICAgICBsOiBwYXJhbUwsXG4gICAgICAgICAgZzogcGFyYW1HLFxuICAgICAgICAgIHZhbHVlOiBjb21wdXRlSVN0YWtpbmcocGFyYW1HLCBwYXJhbUwsIGlucHV0U18pLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFsbG9jYXRpb25TUURhdGE7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwbG90QWxsb2NhdGlvblNRID0ge1xuICBjb25zdCBwbG90QWxsb2NhdGlvblNRID0gUGxvdC5wbG90KHtcbiAgICBhc3BlY3RSYXRpbzogMSxcbiAgICBjb2xvcjoge1xuICAgICAgbGVnZW5kOiB0cnVlLFxuICAgICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgICBkb21haW46IFswLCAxXSxcbiAgICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgICAgbGFiZWw6IFwiQWxsb2NhdGlvbiBJXCIsXG4gICAgfSxcbiAgICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJMaXF1aWRpdHkgTFwiIH0sXG4gICAgeToge1xuICAgICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgICBkb21haW46IFsxLjA1LCAtMC4wNV0sXG4gICAgICBsYWJlbDogXCJTdGFrZSBHXCIsXG4gICAgfSxcbiAgICBmeDogeyBsYWJlbDogbnVsbCB9LFxuICAgIG1hcmtzOiBbXG4gICAgICBQbG90LmZyYW1lKCksXG4gICAgICBQbG90LnJlY3QoYWxsb2NhdGlvblNRRGF0YSwge1xuICAgICAgICB4MTogZCA9PiBkLmwgLSAwLjA1LFxuICAgICAgICB4MjogZCA9PiBkLmwgKyAwLjA1LFxuICAgICAgICB5MTogZCA9PiBkLmcgLSAwLjA1LFxuICAgICAgICB5MjogZCA9PiBkLmcgKyAwLjA1LFxuICAgICAgICBmeDogXCJrZXlcIixcbiAgICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgICAgfSksXG4gICAgICBQbG90LnRleHQoYWxsb2NhdGlvblNRRGF0YSwge1xuICAgICAgICB4OiBcImxcIixcbiAgICAgICAgeTogXCJnXCIsXG4gICAgICAgIGZ4OiBcImtleVwiLFxuICAgICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICAgICksXG4gICAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFswLCAxXSwgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCkoZC52YWx1ZSksXG4gICAgICAgICksXG4gICAgICB9KSxcbiAgICBdLFxuICB9KTtcblxuICBkMy5zZWxlY3QocGxvdEFsbG9jYXRpb25TUSlcbiAgICAuc2VsZWN0KFwiZ1thcmlhLWxhYmVsPSd5LWF4aXMgbGFiZWwnXVwiKVxuICAgIC5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigwLCAxMCkpO1xuXG4gIHJldHVybiBwbG90QWxsb2NhdGlvblNRO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYWxsb2NhdGlvblBvb2xEYXRhID0ge1xuICBjb25zdCBhbGxvY2F0aW9uUG9vbERhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMSkge1xuICAgIGZvciAobGV0IHBhcmFtTCA9IDA7IHBhcmFtTCA8IDEuMDE7IHBhcmFtTCArPSAwLjEpIHtcbiAgICAgIGlmIChwYXJhbUcgKyBwYXJhbUwgPCAxLjAxKSB7XG4gICAgICAgIGFsbG9jYXRpb25Qb29sRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwi8J2XlPCdl5ogUG9vbCBBbGxvY2F0aW9uXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlQb29sKHBhcmFtRywgcGFyYW1MLCBpbnB1dFdlaWdodEFHKSxcbiAgICAgICAgfSk7XG4gICAgICAgIGFsbG9jYXRpb25Qb29sRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwi8J2XlPCdl6QgUG9vbCBBbGxvY2F0aW9uXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlQb29sKHBhcmFtRywgcGFyYW1MLCBwYXJhbVdlaWdodEFRKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBhbGxvY2F0aW9uUG9vbERhdGE7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwbG90QWxsb2NhdGlvblBvb2wgPSB7XG4gIGNvbnN0IHBsb3RBbGxvY2F0aW9uUG9vbCA9IFBsb3QucGxvdCh7XG4gICAgYXNwZWN0UmF0aW86IDEsXG4gICAgY29sb3I6IHtcbiAgICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgICAgZG9tYWluOiBbMCwgMV0sXG4gICAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICAgIGxhYmVsOiBcIkFsbG9jYXRpb24gSVwiLFxuICAgIH0sXG4gICAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxuICAgIHk6IHtcbiAgICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxuICAgICAgZG9tYWluOiBbMS4wNSwgLTAuMDVdLFxuICAgICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxuICAgIH0sXG4gICAgZng6IHsgbGFiZWw6IG51bGwgfSxcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5mcmFtZSgpLFxuICAgICAgUGxvdC5yZWN0KGFsbG9jYXRpb25Qb29sRGF0YSwge1xuICAgICAgICB4MTogZCA9PiBkLmwgLSAwLjA1LFxuICAgICAgICB4MjogZCA9PiBkLmwgKyAwLjA1LFxuICAgICAgICB5MTogZCA9PiBkLmcgLSAwLjA1LFxuICAgICAgICB5MjogZCA9PiBkLmcgKyAwLjA1LFxuICAgICAgICBmeDogXCJrZXlcIixcbiAgICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgICAgfSksXG4gICAgICBQbG90LnRleHQoYWxsb2NhdGlvblBvb2xEYXRhLCB7XG4gICAgICAgIHg6IFwibFwiLFxuICAgICAgICB5OiBcImdcIixcbiAgICAgICAgZng6IFwia2V5XCIsXG4gICAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICAgKSxcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICAgKSxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIGQzLnNlbGVjdChwbG90QWxsb2NhdGlvblBvb2wpXG4gICAgLnNlbGVjdChcImdbYXJpYS1sYWJlbD0neS1heGlzIGxhYmVsJ11cIilcbiAgICAuc2VsZWN0KFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY2hhbmdlVHJhbnNsYXRpb24oMCwgMTApKTtcblxuICByZXR1cm4gcGxvdEFsbG9jYXRpb25Qb29sO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidHJlYXN1cnlEYXRhID0ge1xuICBjb25zdCB0cmVhc3VyeURhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMDUpIHtcbiAgICBmb3IgKGxldCBwYXJhbUwgPSAwOyBwYXJhbUwgPCAxLjAxOyBwYXJhbUwgKz0gMC4wNSkge1xuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcbiAgICAgICAgdHJlYXN1cnlEYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCJJX1RcIixcbiAgICAgICAgICBsOiBwYXJhbUwsXG4gICAgICAgICAgZzogcGFyYW1HLFxuICAgICAgICAgIHZhbHVlOiBjb21wdXRlVHJlYXN1cnkocGFyYW1HLCBwYXJhbUwpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRyZWFzdXJ5RGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGFzcGVjdFJhdGlvOiAxLFxuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICBkb21haW46IFswLCAxXSxcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogXCJBbGxvY2F0aW9uIElcIixcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxuICB5OiB7XG4gICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXG4gICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxuICB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QodHJlYXN1cnlEYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmwgLSAwLjAyNSxcbiAgICAgIHgyOiBkID0+IGQubCArIDAuMDI1LFxuICAgICAgeTE6IGQgPT4gZC5nIC0gMC4wMjUsXG4gICAgICB5MjogZCA9PiBkLmcgKyAwLjAyNSxcbiAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICB9KSxcbiAgICBQbG90LnRleHQodHJlYXN1cnlEYXRhLCB7XG4gICAgICB4OiBcImxcIixcbiAgICAgIHk6IFwiZ1wiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFswLCAxXSwgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRTJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dENpMCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dExpcVNoYXBlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RGVsdGFDaScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEV0JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RGVsdGFCYXJDaScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dERlbHRhQmFyQ251bGwnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREZWx0YUEnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREZWx0YUNpbml0aWFsJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0QVZhbHVlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0QVN1cHBseScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFByZXNlbnRUb25uZXMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREZWx0YVRvbm5lcycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEFpJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0R2knKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBVmFsdWVfJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0QVN1cHBseV8nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRMaXF1aWRUb25uZXMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBQnVybnQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRQMCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRTXycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFdlaWdodEFHJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/whitepaper\.klima\.leodesouza\.net");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>