<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="The Dark Sole Enterprise Ltd ds@darksole.vip with contributions from the Klima and Carbonmark teams">

<title>Klima 2.0</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./brand/favicon.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ce21267a17b13b409651dbb24b76e7cc.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-ce21267a17b13b409651dbb24b76e7cc.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-ce21267a17b13b409651dbb24b76e7cc.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link rel="icon" type="image/png" sizes="96x96" href="./brand/favicon-96x96.png">
<link rel="shortcut icon" href="./brand/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="./brand/apple-touch-icon.png">

  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Klima 2.0">
<meta property="og:description" content="This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.
The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.
The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.
This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.">
<meta property="og:image" content="https://whitepaper.klima.leodesouza.net/brand/klimaprotocol.svg">
<meta property="og:image:alt" content="Klima Protocol Logo.">
<meta name="twitter:title" content="Klima 2.0">
<meta name="twitter:description" content="This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.
The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.
The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.
This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.">
<meta name="twitter:image" content="https://whitepaper.klima.leodesouza.net/brand/klimaprotocol.svg">
<meta name="twitter:image:alt" content="Klima Protocol Logo.">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-prologue" id="toc-sec-prologue" class="nav-link active" data-scroll-target="#sec-prologue"><span class="header-section-number">1</span> Prologue</a></li>
  <li><a href="#sec-klima-2.0" id="toc-sec-klima-2.0" class="nav-link" data-scroll-target="#sec-klima-2.0"><span class="header-section-number">2</span> Klima&nbsp;2.0</a>
  <ul class="collapse">
  <li><a href="#sec-dual-utility-tokens" id="toc-sec-dual-utility-tokens" class="nav-link" data-scroll-target="#sec-dual-utility-tokens"><span class="header-section-number">2.1</span> Dual Utility Tokens</a></li>
  <li><a href="#sec-high-level-architecture" id="toc-sec-high-level-architecture" class="nav-link" data-scroll-target="#sec-high-level-architecture"><span class="header-section-number">2.2</span> High-Level Architecture</a></li>
  <li><a href="#sec-economics-and-incentives" id="toc-sec-economics-and-incentives" class="nav-link" data-scroll-target="#sec-economics-and-incentives"><span class="header-section-number">2.3</span> Economics and Incentives</a></li>
  <li><a href="#sec-portfolio-manager" id="toc-sec-portfolio-manager" class="nav-link" data-scroll-target="#sec-portfolio-manager"><span class="header-section-number">2.4</span> Portfolio Manager</a></li>
  <li><a href="#sec-tokens" id="toc-sec-tokens" class="nav-link" data-scroll-target="#sec-tokens"><span class="header-section-number">2.5</span> Tokens</a></li>
  <li><a href="#sec-initialisation-of-the-kvcm-token" id="toc-sec-initialisation-of-the-kvcm-token" class="nav-link" data-scroll-target="#sec-initialisation-of-the-kvcm-token"><span class="header-section-number">2.6</span> Initialisation of the kVCM Token</a></li>
  <li><a href="#sec-end-users" id="toc-sec-end-users" class="nav-link" data-scroll-target="#sec-end-users"><span class="header-section-number">2.7</span> End Users</a></li>
  <li><a href="#sec-automated-asset-manager-highlights" id="toc-sec-automated-asset-manager-highlights" class="nav-link" data-scroll-target="#sec-automated-asset-manager-highlights"><span class="header-section-number">2.8</span> Automated Asset Manager Highlights</a></li>
  </ul></li>
  <li><a href="#sec-core-economic-pillars" id="toc-sec-core-economic-pillars" class="nav-link" data-scroll-target="#sec-core-economic-pillars"><span class="header-section-number">3</span> Core Economic Pillars</a>
  <ul class="collapse">
  <li><a href="#sec-time-locked-market" id="toc-sec-time-locked-market" class="nav-link" data-scroll-target="#sec-time-locked-market"><span class="header-section-number">3.1</span> Time-Locked Market</a></li>
  <li><a href="#sec-portfolio-manager-detailed" id="toc-sec-portfolio-manager-detailed" class="nav-link" data-scroll-target="#sec-portfolio-manager-detailed"><span class="header-section-number">3.2</span> Portfolio Manager</a></li>
  <li><a href="#sec-liquidity-markets" id="toc-sec-liquidity-markets" class="nav-link" data-scroll-target="#sec-liquidity-markets"><span class="header-section-number">3.3</span> Liquidity Markets</a></li>
  <li><a href="#sec-interactive-model" id="toc-sec-interactive-model" class="nav-link" data-scroll-target="#sec-interactive-model"><span class="header-section-number">3.4</span> Interactive Model</a></li>
  </ul></li>
  <li><a href="#sec-klima-2.0-token-distribution" id="toc-sec-klima-2.0-token-distribution" class="nav-link" data-scroll-target="#sec-klima-2.0-token-distribution"><span class="header-section-number">4</span> Klima&nbsp;2.0 Token Distribution</a>
  <ul class="collapse">
  <li><a href="#sec-planned-allocations" id="toc-sec-planned-allocations" class="nav-link" data-scroll-target="#sec-planned-allocations"><span class="header-section-number">4.1</span> Planned Allocations</a></li>
  <li><a href="#sec-programmatic-incentive-curve" id="toc-sec-programmatic-incentive-curve" class="nav-link" data-scroll-target="#sec-programmatic-incentive-curve"><span class="header-section-number">4.2</span> Programmatic Incentive Curve</a></li>
  <li><a href="#sec-incentive-allocations" id="toc-sec-incentive-allocations" class="nav-link" data-scroll-target="#sec-incentive-allocations"><span class="header-section-number">4.3</span> Incentive Allocations</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="index.md"><i class="bi bi-file-text"></i>Markdown (for LLMs)</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Klima 2.0</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p></p><p>The Dark Sole Enterprise Ltd <a href="mailto:ds@darksole.vip" class="email">ds@darksole.vip</a><br>
with contributions from the Klima and Carbonmark teams</p> <p></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">16 Jan 2026 (Version 1.48)</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Notice to Readers</div>
    <p>This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.<br>
    The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.<br>
    The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.<br>
    This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.</p>
  </div>
</div>


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="brand/klimaprotocol.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%" alt="Klima Protocol Logo."></p>
</figure>
</div>
<p><strong>Copyright Notice</strong></p>
<p>This document represents original work by dark_sole <a href="mailto:ds@darksole.vip" class="email">ds@darksole.vip</a>. While contributions from others are gratefully acknowledged, all intellectual property rights remain with the author. The models, algorithms, processes, products, methodologies, and concepts described herein are licenced exclusively for commercial use by the Klima Protocol. No other party may implement, copy, modify, or derive works from these materials without explicit written permission from the author.</p>
<p>© 2025 dark_sole. All rights reserved.</p>
<section id="sec-prologue" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="sec-prologue"><span class="header-section-number">1</span> Prologue</h2>
<p><strong>Klima&nbsp;2.0 is an autonomous capital system for the carbon asset class.</strong> It is neither a conventional token nor a traditional protocol, but rather a continuously adaptive financial structure governed entirely by endogenous signals and risk-weighted economic inputs.</p>
<p>The system is based on a dual token architecture: <strong>kVCM</strong>, representing capital and asset exposure, and <strong>K2</strong>, reflecting systemic risk preferences. Together, these tokens structure the internal market dynamics without the need for oracles or discretionary oversight. This architecture enables the system to:</p>
<ul>
<li><p>Systematically select and price tokenised carbon credits,</p></li>
<li><p>Construct and maintain a forward-yield curve derived from on-chain capital commitments,</p></li>
<li><p>Govern portfolio allocation, liquidity provisioning, and incentive distribution through deterministic smart contract logic.</p></li>
</ul>
<p>All token holder actions – locking, allocation and staking – serve as inputs to a reflexive coordination mechanism. <strong>kVCM</strong> governs the allocation of capital to carbon assets, while <strong>K2</strong> parametrises the system’s risk assumptions and pricing capacity. This interaction defines a synthetic balance sheet where capital value, risk spread, and yield formation emerge from collective participation.</p>
<p>The platform consists of three interdependent components: the <strong>Portfolio Manager</strong>, which acquires and retires carbon assets; the <strong>Time-Locked Market</strong>, which generates a time-structured synthetic yield curve; and the <strong>Liquidity Market</strong>, which facilitates price discovery and capital flow across <strong>kVCM</strong>, <strong>K2</strong>, and external currencies. These mechanisms are interlocked by design, enabling the system to continuously seek equilibrium.</p>
<p><strong>Klima&nbsp;2.0 abstracts complex market operations into a formal economic structure</strong> that integrates asset management, governance, and liquidity within a single protocol. <strong>kVCM</strong> offers structured exposure to carbon markets through tokenised yield and asset ownership, while <strong>K2</strong> modulates this exposure in response to endogenous risk metrics.</p>
<p>In this model, staking constitutes an economic vote; liquidity provision informs portfolio capacity; and yield is an emergent function of structural configuration. The system is designed to operate without exogenous intervention, maintaining equilibrium through adaptive incentive distribution and real asset correlation.</p>
<p><strong>Klima&nbsp;2.0 is a closed-form capital system with embedded governance and economic reflexivity, capable of continuously modelling and adjusting its internal state through its own token dynamics.</strong></p>
</section>
<section id="sec-klima-2.0" class="level2 page-columns page-full" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="sec-klima-2.0"><span class="header-section-number">2</span> Klima&nbsp;2.0</h2>
<p>KlimaDAO launched in 2021 on the Polygon blockchain as a fork of OlympusDAO. The original system centred on the KLIMA token backed by a treasury of carbon credits. At its peak, the KLIMA token exceeded a one-billion-USD market cap and brought over 20 million tonnes of carbon credits on-chain through incentives and governance.</p>
<p>Supporters agree that voluntary carbon markets benefit greatly from tokenisation and on-chain liquidity. This brings transparency, price discovery, accessibility, interoperability, programmability, and faster settlement for brokers and buyers. These benefits are proven by dozens of production-grade platforms and services built by Klima and partners after launch, including:</p>
<ul>
<li>Integrations with major carbon registries.</li>
<li>Marketplaces, storefronts, and point-of-sale tools.</li>
<li>REST APIs for seamless integration into third-party apps.</li>
<li>Direct blockchain issuance by major project developers.</li>
</ul>
<p>All of these products are powered on KlimaDAO’s tokenised carbon and liquidity, with measurable adoption. This makes the KLIMA token a leading case study for the adoption of tokenised Real World Assets.</p>
<p>Still, after years of iteration it became clear that&nbsp;Klima 1.0 and the KLIMA token would not be able to scale or serve the largest enterprise buyers effectively.</p>
<p>Hence we present <strong>Klima&nbsp;2.0</strong> as an <strong>Autonomous Asset Manager</strong>&nbsp;(AAM) with the new <strong>Risk-Balanced Asset</strong> token <strong>kVCM</strong> that:</p>
<ul>
<li><p>Selects and purchases carbon credits on a spot and forward basis for its own portfolio.</p></li>
<li><p>Retires its carbon credits by issuing carbon offset certificates to buyers.</p></li>
<li><p>Continuously yields carbon credits from its portfolio.</p></li>
<li><p>Enables investors to:</p>
<ul>
<li><p>Hold a true <em>passive</em> exposure to carbon markets, spreads and dislocations via the new <strong>kVCM</strong> token.</p></li>
<li><p><em>Actively</em> reflect their risk appetite collectively to optimise portfolio selection and capacity.</p></li>
<li><p>Determine the proportion of yield distribution vs capital retention, allowing cyclical expansions and contractions and de-facto price modelling of the <strong>kVCM</strong> token.</p></li>
</ul></li>
</ul>
<div id="fig-design" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 high-level design.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-design-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/design.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-design-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Klima&nbsp;2.0 high-level design.
</figcaption>
</figure>
</div>
<p>Klima&nbsp;2.0 provides a fundamental capital, liquidity and execution layer for wholesale carbon trading, capturing spreads and structural pricing across the asset class. It employs rational adaptive financial models to reflect token holders’ collective risk-reward preferences, produced solely through <u>native</u> smart contract balances from staking and liquidity functions allowing price discovery and harmonious functions to govern the stability and risk of the Risk-Balanced Asset token <strong>kVCM</strong>.</p>
<p>The model grants clean <em>look-through</em> economic ownership of tokenised carbon assets to <strong>kVCM</strong> token holders, as well as self-governance for risk and reward allowing maximum flexibility in this hybrid capital instrument for growth <u>and</u> distribution.</p>
<section id="sec-dual-utility-tokens" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="sec-dual-utility-tokens"><span class="header-section-number">2.1</span> Dual Utility Tokens</h3>
<p>In addition to the <strong>kVCM</strong> token, Klima&nbsp;2.0 introduces a second <strong>Risk Governance</strong> token <strong>K2</strong>. This token is responsible for modelling risk across the ecosystem by responding to the <strong>kVCM</strong> token’s core selections and adding essential derivative parameters that manage adverse selection and pricing capacity.</p>
<div id="fig-token-replacement" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token replacement.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-replacement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-replacement.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-replacement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Token replacement.
</figcaption>
</figure>
</div>
<p><strong>kVCM</strong> tokens have the beneficial ownership of the portfolio and set core allocation choices, whereas <strong>K2</strong> acts as the <em>risk-seeking</em> gauge for the portfolio construction.</p>
<p><strong>K2</strong> is formally compensated with <strong>kVCM</strong> tokens hence the two tokens’ interests are fully aligned, and together perform dynamic portfolio optimisation as a result of collective owner utility function.</p>
</section>
<section id="sec-high-level-architecture" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="sec-high-level-architecture"><span class="header-section-number">2.2</span> High-Level Architecture</h3>
<div id="fig-architecture" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 architecture.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-architecture-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/architecture.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-architecture-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Klima&nbsp;2.0 architecture.
</figcaption>
</figure>
</div>
<p>Three economic pillars support the Klima&nbsp;2.0 Automated Asset Manager:</p>
<ol type="1">
<li><p><strong>Portfolio Manager</strong>:</p>
<ul>
<li>Accumulates carbon credits for the portfolio by minting <strong>kVCM</strong>.</li>
<li>Sells carbon offset certificates from the portfolio by burning <strong>kVCM</strong>.</li>
<li>Prices <strong>liquid carbon</strong>&nbsp;(‘spot’ or ‘ex-post credits’) and <strong>forward-delivery carbon</strong>&nbsp;(‘ex-ante credits’) using the system’s generated discount rates.</li>
</ul></li>
<li><p><strong>Time-Locked Market</strong>:</p>
<ul>
<li><strong>kVCM</strong> holders <strong>time-lock</strong> their <strong>kVCM</strong> irreversibly for a fixed time period.</li>
<li>Time-locked <strong>kVCM</strong> holders are able to <em>select</em> carbon assets for the portfolio.</li>
<li>The time-locking pattern creates a <strong>kVCM</strong> Base Accrual curve, which is distributed to time-locked <strong>kVCM</strong> holders. This is utilised to derive discount rates for forward-delivery pricing in the Portfolio Manager and for weightings for time-locked <strong>kVCM</strong> holders in governance.</li>
</ul></li>
<li><p><strong>Liquidity Market</strong>:</p>
<ul>
<li><strong>kVCM</strong> and <strong>K2</strong> holders are able to pair their tokens together, or in the case of <strong>kVCM</strong> with USDC, in order to generate liquidity fees.</li>
<li>Staking the resulting liquidity provider tokens generates a share of the <strong>kVCM</strong> risk premium.</li>
<li>Liquidity locked in the <strong>kVCM</strong>/<strong>K2</strong> liquidity pool participates in general governance alongside time-locked <strong>kVCM</strong> holders.</li>
</ul></li>
</ol>
<p>Noting that throughout the paper, <em>locking</em> and <em>staking</em> mean that asset transfers are disabled for a specified period.</p>
</section>
<section id="sec-economics-and-incentives" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="sec-economics-and-incentives"><span class="header-section-number">2.3</span> Economics and Incentives</h3>
<section id="sec-kvcm-synthetic-yield" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="sec-kvcm-synthetic-yield"><span class="header-section-number">2.3.1</span> kVCM Synthetic Yield</h4>
<p><strong>kVCM</strong> emits a continuous yield rewarding:</p>
<ol type="1">
<li><p>Time-locked <strong>kVCM</strong> holders (‘<strong>kVCM</strong> Base Accrual’).</p></li>
<li><p>User-locked <strong>K2</strong> holders (‘<strong>kVCM</strong> Risk Premium’).</p></li>
<li><p>Both <strong>kVCM</strong> and <strong>K2</strong> stakers, i.e.&nbsp;liquidity providers who staked their liquidity provider tokens (‘<strong>kVCM</strong> Risk Premium’).</p></li>
</ol>
<p>The proportions and quantities are dynamic depending on the system state.</p>
</section>
<section id="sec-k2-incentives" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="sec-k2-incentives"><span class="header-section-number">2.3.2</span> K2 Incentives</h4>
<p>The expansion of the <strong>K2</strong> token supply is allocated to stakeholders below in varying quantities depending on system balances.</p>
<ol type="1">
<li><p>Time-locked <strong>kVCM</strong> holders.</p></li>
<li><p>User-locked <strong>K2</strong> holders.</p></li>
<li><p>Both <strong>kVCM</strong> and <strong>K2</strong> stakers.</p></li>
</ol>
</section>
</section>
<section id="sec-portfolio-manager" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="sec-portfolio-manager"><span class="header-section-number">2.4</span> Portfolio Manager</h3>
<p>At the core of the platform, the Portfolio Manager accumulates, trades and distributes its carbon portfolio driven by parameters determined from collective token holder actions&nbsp;(and inaction).</p>
<div id="fig-portfolio-manager" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 Portfolio Manager.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-portfolio-manager-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/portfolio-manager.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-portfolio-manager-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Klima&nbsp;2.0 Portfolio Manager.
</figcaption>
</figure>
</div>
<p>The Portfolio Manager <strong>purchases</strong> carbon credits and <strong>sells</strong> offset certificates by pre-defined classification called <strong>carbon class</strong>. It does <u>not</u> sell carbon credits.</p>
<p>Token holders collectively set the risk parameters for the pricing of <strong>each class</strong> by defining:</p>
<ul>
<li><p>Portfolio weighting.</p></li>
<li><p>Capacity curve and spreads.</p></li>
</ul>
<p>Additional <strong>global</strong> parameters are similarly determined:</p>
<ul>
<li><p>Forward-delivery discount rates.</p></li>
<li><p><strong>kVCM</strong> synthetic yield curve creating incentives for portfolio selection, liquidity provision and risk management contributions.</p></li>
</ul>
<p>There are no oracles or external inputs required for Klima&nbsp;2.0 as it is fully autonomous and responds to its own native state of token balances.</p>
</section>
<section id="sec-tokens" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="sec-tokens"><span class="header-section-number">2.5</span> Tokens</h3>
<section id="sec-risk-balanced-asset-token-kvcm" class="level4" data-number="2.5.1">
<h4 data-number="2.5.1" class="anchored" data-anchor-id="sec-risk-balanced-asset-token-kvcm"><span class="header-section-number">2.5.1</span> Risk-Balanced Asset Token: kVCM</h4>
<p><strong>kVCM</strong> represents core ownership of the portfolio assets, and is designed to flex between asset and growth value drivers depending on token-holder activity.</p>
<p><strong>kVCM</strong> has <u>no maximum supply</u> but inflates upon carbon credit accumulation, and contracts upon issuance of carbon offset certificates.</p>
<ul>
<li><p>When <strong>time-locked</strong> for fixed maturities:</p>
<ul>
<li><p><em>Optionally</em> selects carbon classes for portfolio weighting and pricing&nbsp;(‘active’).</p></li>
<li><p>Sets the forward discount rate for carbon portfolio acquisition from the collective time locking pattern over time.</p></li>
<li><p>Generates a <strong>synthetic yield</strong> of <strong>kVCM</strong> based on the forward curve.</p></li>
<li><p>Participates in governance for whitelisting carbon assets.</p></li>
</ul></li>
<li><p><strong>Transactional</strong> usage:</p>
<ul>
<li><p><strong>Mint</strong>: New <strong>kVCM</strong> is issued by the Portfolio Manager to purchase new carbon credits for the portfolio.</p></li>
<li><p><strong>Burn</strong>: <strong>kVCM</strong> are retired by the Portfolio Manager to issue carbon offset certificates.</p></li>
</ul></li>
<li><p><strong>Staked</strong> liquidity:</p>
<ul>
<li>Generates a <strong>kVCM</strong> Risk Premium, which is a time-based relative share of the <strong>kVCM</strong> synthetic yield reflecting the risks taken to support the price of platform capital.</li>
</ul></li>
</ul>
<p>Noting that the tokens can delegate utility as required.</p>
<div id="fig-aam-token-utility" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Automated Asset Manager token utility.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-aam-token-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/aam-token-utility.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-aam-token-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Automated Asset Manager token utility.
</figcaption>
</figure>
</div>
</section>
<section id="sec-risk-governance-token-k2" class="level4" data-number="2.5.2">
<h4 data-number="2.5.2" class="anchored" data-anchor-id="sec-risk-governance-token-k2"><span class="header-section-number">2.5.2</span> Risk Governance Token: K2</h4>
<p><strong>K2</strong> is a <u>fixed-supply</u> token issued programmatically over time with a dynamic allocation for <strong>K2</strong> <strong>Incentives</strong>.</p>
<ul>
<li><p>When <strong>user-locked</strong>:</p>
<ul>
<li>Shapes the pricing curve and spread of <strong>kVCM</strong>.</li>
<li>Determines the <strong>kVCM</strong> Risk Premium for staked liquidity providers.</li>
<li>Generates a share of the <strong>kVCM</strong> Risk Premium.</li>
<li>Receives <strong>K2</strong> Incentives.</li>
</ul></li>
<li><p><strong>Staked</strong> Liquidity:</p>
<ul>
<li>Generates a share of the <strong>kVCM</strong> Risk Premium.</li>
<li>Participates in governance.</li>
<li>Receives <strong>K2</strong> Incentives.</li>
</ul></li>
</ul>
</section>
<section id="sec-staking-functions" class="level4" data-number="2.5.3">
<h4 data-number="2.5.3" class="anchored" data-anchor-id="sec-staking-functions"><span class="header-section-number">2.5.3</span> Utility Functions</h4>
<p>The <strong>kVCM</strong> token has <u>two</u> utility functions which are not independent:</p>
<div id="fig-kvcm-staking" class="quarto-float quarto-figure quarto-figure-center anchored" alt="kVCM utility functions.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kvcm-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/kvcm-staking.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kvcm-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: <strong>kVCM</strong> utility functions.
</figcaption>
</figure>
</div>
<ol type="1">
<li><p><strong>Time lock</strong>: The <strong>kVCM</strong> token is locked for a specific period of time representing a liquidity preference for the holder in return for yield (‘<strong>kVCM</strong> base accrual’). This cannot be amended.</p></li>
<li><p><strong>Price allocation</strong>: Collective selection of carbon classes by <strong>kVCM</strong> allocations determines the <strong>instantaneous</strong> price ratio for <strong>kVCM</strong> token issuance. This selection can be amended and withdrawn at any time to allow price modulation for the platform of its carbon assets.</p></li>
</ol>
<p>The <strong>K2</strong> token also has <u>two</u> utility functions:</p>
<ol type="1">
<li><p><strong>User lock</strong>: The <strong>K2</strong> token remains locked for at least 24 hours.</p></li>
<li><p><strong>Risk allocation</strong>: collective selection of carbon classes by <strong>K2</strong> allocations determines the rate of issuance or price curve of <strong>kVCM</strong> for the specified carbon class, as well as the retirement burning rate.</p></li>
</ol>
<p>Both tokens facilitate the carbon market to function efficiently with the <strong>kVCM</strong> token responsible for portfolio selection and pricing, and the <strong>K2</strong> token modulating capacity and risk.</p>
</section>
</section>
<section id="sec-initialisation-of-the-kvcm-token" class="level3 page-columns page-full" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="sec-initialisation-of-the-kvcm-token"><span class="header-section-number">2.6</span> Initialisation of the kVCM Token</h3>
<p>The Klima Protocol has approximately <strong>20 million tonnes</strong> of carbon credits in its treasury as assets, a part of which will be used to create the initial issuance of <strong>kVCM</strong> tokens upon launch of Klima&nbsp;2.0.</p>
<div id="tbl-token-summary" class="column-body-outset quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[10,15,75]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-token-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Token</th>
<th style="text-align: left;">Amount</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>kVCM</strong><br>
<strong>A</strong> Token</td>
<td style="text-align: left;">20 million</td>
<td style="text-align: left;"><ul>
<li>Supply expands and contracts perpetually.</li>
<li>87.5% of initial supply available to existing KLIMA holders.</li>
<li>Initially created approximately on a 1:1 basis with carbon tonnes held.</li>
<li>Issues on carbon received, and burns on barbon retired.</li>
</ul></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>K2</strong><br>
<strong>G</strong> Token</td>
<td style="text-align: left;">100 million</td>
<td style="text-align: left;"><ul>
<li>Fixed supply.</li>
<li>40% put into programmatic issuance as <strong>K2</strong> Incentives yield over time.</li>
<li>40% for existing KLIMA holders.</li>
</ul></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-token-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Token Summary
</figcaption>
</figure>
</div>
</section>
<section id="sec-end-users" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="sec-end-users"><span class="header-section-number">2.7</span> End Users</h3>
<ol type="1">
<li><p><strong>Carbon Credit Sellers</strong></p>
<p>Those wishing to monetise spot- or forward-delivery classes of carbon.</p>
<p><em><strong>Portfolio Manager</strong>: Continuously acquires carbon credits using an autonomous pricing strategy based on carbon class, delivery and token balances, issuing new <strong>kVCM</strong> tokens as consideration to build the carbon portfolio.</em></p></li>
<li><p><strong>Offset Buyers</strong></p>
<p>Those wishing to obtain carbon offset certificates by retiring carbon credits from the portfolio.</p>
<p><em><strong>Portfolio Manager</strong>: Continuously sells carbon offset certificates, by burning <strong>kVCM</strong> tokens and issuing carbon offset certificates by retiring the quantity in the registry.</em></p></li>
<li><p><strong>Investors</strong></p>
<p>Those who wish to own a liquid or yielding locked fixed-maturity financial exposure to a basket of carbon assets.</p>
<p><em><strong>Time-Locked Market</strong>: Provides a daily time-based yield for those time-locking <strong>kVCM</strong> tokens called Base Accrual.</em></p></li>
<li><p><strong>Liquidity Providers</strong></p>
<p>Those who wish to generate liquidity fees on their portfolio of Klima&nbsp;2.0 assets coupled together or with USDC.</p>
<p><em><strong>Liquidity Market</strong>: Staked liquidity providers are incentivised by the <strong>kVCM</strong> Risk Premium calculated from system metrics to compensate them for risk.</em></p></li>
<li><p><strong>Active Portfolio Optimisation</strong></p>
<p><em><strong>K2 and kVCM asset selection</strong>: The incentives and allocations are designed for those who wish to participate in overall risk management to collectively resolve for the optimal portfolio risks.</em></p></li>
</ol>
</section>
<section id="sec-automated-asset-manager-highlights" class="level3" data-number="2.8">
<h3 data-number="2.8" class="anchored" data-anchor-id="sec-automated-asset-manager-highlights"><span class="header-section-number">2.8</span> Automated Asset Manager Highlights</h3>
<ul>
<li><p><strong>Decentralised architecture</strong>:</p>
<p>The Automated Asset Manager is smart-contract based, fully autonomous as to pricing and distribution of its assets with governance power held by risk-based capital.</p></li>
<li><p><strong>Adverse selection</strong>:</p>
<p>The Automated Asset Manager does not permit the direct purchase of carbon credits from its portfolio&nbsp;(only carbon offset certificates).</p></li>
<li><p><strong>Liquid carbon</strong>:</p>
<p>Users with liquid carbon credits can always access carbon offset certificates through the registry, hold the specific carbon credits or sell back to the Automated Asset Manager if required. Secondary markets and utility for liquid carbon credits may emerge over time.</p></li>
<li><p><strong>Implied spreads</strong>:</p>
<p>The Automated Asset Manager purchases carbon at relative discounts based on capacity pricing and forward discount rates folding natural returns into the portfolio capital.</p></li>
<li><p><strong>Dual token structure</strong>:</p>
<p>Whilst the <strong>kVCM</strong> token reflects asset economics, the <strong>K2</strong> token is essential for optimising pricing capacity and in return <strong>maximising risk-adjusted spreads</strong> for the portfolio. Since its earnings power is a function of the <strong>kVCM</strong> token value, its role as this spread optimiser is truly economically aligned and as such fundamental values of <strong>kVCM</strong> and <strong>K2</strong> are highly correlated.</p></li>
</ul>
</section>
</section>
<section id="sec-core-economic-pillars" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="sec-core-economic-pillars"><span class="header-section-number">3</span> Core Economic Pillars</h2>
<p>From this Section, we refer to <strong>kVCM</strong> and <strong>K2</strong> tokens as <strong>A</strong> and <strong>G</strong> respectively.</p>
<p>The three tenets of Klima&nbsp;2.0 enable the model to find equilibrium through continuous dynamic feedback loops and system balances. There is no oversight or centralised management entity with discretionary powers.</p>
<ol type="1">
<li><p><strong>Time-Locked Market</strong>: <strong>A</strong> token holders stake tokens until a set expiry to create floating yield time locks and have the ability to select carbon classes for portfolio weighting.</p>
<ul>
<li><p>The collective temporal staking pattern produces a <strong>Synthetic Yield</strong> curve in <strong>A</strong> tokens to reward time-locked token holders, as well as price the forward curve for the AAM.</p></li>
<li><p>Only <strong>A</strong> tokens participate in the Time-Locked Market.</p></li>
</ul></li>
<li><p><strong>Portfolio Manager</strong>: The Portfolio Manager swaps its own token <strong>A</strong> for carbon credits <strong>C</strong>&nbsp;(in) or carbon offset certificates <strong>C*</strong>&nbsp;(out) to build a portfolio of carbon credits.</p>
<ul>
<li><p>Both <strong>time-locked</strong> <strong>A</strong> and <strong>user-locked</strong> <strong>G</strong> are used in the portfolio manager whereby allocating <strong>A</strong> determines the pricing of any given carbon class, and allocating <strong>G</strong> determines the rate of acquisition&nbsp;(and disposal).</p>
<p><em>Only time-locked <strong>A</strong> tokens can participate in portfolio weighting although it is not mandatory.</em></p></li>
<li><p>Forward-delivery carbon&nbsp;(for a set of fixed dates out to 10 years) is transacted simultaneously with spot liquid carbon.</p></li>
</ul></li>
<li><p><strong>Liquidity Market</strong>: Here the tokens are traded in two core liquidity pairs with various incentives available to staked liquidity providers&nbsp;(<strong>LPs</strong>), including a <strong>Risk Premium</strong> generated by the Time-Locked Market synthetic yield.</p>
<ul>
<li><p><span class="overline"><strong>AG</strong></span>: Native token swap <strong>A</strong> and <strong>G</strong>.</p></li>
<li><p><span class="overline"><strong>AQ</strong></span>: The asset token <strong>A</strong> with USDC <strong>Q</strong>.</p></li>
</ul>
<p>The Liquidity Market provides the complementary facility to the Time-Locked Market and the critical relationship between the native tokens and the hard currency of USDC.</p></li>
</ol>
<p>The Klima&nbsp;2.0 system enables each participant in the various economic pillars to act in the interests of their own capital and utility, which through the harmonic model, enables price discovery, liquidity and stability for carbon trading which creates positive reinforcement cycles as catalysts for growth and scale.</p>
<section id="sec-time-locked-market" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="sec-time-locked-market"><span class="header-section-number">3.1</span> Time-Locked Market</h3>
<p>Holders of <strong>A</strong> can time-lock their token until a maturity from the set of <strong>standard maturities</strong>. Time locks expire every 90 days on a rolling basis. There are always 40 maturities extending out to approximately 10 years.</p>
<ul>
<li><p><strong>Forward curve</strong>: Aggregate time-locking determines the shape of the discount curve of the <strong>A</strong> token with regards to its purchasing rate of forward-delivery carbon.</p></li>
<li><p><strong>Synthetic yield</strong>: Time-locked <strong>A</strong> token holders receive a floating yield of new <strong>A</strong> tokens following the shape of this discount curve called <strong>Base Accrual</strong>. Base Accrual is calculated daily and accumulates to the principal.</p></li>
<li><p><strong>Liquidity</strong>: There is no early unlocking; all principal and accumulated yield is released only at time lock expiration.</p></li>
</ul>
<p><strong>G</strong> tokens are <u>not</u> involved in the Time-Locked Market. The forward curve is agnostic to carbon class although only time-locked <strong>A</strong> token holders can allocate their token to carbon classes for portfolio pricing.</p>
<section id="sec-synthetic-yield-and-forward-delivery-curve" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="sec-synthetic-yield-and-forward-delivery-curve"><span class="header-section-number">3.1.1</span> Synthetic Yield and Forward-Delivery Curve</h4>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">S</span>: Total time-locked <strong>A</strong> tokens expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
<li><p><span class="math inline">S_t</span>: Total <strong>A</strong> tokens time-locked in maturity bucket <span class="math inline">t</span>, expressed as a proportion of the outstanding supply of <strong>A</strong>, where <span class="math inline">{\sum S_t = S}</span>, and <span class="math inline">t</span> is the index of standard maturities <span class="math inline">t \in \{1, 2, 3, \dots, 40\}</span>.</p></li>
<li><p><span class="math inline">E_t</span>: Time to expiry expressed in years.</p></li>
</ul>
<p>Calculating curve parameters <span class="math inline">D</span> and <span class="math inline">C</span>:</p>
<p><span id="eq-curve-parameter-d"><span class="math display">
D = \frac{1}{S} \sum_{t=1}^{40} S_t \, E_t
\tag{1}</span></span></p>
<p><span id="eq-curve-parameter-c"><span class="math display">
C = \frac{1}{S} \sum_{t=1}^{40} S_t \, E_t^2
\tag{2}</span></span></p>
<p>The shape of the synthetic yield curve is produced:</p>
<p><span id="eq-yield-curve-shape"><span class="math display">
\gamma_t = \max \left( \frac{E_t}{D} - \frac{E_t^2}{2 \, C}, \, 0 \right)
\tag{3}</span></span></p>
<p>Normalising <span class="math inline">\gamma_t</span> to <span class="math inline">\hat \gamma_t</span>:</p>
<p><span id="eq-yield-curve-shape-normalised"><span class="math display">
\hat \gamma_t = \frac{\gamma_t}{\sum_{t=1}^{40} \gamma_t}
\tag{4}</span></span></p>
<p>With the cumulative sum of the normalised values expressed as <span class="math inline">\Gamma_t</span>:</p>
<p><span id="eq-yield-curve-shape-normalized-sum"><span class="math display">
\Gamma_t = \sum_{i=1}^t \hat \gamma_i \quad \text{for } t = 1, \dots, 40
\tag{5}</span></span></p>
<p>The zero-coupon yield curve <span class="math inline">Z_t</span> is solved:</p>
<p><span id="eq-yield-curve"><span class="math display">
Z_t = (1 - S) \, \frac{\Gamma_t}{E_t}
\tag{6}</span></span></p>
<p>Whereupon, the discount rate <span class="math inline">B_t</span> that forms the forward-delivery curve is derived:</p>
<p><span id="eq-discount-rate"><span class="math display">
B_t = \exp(-Z_t \, E_t)
\tag{7}</span></span></p>
<p>The yield due on time-locked <strong>A</strong> tokens is calculated daily and added to the staked principal, hence the daily yield for each time bucket is calculated:</p>
<p><span id="eq-daily-yield"><span class="math display">
Y_t = \exp \left( \frac{Z_t}{365} \right) - 1
\tag{8}</span></span></p>
<p>Hence, any time-locked <strong>A</strong> stake <span class="math inline">S_t</span> will increase by <span class="math inline">\Delta S_t</span>:</p>
<p><span id="eq-base-accrual"><span class="math display">
\Delta S_t = S_t \, Y_t
\tag{9}</span></span></p>
<p>With the total <strong>A</strong> tokens created on a daily basis for time-locked inflation as</p>
<p><span id="eq-inflation"><span class="math display">
R = \sum_{t=1}^{40} \Delta S_t
\tag{10}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="681" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 680;"><span id="cb1-681"><a href="#cb1-681" aria-hidden="true" tabindex="-1"></a>viewof inputS <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-4</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb1-682"><a href="#cb1-682" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Time-Locked } S`</span><span class="op">,</span></span>
<span id="cb1-683"><a href="#cb1-683" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-4</span><span class="op">,</span></span>
<span id="cb1-684"><a href="#cb1-684" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.55</span><span class="op">,</span></span>
<span id="cb1-685"><a href="#cb1-685" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-686"><a href="#cb1-686" aria-hidden="true" tabindex="-1"></a>viewof inputD <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.25</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {</span>
<span id="cb1-687"><a href="#cb1-687" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Parameter } D`</span><span class="op">,</span></span>
<span id="cb1-688"><a href="#cb1-688" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb1-689"><a href="#cb1-689" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">4.69</span><span class="op">,</span></span>
<span id="cb1-690"><a href="#cb1-690" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-time-locked-market-state" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-time-locked-market-state-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="701" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 700;"><span id="cb2-701"><a href="#cb2-701" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">constAreaLinear</span>(range<span class="op">,</span> area<span class="op">,</span> inputSlope<span class="op">,</span> slopeFactor <span class="op">=</span> <span class="fl">0.007</span>) {</span>
<span id="cb2-702"><a href="#cb2-702" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (range<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb2-703"><a href="#cb2-703" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [area]<span class="op">;</span></span>
<span id="cb2-704"><a href="#cb2-704" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-705"><a href="#cb2-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-706"><a href="#cb2-706" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-707"><a href="#cb2-707" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y2 <span class="op">=</span> range<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-708"><a href="#cb2-708" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> slope <span class="op">=</span> slopeFactor <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atanh</span>(inputSlope)<span class="op">;</span></span>
<span id="cb2-709"><a href="#cb2-709" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> intercept <span class="op">=</span> area <span class="op">/</span> range<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb2-710"><a href="#cb2-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-711"><a href="#cb2-711" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(slope) <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">*</span> intercept <span class="op">/</span> (y2 <span class="op">-</span> y1 <span class="op">-</span> <span class="dv">1</span>)) {</span>
<span id="cb2-712"><a href="#cb2-712" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yExactShift <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="dv">2</span> <span class="op">*</span> area <span class="op">/</span> slope))<span class="op">;</span></span>
<span id="cb2-713"><a href="#cb2-713" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yRoundShift <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(yExactShift))<span class="op">;</span></span>
<span id="cb2-714"><a href="#cb2-714" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (slope <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-715"><a href="#cb2-715" aria-hidden="true" tabindex="-1"></a>      y1 <span class="op">=</span> y2 <span class="op">-</span> yRoundShift<span class="op">;</span></span>
<span id="cb2-716"><a href="#cb2-716" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-717"><a href="#cb2-717" aria-hidden="true" tabindex="-1"></a>      y2 <span class="op">=</span> y1 <span class="op">+</span> yRoundShift<span class="op">;</span></span>
<span id="cb2-718"><a href="#cb2-718" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-719"><a href="#cb2-719" aria-hidden="true" tabindex="-1"></a>    slope <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(slope) <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> area <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>((y2 <span class="op">-</span> y1)<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-720"><a href="#cb2-720" aria-hidden="true" tabindex="-1"></a>    intercept <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(slope) <span class="op">*</span> (y2 <span class="op">-</span> y1 <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-721"><a href="#cb2-721" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-722"><a href="#cb2-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-723"><a href="#cb2-723" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yConstArea <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-724"><a href="#cb2-724" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> range<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-725"><a href="#cb2-725" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> i <span class="op">-</span> (y1 <span class="op">+</span> y2) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-726"><a href="#cb2-726" aria-hidden="true" tabindex="-1"></a>    yConstArea<span class="op">.</span><span class="fu">push</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> slope <span class="op">*</span> y <span class="op">+</span> intercept))<span class="op">;</span></span>
<span id="cb2-727"><a href="#cb2-727" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-728"><a href="#cb2-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-729"><a href="#cb2-729" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> yConstArea<span class="op">;</span></span>
<span id="cb2-730"><a href="#cb2-730" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="735" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 734;"><span id="cb3-735"><a href="#cb3-735" aria-hidden="true" tabindex="-1"></a>vecE <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.1</span><span class="op">,</span> <span class="fl">0.25</span>)<span class="op">;</span></span>
<span id="cb3-736"><a href="#cb3-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-737"><a href="#cb3-737" aria-hidden="true" tabindex="-1"></a>scaleE <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(d3<span class="op">.</span><span class="fu">extent</span>(vecE)<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb3-738"><a href="#cb3-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-739"><a href="#cb3-739" aria-hidden="true" tabindex="-1"></a>vecS <span class="op">=</span> <span class="fu">constAreaLinear</span>(vecE<span class="op">,</span> <span class="fl">0.55</span><span class="op">,</span> <span class="fu">scaleE</span>(inputD))<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb3-740"><a href="#cb3-740" aria-hidden="true" tabindex="-1"></a>  x <span class="kw">=&gt;</span> x <span class="op">*</span> inputS <span class="op">/</span> <span class="fl">0.55</span><span class="op">,</span></span>
<span id="cb3-741"><a href="#cb3-741" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb3-742"><a href="#cb3-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-743"><a href="#cb3-743" aria-hidden="true" tabindex="-1"></a>vecReverseCumsumS <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecS<span class="op">.</span><span class="fu">slice</span>()<span class="op">.</span><span class="fu">reverse</span>())<span class="op">.</span><span class="fu">reverse</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="747" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 746;"><span id="cb4-747"><a href="#cb4-747" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dotProduct</span>(v<span class="op">,</span> w) {</span>
<span id="cb4-748"><a href="#cb4-748" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (v<span class="op">.</span><span class="at">length</span> <span class="op">!==</span> w<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb4-749"><a href="#cb4-749" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"Vectors must have the same length"</span>)<span class="op">;</span></span>
<span id="cb4-750"><a href="#cb4-750" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-751"><a href="#cb4-751" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> val<span class="op">,</span> i) <span class="kw">=&gt;</span> acc <span class="op">+</span> val <span class="op">*</span> w[i]<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb4-752"><a href="#cb4-752" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-753"><a href="#cb4-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-754"><a href="#cb4-754" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">weightedArithmeticMean</span>(v<span class="op">,</span> weights) {</span>
<span id="cb4-755"><a href="#cb4-755" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">dotProduct</span>(v<span class="op">,</span> weights) <span class="op">/</span> d3<span class="op">.</span><span class="fu">sum</span>(weights)<span class="op">;</span></span>
<span id="cb4-756"><a href="#cb4-756" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="759" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 758;"><span id="cb5-759"><a href="#cb5-759" aria-hidden="true" tabindex="-1"></a>paramD <span class="op">=</span> <span class="fu">weightedArithmeticMean</span>(vecE<span class="op">,</span> vecS)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="763" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 762;"><span id="cb6-763"><a href="#cb6-763" aria-hidden="true" tabindex="-1"></a>paramC <span class="op">=</span> <span class="fu">weightedArithmeticMean</span>(vecE<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> e <span class="op">*</span> e)<span class="op">,</span> vecS)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="767" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 766;"><span id="cb7-767"><a href="#cb7-767" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeGamma</span>(vecE<span class="op">,</span> paramD<span class="op">,</span> paramC) {</span>
<span id="cb7-768"><a href="#cb7-768" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> twoC <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> paramC<span class="op">;</span></span>
<span id="cb7-769"><a href="#cb7-769" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecE<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> e<span class="op">/</span>paramD <span class="op">-</span> e<span class="op">*</span>e<span class="op">/</span>twoC))<span class="op">;</span></span>
<span id="cb7-770"><a href="#cb7-770" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="774" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 773;"><span id="cb8-774"><a href="#cb8-774" aria-hidden="true" tabindex="-1"></a>vecGamma <span class="op">=</span> <span class="fu">computeGamma</span>(vecE<span class="op">,</span> paramD<span class="op">,</span> paramC)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="778" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 777;"><span id="cb9-778"><a href="#cb9-778" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">normalize</span>(v) {</span>
<span id="cb9-779"><a href="#cb9-779" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sum <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(v)<span class="op">;</span></span>
<span id="cb9-780"><a href="#cb9-780" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">.</span><span class="fu">map</span>(val <span class="kw">=&gt;</span> val <span class="op">/</span> sum)<span class="op">;</span></span>
<span id="cb9-781"><a href="#cb9-781" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="785" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 784;"><span id="cb10-785"><a href="#cb10-785" aria-hidden="true" tabindex="-1"></a>vecNormGamma <span class="op">=</span> <span class="fu">normalize</span>(vecGamma)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="789" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 788;"><span id="cb11-789"><a href="#cb11-789" aria-hidden="true" tabindex="-1"></a>vecCumSumGamma <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecNormGamma)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="793" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 792;"><span id="cb12-793"><a href="#cb12-793" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeZ</span>(paramS<span class="op">,</span> vecCumSumGamma<span class="op">,</span> vecE) {</span>
<span id="cb12-794"><a href="#cb12-794" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecCumSumGamma<span class="op">.</span><span class="fu">map</span>((g<span class="op">,</span> t) <span class="kw">=&gt;</span> (<span class="dv">1</span> <span class="op">-</span> paramS) <span class="op">*</span> g <span class="op">/</span> vecE[t])<span class="op">;</span></span>
<span id="cb12-795"><a href="#cb12-795" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="799" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 798;"><span id="cb13-799"><a href="#cb13-799" aria-hidden="true" tabindex="-1"></a>vecZ <span class="op">=</span> <span class="fu">computeZ</span>(inputS<span class="op">,</span> vecCumSumGamma<span class="op">,</span> vecE)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="803" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 802;"><span id="cb14-803"><a href="#cb14-803" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeB</span>(vecZ<span class="op">,</span> vecE) {</span>
<span id="cb14-804"><a href="#cb14-804" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecZ<span class="op">.</span><span class="fu">map</span>((z<span class="op">,</span> t) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>z <span class="op">*</span> vecE[t]))<span class="op">;</span></span>
<span id="cb14-805"><a href="#cb14-805" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="809" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 808;"><span id="cb15-809"><a href="#cb15-809" aria-hidden="true" tabindex="-1"></a>vecB <span class="op">=</span> <span class="fu">computeB</span>(vecZ<span class="op">,</span> vecE)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="813" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 812;"><span id="cb16-813"><a href="#cb16-813" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeY</span>(vecZ) {</span>
<span id="cb16-814"><a href="#cb16-814" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecZ<span class="op">.</span><span class="fu">map</span>(z <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>(z))<span class="op">;</span></span>
<span id="cb16-815"><a href="#cb16-815" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="819" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 818;"><span id="cb17-819"><a href="#cb17-819" aria-hidden="true" tabindex="-1"></a>vecY <span class="op">=</span> <span class="fu">computeY</span>(vecZ)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="823" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 822;"><span id="cb18-823"><a href="#cb18-823" aria-hidden="true" tabindex="-1"></a>paramI <span class="op">=</span> <span class="fu">dotProduct</span>(vecS<span class="op">,</span> vecY)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="828" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 827;"><span id="cb19-828"><a href="#cb19-828" aria-hidden="true" tabindex="-1"></a>yieldData <span class="op">=</span> {</span>
<span id="cb19-829"><a href="#cb19-829" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> yieldData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb19-830"><a href="#cb19-830" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb19-831"><a href="#cb19-831" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-832"><a href="#cb19-832" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Stake A"</span><span class="op">,</span></span>
<span id="cb19-833"><a href="#cb19-833" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecS<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb19-834"><a href="#cb19-834" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-835"><a href="#cb19-835" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-836"><a href="#cb19-836" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-837"><a href="#cb19-837" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Yield Term Structure"</span><span class="op">,</span></span>
<span id="cb19-838"><a href="#cb19-838" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecZ[t]<span class="op">,</span></span>
<span id="cb19-839"><a href="#cb19-839" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-840"><a href="#cb19-840" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-841"><a href="#cb19-841" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-842"><a href="#cb19-842" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Real Yield"</span><span class="op">,</span></span>
<span id="cb19-843"><a href="#cb19-843" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> (vecZ[t] <span class="op">-</span> paramI)<span class="op">,</span></span>
<span id="cb19-844"><a href="#cb19-844" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-845"><a href="#cb19-845" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-846"><a href="#cb19-846" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-847"><a href="#cb19-847" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb19-848"><a href="#cb19-848" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb19-849"><a href="#cb19-849" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-850"><a href="#cb19-850" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-851"><a href="#cb19-851" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-852"><a href="#cb19-852" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Cumulative Stake A"</span><span class="op">,</span></span>
<span id="cb19-853"><a href="#cb19-853" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecReverseCumsumS[t <span class="op">-</span> <span class="dv">3</span>]<span class="op">,</span></span>
<span id="cb19-854"><a href="#cb19-854" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-855"><a href="#cb19-855" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-856"><a href="#cb19-856" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb19-857"><a href="#cb19-857" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> yieldData<span class="op">;</span></span>
<span id="cb19-858"><a href="#cb19-858" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb19-859"><a href="#cb19-859" aria-hidden="true" tabindex="-1"></a>getStake <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Stake A"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-860"><a href="#cb19-860" aria-hidden="true" tabindex="-1"></a>getYieldTerm <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Yield Term Structure"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-861"><a href="#cb19-861" aria-hidden="true" tabindex="-1"></a>getRealYield <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Real Yield"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-862"><a href="#cb19-862" aria-hidden="true" tabindex="-1"></a>getDiscount <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Discount Curve"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-863"><a href="#cb19-863" aria-hidden="true" tabindex="-1"></a>getCumStake <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Cumulative Stake A"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-864"><a href="#cb19-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-865"><a href="#cb19-865" aria-hidden="true" tabindex="-1"></a>stringS <span class="op">=</span> <span class="st">"Total Stake = "</span> <span class="op">+</span> inputS<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-866"><a href="#cb19-866" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-867"><a href="#cb19-867" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-868"><a href="#cb19-868" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb19-869"><a href="#cb19-869" aria-hidden="true" tabindex="-1"></a>stringI <span class="op">=</span> <span class="st">"Inflation = "</span> <span class="op">+</span> paramI<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-870"><a href="#cb19-870" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-871"><a href="#cb19-871" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-872"><a href="#cb19-872" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb19-873"><a href="#cb19-873" aria-hidden="true" tabindex="-1"></a>stringD <span class="op">=</span> <span class="vs">`D = </span><span class="sc">${</span>paramD<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-874"><a href="#cb19-874" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-875"><a href="#cb19-875" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-876"><a href="#cb19-876" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> years`</span><span class="op">;</span></span>
<span id="cb19-877"><a href="#cb19-877" aria-hidden="true" tabindex="-1"></a>stringC <span class="op">=</span> <span class="vs">`√C = </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(paramC)<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-878"><a href="#cb19-878" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-879"><a href="#cb19-879" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-880"><a href="#cb19-880" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> years`</span><span class="op">;</span></span>
<span id="cb19-881"><a href="#cb19-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-882"><a href="#cb19-882" aria-hidden="true" tabindex="-1"></a>yieldParams <span class="op">=</span> [</span>
<span id="cb19-883"><a href="#cb19-883" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringD<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> paramD }<span class="op">,</span></span>
<span id="cb19-884"><a href="#cb19-884" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringC<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(paramC) }<span class="op">,</span></span>
<span id="cb19-885"><a href="#cb19-885" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="889" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 888;"><span id="cb20-889"><a href="#cb20-889" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb20-890"><a href="#cb20-890" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb20-891"><a href="#cb20-891" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-892"><a href="#cb20-892" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span></span>
<span id="cb20-893"><a href="#cb20-893" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Stake A"</span><span class="op">,</span> <span class="st">"Yield Term Structure"</span><span class="op">,</span> <span class="st">"Real Yield"</span><span class="op">,</span> stringD<span class="op">,</span> stringC]<span class="op">,</span></span>
<span id="cb20-894"><a href="#cb20-894" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-895"><a href="#cb20-895" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb20-896"><a href="#cb20-896" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">,</span></span>
<span id="cb20-897"><a href="#cb20-897" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.45</span>]<span class="op">,</span></span>
<span id="cb20-898"><a href="#cb20-898" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span><span class="op">,</span></span>
<span id="cb20-899"><a href="#cb20-899" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-900"><a href="#cb20-900" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb20-901"><a href="#cb20-901" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb20-902"><a href="#cb20-902" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span></span>
<span id="cb20-903"><a href="#cb20-903" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(yieldData<span class="op">,</span> getStake)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(yieldData<span class="op">,</span> getYieldTerm))<span class="op">,</span></span>
<span id="cb20-904"><a href="#cb20-904" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb20-905"><a href="#cb20-905" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-906"><a href="#cb20-906" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-907"><a href="#cb20-907" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb20-908"><a href="#cb20-908" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb20-909"><a href="#cb20-909" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb20-910"><a href="#cb20-910" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-911"><a href="#cb20-911" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb20-912"><a href="#cb20-912" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb20-913"><a href="#cb20-913" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake A by Maturity (%)"</span> })<span class="op">,</span></span>
<span id="cb20-914"><a href="#cb20-914" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Yield Rates (%)"</span> })<span class="op">,</span></span>
<span id="cb20-915"><a href="#cb20-915" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(yieldData<span class="op">,</span> {</span>
<span id="cb20-916"><a href="#cb20-916" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb20-917"><a href="#cb20-917" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb20-918"><a href="#cb20-918" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getStake<span class="op">,</span></span>
<span id="cb20-919"><a href="#cb20-919" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb20-920"><a href="#cb20-920" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-921"><a href="#cb20-921" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(yieldParams<span class="op">,</span> {</span>
<span id="cb20-922"><a href="#cb20-922" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span></span>
<span id="cb20-923"><a href="#cb20-923" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb20-924"><a href="#cb20-924" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb20-925"><a href="#cb20-925" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb20-926"><a href="#cb20-926" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-927"><a href="#cb20-927" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getYieldTerm<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-928"><a href="#cb20-928" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getYieldTerm<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-929"><a href="#cb20-929" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getRealYield<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-930"><a href="#cb20-930" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getRealYield<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-931"><a href="#cb20-931" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb20-932"><a href="#cb20-932" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-20" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-20" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Yield <span>(<span id="ojs-element-id-1"></span>,</span> <span><span id="ojs-element-id-2"></span>).</span>
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="937" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 936;"><span id="cb21-937"><a href="#cb21-937" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb21-938"><a href="#cb21-938" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb21-939"><a href="#cb21-939" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-940"><a href="#cb21-940" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">8</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb21-941"><a href="#cb21-941" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Cumulative Stake A"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringD<span class="op">,</span> stringC]<span class="op">,</span></span>
<span id="cb21-942"><a href="#cb21-942" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-943"><a href="#cb21-943" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb21-944"><a href="#cb21-944" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">,</span></span>
<span id="cb21-945"><a href="#cb21-945" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.45</span>]<span class="op">,</span></span>
<span id="cb21-946"><a href="#cb21-946" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span></span>
<span id="cb21-947"><a href="#cb21-947" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-948"><a href="#cb21-948" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb21-949"><a href="#cb21-949" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-950"><a href="#cb21-950" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb21-951"><a href="#cb21-951" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb21-952"><a href="#cb21-952" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb21-953"><a href="#cb21-953" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb21-954"><a href="#cb21-954" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb21-955"><a href="#cb21-955" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Cumulative Stake (%)"</span> })<span class="op">,</span></span>
<span id="cb21-956"><a href="#cb21-956" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb21-957"><a href="#cb21-957" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(yieldData<span class="op">,</span> {</span>
<span id="cb21-958"><a href="#cb21-958" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb21-959"><a href="#cb21-959" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb21-960"><a href="#cb21-960" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCumStake<span class="op">,</span></span>
<span id="cb21-961"><a href="#cb21-961" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb21-962"><a href="#cb21-962" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb21-963"><a href="#cb21-963" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(yieldParams<span class="op">,</span> {</span>
<span id="cb21-964"><a href="#cb21-964" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span></span>
<span id="cb21-965"><a href="#cb21-965" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb21-966"><a href="#cb21-966" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb21-967"><a href="#cb21-967" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb21-968"><a href="#cb21-968" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb21-969"><a href="#cb21-969" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb21-970"><a href="#cb21-970" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb21-971"><a href="#cb21-971" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb21-972"><a href="#cb21-972" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-21" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-21" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Discount rate.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-time-locked-market-state-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Example of a Time-Locked Market state.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>For visualising the sensitivity of overall <strong>A</strong> inflation rates with respect to staking and duration, <a href="#fig-inflation-rate" class="quarto-xref">Figure&nbsp;8</a> assumes a single maturity over the staking range to provide an approximation of inflation <span class="math inline">\Delta S \approx Z \, S</span>.</p>
<div id="fig-inflation-rate" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A inflation rate from time-locked token yields Delta S.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-inflation-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="1001" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1000;"><span id="cb22-1001"><a href="#cb22-1001" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">contrastingTextColor</span>(backgroundColor) {</span>
<span id="cb22-1002"><a href="#cb22-1002" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d3<span class="op">.</span><span class="fu">hsl</span>(backgroundColor)<span class="op">.</span><span class="at">l</span> <span class="op">&lt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb22-1003"><a href="#cb22-1003" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"white"</span><span class="op">;</span></span>
<span id="cb22-1004"><a href="#cb22-1004" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-1005"><a href="#cb22-1005" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb22-1006"><a href="#cb22-1006" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-1007"><a href="#cb22-1007" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="1011" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1010;"><span id="cb23-1011"><a href="#cb23-1011" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeApproxDeltaA</span>(paramS<span class="op">,</span> paramE) {</span>
<span id="cb23-1012"><a href="#cb23-1012" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> paramS <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> paramS) <span class="op">/</span> paramE<span class="op">;</span></span>
<span id="cb23-1013"><a href="#cb23-1013" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="1017" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1016;"><span id="cb24-1017"><a href="#cb24-1017" aria-hidden="true" tabindex="-1"></a>inflationData <span class="op">=</span> {</span>
<span id="cb24-1018"><a href="#cb24-1018" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inflationData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb24-1019"><a href="#cb24-1019" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramS <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramS <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramS <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb24-1020"><a href="#cb24-1020" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramE <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> paramE <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">;</span> paramE<span class="op">++</span>) {</span>
<span id="cb24-1021"><a href="#cb24-1021" aria-hidden="true" tabindex="-1"></a>      inflationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb24-1022"><a href="#cb24-1022" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb24-1023"><a href="#cb24-1023" aria-hidden="true" tabindex="-1"></a>        <span class="dt">e</span><span class="op">:</span> paramE<span class="op">,</span></span>
<span id="cb24-1024"><a href="#cb24-1024" aria-hidden="true" tabindex="-1"></a>        <span class="dt">s</span><span class="op">:</span> paramS<span class="op">,</span></span>
<span id="cb24-1025"><a href="#cb24-1025" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeApproxDeltaA</span>(paramS<span class="op">,</span> paramE)<span class="op">,</span></span>
<span id="cb24-1026"><a href="#cb24-1026" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb24-1027"><a href="#cb24-1027" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-1028"><a href="#cb24-1028" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-1029"><a href="#cb24-1029" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> inflationData<span class="op">;</span></span>
<span id="cb24-1030"><a href="#cb24-1030" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="1034" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1033;"><span id="cb25-1034"><a href="#cb25-1034" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb25-1035"><a href="#cb25-1035" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"ΔS"</span> }<span class="op">,</span></span>
<span id="cb25-1036"><a href="#cb25-1036" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="fl">10.1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">10.5</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Expiry Time E"</span> }<span class="op">,</span></span>
<span id="cb25-1037"><a href="#cb25-1037" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Staking S"</span> }<span class="op">,</span></span>
<span id="cb25-1038"><a href="#cb25-1038" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb25-1039"><a href="#cb25-1039" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb25-1040"><a href="#cb25-1040" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(inflationData<span class="op">,</span> {</span>
<span id="cb25-1041"><a href="#cb25-1041" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">e</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-1042"><a href="#cb25-1042" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">e</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-1043"><a href="#cb25-1043" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb25-1044"><a href="#cb25-1044" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb25-1045"><a href="#cb25-1045" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb25-1046"><a href="#cb25-1046" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-1047"><a href="#cb25-1047" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(inflationData<span class="op">,</span> {</span>
<span id="cb25-1048"><a href="#cb25-1048" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"e"</span><span class="op">,</span></span>
<span id="cb25-1049"><a href="#cb25-1049" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"s"</span><span class="op">,</span></span>
<span id="cb25-1050"><a href="#cb25-1050" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb25-1051"><a href="#cb25-1051" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb25-1052"><a href="#cb25-1052" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb25-1053"><a href="#cb25-1053" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb25-1054"><a href="#cb25-1054" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb25-1055"><a href="#cb25-1055" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb25-1056"><a href="#cb25-1056" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeApproxDeltaA</span>(<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span></span>
<span id="cb25-1057"><a href="#cb25-1057" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb25-1058"><a href="#cb25-1058" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb25-1059"><a href="#cb25-1059" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb25-1060"><a href="#cb25-1060" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-1061"><a href="#cb25-1061" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb25-1062"><a href="#cb25-1062" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-25" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inflation-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: <strong>A</strong> inflation rate from time-locked token yields <span class="math inline">\Delta S</span>.
</figcaption>
</figure>
</div>
</section>
<section id="sec-governance-weightings" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="sec-governance-weightings"><span class="header-section-number">3.1.2</span> Governance Weightings</h4>
<p>Governance rights, for example the whitelisting&nbsp;(and blacklisting) of carbon classes, and any other matter requiring token stakeholder voting, are allocated to two cohorts:</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong> tokens: <span class="math inline">S_t</span></p></li>
<li><p>Staked liquidity in the <strong>A</strong>-<strong>G</strong> pair <span class="overline"><strong>AG</strong></span>&nbsp;(see <a href="#sec-liquidity-markets" class="quarto-xref">Section&nbsp;3.3</a>), defined here as <span class="math inline">A_{Gt}</span>, representing the quantity of <strong>A</strong> tokens held in the liquidity pool expressed as a proportion of circulating supply.</p></li>
</ol>
<p>Voting power is allocated by time and applied to the respective balance of <strong>A</strong>:</p>
<ol type="1">
<li><p>Initial voting weights for time-locked <strong>A</strong> tokens <span class="math inline">v_t</span>:</p>
<p><span id="eq-voting-weights-time-locks-initial"><span class="math display">
v_t = Z_t \, S_t
  \tag{11}</span></span></p></li>
<li><p>Initial voting weights for staked liquidity <span class="math inline">w_t</span>:</p>
<p><span id="eq-voting-weights-lps-initial"><span class="math display">
w_t = Z_t \, A_{Gt}
  \tag{12}</span></span></p></li>
<li><p>Final voting weights for time-locked <strong>A</strong> tokens <span class="math inline">V_t</span>:</p>
<p><span id="eq-voting-weights-time-locks"><span class="math display">
V_t = \frac{v_t}{\sum_{j=1}^{40} (v_j + 2 w_j)}
  \tag{13}</span></span></p></li>
<li><p>Final voting weights for staked liquidity <span class="math inline">W_t</span>:</p>
<p><span id="eq-voting-weights-lps"><span class="math display">
W_t = \frac{w_t}{\sum_{j=1}^{40} \left( \frac 1 2 v_j + w_j \right)}
  \tag{14}</span></span></p></li>
</ol>
</section>
</section>
<section id="sec-portfolio-manager-detailed" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="sec-portfolio-manager-detailed"><span class="header-section-number">3.2</span> Portfolio Manager</h3>
<p>The Portfolio Manager’s role of swapping <strong>A</strong> for carbon is managed through a set of smart contracts driven by allocation choices from the token system, the balances of assets held, and the discount rates generated by the Time-Locked Market.</p>
<p>The combined allocations of <strong>A</strong> and <strong>G</strong> tokens creates a dynamic pricing matrix by carbon class and by time, enabling spot and forward trading of carbon.</p>
<div id="fig-portfolio-manager-detailed" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 Portfolio Manager.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-portfolio-manager-detailed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/portfolio-manager-detailed.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-portfolio-manager-detailed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Klima&nbsp;2.0 Portfolio Manager.
</figcaption>
</figure>
</div>
<section id="sec-purchase-carbon" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="sec-purchase-carbon"><span class="header-section-number">3.2.1</span> Purchase Carbon</h4>
<p><em>User swaps carbon credits for <strong>A</strong> tokens.</em></p>
<section id="sec-existing-carbon-in-the-portfolio" class="level5" data-number="3.2.1.1">
<h5 data-number="3.2.1.1" class="anchored" data-anchor-id="sec-existing-carbon-in-the-portfolio"><span class="header-section-number">3.2.1.1</span> Existing Carbon in the Portfolio</h5>
<p>Carbon classes <span class="math inline">{i \in \{1, 2, 3, \dots, n\}}</span> are whitelisted through governance by time-locked <strong>A</strong> token and staked <span class="overline"><strong>AG</strong></span> liquidity providers&nbsp;(see <a href="#sec-governance-weightings" class="quarto-xref">Section&nbsp;3.1.2</a>).</p>
<p>For carbon pricing, both <strong>A</strong> tokens and <strong>G</strong> tokens may be allocated to specific carbon classes <span class="math inline">i</span> and these are independent allocations between the two-token systems.</p>
<div id="fig-token-staking-class-structure" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token staking class structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-staking-class-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-staking-class-structure.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-staking-class-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Token staking class structure.
</figcaption>
</figure>
</div>
<p>For a carbon class quantity to be sold to the Automated Asset Manager, it must have a strictly positive quantity of <strong>A</strong> tokens allocated to that carbon class, otherwise there is no price, and the carbon cannot be sold.</p>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">C_i</span>: Total tonnes of carbon class <span class="math inline">i</span> currently held in the portfolio.</p></li>
<li><p><span class="math inline">A_i</span>: <strong>A</strong> tokens allocated to carbon class <span class="math inline">i</span> expressed as a proportion of the outstanding supply of <strong>A</strong> tokens, where <span class="math inline">{\sum A_i = A}</span>.</p></li>
<li><p><span class="math inline">G_i</span>: <strong>G</strong> tokens allocated to carbon class <span class="math inline">i</span> expressed as a proportion of the outstanding supply of <strong>G</strong> Tokens.</p></li>
<li><p><span class="math inline">C_{it}</span>: The quantity of carbon class <span class="math inline">i</span> held in the Automated Asset Manager deliverable per maturity <span class="math inline">t</span> where <span class="math inline">C_{i0}</span> reflects the liquid quantity.</p></li>
</ul>
<p>In order to determine the present-value quantity of carbon, <span class="math inline">\bar C_i</span>, we apply the discount curve from <a href="#eq-discount-rate" class="quarto-xref">Equation&nbsp;7</a> to the liquidity schedule and sum the discounted holdings:</p>
<p><span id="eq-present-value-carbon"><span class="math display">
\bar C_i = C_{i0} + \sum_{t=1}^{40} B_t \, C_{it}
\tag{15}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="1198" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1197;"><span id="cb26-1198"><a href="#cb26-1198" aria-hidden="true" tabindex="-1"></a>viewof inputCi0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb26-1199"><a href="#cb26-1199" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } C_{i0}`</span><span class="op">,</span></span>
<span id="cb26-1200"><a href="#cb26-1200" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb26-1201"><a href="#cb26-1201" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb26-1202"><a href="#cb26-1202" aria-hidden="true" tabindex="-1"></a>viewof inputLiqShape <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb26-1203"><a href="#cb26-1203" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Schedule shape}`</span><span class="op">,</span></span>
<span id="cb26-1204"><a href="#cb26-1204" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb26-1205"><a href="#cb26-1205" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-26-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-26-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-held-in-the-aam" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon held in the portfolio.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-held-in-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="1217" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1216;"><span id="cb27-1217"><a href="#cb27-1217" aria-hidden="true" tabindex="-1"></a>vecCi <span class="op">=</span> <span class="fu">constAreaLinear</span>(vecE<span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> inputCi0<span class="op">,</span> inputLiqShape<span class="op">,</span> <span class="fl">0.01</span>)<span class="op">;</span></span>
<span id="cb27-1218"><a href="#cb27-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1219"><a href="#cb27-1219" aria-hidden="true" tabindex="-1"></a>paramBarCi <span class="op">=</span> inputCi0 <span class="op">+</span> <span class="fu">dotProduct</span>(vecB<span class="op">,</span> vecCi)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-27-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-27-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="1223" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1222;"><span id="cb28-1223"><a href="#cb28-1223" aria-hidden="true" tabindex="-1"></a>carbonHeldData <span class="op">=</span> {</span>
<span id="cb28-1224"><a href="#cb28-1224" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> carbonHeldData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb28-1225"><a href="#cb28-1225" aria-hidden="true" tabindex="-1"></a>  carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1226"><a href="#cb28-1226" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"Liquidity Schedule"</span><span class="op">,</span></span>
<span id="cb28-1227"><a href="#cb28-1227" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> inputCi0<span class="op">,</span></span>
<span id="cb28-1228"><a href="#cb28-1228" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb28-1229"><a href="#cb28-1229" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb28-1230"><a href="#cb28-1230" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb28-1231"><a href="#cb28-1231" aria-hidden="true" tabindex="-1"></a>    carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1232"><a href="#cb28-1232" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Liquidity Schedule"</span><span class="op">,</span></span>
<span id="cb28-1233"><a href="#cb28-1233" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecCi<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb28-1234"><a href="#cb28-1234" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb28-1235"><a href="#cb28-1235" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-1236"><a href="#cb28-1236" aria-hidden="true" tabindex="-1"></a>    carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1237"><a href="#cb28-1237" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb28-1238"><a href="#cb28-1238" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb28-1239"><a href="#cb28-1239" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb28-1240"><a href="#cb28-1240" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-1241"><a href="#cb28-1241" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-1242"><a href="#cb28-1242" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> carbonHeldData<span class="op">;</span></span>
<span id="cb28-1243"><a href="#cb28-1243" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb28-1244"><a href="#cb28-1244" aria-hidden="true" tabindex="-1"></a>getLiqSchedule <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Liquidity Schedule"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb28-1245"><a href="#cb28-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1246"><a href="#cb28-1246" aria-hidden="true" tabindex="-1"></a>stringBarCi <span class="op">=</span> <span class="vs">`Present-Value Carbon C̄ᵢ = </span><span class="sc">${</span>paramBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb28-1247"><a href="#cb28-1247" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb28-1248"><a href="#cb28-1248" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb28-1249"><a href="#cb28-1249" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb28-1250"><a href="#cb28-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1251"><a href="#cb28-1251" aria-hidden="true" tabindex="-1"></a>heldCarbonParam <span class="op">=</span> [{ <span class="dt">key</span><span class="op">:</span> stringBarCi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramBarCi }]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="1254" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1253;"><span id="cb29-1254"><a href="#cb29-1254" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb29-1255"><a href="#cb29-1255" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb29-1256"><a href="#cb29-1256" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1257"><a href="#cb29-1257" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb29-1258"><a href="#cb29-1258" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Liquidity Schedule"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringBarCi]<span class="op">,</span></span>
<span id="cb29-1259"><a href="#cb29-1259" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb29-1260"><a href="#cb29-1260" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb29-1261"><a href="#cb29-1261" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span><span class="op">,</span></span>
<span id="cb29-1262"><a href="#cb29-1262" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb29-1263"><a href="#cb29-1263" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelArrow</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1264"><a href="#cb29-1264" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb29-1265"><a href="#cb29-1265" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb29-1266"><a href="#cb29-1266" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb29-1267"><a href="#cb29-1267" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb29-1268"><a href="#cb29-1268" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb29-1269"><a href="#cb29-1269" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1270"><a href="#cb29-1270" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb29-1271"><a href="#cb29-1271" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb29-1272"><a href="#cb29-1272" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Quantity of Carbon (%)"</span> })<span class="op">,</span></span>
<span id="cb29-1273"><a href="#cb29-1273" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb29-1274"><a href="#cb29-1274" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(carbonHeldData<span class="op">,</span> {</span>
<span id="cb29-1275"><a href="#cb29-1275" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb29-1276"><a href="#cb29-1276" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb29-1277"><a href="#cb29-1277" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLiqSchedule<span class="op">,</span></span>
<span id="cb29-1278"><a href="#cb29-1278" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb29-1279"><a href="#cb29-1279" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-1280"><a href="#cb29-1280" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(heldCarbonParam<span class="op">,</span> {</span>
<span id="cb29-1281"><a href="#cb29-1281" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb29-1282"><a href="#cb29-1282" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb29-1283"><a href="#cb29-1283" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb29-1284"><a href="#cb29-1284" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb29-1285"><a href="#cb29-1285" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-1286"><a href="#cb29-1286" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(carbonHeldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb29-1287"><a href="#cb29-1287" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(carbonHeldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb29-1288"><a href="#cb29-1288" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb29-1289"><a href="#cb29-1289" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-29" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-held-in-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Carbon held in the portfolio.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Similarly, taking <span class="math inline">\Delta C_{it}</span> as the quantity of carbon <span class="math inline">i</span> to be sold with a specific maturity index <span class="math inline">t</span>:</p>
<p><span id="eq-present-value-carbon-change"><span class="math display">
\Delta \bar C_i = \Delta C_{i0} + \sum_{t=1}^{40} B_t \, \Delta C_{it}
\tag{16}</span></span></p>
<p>Once standardised by the discount curve, trades can be aggregated in the same class for the defined trade or auction period.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="1316" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1315;"><span id="cb30-1316"><a href="#cb30-1316" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaCi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb30-1317"><a href="#cb30-1317" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta C_i`</span><span class="op">,</span></span>
<span id="cb30-1318"><a href="#cb30-1318" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb30-1319"><a href="#cb30-1319" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb30-1320"><a href="#cb30-1320" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb30-1321"><a href="#cb30-1321" aria-hidden="true" tabindex="-1"></a>viewof inputEt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {</span>
<span id="cb30-1322"><a href="#cb30-1322" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Expiry } E_t </span><span class="sc">\t</span><span class="vs">ext{ (years)}`</span><span class="op">,</span></span>
<span id="cb30-1323"><a href="#cb30-1323" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb30-1324"><a href="#cb30-1324" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb30-1325"><a href="#cb30-1325" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-30-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-30-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-bought-by-the-aam" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon bought by the Portfolio Manager.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-bought-by-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="1337" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1336;"><span id="cb31-1337"><a href="#cb31-1337" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaCi0</span>(deltaCi<span class="op">,</span> t) {</span>
<span id="cb31-1338"><a href="#cb31-1338" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> deltaCi <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb31-1339"><a href="#cb31-1339" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-1340"><a href="#cb31-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1341"><a href="#cb31-1341" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeVecDeltaCi</span>(deltaCi<span class="op">,</span> t) {</span>
<span id="cb31-1342"><a href="#cb31-1342" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecDeltaCi <span class="op">=</span> <span class="bu">Array</span>(<span class="dv">40</span>)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb31-1343"><a href="#cb31-1343" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="op">!==</span> <span class="dv">0</span>) {</span>
<span id="cb31-1344"><a href="#cb31-1344" aria-hidden="true" tabindex="-1"></a>    vecDeltaCi[t <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> deltaCi<span class="op">;</span></span>
<span id="cb31-1345"><a href="#cb31-1345" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-1346"><a href="#cb31-1346" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecDeltaCi<span class="op">;</span></span>
<span id="cb31-1347"><a href="#cb31-1347" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-31-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-31-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="1351" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1350;"><span id="cb32-1351"><a href="#cb32-1351" aria-hidden="true" tabindex="-1"></a>paramMaturityIdx <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> inputEt<span class="op">;</span></span>
<span id="cb32-1352"><a href="#cb32-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1353"><a href="#cb32-1353" aria-hidden="true" tabindex="-1"></a>paramDeltaCi0 <span class="op">=</span> <span class="fu">computeDeltaCi0</span>(inputDeltaCi<span class="op">,</span> paramMaturityIdx)<span class="op">;</span></span>
<span id="cb32-1354"><a href="#cb32-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1355"><a href="#cb32-1355" aria-hidden="true" tabindex="-1"></a>vecDeltaCi <span class="op">=</span> <span class="fu">computeVecDeltaCi</span>(inputDeltaCi<span class="op">,</span> paramMaturityIdx)<span class="op">;</span></span>
<span id="cb32-1356"><a href="#cb32-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1357"><a href="#cb32-1357" aria-hidden="true" tabindex="-1"></a>paramDeltaBarCi <span class="op">=</span> paramDeltaCi0 <span class="op">+</span> <span class="fu">dotProduct</span>(vecB<span class="op">,</span> vecDeltaCi)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="1361" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1360;"><span id="cb33-1361"><a href="#cb33-1361" aria-hidden="true" tabindex="-1"></a>carbonBuyData <span class="op">=</span> {</span>
<span id="cb33-1362"><a href="#cb33-1362" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> carbonBuyData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb33-1363"><a href="#cb33-1363" aria-hidden="true" tabindex="-1"></a>  carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1364"><a href="#cb33-1364" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"Carbon Bought by AAM"</span><span class="op">,</span></span>
<span id="cb33-1365"><a href="#cb33-1365" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDeltaCi0<span class="op">,</span></span>
<span id="cb33-1366"><a href="#cb33-1366" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb33-1367"><a href="#cb33-1367" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1368"><a href="#cb33-1368" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb33-1369"><a href="#cb33-1369" aria-hidden="true" tabindex="-1"></a>    carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1370"><a href="#cb33-1370" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Carbon Bought by AAM"</span><span class="op">,</span></span>
<span id="cb33-1371"><a href="#cb33-1371" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecDeltaCi<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb33-1372"><a href="#cb33-1372" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb33-1373"><a href="#cb33-1373" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb33-1374"><a href="#cb33-1374" aria-hidden="true" tabindex="-1"></a>    carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1375"><a href="#cb33-1375" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb33-1376"><a href="#cb33-1376" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb33-1377"><a href="#cb33-1377" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb33-1378"><a href="#cb33-1378" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb33-1379"><a href="#cb33-1379" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-1380"><a href="#cb33-1380" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> carbonBuyData<span class="op">;</span></span>
<span id="cb33-1381"><a href="#cb33-1381" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb33-1382"><a href="#cb33-1382" aria-hidden="true" tabindex="-1"></a>getCarbonBought <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Carbon Bought by AAM"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb33-1383"><a href="#cb33-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1384"><a href="#cb33-1384" aria-hidden="true" tabindex="-1"></a>stringDeltaBarCi <span class="op">=</span> <span class="st">"Present-Value Carbon Bought by AAM ΔC̄ᵢ = "</span> <span class="op">+</span></span>
<span id="cb33-1385"><a href="#cb33-1385" aria-hidden="true" tabindex="-1"></a>        paramDeltaBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb33-1386"><a href="#cb33-1386" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb33-1387"><a href="#cb33-1387" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb33-1388"><a href="#cb33-1388" aria-hidden="true" tabindex="-1"></a>            <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span></span>
<span id="cb33-1389"><a href="#cb33-1389" aria-hidden="true" tabindex="-1"></a>            <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb33-1390"><a href="#cb33-1390" aria-hidden="true" tabindex="-1"></a>            <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb33-1391"><a href="#cb33-1391" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb33-1392"><a href="#cb33-1392" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb33-1393"><a href="#cb33-1393" aria-hidden="true" tabindex="-1"></a>boughtCarbonParam <span class="op">=</span> [{ <span class="dt">key</span><span class="op">:</span> stringDeltaBarCi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDeltaBarCi }]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="1396" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1395;"><span id="cb34-1396"><a href="#cb34-1396" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb34-1397"><a href="#cb34-1397" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb34-1398"><a href="#cb34-1398" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1399"><a href="#cb34-1399" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">7</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb34-1400"><a href="#cb34-1400" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Carbon Bought by AAM"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringDeltaBarCi]<span class="op">,</span></span>
<span id="cb34-1401"><a href="#cb34-1401" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1402"><a href="#cb34-1402" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb34-1403"><a href="#cb34-1403" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span><span class="op">,</span></span>
<span id="cb34-1404"><a href="#cb34-1404" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb34-1405"><a href="#cb34-1405" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelArrow</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1406"><a href="#cb34-1406" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1407"><a href="#cb34-1407" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb34-1408"><a href="#cb34-1408" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb34-1409"><a href="#cb34-1409" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb34-1410"><a href="#cb34-1410" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb34-1411"><a href="#cb34-1411" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1412"><a href="#cb34-1412" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb34-1413"><a href="#cb34-1413" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb34-1414"><a href="#cb34-1414" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Quantity of Carbon (%)"</span> })<span class="op">,</span></span>
<span id="cb34-1415"><a href="#cb34-1415" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb34-1416"><a href="#cb34-1416" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(carbonBuyData<span class="op">,</span> {</span>
<span id="cb34-1417"><a href="#cb34-1417" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb34-1418"><a href="#cb34-1418" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb34-1419"><a href="#cb34-1419" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCarbonBought<span class="op">,</span></span>
<span id="cb34-1420"><a href="#cb34-1420" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb34-1421"><a href="#cb34-1421" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-1422"><a href="#cb34-1422" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(boughtCarbonParam<span class="op">,</span> {</span>
<span id="cb34-1423"><a href="#cb34-1423" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb34-1424"><a href="#cb34-1424" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb34-1425"><a href="#cb34-1425" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb34-1426"><a href="#cb34-1426" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-1427"><a href="#cb34-1427" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-1428"><a href="#cb34-1428" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(carbonBuyData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb34-1429"><a href="#cb34-1429" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(carbonBuyData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb34-1430"><a href="#cb34-1430" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb34-1431"><a href="#cb34-1431" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-34" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-bought-by-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Carbon bought by the Portfolio Manager.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Where <span class="math inline">\Delta \bar C_i</span> is expressed as the relative increment to its respective pool balance, the amount of <strong>A</strong> tokens issued to pay for carbon, <span class="math inline">\Delta A</span>, expressed as a proportion of current supply, is determined as:</p>
<p><span id="eq-a-change-intermediary-step"><span class="math display">
\ln(1 + \Delta A) =
  \left( A_i - \frac{A_i^2 \, (1 - G_i)^2}{2} \right) \ln(1 + \Delta \bar C_i)
\tag{17}</span></span></p>
<p>Denoting the expression on the right hand side of <a href="#eq-a-change-intermediary-step" class="quarto-xref">Equation&nbsp;17</a> as <span class="math inline">\mathsf{RHS}</span>:</p>
<p><span id="eq-a-change"><span class="math display">
\Delta A = \exp(\mathsf{RHS}) - 1
\tag{18}</span></span></p>
<p>Finally, <span class="math inline">\Delta A</span> is applied to the outstanding supply of <strong>A</strong> to solve for token quantities.</p>
<p><a href="#fig-a-price-curves" class="quarto-xref">Figure&nbsp;13</a> illustrates the <strong>G</strong> token’s capacity to maintain the initial portfolio pricing of the <strong>A</strong> token. The data has been normalised in <a href="#fig-a-price-curves-normalised" class="quarto-xref">Figure&nbsp;14</a> to <span class="math inline">\Delta \bar C_i \, A_i</span>.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="1470" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1469;"><span id="cb35-1470"><a href="#cb35-1470" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaBarCi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb35-1471"><a href="#cb35-1471" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta </span><span class="sc">\b</span><span class="vs">ar C_i`</span><span class="op">,</span></span>
<span id="cb35-1472"><a href="#cb35-1472" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb35-1473"><a href="#cb35-1473" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb35-1474"><a href="#cb35-1474" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-35" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-a-price-curves" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A price curves.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="1486" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1485;"><span id="cb36-1486"><a href="#cb36-1486" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCi) {</span>
<span id="cb36-1487"><a href="#cb36-1487" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>((Ai <span class="op">-</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>)) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log1p</span>(deltaCi))<span class="op">;</span></span>
<span id="cb36-1488"><a href="#cb36-1488" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="1493" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1492;"><span id="cb37-1493"><a href="#cb37-1493" aria-hidden="true" tabindex="-1"></a>pricingData <span class="op">=</span> {</span>
<span id="cb37-1494"><a href="#cb37-1494" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pricingData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb37-1495"><a href="#cb37-1495" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb37-1496"><a href="#cb37-1496" aria-hidden="true" tabindex="-1"></a>    pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1497"><a href="#cb37-1497" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb37-1498"><a href="#cb37-1498" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb37-1499"><a href="#cb37-1499" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1500"><a href="#cb37-1500" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb37-1501"><a href="#cb37-1501" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb37-1502"><a href="#cb37-1502" aria-hidden="true" tabindex="-1"></a>    pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1503"><a href="#cb37-1503" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb37-1504"><a href="#cb37-1504" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb37-1505"><a href="#cb37-1505" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1506"><a href="#cb37-1506" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb37-1507"><a href="#cb37-1507" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb37-1508"><a href="#cb37-1508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb37-1509"><a href="#cb37-1509" aria-hidden="true" tabindex="-1"></a>      pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1510"><a href="#cb37-1510" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb37-1511"><a href="#cb37-1511" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb37-1512"><a href="#cb37-1512" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1513"><a href="#cb37-1513" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb37-1514"><a href="#cb37-1514" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb37-1515"><a href="#cb37-1515" aria-hidden="true" tabindex="-1"></a>      pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1516"><a href="#cb37-1516" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb37-1517"><a href="#cb37-1517" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb37-1518"><a href="#cb37-1518" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1519"><a href="#cb37-1519" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCi) <span class="op">/</span></span>
<span id="cb37-1520"><a href="#cb37-1520" aria-hidden="true" tabindex="-1"></a>                (inputDeltaBarCi <span class="op">*</span> paramAi)<span class="op">,</span></span>
<span id="cb37-1521"><a href="#cb37-1521" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb37-1522"><a href="#cb37-1522" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-1523"><a href="#cb37-1523" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-1524"><a href="#cb37-1524" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pricingData<span class="op">;</span></span>
<span id="cb37-1525"><a href="#cb37-1525" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb37-1526"><a href="#cb37-1526" aria-hidden="true" tabindex="-1"></a>getDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"ΔA"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb37-1527"><a href="#cb37-1527" aria-hidden="true" tabindex="-1"></a>getNormDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Normalised ΔA"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb37-1528"><a href="#cb37-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1529"><a href="#cb37-1529" aria-hidden="true" tabindex="-1"></a>stringInputDeltaBarCi <span class="op">=</span> inputDeltaBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb37-1530"><a href="#cb37-1530" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb37-1531"><a href="#cb37-1531" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb37-1532"><a href="#cb37-1532" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="1535" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1534;"><span id="cb38-1535"><a href="#cb38-1535" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb38-1536"><a href="#cb38-1536" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb38-1537"><a href="#cb38-1537" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-1538"><a href="#cb38-1538" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb38-1539"><a href="#cb38-1539" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb38-1540"><a href="#cb38-1540" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`ΔA, where ΔC̄ᵢ = </span><span class="sc">${</span>stringInputDeltaBarCi<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb38-1541"><a href="#cb38-1541" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb38-1542"><a href="#cb38-1542" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb38-1543"><a href="#cb38-1543" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb38-1544"><a href="#cb38-1544" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb38-1545"><a href="#cb38-1545" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb38-1546"><a href="#cb38-1546" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(pricingData<span class="op">,</span> {</span>
<span id="cb38-1547"><a href="#cb38-1547" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1548"><a href="#cb38-1548" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1549"><a href="#cb38-1549" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1550"><a href="#cb38-1550" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1551"><a href="#cb38-1551" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getDeltaA<span class="op">,</span></span>
<span id="cb38-1552"><a href="#cb38-1552" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb38-1553"><a href="#cb38-1553" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(pricingData<span class="op">,</span> {</span>
<span id="cb38-1554"><a href="#cb38-1554" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb38-1555"><a href="#cb38-1555" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb38-1556"><a href="#cb38-1556" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb38-1557"><a href="#cb38-1557" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb38-1558"><a href="#cb38-1558" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb38-1559"><a href="#cb38-1559" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb38-1560"><a href="#cb38-1560" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb38-1561"><a href="#cb38-1561" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb38-1562"><a href="#cb38-1562" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb38-1563"><a href="#cb38-1563" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb38-1564"><a href="#cb38-1564" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb38-1565"><a href="#cb38-1565" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb38-1566"><a href="#cb38-1566" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb38-1567"><a href="#cb38-1567" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb38-1568"><a href="#cb38-1568" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb38-1569"><a href="#cb38-1569" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb38-1570"><a href="#cb38-1570" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb38-1571"><a href="#cb38-1571" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-38" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: <strong>A</strong> price curves (<span class="math inline">\Delta A</span>).
</figcaption>
</figure>
</div>
<div id="fig-a-price-curves-normalised" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Normalised A price curves.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1585" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1584;"><span id="cb39-1585"><a href="#cb39-1585" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb39-1586"><a href="#cb39-1586" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb39-1587"><a href="#cb39-1587" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb39-1588"><a href="#cb39-1588" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb39-1589"><a href="#cb39-1589" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb39-1590"><a href="#cb39-1590" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Normalised ΔA, where ΔC̄ᵢ = </span><span class="sc">${</span>stringInputDeltaBarCi<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb39-1591"><a href="#cb39-1591" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb39-1592"><a href="#cb39-1592" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb39-1593"><a href="#cb39-1593" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb39-1594"><a href="#cb39-1594" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb39-1595"><a href="#cb39-1595" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb39-1596"><a href="#cb39-1596" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(pricingData<span class="op">,</span> {</span>
<span id="cb39-1597"><a href="#cb39-1597" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1598"><a href="#cb39-1598" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1599"><a href="#cb39-1599" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1600"><a href="#cb39-1600" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1601"><a href="#cb39-1601" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getNormDeltaA<span class="op">,</span></span>
<span id="cb39-1602"><a href="#cb39-1602" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb39-1603"><a href="#cb39-1603" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(pricingData<span class="op">,</span> {</span>
<span id="cb39-1604"><a href="#cb39-1604" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb39-1605"><a href="#cb39-1605" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb39-1606"><a href="#cb39-1606" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getNormDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb39-1607"><a href="#cb39-1607" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb39-1608"><a href="#cb39-1608" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb39-1609"><a href="#cb39-1609" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb39-1610"><a href="#cb39-1610" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb39-1611"><a href="#cb39-1611" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb39-1612"><a href="#cb39-1612" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb39-1613"><a href="#cb39-1613" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaBarCi) <span class="op">/</span> inputDeltaBarCi<span class="op">,</span></span>
<span id="cb39-1614"><a href="#cb39-1614" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi) <span class="op">/</span> inputDeltaBarCi<span class="op">,</span></span>
<span id="cb39-1615"><a href="#cb39-1615" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb39-1616"><a href="#cb39-1616" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb39-1617"><a href="#cb39-1617" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb39-1618"><a href="#cb39-1618" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb39-1619"><a href="#cb39-1619" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb39-1620"><a href="#cb39-1620" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb39-1621"><a href="#cb39-1621" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-39" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Normalised <strong>A</strong> price curves.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Noting that the sensitivity to <span class="math inline">G_i</span> increases as <span class="math inline">A_i</span> increases and the effects become more pronounced as <span class="math inline">\Delta \bar C_i</span> increases.</p>
</section>
<section id="sec-zero-carbon-scenario" class="level5" data-number="3.2.1.2">
<h5 data-number="3.2.1.2" class="anchored" data-anchor-id="sec-zero-carbon-scenario"><span class="header-section-number">3.2.1.2</span> Zero Carbon Scenario</h5>
<p>There are circumstances when there is zero carbon held in the portfolio for a particular class, i.e.&nbsp;<span class="math inline">{C_i = 0}</span>, which invalidates the calculation of <span class="math inline">\Delta \bar C_i</span> and a different approach is required.</p>
<p>Taking <span class="math inline">\Delta \bar C_\emptyset</span> as the tonnes of carbon tokens (implying an existing balance of 1 tonne), adjusted for forward discounting, to be sold for any carbon class that has a strictly positive <strong>A</strong> allocation <span class="math inline">A_\emptyset</span>, together with <strong>G</strong> allocation <span class="math inline">G_\emptyset</span>:</p>
<p><span id="eq-a-change-zero-carbon"><span class="math display">
\Delta A =
  \frac{\Delta \bar C_\emptyset}{1 + \Delta \bar C_\emptyset} \,
  \left( A_\emptyset - \frac{A_\emptyset^2 (1 - G_\emptyset)^2}{2} \right)^2
\tag{19}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1657" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1656;"><span id="cb40-1657"><a href="#cb40-1657" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaBarCnull <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-1</span><span class="op">,</span> <span class="fl">1e5</span>]<span class="op">,</span> {</span>
<span id="cb40-1658"><a href="#cb40-1658" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta </span><span class="sc">\b</span><span class="vs">ar C_</span><span class="sc">\e</span><span class="vs">mptyset`</span><span class="op">,</span></span>
<span id="cb40-1659"><a href="#cb40-1659" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-1</span><span class="op">,</span></span>
<span id="cb40-1660"><a href="#cb40-1660" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">1e2</span><span class="op">,</span></span>
<span id="cb40-1661"><a href="#cb40-1661" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb40-1662"><a href="#cb40-1662" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-40" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-a-price-curves-zero-carbon" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A price curves in the zero carbon scenario.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-zero-carbon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1675" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1674;"><span id="cb41-1675"><a href="#cb41-1675" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeZeroCarbonDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCnull) {</span>
<span id="cb41-1676"><a href="#cb41-1676" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (deltaCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> deltaCnull)) <span class="op">*</span> (Ai <span class="op">-</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>))<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb41-1677"><a href="#cb41-1677" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-1678"><a href="#cb41-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1679"><a href="#cb41-1679" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeTrueDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> barCiTonnes<span class="op">,</span> deltaBarCiTonnes) {</span>
<span id="cb41-1680"><a href="#cb41-1680" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (barCiTonnes <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb41-1681"><a href="#cb41-1681" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">computeZeroCarbonDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaBarCiTonnes)<span class="op">;</span></span>
<span id="cb41-1682"><a href="#cb41-1682" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb41-1683"><a href="#cb41-1683" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> deltaBarCi <span class="op">=</span> deltaBarCiTonnes <span class="op">/</span> barCiTonnes<span class="op">;</span></span>
<span id="cb41-1684"><a href="#cb41-1684" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaBarCi)<span class="op">;</span></span>
<span id="cb41-1685"><a href="#cb41-1685" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-1686"><a href="#cb41-1686" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-1687"><a href="#cb41-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1688"><a href="#cb41-1688" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">numberOfDigits</span>(x) {</span>
<span id="cb41-1689"><a href="#cb41-1689" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> (<span class="dv">1</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(x)))<span class="op">;</span></span>
<span id="cb41-1690"><a href="#cb41-1690" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1694" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1693;"><span id="cb42-1694"><a href="#cb42-1694" aria-hidden="true" tabindex="-1"></a>zeroCarbonData <span class="op">=</span> {</span>
<span id="cb42-1695"><a href="#cb42-1695" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> zeroCarbonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb42-1696"><a href="#cb42-1696" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb42-1697"><a href="#cb42-1697" aria-hidden="true" tabindex="-1"></a>    zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1698"><a href="#cb42-1698" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb42-1699"><a href="#cb42-1699" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb42-1700"><a href="#cb42-1700" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1701"><a href="#cb42-1701" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb42-1702"><a href="#cb42-1702" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb42-1703"><a href="#cb42-1703" aria-hidden="true" tabindex="-1"></a>    zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1704"><a href="#cb42-1704" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb42-1705"><a href="#cb42-1705" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb42-1706"><a href="#cb42-1706" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1707"><a href="#cb42-1707" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb42-1708"><a href="#cb42-1708" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb42-1709"><a href="#cb42-1709" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb42-1710"><a href="#cb42-1710" aria-hidden="true" tabindex="-1"></a>      zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1711"><a href="#cb42-1711" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb42-1712"><a href="#cb42-1712" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1713"><a href="#cb42-1713" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1714"><a href="#cb42-1714" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeZeroCarbonDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb42-1715"><a href="#cb42-1715" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1716"><a href="#cb42-1716" aria-hidden="true" tabindex="-1"></a>      zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1717"><a href="#cb42-1717" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb42-1718"><a href="#cb42-1718" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1719"><a href="#cb42-1719" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1720"><a href="#cb42-1720" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeZeroCarbonDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb42-1721"><a href="#cb42-1721" aria-hidden="true" tabindex="-1"></a>                ((inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull)) <span class="op">*</span> paramAi<span class="op">**</span><span class="dv">2</span>)<span class="op">,</span></span>
<span id="cb42-1722"><a href="#cb42-1722" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1723"><a href="#cb42-1723" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-1724"><a href="#cb42-1724" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-1725"><a href="#cb42-1725" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> zeroCarbonData<span class="op">;</span></span>
<span id="cb42-1726"><a href="#cb42-1726" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb42-1727"><a href="#cb42-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1728"><a href="#cb42-1728" aria-hidden="true" tabindex="-1"></a>stringDeltaBarCnull <span class="op">=</span> inputDeltaBarCnull<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb42-1729"><a href="#cb42-1729" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb42-1730"><a href="#cb42-1730" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb42-1731"><a href="#cb42-1731" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="fu">numberOfDigits</span>(inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb42-1732"><a href="#cb42-1732" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="fu">numberOfDigits</span>(inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb42-1733"><a href="#cb42-1733" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb42-1734"><a href="#cb42-1734" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1737" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1736;"><span id="cb43-1737"><a href="#cb43-1737" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb43-1738"><a href="#cb43-1738" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb43-1739"><a href="#cb43-1739" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-1740"><a href="#cb43-1740" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb43-1741"><a href="#cb43-1741" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb43-1742"><a href="#cb43-1742" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`ΔA, where ΔC̄∅ = </span><span class="sc">${</span>stringDeltaBarCnull<span class="sc">}</span><span class="vs"> tCO2eq`</span><span class="op">,</span></span>
<span id="cb43-1743"><a href="#cb43-1743" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb43-1744"><a href="#cb43-1744" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb43-1745"><a href="#cb43-1745" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb43-1746"><a href="#cb43-1746" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb43-1747"><a href="#cb43-1747" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb43-1748"><a href="#cb43-1748" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb43-1749"><a href="#cb43-1749" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1750"><a href="#cb43-1750" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1751"><a href="#cb43-1751" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1752"><a href="#cb43-1752" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1753"><a href="#cb43-1753" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getDeltaA<span class="op">,</span></span>
<span id="cb43-1754"><a href="#cb43-1754" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb43-1755"><a href="#cb43-1755" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb43-1756"><a href="#cb43-1756" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb43-1757"><a href="#cb43-1757" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb43-1758"><a href="#cb43-1758" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb43-1759"><a href="#cb43-1759" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb43-1760"><a href="#cb43-1760" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb43-1761"><a href="#cb43-1761" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1762"><a href="#cb43-1762" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb43-1763"><a href="#cb43-1763" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb43-1764"><a href="#cb43-1764" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb43-1765"><a href="#cb43-1765" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb43-1766"><a href="#cb43-1766" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb43-1767"><a href="#cb43-1767" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb43-1768"><a href="#cb43-1768" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb43-1769"><a href="#cb43-1769" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb43-1770"><a href="#cb43-1770" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1771"><a href="#cb43-1771" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb43-1772"><a href="#cb43-1772" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb43-1773"><a href="#cb43-1773" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-43" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-zero-carbon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: <strong>A</strong> price curves (<span class="math inline">\Delta A</span>) in the zero carbon scenario.
</figcaption>
</figure>
</div>
<div id="fig-a-price-curves-zero-carbon-normalised" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Normalised A price curves in the zero carbon scenario.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-zero-carbon-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1788" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1787;"><span id="cb44-1788"><a href="#cb44-1788" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb44-1789"><a href="#cb44-1789" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb44-1790"><a href="#cb44-1790" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb44-1791"><a href="#cb44-1791" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb44-1792"><a href="#cb44-1792" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb44-1793"><a href="#cb44-1793" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Normalised ΔA, where ΔC̄∅ = </span><span class="sc">${</span>stringDeltaBarCnull<span class="sc">}</span><span class="vs"> tCO2eq`</span><span class="op">,</span></span>
<span id="cb44-1794"><a href="#cb44-1794" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb44-1795"><a href="#cb44-1795" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb44-1796"><a href="#cb44-1796" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb44-1797"><a href="#cb44-1797" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb44-1798"><a href="#cb44-1798" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb44-1799"><a href="#cb44-1799" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb44-1800"><a href="#cb44-1800" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1801"><a href="#cb44-1801" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1802"><a href="#cb44-1802" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1803"><a href="#cb44-1803" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1804"><a href="#cb44-1804" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getNormDeltaA<span class="op">,</span></span>
<span id="cb44-1805"><a href="#cb44-1805" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb44-1806"><a href="#cb44-1806" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb44-1807"><a href="#cb44-1807" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb44-1808"><a href="#cb44-1808" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb44-1809"><a href="#cb44-1809" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getNormDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb44-1810"><a href="#cb44-1810" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb44-1811"><a href="#cb44-1811" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb44-1812"><a href="#cb44-1812" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb44-1813"><a href="#cb44-1813" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb44-1814"><a href="#cb44-1814" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb44-1815"><a href="#cb44-1815" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb44-1816"><a href="#cb44-1816" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb44-1817"><a href="#cb44-1817" aria-hidden="true" tabindex="-1"></a>                    (inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb44-1818"><a href="#cb44-1818" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb44-1819"><a href="#cb44-1819" aria-hidden="true" tabindex="-1"></a>                    (inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb44-1820"><a href="#cb44-1820" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb44-1821"><a href="#cb44-1821" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb44-1822"><a href="#cb44-1822" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb44-1823"><a href="#cb44-1823" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb44-1824"><a href="#cb44-1824" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb44-1825"><a href="#cb44-1825" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb44-1826"><a href="#cb44-1826" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-44" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-zero-carbon-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Normalised <strong>A</strong> price curves in the zero carbon scenario.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-sell-offset-certificates" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="sec-sell-offset-certificates"><span class="header-section-number">3.2.2</span> Sell Offset Certificates</h4>
<p><em>User swaps <strong>A</strong> tokens for carbon offset certificates.</em></p>
<section id="sec-weighted-carbon-class" class="level5" data-number="3.2.2.1">
<h5 data-number="3.2.2.1" class="anchored" data-anchor-id="sec-weighted-carbon-class"><span class="header-section-number">3.2.2.1</span> Weighted Carbon Class</h5>
<p>For retiring carbon that is <em>weighted</em>, that is for which there is a strictly positive <strong>A</strong> token allocation, an <strong>A</strong> token holder can extract the carbon class offset certificate of their choice <span class="math inline">C_i</span> but the available pool is only the liquid carbon balance, namely the element <span class="math inline">C_{i0}</span>:</p>
<p><span id="eq-carbon-change-intermediary-step"><span class="math display">
\ln(1 + \Delta C_i) =
  \frac{-\ln(1 + \Delta A)}{A_i + \frac 1 2 A_i^2 \, (1 - G_i)^2}
\tag{20}</span></span></p>
<p>As before, denoting the expression on the right hand side of <a href="#eq-carbon-change-intermediary-step" class="quarto-xref">Equation&nbsp;20</a> as <span class="math inline">\mathsf{RHS}</span>:</p>
<p><span id="eq-carbon-change"><span class="math display">
\Delta C_i = \exp(\mathsf{RHS}) - 1
\tag{21}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1865" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1864;"><span id="cb45-1865"><a href="#cb45-1865" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaA <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="fl">0.999</span>]<span class="op">,</span> {</span>
<span id="cb45-1866"><a href="#cb45-1866" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Burnt } </span><span class="sc">\D</span><span class="vs">elta A`</span><span class="op">,</span></span>
<span id="cb45-1867"><a href="#cb45-1867" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb45-1868"><a href="#cb45-1868" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb45-1869"><a href="#cb45-1869" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-45" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-proportion-of-carbon-retired" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Proportion of carbon retired.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-proportion-of-carbon-retired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1881" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1880;"><span id="cb46-1881"><a href="#cb46-1881" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaCi</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaA) {</span>
<span id="cb46-1882"><a href="#cb46-1882" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log1p</span>(deltaA) <span class="op">/</span> (Ai <span class="op">+</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>)))<span class="op">;</span></span>
<span id="cb46-1883"><a href="#cb46-1883" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-46" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1888" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1887;"><span id="cb47-1888"><a href="#cb47-1888" aria-hidden="true" tabindex="-1"></a>retirementData <span class="op">=</span> {</span>
<span id="cb47-1889"><a href="#cb47-1889" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> retirementData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb47-1890"><a href="#cb47-1890" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb47-1891"><a href="#cb47-1891" aria-hidden="true" tabindex="-1"></a>    retirementData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb47-1892"><a href="#cb47-1892" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"-ΔCᵢ"</span><span class="op">,</span></span>
<span id="cb47-1893"><a href="#cb47-1893" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb47-1894"><a href="#cb47-1894" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb47-1895"><a href="#cb47-1895" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb47-1896"><a href="#cb47-1896" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb47-1897"><a href="#cb47-1897" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb47-1898"><a href="#cb47-1898" aria-hidden="true" tabindex="-1"></a>      retirementData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb47-1899"><a href="#cb47-1899" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"-ΔCᵢ"</span><span class="op">,</span></span>
<span id="cb47-1900"><a href="#cb47-1900" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb47-1901"><a href="#cb47-1901" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb47-1902"><a href="#cb47-1902" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="op">-</span><span class="fu">computeDeltaCi</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb47-1903"><a href="#cb47-1903" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb47-1904"><a href="#cb47-1904" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-1905"><a href="#cb47-1905" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-1906"><a href="#cb47-1906" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> retirementData<span class="op">;</span></span>
<span id="cb47-1907"><a href="#cb47-1907" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb47-1908"><a href="#cb47-1908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1909"><a href="#cb47-1909" aria-hidden="true" tabindex="-1"></a>stringInputDeltaA <span class="op">=</span> inputDeltaA<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb47-1910"><a href="#cb47-1910" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb47-1911"><a href="#cb47-1911" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb47-1912"><a href="#cb47-1912" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-47-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-47-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1915" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1914;"><span id="cb48-1915"><a href="#cb48-1915" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb48-1916"><a href="#cb48-1916" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb48-1917"><a href="#cb48-1917" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb48-1918"><a href="#cb48-1918" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb48-1919"><a href="#cb48-1919" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb48-1920"><a href="#cb48-1920" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`-ΔCᵢ, where ΔA = </span><span class="sc">${</span>stringInputDeltaA<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb48-1921"><a href="#cb48-1921" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb48-1922"><a href="#cb48-1922" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb48-1923"><a href="#cb48-1923" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb48-1924"><a href="#cb48-1924" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb48-1925"><a href="#cb48-1925" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb48-1926"><a href="#cb48-1926" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(retirementData<span class="op">,</span> {</span>
<span id="cb48-1927"><a href="#cb48-1927" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1928"><a href="#cb48-1928" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1929"><a href="#cb48-1929" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1930"><a href="#cb48-1930" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1931"><a href="#cb48-1931" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb48-1932"><a href="#cb48-1932" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb48-1933"><a href="#cb48-1933" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(retirementData<span class="op">,</span> {</span>
<span id="cb48-1934"><a href="#cb48-1934" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb48-1935"><a href="#cb48-1935" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb48-1936"><a href="#cb48-1936" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb48-1937"><a href="#cb48-1937" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb48-1938"><a href="#cb48-1938" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb48-1939"><a href="#cb48-1939" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb48-1940"><a href="#cb48-1940" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb48-1941"><a href="#cb48-1941" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb48-1942"><a href="#cb48-1942" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb48-1943"><a href="#cb48-1943" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fu">computeDeltaCi</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb48-1944"><a href="#cb48-1944" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fu">computeDeltaCi</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb48-1945"><a href="#cb48-1945" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb48-1946"><a href="#cb48-1946" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb48-1947"><a href="#cb48-1947" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb48-1948"><a href="#cb48-1948" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb48-1949"><a href="#cb48-1949" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb48-1950"><a href="#cb48-1950" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb48-1951"><a href="#cb48-1951" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-48" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-proportion-of-carbon-retired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Proportion of carbon retired.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-proportion-of-carbon-retired" class="quarto-xref">Figure&nbsp;17</a> shows the cost of carbon increasing with <span class="math inline">A_i</span> and decreasing on <span class="math inline">G_i</span>.</p>
</section>
<section id="sec-unweighted-carbon-class" class="level5" data-number="3.2.2.2">
<h5 data-number="3.2.2.2" class="anchored" data-anchor-id="sec-unweighted-carbon-class"><span class="header-section-number">3.2.2.2</span> Unweighted Carbon Class</h5>
<p>An offset certificate for a carbon class with a zero <strong>A</strong> allocation cannot be extracted from the portfolio by swapping in <strong>A</strong> tokens.</p>
</section>
<section id="sec-liquidation-delta-a-1" class="level5" data-number="3.2.2.3">
<h5 data-number="3.2.2.3" class="anchored" data-anchor-id="sec-liquidation-delta-a-1"><span class="header-section-number">3.2.2.3</span> Liquidation: <span class="math inline">\Delta A = 1</span></h5>
<p>In the event that 100% of <strong>A</strong> tokens are placed into the burn mechanism for carbon offset certificates, the balances of all carbon held in the portfolio post-trade are distributed to all <strong>G</strong> token holders.</p>
<p><a href="#fig-carbon-spread" class="quarto-xref">Figure&nbsp;18</a> below shows the spread captured on a ‘round trip’ by the system where <span class="math inline">\varepsilon</span> is the proportion retained:</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1984" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1983;"><span id="cb49-1984"><a href="#cb49-1984" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaCinitial <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb49-1985"><a href="#cb49-1985" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial }</span><span class="sc">\D</span><span class="vs">elta C`</span><span class="op">,</span></span>
<span id="cb49-1986"><a href="#cb49-1986" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb49-1987"><a href="#cb49-1987" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb49-1988"><a href="#cb49-1988" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-49" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-spread" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon spread.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-spread-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="2000" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1999;"><span id="cb50-2000"><a href="#cb50-2000" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeSpread</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCinitial) {</span>
<span id="cb50-2001"><a href="#cb50-2001" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaA <span class="op">=</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCinitial)<span class="op">;</span></span>
<span id="cb50-2002"><a href="#cb50-2002" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaCfinal <span class="op">=</span> <span class="op">-</span><span class="fu">computeDeltaCi</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaA)<span class="op">;</span></span>
<span id="cb50-2003"><a href="#cb50-2003" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (deltaCinitial <span class="op">-</span> deltaCfinal) <span class="op">/</span> deltaCinitial<span class="op">;</span></span>
<span id="cb50-2004"><a href="#cb50-2004" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-50" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="2009" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2008;"><span id="cb51-2009"><a href="#cb51-2009" aria-hidden="true" tabindex="-1"></a>liquidationData <span class="op">=</span> {</span>
<span id="cb51-2010"><a href="#cb51-2010" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> liquidationData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb51-2011"><a href="#cb51-2011" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb51-2012"><a href="#cb51-2012" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"deltaa"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-2013"><a href="#cb51-2013" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"deltac"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-2014"><a href="#cb51-2014" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"spread"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-2015"><a href="#cb51-2015" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb51-2016"><a href="#cb51-2016" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> deltaA <span class="op">=</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial)</span>
<span id="cb51-2017"><a href="#cb51-2017" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-2018"><a href="#cb51-2018" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"deltaa"</span><span class="op">,</span></span>
<span id="cb51-2019"><a href="#cb51-2019" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-2020"><a href="#cb51-2020" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-2021"><a href="#cb51-2021" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial) <span class="op">/</span></span>
<span id="cb51-2022"><a href="#cb51-2022" aria-hidden="true" tabindex="-1"></a>                inputDeltaCinitial<span class="op">,</span></span>
<span id="cb51-2023"><a href="#cb51-2023" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-2024"><a href="#cb51-2024" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-2025"><a href="#cb51-2025" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"deltac"</span><span class="op">,</span></span>
<span id="cb51-2026"><a href="#cb51-2026" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-2027"><a href="#cb51-2027" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-2028"><a href="#cb51-2028" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaCi</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> deltaA) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb51-2029"><a href="#cb51-2029" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-2030"><a href="#cb51-2030" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-2031"><a href="#cb51-2031" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"spread"</span><span class="op">,</span></span>
<span id="cb51-2032"><a href="#cb51-2032" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-2033"><a href="#cb51-2033" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-2034"><a href="#cb51-2034" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeSpread</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial)<span class="op">,</span></span>
<span id="cb51-2035"><a href="#cb51-2035" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-2036"><a href="#cb51-2036" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-2037"><a href="#cb51-2037" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-2038"><a href="#cb51-2038" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> liquidationData<span class="op">;</span></span>
<span id="cb51-2039"><a href="#cb51-2039" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb51-2040"><a href="#cb51-2040" aria-hidden="true" tabindex="-1"></a>getLiqDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"deltaa"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-2041"><a href="#cb51-2041" aria-hidden="true" tabindex="-1"></a>getLiqDeltaCi <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"deltac"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-2042"><a href="#cb51-2042" aria-hidden="true" tabindex="-1"></a>getLiqSpread <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"spread"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-2043"><a href="#cb51-2043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2044"><a href="#cb51-2044" aria-hidden="true" tabindex="-1"></a>stringInputDeltaCinitial <span class="op">=</span> inputDeltaCinitial<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb51-2045"><a href="#cb51-2045" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb51-2046"><a href="#cb51-2046" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb51-2047"><a href="#cb51-2047" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="2050" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2049;"><span id="cb52-2050"><a href="#cb52-2050" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb52-2051"><a href="#cb52-2051" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb52-2052"><a href="#cb52-2052" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb52-2053"><a href="#cb52-2053" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb52-2054"><a href="#cb52-2054" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeSpread</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span></span>
<span id="cb52-2055"><a href="#cb52-2055" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb52-2056"><a href="#cb52-2056" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Carbon Spread ε, where initial ΔC = </span><span class="sc">${</span>stringInputDeltaCinitial<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb52-2057"><a href="#cb52-2057" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb52-2058"><a href="#cb52-2058" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb52-2059"><a href="#cb52-2059" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb52-2060"><a href="#cb52-2060" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb52-2061"><a href="#cb52-2061" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb52-2062"><a href="#cb52-2062" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb52-2063"><a href="#cb52-2063" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2064"><a href="#cb52-2064" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2065"><a href="#cb52-2065" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2066"><a href="#cb52-2066" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2067"><a href="#cb52-2067" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqSpread<span class="op">,</span></span>
<span id="cb52-2068"><a href="#cb52-2068" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb52-2069"><a href="#cb52-2069" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb52-2070"><a href="#cb52-2070" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb52-2071"><a href="#cb52-2071" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb52-2072"><a href="#cb52-2072" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqSpread</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb52-2073"><a href="#cb52-2073" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb52-2074"><a href="#cb52-2074" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb52-2075"><a href="#cb52-2075" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb52-2076"><a href="#cb52-2076" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb52-2077"><a href="#cb52-2077" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb52-2078"><a href="#cb52-2078" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeSpread</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial)]<span class="op">,</span></span>
<span id="cb52-2079"><a href="#cb52-2079" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb52-2080"><a href="#cb52-2080" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb52-2081"><a href="#cb52-2081" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb52-2082"><a href="#cb52-2082" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb52-2083"><a href="#cb52-2083" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb52-2084"><a href="#cb52-2084" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-52" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-spread-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Carbon ‘spread’.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-carbon-spread-components" class="quarto-xref">Figure&nbsp;19</a> shows the component ‘spread’ contributions on a carbon sale and purchase round trip of a carbon offset certificate.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="2103" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2102;"><span id="cb53-2103"><a href="#cb53-2103" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb53-2104"><a href="#cb53-2104" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb53-2105"><a href="#cb53-2105" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial }</span><span class="sc">\D</span><span class="vs">elta C`</span><span class="op">,</span></span>
<span id="cb53-2106"><a href="#cb53-2106" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb53-2107"><a href="#cb53-2107" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb53-2108"><a href="#cb53-2108" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb53-2109"><a href="#cb53-2109" aria-hidden="true" tabindex="-1"></a>  viewof inputDeltaCinitial<span class="op">,</span></span>
<span id="cb53-2110"><a href="#cb53-2110" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-53" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-spread-components" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-spread-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="2123" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2122;"><span id="cb54-2123"><a href="#cb54-2123" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb54-2124"><a href="#cb54-2124" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb54-2125"><a href="#cb54-2125" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb54-2126"><a href="#cb54-2126" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb54-2127"><a href="#cb54-2127" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb54-2128"><a href="#cb54-2128" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb54-2129"><a href="#cb54-2129" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Component ΔA, where initial ΔC = </span><span class="sc">${</span></span>
<span id="cb54-2130"><a href="#cb54-2130" aria-hidden="true" tabindex="-1"></a>      stringInputDeltaCinitial</span>
<span id="cb54-2131"><a href="#cb54-2131" aria-hidden="true" tabindex="-1"></a>    <span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb54-2132"><a href="#cb54-2132" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb54-2133"><a href="#cb54-2133" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb54-2134"><a href="#cb54-2134" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb54-2135"><a href="#cb54-2135" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb54-2136"><a href="#cb54-2136" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb54-2137"><a href="#cb54-2137" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb54-2138"><a href="#cb54-2138" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2139"><a href="#cb54-2139" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2140"><a href="#cb54-2140" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2141"><a href="#cb54-2141" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2142"><a href="#cb54-2142" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqDeltaA<span class="op">,</span></span>
<span id="cb54-2143"><a href="#cb54-2143" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb54-2144"><a href="#cb54-2144" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb54-2145"><a href="#cb54-2145" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb54-2146"><a href="#cb54-2146" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb54-2147"><a href="#cb54-2147" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb54-2148"><a href="#cb54-2148" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb54-2149"><a href="#cb54-2149" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb54-2150"><a href="#cb54-2150" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb54-2151"><a href="#cb54-2151" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(d3<span class="op">.</span><span class="fu">interpolateSpectral</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">,</span></span>
<span id="cb54-2152"><a href="#cb54-2152" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb54-2153"><a href="#cb54-2153" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb54-2154"><a href="#cb54-2154" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-54" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-54-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-54" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-54-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Carbon ‘spread’ component ΔA.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="2159" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2158;"><span id="cb55-2159"><a href="#cb55-2159" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb55-2160"><a href="#cb55-2160" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb55-2161"><a href="#cb55-2161" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb55-2162"><a href="#cb55-2162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Greys"</span><span class="op">,</span></span>
<span id="cb55-2163"><a href="#cb55-2163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb55-2164"><a href="#cb55-2164" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2165"><a href="#cb55-2165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">computeDeltaCi</span>(</span>
<span id="cb55-2166"><a href="#cb55-2166" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2167"><a href="#cb55-2167" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span></span>
<span id="cb55-2168"><a href="#cb55-2168" aria-hidden="true" tabindex="-1"></a>        <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb55-2169"><a href="#cb55-2169" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2170"><a href="#cb55-2170" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb55-2171"><a href="#cb55-2171" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Component ΔC, where initial ΔC = </span><span class="sc">${</span></span>
<span id="cb55-2172"><a href="#cb55-2172" aria-hidden="true" tabindex="-1"></a>      stringInputDeltaCinitial</span>
<span id="cb55-2173"><a href="#cb55-2173" aria-hidden="true" tabindex="-1"></a>    <span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb55-2174"><a href="#cb55-2174" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb55-2175"><a href="#cb55-2175" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb55-2176"><a href="#cb55-2176" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb55-2177"><a href="#cb55-2177" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb55-2178"><a href="#cb55-2178" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb55-2179"><a href="#cb55-2179" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb55-2180"><a href="#cb55-2180" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2181"><a href="#cb55-2181" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2182"><a href="#cb55-2182" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2183"><a href="#cb55-2183" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2184"><a href="#cb55-2184" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqDeltaCi<span class="op">,</span></span>
<span id="cb55-2185"><a href="#cb55-2185" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb55-2186"><a href="#cb55-2186" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb55-2187"><a href="#cb55-2187" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb55-2188"><a href="#cb55-2188" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb55-2189"><a href="#cb55-2189" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqDeltaCi</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb55-2190"><a href="#cb55-2190" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb55-2191"><a href="#cb55-2191" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb55-2192"><a href="#cb55-2192" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2193"><a href="#cb55-2193" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb55-2194"><a href="#cb55-2194" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb55-2195"><a href="#cb55-2195" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb55-2196"><a href="#cb55-2196" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2197"><a href="#cb55-2197" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaCi</span>(</span>
<span id="cb55-2198"><a href="#cb55-2198" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2199"><a href="#cb55-2199" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span><span class="op">,</span></span>
<span id="cb55-2200"><a href="#cb55-2200" aria-hidden="true" tabindex="-1"></a>              <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb55-2201"><a href="#cb55-2201" aria-hidden="true" tabindex="-1"></a>            )<span class="op">,</span></span>
<span id="cb55-2202"><a href="#cb55-2202" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb55-2203"><a href="#cb55-2203" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateGreys</span><span class="op">,</span></span>
<span id="cb55-2204"><a href="#cb55-2204" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb55-2205"><a href="#cb55-2205" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2206"><a href="#cb55-2206" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb55-2207"><a href="#cb55-2207" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb55-2208"><a href="#cb55-2208" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-55" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-55-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-55" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-55-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Carbon ‘spread’ component ΔC.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-spread-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Carbon ‘spread’ components.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-liquidity-markets" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="sec-liquidity-markets"><span class="header-section-number">3.3</span> Liquidity Markets</h3>
<p>Both <strong>A</strong> and <strong>G</strong> tokens can be used for providing liquidity.</p>
<div id="fig-token-liquidity" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token liquidity and pricing structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-liquidity.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Token liquidity and pricing structure.
</figcaption>
</figure>
</div>
<p>There are two core liquidity pools:</p>
<ol type="1">
<li><p>An AAM 50:50 pairing of <strong>A</strong> and <strong>G</strong>&nbsp;tokens: pool <span class="overline"><strong>AG</strong></span>.</p></li>
<li><p>A hard currency USDC denoted as <strong>Q</strong> paired with <strong>A</strong>: pool <span class="overline"><strong>AQ</strong></span>.</p></li>
</ol>
<section id="sec-liquidity-fees" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="sec-liquidity-fees"><span class="header-section-number">3.3.1</span> Liquidity Fees</h4>
<p>The <span class="overline"><strong>AQ</strong></span> pool will have its own set of fees in the normal way.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The <span class="overline"><strong>AG</strong></span> pool has different economics as the assets are highly correlated since they represent the same economy. For this reason, the fees are extremely low.</p>
<p>By staking liquidity&nbsp;(liquidity provider tokens) to the <strong>standard maturities</strong>, both pools may receive a distribution of <strong>A</strong> tokens determined from the Risk Premium calculation below. This is an <u>additional</u> primary issuance to the Base Accrual already discussed.</p>
</section>
<section id="sec-risk-premium-beta-determination" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="sec-risk-premium-beta-determination"><span class="header-section-number">3.3.2</span> Risk Premium: Beta Determination</h4>
<p>We can consider the Time-Locked Market yield as the system’s <em>risk-free</em> rate. In addition to this mechanism, a <em>risky</em> spread is determined that is ultimately paid to the staked liquidity providers of the <strong>A</strong> and <strong>G</strong> tokens as compensation for the risk levels assumed.</p>
<p>As we have seen, the <strong>G</strong> token has an impact on risk-pricing of <strong>A</strong>. As <strong>G</strong> staking increases, the relationship between the carbon class selected under <span class="math inline">G_i</span> and the portfolio token <strong>A</strong> strengthens. We can consider <span class="math inline">G_i</span> staking as an estimate of residual or idiosyncratic risk in the carbon class and this allows us to calculate a portfolio beta <span class="math inline">\beta</span> from the implied betas of each carbon class <span class="math inline">i</span>.</p>
<p><span id="eq-beta"><span class="math display">
\beta = \sqrt{\sum_{i=1}^n A_i - A_i \, (1 - G_i)^2}
\tag{22}</span></span></p>
<p>The portfolio <span class="math inline">\beta</span> determines a yield factor for the liquidity pools of <strong>A</strong> to compensate for the implied risk levels.</p>
<p>For intuition, the map in <a href="#fig-range-of-beta-i" class="quarto-xref">Figure&nbsp;21</a> shows the various outputs of the function per carbon class.</p>
<div id="fig-range-of-beta-i" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Range of Beta i.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-range-of-beta-i-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="2313" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2312;"><span id="cb56-2313"><a href="#cb56-2313" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeBeta</span>(vecAi<span class="op">,</span> vecGi) {</span>
<span id="cb56-2314"><a href="#cb56-2314" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> beta2 <span class="op">=</span> vecAi<span class="op">.</span><span class="fu">reduce</span>(</span>
<span id="cb56-2315"><a href="#cb56-2315" aria-hidden="true" tabindex="-1"></a>    (acc<span class="op">,</span> Ai<span class="op">,</span> i) <span class="kw">=&gt;</span> acc <span class="op">+</span> Ai <span class="op">-</span> Ai <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> vecGi[i])<span class="op">**</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb56-2316"><a href="#cb56-2316" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span><span class="op">,</span></span>
<span id="cb56-2317"><a href="#cb56-2317" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb56-2318"><a href="#cb56-2318" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(beta2)<span class="op">;</span></span>
<span id="cb56-2319"><a href="#cb56-2319" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-56" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb57" data-startfrom="2323" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2322;"><span id="cb57-2323"><a href="#cb57-2323" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> Gi) {</span>
<span id="cb57-2324"><a href="#cb57-2324" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(Ai <span class="op">-</span> Ai <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb57-2325"><a href="#cb57-2325" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-57" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb58" data-startfrom="2329" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2328;"><span id="cb58-2329"><a href="#cb58-2329" aria-hidden="true" tabindex="-1"></a>betaData <span class="op">=</span> {</span>
<span id="cb58-2330"><a href="#cb58-2330" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> betaData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb58-2331"><a href="#cb58-2331" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb58-2332"><a href="#cb58-2332" aria-hidden="true" tabindex="-1"></a>    betaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb58-2333"><a href="#cb58-2333" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb58-2334"><a href="#cb58-2334" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb58-2335"><a href="#cb58-2335" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb58-2336"><a href="#cb58-2336" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb58-2337"><a href="#cb58-2337" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb58-2338"><a href="#cb58-2338" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb58-2339"><a href="#cb58-2339" aria-hidden="true" tabindex="-1"></a>      betaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb58-2340"><a href="#cb58-2340" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb58-2341"><a href="#cb58-2341" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb58-2342"><a href="#cb58-2342" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb58-2343"><a href="#cb58-2343" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeBetai</span>(paramAi<span class="op">,</span> paramGi)<span class="op">,</span></span>
<span id="cb58-2344"><a href="#cb58-2344" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb58-2345"><a href="#cb58-2345" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-2346"><a href="#cb58-2346" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-2347"><a href="#cb58-2347" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> betaData<span class="op">;</span></span>
<span id="cb58-2348"><a href="#cb58-2348" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-58" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb59" data-startfrom="2352" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2351;"><span id="cb59-2352"><a href="#cb59-2352" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb59-2353"><a href="#cb59-2353" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb59-2354"><a href="#cb59-2354" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb59-2355"><a href="#cb59-2355" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb59-2356"><a href="#cb59-2356" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb59-2357"><a href="#cb59-2357" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb59-2358"><a href="#cb59-2358" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb59-2359"><a href="#cb59-2359" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb59-2360"><a href="#cb59-2360" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb59-2361"><a href="#cb59-2361" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb59-2362"><a href="#cb59-2362" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb59-2363"><a href="#cb59-2363" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(betaData<span class="op">,</span> {</span>
<span id="cb59-2364"><a href="#cb59-2364" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2365"><a href="#cb59-2365" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2366"><a href="#cb59-2366" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2367"><a href="#cb59-2367" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2368"><a href="#cb59-2368" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb59-2369"><a href="#cb59-2369" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb59-2370"><a href="#cb59-2370" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(betaData<span class="op">,</span> {</span>
<span id="cb59-2371"><a href="#cb59-2371" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb59-2372"><a href="#cb59-2372" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb59-2373"><a href="#cb59-2373" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb59-2374"><a href="#cb59-2374" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb59-2375"><a href="#cb59-2375" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb59-2376"><a href="#cb59-2376" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb59-2377"><a href="#cb59-2377" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(d3<span class="op">.</span><span class="fu">interpolateSpectral</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">,</span></span>
<span id="cb59-2378"><a href="#cb59-2378" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb59-2379"><a href="#cb59-2379" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb59-2380"><a href="#cb59-2380" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-59" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-range-of-beta-i-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: Range of <span class="math inline">\beta_i</span>.
</figcaption>
</figure>
</div>
<p>The table and figure below show an example of the effects on <span class="math inline">\beta</span> of allocating large <span class="math inline">G_i</span> values to small <span class="math inline">A_i</span> values where the shift in <span class="math inline">G_i</span> results in a lower <span class="math inline">\beta</span>&nbsp;(0.27 from 0.55) with no change to total <strong>G</strong> and <strong>A</strong> allocations.</p>
<div id="tbl-effect-on-beta-from-outsized-g-staking" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[15,10,10,10,10,10]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-effect-on-beta-from-outsized-g-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Class</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
<th style="text-align: left;">3</th>
<th style="text-align: left;">4</th>
<th style="text-align: left;"><span class="math inline">\beta</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">A_i</span></td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">0.20</td>
<td style="text-align: left;">0.10</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Initial <span class="math inline">G_i</span></td>
<td style="text-align: left;"><span class="blue">0.30</span></td>
<td style="text-align: left;"><span class="blue">0.10</span></td>
<td style="text-align: left;"><span class="blue">0.05</span></td>
<td style="text-align: left;"><span class="blue">0.01</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Initial <span class="math inline">\beta_i^2</span></td>
<td style="text-align: left;">0.2550</td>
<td style="text-align: left;">0.0380</td>
<td style="text-align: left;">0.0098</td>
<td style="text-align: left;">0.0010</td>
<td style="text-align: left;"><span class="blue">0.5511</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">New <span class="math inline">G_i</span></td>
<td style="text-align: left;"><span class="red">0.01</span></td>
<td style="text-align: left;"><span class="red">0.05</span></td>
<td style="text-align: left;"><span class="red">0.10</span></td>
<td style="text-align: left;"><span class="red">0.30</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">New <span class="math inline">\beta_i^2</span></td>
<td style="text-align: left;">0.0100</td>
<td style="text-align: left;">0.0195</td>
<td style="text-align: left;">0.0190</td>
<td style="text-align: left;">0.0255</td>
<td style="text-align: left;"><span class="red">0.2719</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\Delta G_i</span></td>
<td style="text-align: left;">(0.29)</td>
<td style="text-align: left;">(0.05)</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;">0.29</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\Delta \beta_i^2</span></td>
<td style="text-align: left;">(0.2451)</td>
<td style="text-align: left;">(0.0185)</td>
<td style="text-align: left;">0.0092</td>
<td style="text-align: left;">0.0245</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-effect-on-beta-from-outsized-g-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Effect on <span class="math inline">\beta</span> from outsized <strong>G</strong> allocation.
</figcaption>
</figure>
</div>
<div id="fig-example-of-g-stake-on-beta" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Example of G allocation on Beta.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-example-of-g-stake-on-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb60" data-startfrom="2428" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2427;"><span id="cb60-2428"><a href="#cb60-2428" aria-hidden="true" tabindex="-1"></a>arrayAi <span class="op">=</span> [<span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.05</span>]<span class="op">;</span></span>
<span id="cb60-2429"><a href="#cb60-2429" aria-hidden="true" tabindex="-1"></a>arrayInitialGi <span class="op">=</span> [<span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.01</span>]<span class="op">;</span></span>
<span id="cb60-2430"><a href="#cb60-2430" aria-hidden="true" tabindex="-1"></a>arrayNewGi <span class="op">=</span> arrayInitialGi<span class="op">.</span><span class="fu">toReversed</span>()<span class="op">;</span></span>
<span id="cb60-2431"><a href="#cb60-2431" aria-hidden="true" tabindex="-1"></a>betaContribData <span class="op">=</span> {</span>
<span id="cb60-2432"><a href="#cb60-2432" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> betaContribData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb60-2433"><a href="#cb60-2433" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> arrayAi<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb60-2434"><a href="#cb60-2434" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> Ai <span class="op">=</span> arrayAi[i]<span class="op">;</span></span>
<span id="cb60-2435"><a href="#cb60-2435" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialGi <span class="op">=</span> arrayInitialGi[i]<span class="op">;</span></span>
<span id="cb60-2436"><a href="#cb60-2436" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialBeta2 <span class="op">=</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> initialGi)<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb60-2437"><a href="#cb60-2437" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newGi <span class="op">=</span> arrayNewGi[i]<span class="op">;</span></span>
<span id="cb60-2438"><a href="#cb60-2438" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newBeta2 <span class="op">=</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> newGi)<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb60-2439"><a href="#cb60-2439" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Initial Gᵢ"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> initialGi })<span class="op">;</span></span>
<span id="cb60-2440"><a href="#cb60-2440" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Initial βᵢ²"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> initialBeta2 })<span class="op">;</span></span>
<span id="cb60-2441"><a href="#cb60-2441" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"New Gᵢ"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> newGi })<span class="op">;</span></span>
<span id="cb60-2442"><a href="#cb60-2442" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"New βᵢ²"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> newBeta2 })<span class="op">;</span></span>
<span id="cb60-2443"><a href="#cb60-2443" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-2444"><a href="#cb60-2444" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> betaContribData<span class="op">;</span></span>
<span id="cb60-2445"><a href="#cb60-2445" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb60-2446"><a href="#cb60-2446" aria-hidden="true" tabindex="-1"></a>getInitialG <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Initial Gᵢ"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2447"><a href="#cb60-2447" aria-hidden="true" tabindex="-1"></a>getInitialBeta2 <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Initial βᵢ²"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2448"><a href="#cb60-2448" aria-hidden="true" tabindex="-1"></a>getNewG <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"New Gᵢ"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2449"><a href="#cb60-2449" aria-hidden="true" tabindex="-1"></a>getNewBeta2 <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"New βᵢ²"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2450"><a href="#cb60-2450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2451"><a href="#cb60-2451" aria-hidden="true" tabindex="-1"></a>domainG <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(arrayInitialGi)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(arrayNewGi))]<span class="op">;</span></span>
<span id="cb60-2452"><a href="#cb60-2452" aria-hidden="true" tabindex="-1"></a>rangeBeta2 <span class="op">=</span> [</span>
<span id="cb60-2453"><a href="#cb60-2453" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb60-2454"><a href="#cb60-2454" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(</span>
<span id="cb60-2455"><a href="#cb60-2455" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">max</span>(betaContribData<span class="op">,</span> getInitialBeta2)<span class="op">,</span></span>
<span id="cb60-2456"><a href="#cb60-2456" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">max</span>(betaContribData<span class="op">,</span> getNewBeta2)<span class="op">,</span></span>
<span id="cb60-2457"><a href="#cb60-2457" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb60-2458"><a href="#cb60-2458" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb60-2459"><a href="#cb60-2459" aria-hidden="true" tabindex="-1"></a>scaleG <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(domainG<span class="op">,</span> rangeBeta2)<span class="op">;</span></span>
<span id="cb60-2460"><a href="#cb60-2460" aria-hidden="true" tabindex="-1"></a>mapScaleG <span class="op">=</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>(scaleG)<span class="op">;</span></span>
<span id="cb60-2461"><a href="#cb60-2461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2462"><a href="#cb60-2462" aria-hidden="true" tabindex="-1"></a>paramInitialBeta <span class="op">=</span> <span class="fu">computeBeta</span>(arrayAi<span class="op">,</span> arrayInitialGi)<span class="op">;</span></span>
<span id="cb60-2463"><a href="#cb60-2463" aria-hidden="true" tabindex="-1"></a>paramNewBeta <span class="op">=</span> <span class="fu">computeBeta</span>(arrayAi<span class="op">,</span> arrayNewGi)<span class="op">;</span></span>
<span id="cb60-2464"><a href="#cb60-2464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2465"><a href="#cb60-2465" aria-hidden="true" tabindex="-1"></a>stringInitialBeta <span class="op">=</span> <span class="st">"Initial β = "</span> <span class="op">+</span> paramInitialBeta<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb60-2466"><a href="#cb60-2466" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb60-2467"><a href="#cb60-2467" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb60-2468"><a href="#cb60-2468" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb60-2469"><a href="#cb60-2469" aria-hidden="true" tabindex="-1"></a>stringNewBeta <span class="op">=</span> <span class="st">"New β = "</span> <span class="op">+</span> paramNewBeta<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb60-2470"><a href="#cb60-2470" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb60-2471"><a href="#cb60-2471" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb60-2472"><a href="#cb60-2472" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-16" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb61" data-startfrom="2475" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2474;"><span id="cb61-2475"><a href="#cb61-2475" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb61-2476"><a href="#cb61-2476" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb61-2477"><a href="#cb61-2477" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb61-2478"><a href="#cb61-2478" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="st">"gray"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"red"</span>]<span class="op">,</span></span>
<span id="cb61-2479"><a href="#cb61-2479" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Initial βᵢ²"</span><span class="op">,</span> <span class="st">"New βᵢ²"</span><span class="op">,</span> <span class="st">"Initial Gᵢ"</span><span class="op">,</span> <span class="st">"New Gᵢ"</span>]<span class="op">,</span></span>
<span id="cb61-2480"><a href="#cb61-2480" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb61-2481"><a href="#cb61-2481" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb61-2482"><a href="#cb61-2482" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">4</span>)<span class="op">,</span></span>
<span id="cb61-2483"><a href="#cb61-2483" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ Over 4 Classes"</span><span class="op">,</span></span>
<span id="cb61-2484"><a href="#cb61-2484" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> arrayAi[d]<span class="op">,</span></span>
<span id="cb61-2485"><a href="#cb61-2485" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb61-2486"><a href="#cb61-2486" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> rangeBeta2 }<span class="op">,</span></span>
<span id="cb61-2487"><a href="#cb61-2487" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb61-2488"><a href="#cb61-2488" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb61-2489"><a href="#cb61-2489" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb61-2490"><a href="#cb61-2490" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb61-2491"><a href="#cb61-2491" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb61-2492"><a href="#cb61-2492" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"βᵢ²"</span> })<span class="op">,</span></span>
<span id="cb61-2493"><a href="#cb61-2493" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>(scaleG<span class="op">.</span><span class="fu">ticks</span>()<span class="op">,</span> { <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> scaleG })<span class="op">,</span></span>
<span id="cb61-2494"><a href="#cb61-2494" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(betaContribData<span class="op">,</span> {</span>
<span id="cb61-2495"><a href="#cb61-2495" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb61-2496"><a href="#cb61-2496" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span><span class="op">,</span></span>
<span id="cb61-2497"><a href="#cb61-2497" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialBeta2<span class="op">,</span></span>
<span id="cb61-2498"><a href="#cb61-2498" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2499"><a href="#cb61-2499" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb61-2500"><a href="#cb61-2500" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(betaContribData<span class="op">,</span> {</span>
<span id="cb61-2501"><a href="#cb61-2501" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span><span class="op">,</span></span>
<span id="cb61-2502"><a href="#cb61-2502" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb61-2503"><a href="#cb61-2503" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewBeta2<span class="op">,</span></span>
<span id="cb61-2504"><a href="#cb61-2504" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2505"><a href="#cb61-2505" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb61-2506"><a href="#cb61-2506" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2507"><a href="#cb61-2507" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2508"><a href="#cb61-2508" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialG<span class="op">,</span></span>
<span id="cb61-2509"><a href="#cb61-2509" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2510"><a href="#cb61-2510" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb61-2511"><a href="#cb61-2511" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2512"><a href="#cb61-2512" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2513"><a href="#cb61-2513" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2514"><a href="#cb61-2514" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialG<span class="op">,</span></span>
<span id="cb61-2515"><a href="#cb61-2515" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2516"><a href="#cb61-2516" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2517"><a href="#cb61-2517" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2518"><a href="#cb61-2518" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2519"><a href="#cb61-2519" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewG<span class="op">,</span></span>
<span id="cb61-2520"><a href="#cb61-2520" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2521"><a href="#cb61-2521" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb61-2522"><a href="#cb61-2522" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2523"><a href="#cb61-2523" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2524"><a href="#cb61-2524" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2525"><a href="#cb61-2525" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewG<span class="op">,</span></span>
<span id="cb61-2526"><a href="#cb61-2526" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2527"><a href="#cb61-2527" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2528"><a href="#cb61-2528" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([stringInitialBeta]<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fl">0.23</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="st">"blue"</span> })<span class="op">,</span></span>
<span id="cb61-2529"><a href="#cb61-2529" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([stringNewBeta]<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fl">0.23</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="st">"red"</span> })<span class="op">,</span></span>
<span id="cb61-2530"><a href="#cb61-2530" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb61-2531"><a href="#cb61-2531" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-61" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-example-of-g-stake-on-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22: Example of <strong>G</strong> allocation on <span class="math inline">\beta</span>.
</figcaption>
</figure>
</div>
<p><a href="#fig-example-of-g-stake-on-beta" class="quarto-xref">Figure&nbsp;22</a> shows <span class="math inline">\beta</span>’s sensitivity to <strong>G</strong> allocation as a function of <strong>A</strong> allocation; that is to say that a large <span class="math inline">G_i</span> stake on a small <span class="math inline">A_i</span> stake has limited effects&nbsp;(notwithstanding other consequential factors).</p>
</section>
<section id="sec-allocation-of-risk-premium" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="sec-allocation-of-risk-premium"><span class="header-section-number">3.3.3</span> Allocation of Risk Premium</h4>
<p>The full issuance of <strong>A</strong> tokens is depicted below including now the Risk Premium for the liquidity pools accordingly.</p>
<div id="fig-a-token-flow-structure" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A token flow structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-token-flow-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/a-token-flow-structure.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-token-flow-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23: <strong>A</strong> token flow structure.
</figcaption>
</figure>
</div>
</section>
<section id="sec-share-of-risk-premium" class="level4" data-number="3.3.4">
<h4 data-number="3.3.4" class="anchored" data-anchor-id="sec-share-of-risk-premium"><span class="header-section-number">3.3.4</span> Share of Risk Premium</h4>
<p>The Risk Premium allocation is shared between user-locked <strong>G</strong> tokens, <span class="overline"><strong>AG</strong></span>. and <span class="overline"><strong>AQ</strong></span> pools, with shares <span class="math inline">\lambda_{GG}</span>, <span class="math inline">\lambda_G</span>, and <span class="math inline">\lambda_Q</span> respectively.</p>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">G_G</span>: Total <strong>G</strong> tokens in the <span class="overline"><strong>AG</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>G</strong>.</p></li>
<li><p><span class="math inline">A_G</span>: Total <strong>A</strong>&nbsp;tokens in the <span class="overline"><strong>AG</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
<li><p><span class="math inline">A_Q</span>: Total <strong>A</strong>&nbsp;tokens in the <span class="overline"><strong>AQ</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
</ul>
<p>The allocation to user-locked <strong>G</strong> tokens, <span class="math inline">\lambda_{GG}</span>:</p>
<p><span id="eq-lambda-gg"><span class="math display">
\lambda_{GG} = \frac{1 - A_Q}{1 + \left( \frac{\sum_{i=1}^{n}{G_i}}{G_G} \right)^2}
\tag{23}</span></span></p>
<div id="fig-g-stake-allocation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="G stake allocation.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-g-stake-allocation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb62" data-startfrom="2612" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2611;"><span id="cb62-2612"><a href="#cb62-2612" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaGG</span>(AQ<span class="op">,</span> Gi<span class="op">,</span> GG) {</span>
<span id="cb62-2613"><a href="#cb62-2613" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> AQ) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> (Gi <span class="op">/</span> GG)<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb62-2614"><a href="#cb62-2614" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-2615"><a href="#cb62-2615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2616"><a href="#cb62-2616" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">changeTranslation</span>(dx<span class="op">,</span> dy) {</span>
<span id="cb62-2617"><a href="#cb62-2617" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">function</span> () {</span>
<span id="cb62-2618"><a href="#cb62-2618" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svgTransformList <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">transform</span><span class="op">.</span><span class="at">baseVal</span><span class="op">;</span></span>
<span id="cb62-2619"><a href="#cb62-2619" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (svgTransformList<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb62-2620"><a href="#cb62-2620" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"SVGTransformList must only contain one translation"</span>)<span class="op">;</span></span>
<span id="cb62-2621"><a href="#cb62-2621" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-2622"><a href="#cb62-2622" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {e<span class="op">,</span> f} <span class="op">=</span> svgTransformList<span class="op">.</span><span class="fu">consolidate</span>()<span class="op">.</span><span class="at">matrix</span><span class="op">;</span></span>
<span id="cb62-2623"><a href="#cb62-2623" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`translate(</span><span class="sc">${</span>e <span class="op">+</span> dx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>f <span class="op">+</span> dy<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb62-2624"><a href="#cb62-2624" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-2625"><a href="#cb62-2625" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-62-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-62-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb63" data-startfrom="2628" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2627;"><span id="cb63-2628"><a href="#cb63-2628" aria-hidden="true" tabindex="-1"></a>lambdaGGData <span class="op">=</span> {</span>
<span id="cb63-2629"><a href="#cb63-2629" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambdaGGData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb63-2630"><a href="#cb63-2630" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb63-2631"><a href="#cb63-2631" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAQ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAQ <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb63-2632"><a href="#cb63-2632" aria-hidden="true" tabindex="-1"></a>      lambdaGGData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb63-2633"><a href="#cb63-2633" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb63-2634"><a href="#cb63-2634" aria-hidden="true" tabindex="-1"></a>        <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb63-2635"><a href="#cb63-2635" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb63-2636"><a href="#cb63-2636" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaGG</span>(paramAQ<span class="op">,</span> paramGi<span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> paramGi)<span class="op">,</span></span>
<span id="cb63-2637"><a href="#cb63-2637" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb63-2638"><a href="#cb63-2638" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-2639"><a href="#cb63-2639" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-2640"><a href="#cb63-2640" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> lambdaGGData<span class="op">;</span></span>
<span id="cb63-2641"><a href="#cb63-2641" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-63" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb64" data-startfrom="2645" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2644;"><span id="cb64-2645"><a href="#cb64-2645" aria-hidden="true" tabindex="-1"></a>plotLambdaGG <span class="op">=</span> {</span>
<span id="cb64-2646"><a href="#cb64-2646" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotLambdaGG <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb64-2647"><a href="#cb64-2647" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb64-2648"><a href="#cb64-2648" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb64-2649"><a href="#cb64-2649" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb64-2650"><a href="#cb64-2650" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb64-2651"><a href="#cb64-2651" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb64-2652"><a href="#cb64-2652" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb64-2653"><a href="#cb64-2653" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb64-2654"><a href="#cb64-2654" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"A  "</span> }<span class="op">,</span></span>
<span id="cb64-2655"><a href="#cb64-2655" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb64-2656"><a href="#cb64-2656" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb64-2657"><a href="#cb64-2657" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb64-2658"><a href="#cb64-2658" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(lambdaGGData<span class="op">,</span> {</span>
<span id="cb64-2659"><a href="#cb64-2659" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2660"><a href="#cb64-2660" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2661"><a href="#cb64-2661" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2662"><a href="#cb64-2662" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2663"><a href="#cb64-2663" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb64-2664"><a href="#cb64-2664" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb64-2665"><a href="#cb64-2665" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(lambdaGGData<span class="op">,</span> {</span>
<span id="cb64-2666"><a href="#cb64-2666" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"aq"</span><span class="op">,</span></span>
<span id="cb64-2667"><a href="#cb64-2667" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb64-2668"><a href="#cb64-2668" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2669"><a href="#cb64-2669" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2670"><a href="#cb64-2670" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb64-2671"><a href="#cb64-2671" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb64-2672"><a href="#cb64-2672" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb64-2673"><a href="#cb64-2673" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb64-2674"><a href="#cb64-2674" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb64-2675"><a href="#cb64-2675" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb64-2676"><a href="#cb64-2676" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb64-2677"><a href="#cb64-2677" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb64-2678"><a href="#cb64-2678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2679"><a href="#cb64-2679" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGG)</span>
<span id="cb64-2680"><a href="#cb64-2680" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='x-axis label']"</span>)</span>
<span id="cb64-2681"><a href="#cb64-2681" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb64-2682"><a href="#cb64-2682" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb64-2683"><a href="#cb64-2683" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="fl">1.5</span>))</span>
<span id="cb64-2684"><a href="#cb64-2684" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb64-2685"><a href="#cb64-2685" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb64-2686"><a href="#cb64-2686" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb64-2687"><a href="#cb64-2687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2688"><a href="#cb64-2688" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotLambdaGG<span class="op">;</span></span>
<span id="cb64-2689"><a href="#cb64-2689" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-64" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-g-stake-allocation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24: <strong>G</strong> stake allocation&nbsp;(assuming <span class="math inline">G_G = 1 - G_i</span>).
</figcaption>
</figure>
</div>
<p>Noting the relationship between <span class="math inline">G</span> and <span class="math inline">\beta</span>, and particularly if <span class="math inline">G = 0</span>, <span class="math inline">\beta = 0</span>.</p>
<p>The residual share, <span class="math inline">1 - \lambda_{GG}</span>, is split between the liquidity pools:</p>
<p><span id="eq-lambda-g"><span class="math display">
\lambda_G = (1 - \lambda_{GG}) \frac{2 A_G}{2 A_G + A_Q \sqrt 2}
\tag{24}</span></span></p>
<p>For completeness:</p>
<p><span id="eq-lambda-q"><span class="math display">
\lambda_Q = 1 - \lambda_{GG} - \lambda_G
\tag{25}</span></span></p>
<div id="fig-liquidity-pool-split" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Liquidity pool split.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-liquidity-pool-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb65" data-startfrom="2718" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2717;"><span id="cb65-2718"><a href="#cb65-2718" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaG</span>(AQ<span class="op">,</span> AG) {</span>
<span id="cb65-2719"><a href="#cb65-2719" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> AG <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> AG <span class="op">+</span> AQ <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb65-2720"><a href="#cb65-2720" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-65" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb66" data-startfrom="2724" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2723;"><span id="cb66-2724"><a href="#cb66-2724" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaQ</span>(AQ<span class="op">,</span> AG) {</span>
<span id="cb66-2725"><a href="#cb66-2725" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> <span class="fu">computeLambdaG</span>(AQ<span class="op">,</span> AG)<span class="op">;</span></span>
<span id="cb66-2726"><a href="#cb66-2726" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-66" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb67" data-startfrom="2730" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2729;"><span id="cb67-2730"><a href="#cb67-2730" aria-hidden="true" tabindex="-1"></a>lambdaGQData <span class="op">=</span> {</span>
<span id="cb67-2731"><a href="#cb67-2731" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambdaGQData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb67-2732"><a href="#cb67-2732" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramAG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb67-2733"><a href="#cb67-2733" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAQ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAQ <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb67-2734"><a href="#cb67-2734" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramAG <span class="op">+</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb67-2735"><a href="#cb67-2735" aria-hidden="true" tabindex="-1"></a>        lambdaGQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb67-2736"><a href="#cb67-2736" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"Relative 𝗔𝗚 Liquidity Pool Share"</span><span class="op">,</span></span>
<span id="cb67-2737"><a href="#cb67-2737" aria-hidden="true" tabindex="-1"></a>          <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb67-2738"><a href="#cb67-2738" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ag</span><span class="op">:</span> paramAG<span class="op">,</span></span>
<span id="cb67-2739"><a href="#cb67-2739" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaG</span>(paramAQ<span class="op">,</span> paramAG)<span class="op">,</span></span>
<span id="cb67-2740"><a href="#cb67-2740" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb67-2741"><a href="#cb67-2741" aria-hidden="true" tabindex="-1"></a>        lambdaGQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb67-2742"><a href="#cb67-2742" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"Relative 𝗔𝗤 Liquidity Pool Share"</span><span class="op">,</span></span>
<span id="cb67-2743"><a href="#cb67-2743" aria-hidden="true" tabindex="-1"></a>          <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb67-2744"><a href="#cb67-2744" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ag</span><span class="op">:</span> paramAG<span class="op">,</span></span>
<span id="cb67-2745"><a href="#cb67-2745" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaQ</span>(paramAQ<span class="op">,</span> paramAG)<span class="op">,</span></span>
<span id="cb67-2746"><a href="#cb67-2746" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb67-2747"><a href="#cb67-2747" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-2748"><a href="#cb67-2748" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb67-2749"><a href="#cb67-2749" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb67-2750"><a href="#cb67-2750" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> lambdaGQData<span class="op">;</span></span>
<span id="cb67-2751"><a href="#cb67-2751" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-67" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb68" data-startfrom="2755" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2754;"><span id="cb68-2755"><a href="#cb68-2755" aria-hidden="true" tabindex="-1"></a>plotLambdaGQ <span class="op">=</span> {</span>
<span id="cb68-2756"><a href="#cb68-2756" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotLambdaGQ <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb68-2757"><a href="#cb68-2757" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb68-2758"><a href="#cb68-2758" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb68-2759"><a href="#cb68-2759" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb68-2760"><a href="#cb68-2760" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb68-2761"><a href="#cb68-2761" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb68-2762"><a href="#cb68-2762" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb68-2763"><a href="#cb68-2763" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb68-2764"><a href="#cb68-2764" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb68-2765"><a href="#cb68-2765" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"A  "</span> }<span class="op">,</span></span>
<span id="cb68-2766"><a href="#cb68-2766" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb68-2767"><a href="#cb68-2767" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb68-2768"><a href="#cb68-2768" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb68-2769"><a href="#cb68-2769" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"A"</span><span class="op">,</span></span>
<span id="cb68-2770"><a href="#cb68-2770" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb68-2771"><a href="#cb68-2771" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb68-2772"><a href="#cb68-2772" aria-hidden="true" tabindex="-1"></a>    <span class="dt">className</span><span class="op">:</span> <span class="st">"LambdaGQ"</span><span class="op">,</span></span>
<span id="cb68-2773"><a href="#cb68-2773" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb68-2774"><a href="#cb68-2774" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb68-2775"><a href="#cb68-2775" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(lambdaGQData<span class="op">,</span> {</span>
<span id="cb68-2776"><a href="#cb68-2776" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2777"><a href="#cb68-2777" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2778"><a href="#cb68-2778" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ag</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2779"><a href="#cb68-2779" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ag</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2780"><a href="#cb68-2780" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb68-2781"><a href="#cb68-2781" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb68-2782"><a href="#cb68-2782" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb68-2783"><a href="#cb68-2783" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(lambdaGQData<span class="op">,</span> {</span>
<span id="cb68-2784"><a href="#cb68-2784" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"aq"</span><span class="op">,</span></span>
<span id="cb68-2785"><a href="#cb68-2785" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"ag"</span><span class="op">,</span></span>
<span id="cb68-2786"><a href="#cb68-2786" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb68-2787"><a href="#cb68-2787" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb68-2788"><a href="#cb68-2788" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb68-2789"><a href="#cb68-2789" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb68-2790"><a href="#cb68-2790" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb68-2791"><a href="#cb68-2791" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb68-2792"><a href="#cb68-2792" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb68-2793"><a href="#cb68-2793" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb68-2794"><a href="#cb68-2794" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb68-2795"><a href="#cb68-2795" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb68-2796"><a href="#cb68-2796" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb68-2797"><a href="#cb68-2797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2798"><a href="#cb68-2798" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGQ)</span>
<span id="cb68-2799"><a href="#cb68-2799" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='x-axis label']"</span>)</span>
<span id="cb68-2800"><a href="#cb68-2800" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb68-2801"><a href="#cb68-2801" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb68-2802"><a href="#cb68-2802" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="fl">1.5</span>))</span>
<span id="cb68-2803"><a href="#cb68-2803" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb68-2804"><a href="#cb68-2804" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb68-2805"><a href="#cb68-2805" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb68-2806"><a href="#cb68-2806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2807"><a href="#cb68-2807" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGQ)</span>
<span id="cb68-2808"><a href="#cb68-2808" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb68-2809"><a href="#cb68-2809" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb68-2810"><a href="#cb68-2810" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb68-2811"><a href="#cb68-2811" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb68-2812"><a href="#cb68-2812" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">14</span><span class="op">,</span> <span class="fl">4.1</span>))</span>
<span id="cb68-2813"><a href="#cb68-2813" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb68-2814"><a href="#cb68-2814" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb68-2815"><a href="#cb68-2815" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"G"</span>)<span class="op">;</span></span>
<span id="cb68-2816"><a href="#cb68-2816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2817"><a href="#cb68-2817" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotLambdaGQ<span class="op">;</span></span>
<span id="cb68-2818"><a href="#cb68-2818" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-68" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-liquidity-pool-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25: Liquidity pool split <span class="math inline">\lambda_G, \lambda_Q</span>.
</figcaption>
</figure>
</div>
</section>
<section id="sec-risk-premium-distribution" class="level4" data-number="3.3.5">
<h4 data-number="3.3.5" class="anchored" data-anchor-id="sec-risk-premium-distribution"><span class="header-section-number">3.3.5</span> Risk Premium Distribution</h4>
<p>For <span class="math inline">\lambda_{GG}</span>, <span class="math inline">\lambda_G</span>, <span class="math inline">\lambda_Q</span> we apply <span class="math inline">\beta</span>:</p>
<p><span id="eq-capital-lambda"><span class="math display">
\Lambda_X = \lambda_X \, \beta, \quad \text{for } X \in \{GG, G, Q\}
\tag{26}</span></span></p>
<p>Taking <span class="math inline">b</span> as a discount parameter:</p>
<p><span id="eq-discount-parameter"><span class="math display">
b = \frac{\sum_1^{40} Z_t \, S_t \, B_t}{\sum_1^{40} Z_t \, S_t }
\tag{27}</span></span></p>
<p>The total Risk Premium tokens <span class="math inline">R_\lambda</span>:</p>
<p><span id="eq-risk-premium"><span class="math display">
R_\lambda = b \, R \, (\Lambda_{GG} + \Lambda_G + \Lambda_Q)
\tag{28}</span></span></p>
<p>The allocations of <span class="math inline">R_\lambda</span> are pro-rata to <span class="math inline">\Lambda_{GG}</span>, <span class="math inline">\Lambda_G</span>, <span class="math inline">\Lambda_Q</span>, and thereafter:</p>
<ol type="1">
<li><p>Locked <strong>G</strong>: <span class="math inline">\Lambda_{GG}</span> in proportion to <strong>G</strong>.</p></li>
<li><p>Locked <span class="overline"><strong>AG</strong></span>, <span class="overline"><strong>AQ</strong></span> tokens are allocated a weighting <span class="math inline">G_t</span>, <span class="math inline">Q_t</span> depending on their time bucket <span class="math inline">t</span>:</p>
<p><span id="eq-risky-premium-weighting-ag-pool"><span class="math display">
G_t = \frac{Z_t \, L_{Gt} \, B_t}{\sum Z_t \, L_{Gt} \, B_t}
  \tag{29}</span></span></p>
<p><span id="eq-risky-premium-weighting-aq-pool"><span class="math display">
Q_t = \frac{Z_t \, L_{Qt} \, B_t}{\sum Z_t \, L_{Qt} \, B_t}
  \tag{30}</span></span></p>
<p>Where <span class="math inline">L_{Gt}</span>, <span class="math inline">L_{Qt}</span> are the proportion of all liquidity locked in each time bucket for <span class="overline"><strong>AG</strong></span> and <span class="overline"><strong>AQ</strong></span> respectively.</p></li>
</ol>
<p>Thereafter each time bucket allocation is proportionate to staked liquidity provider token holdings.</p>
</section>
</section>
<section id="sec-interactive-model" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="sec-interactive-model"><span class="header-section-number">3.4</span> Interactive Model</h3>
<p>This additional section is only in the interactive version of the whitepaper. It presents an interactive model of the AAM where each parameter of interest can be adjusted by the reader.</p>
<p>In <a href="#sec-kvcm-tokens-minted-when-the-aam-purchases-carbon" class="quarto-xref">Section&nbsp;3.4.1</a>, a carbon holder sells carbon to the AAM in exchange for <strong>A</strong> tokens; from the point of view of the AAM, this represents a carbon purchase. In <a href="#sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens" class="quarto-xref">Section&nbsp;3.4.2</a>, a holder of <strong>A</strong> tokens burns them to buy carbon from the AAM; from the point of view of the AAM, this represents a carbon sale.</p>
<section id="sec-kvcm-tokens-minted-when-the-aam-purchases-carbon" class="level4" data-number="3.4.1">
<h4 data-number="3.4.1" class="anchored" data-anchor-id="sec-kvcm-tokens-minted-when-the-aam-purchases-carbon"><span class="header-section-number">3.4.1</span> kVCM Tokens Minted When the AAM Purchases Carbon</h4>
<p>In this section, the reader controls how many present-value tonnes of carbon class <span class="math inline">i</span> are purchased by the AAM. The number of <strong>A</strong> tokens emitted in exchange is calculated in real time. The price of carbon class <span class="math inline">i</span> is calculated by dividing the number of <strong>A</strong> tokens emitted by the AAM by the number of present-value tonnes of carbon class <span class="math inline">i</span> purchased by the AAM.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb69" data-startfrom="2916" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2915;"><span id="cb69-2916"><a href="#cb69-2916" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">piecewiseLogTransform</span>(xTran <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb69-2917"><a href="#cb69-2917" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="kw">=&gt;</span> x <span class="op">&gt;</span> xTran <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x) <span class="op">:</span> x <span class="op">-</span> xTran <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(xTran)<span class="op">;</span></span>
<span id="cb69-2918"><a href="#cb69-2918" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2919"><a href="#cb69-2919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2920"><a href="#cb69-2920" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">piecewiseLogInvert</span>(xTran <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb69-2921"><a href="#cb69-2921" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> y <span class="kw">=&gt;</span> y <span class="op">&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(xTran) <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(y) <span class="op">:</span> y <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(xTran) <span class="op">+</span> xTran<span class="op">;</span></span>
<span id="cb69-2922"><a href="#cb69-2922" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2923"><a href="#cb69-2923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2924"><a href="#cb69-2924" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setInput</span>(input<span class="op">,</span> value) {</span>
<span id="cb69-2925"><a href="#cb69-2925" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb69-2926"><a href="#cb69-2926" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb69-2927"><a href="#cb69-2927" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2928"><a href="#cb69-2928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2929"><a href="#cb69-2929" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">numDigits</span>(x) {</span>
<span id="cb69-2930"><a href="#cb69-2930" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> (<span class="dv">1</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(x)))<span class="op">;</span></span>
<span id="cb69-2931"><a href="#cb69-2931" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb70" data-startfrom="2935" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2934;"><span id="cb70-2935"><a href="#cb70-2935" aria-hidden="true" tabindex="-1"></a>defaultAValue <span class="op">=</span> <span class="fl">2e6</span><span class="op">;</span></span>
<span id="cb70-2936"><a href="#cb70-2936" aria-hidden="true" tabindex="-1"></a>defaultASupply <span class="op">=</span> <span class="fl">2e7</span><span class="op">;</span></span>
<span id="cb70-2937"><a href="#cb70-2937" aria-hidden="true" tabindex="-1"></a>defaultPresentTonnes <span class="op">=</span> <span class="fl">1e7</span><span class="op">;</span></span>
<span id="cb70-2938"><a href="#cb70-2938" aria-hidden="true" tabindex="-1"></a>defaultDeltaTonnes <span class="op">=</span> <span class="fl">1e2</span><span class="op">;</span></span>
<span id="cb70-2939"><a href="#cb70-2939" aria-hidden="true" tabindex="-1"></a>defaultAi <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb70-2940"><a href="#cb70-2940" aria-hidden="true" tabindex="-1"></a>defaultGi <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb71" data-startfrom="2943" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2942;"><span id="cb71-2943"><a href="#cb71-2943" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>(</span>
<span id="cb71-2944"><a href="#cb71-2944" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">"Reset"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb71-2945"><a href="#cb71-2945" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAValue<span class="op">,</span> defaultAValue)<span class="op">;</span></span>
<span id="cb71-2946"><a href="#cb71-2946" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputASupply<span class="op">,</span> defaultASupply)<span class="op">;</span></span>
<span id="cb71-2947"><a href="#cb71-2947" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputPresentTonnes<span class="op">,</span> defaultPresentTonnes)<span class="op">;</span></span>
<span id="cb71-2948"><a href="#cb71-2948" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputDeltaTonnes<span class="op">,</span> defaultDeltaTonnes)<span class="op">;</span></span>
<span id="cb71-2949"><a href="#cb71-2949" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAi<span class="op">,</span> defaultAi)<span class="op">;</span></span>
<span id="cb71-2950"><a href="#cb71-2950" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputGi<span class="op">,</span> defaultGi)<span class="op">;</span></span>
<span id="cb71-2951"><a href="#cb71-2951" aria-hidden="true" tabindex="-1"></a>  }]]<span class="op">,</span></span>
<span id="cb71-2952"><a href="#cb71-2952" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-71" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb72" data-startfrom="2957" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2956;"><span id="cb72-2957"><a href="#cb72-2957" aria-hidden="true" tabindex="-1"></a>viewof inputAValue <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e5</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb72-2958"><a href="#cb72-2958" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Market cap. of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb72-2959"><a href="#cb72-2959" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb72-2960"><a href="#cb72-2960" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAValue<span class="op">,</span></span>
<span id="cb72-2961"><a href="#cb72-2961" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2962"><a href="#cb72-2962" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2963"><a href="#cb72-2963" aria-hidden="true" tabindex="-1"></a>viewof inputASupply <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e6</span><span class="op">,</span> <span class="fl">1e10</span>]<span class="op">,</span> {</span>
<span id="cb72-2964"><a href="#cb72-2964" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Supply of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb72-2965"><a href="#cb72-2965" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb72-2966"><a href="#cb72-2966" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultASupply<span class="op">,</span></span>
<span id="cb72-2967"><a href="#cb72-2967" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2968"><a href="#cb72-2968" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2969"><a href="#cb72-2969" aria-hidden="true" tabindex="-1"></a>viewof inputPresentTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb72-2970"><a href="#cb72-2970" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } </span><span class="sc">\b</span><span class="vs">ar C_i`</span><span class="op">,</span></span>
<span id="cb72-2971"><a href="#cb72-2971" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb72-2972"><a href="#cb72-2972" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultPresentTonnes<span class="op">,</span></span>
<span id="cb72-2973"><a href="#cb72-2973" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-3</span>)<span class="op">,</span></span>
<span id="cb72-2974"><a href="#cb72-2974" aria-hidden="true" tabindex="-1"></a>  <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-3</span>)<span class="op">,</span></span>
<span id="cb72-2975"><a href="#cb72-2975" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2976"><a href="#cb72-2976" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-3</span><span class="op">,</span> <span class="fl">1e7</span>]<span class="op">,</span> {</span>
<span id="cb72-2977"><a href="#cb72-2977" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased tonnes}`</span><span class="op">,</span></span>
<span id="cb72-2978"><a href="#cb72-2978" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb72-2979"><a href="#cb72-2979" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultDeltaTonnes<span class="op">,</span></span>
<span id="cb72-2980"><a href="#cb72-2980" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2981"><a href="#cb72-2981" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2982"><a href="#cb72-2982" aria-hidden="true" tabindex="-1"></a>viewof inputAi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb72-2983"><a href="#cb72-2983" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } A_i`</span><span class="op">,</span></span>
<span id="cb72-2984"><a href="#cb72-2984" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb72-2985"><a href="#cb72-2985" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAi<span class="op">,</span></span>
<span id="cb72-2986"><a href="#cb72-2986" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb72-2987"><a href="#cb72-2987" aria-hidden="true" tabindex="-1"></a>  <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb72-2988"><a href="#cb72-2988" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2989"><a href="#cb72-2989" aria-hidden="true" tabindex="-1"></a>viewof inputGi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb72-2990"><a href="#cb72-2990" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } G_i`</span><span class="op">,</span></span>
<span id="cb72-2991"><a href="#cb72-2991" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb72-2992"><a href="#cb72-2992" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultGi<span class="op">,</span></span>
<span id="cb72-2993"><a href="#cb72-2993" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb73" data-startfrom="2997" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2996;"><span id="cb73-2997"><a href="#cb73-2997" aria-hidden="true" tabindex="-1"></a>paramDeltaA <span class="op">=</span> <span class="fu">computeTrueDeltaA</span>(</span>
<span id="cb73-2998"><a href="#cb73-2998" aria-hidden="true" tabindex="-1"></a>  inputAi<span class="op">,</span></span>
<span id="cb73-2999"><a href="#cb73-2999" aria-hidden="true" tabindex="-1"></a>  inputGi<span class="op">,</span></span>
<span id="cb73-3000"><a href="#cb73-3000" aria-hidden="true" tabindex="-1"></a>  inputPresentTonnes<span class="op">,</span></span>
<span id="cb73-3001"><a href="#cb73-3001" aria-hidden="true" tabindex="-1"></a>  inputDeltaTonnes<span class="op">,</span></span>
<span id="cb73-3002"><a href="#cb73-3002" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb73-3003"><a href="#cb73-3003" aria-hidden="true" tabindex="-1"></a>paramDeltaTonnes <span class="op">=</span> paramDeltaA <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputDeltaTonnes<span class="op">;</span></span>
<span id="cb73-3004"><a href="#cb73-3004" aria-hidden="true" tabindex="-1"></a>paramAEmitted <span class="op">=</span> paramDeltaA <span class="op">*</span> inputASupply<span class="op">;</span></span>
<span id="cb73-3005"><a href="#cb73-3005" aria-hidden="true" tabindex="-1"></a>paramAPrice <span class="op">=</span> inputAValue <span class="op">/</span> inputASupply<span class="op">;</span></span>
<span id="cb73-3006"><a href="#cb73-3006" aria-hidden="true" tabindex="-1"></a>paramBarCiPrice <span class="op">=</span> inputAValue <span class="op">*</span> paramDeltaA <span class="op">/</span> inputDeltaTonnes<span class="op">;</span></span>
<span id="cb73-3007"><a href="#cb73-3007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3008"><a href="#cb73-3008" aria-hidden="true" tabindex="-1"></a>stringASupply <span class="op">=</span> inputASupply<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-3009"><a href="#cb73-3009" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-3010"><a href="#cb73-3010" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-3011"><a href="#cb73-3011" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-3012"><a href="#cb73-3012" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-3013"><a href="#cb73-3013" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-3014"><a href="#cb73-3014" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb73-3015"><a href="#cb73-3015" aria-hidden="true" tabindex="-1"></a>stringPresentTonnes <span class="op">=</span> inputPresentTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-3016"><a href="#cb73-3016" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-3017"><a href="#cb73-3017" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-3018"><a href="#cb73-3018" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-3019"><a href="#cb73-3019" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-3020"><a href="#cb73-3020" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-3021"><a href="#cb73-3021" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb73-3022"><a href="#cb73-3022" aria-hidden="true" tabindex="-1"></a>stringAEmitted <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> paramAEmitted<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-3023"><a href="#cb73-3023" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-3024"><a href="#cb73-3024" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-3025"><a href="#cb73-3025" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-3026"><a href="#cb73-3026" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-3027"><a href="#cb73-3027" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-3028"><a href="#cb73-3028" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb73-3029"><a href="#cb73-3029" aria-hidden="true" tabindex="-1"></a>stringDeltaTonnes <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> paramDeltaTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-3030"><a href="#cb73-3030" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-3031"><a href="#cb73-3031" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-3032"><a href="#cb73-3032" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">3</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-3033"><a href="#cb73-3033" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">3</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-3034"><a href="#cb73-3034" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-3035"><a href="#cb73-3035" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb73-3036"><a href="#cb73-3036" aria-hidden="true" tabindex="-1"></a>stringAPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramAPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-3037"><a href="#cb73-3037" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-3038"><a href="#cb73-3038" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-3039"><a href="#cb73-3039" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice))<span class="op">,</span></span>
<span id="cb73-3040"><a href="#cb73-3040" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice))<span class="op">,</span></span>
<span id="cb73-3041"><a href="#cb73-3041" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-3042"><a href="#cb73-3042" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb73-3043"><a href="#cb73-3043" aria-hidden="true" tabindex="-1"></a>stringBarCiPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramBarCiPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-3044"><a href="#cb73-3044" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-3045"><a href="#cb73-3045" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-3046"><a href="#cb73-3046" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramBarCiPrice))<span class="op">,</span></span>
<span id="cb73-3047"><a href="#cb73-3047" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramBarCiPrice))<span class="op">,</span></span>
<span id="cb73-3048"><a href="#cb73-3048" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-3049"><a href="#cb73-3049" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Supply of <strong>A</strong> Tokens</th>
<th style="text-align: right;">Portfolio Carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-3"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-4"></span></span></td>
</tr>
<tr class="even">
<td><strong>Variation</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-5"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-6"></span></span></td>
</tr>
<tr class="odd">
<td><strong>Unit Price</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-7"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-8"></span></span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens" class="level4" data-number="3.4.2">
<h4 data-number="3.4.2" class="anchored" data-anchor-id="sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens"><span class="header-section-number">3.4.2</span> Carbon Sold by the AAM When it Burns kVCM Tokens</h4>
<p>In this section, the reader controls how many <strong>A</strong> tokens are burnt by the AAM. The number of liquid tonnes of carbon class <span class="math inline">i</span> sold by the AAM in exchange is calculated in real time. The price of carbon is calculated by dividing the number of <strong>A</strong> tokens burnt by the AAM by the number of liquid tonnes of carbon class <span class="math inline">i</span> sold by the AAM.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb74" data-startfrom="3075" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3074;"><span id="cb74-3075"><a href="#cb74-3075" aria-hidden="true" tabindex="-1"></a>defaultLiquidTonnes <span class="op">=</span> <span class="fl">1e7</span><span class="op">;</span></span>
<span id="cb74-3076"><a href="#cb74-3076" aria-hidden="true" tabindex="-1"></a>defaultABurnt <span class="op">=</span> <span class="fl">1e2</span><span class="op">;</span></span>
<span id="cb74-3077"><a href="#cb74-3077" aria-hidden="true" tabindex="-1"></a>defaultGnull <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb74-3078"><a href="#cb74-3078" aria-hidden="true" tabindex="-1"></a>defaultA <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb74-3079"><a href="#cb74-3079" aria-hidden="true" tabindex="-1"></a>defaultS <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb75" data-startfrom="3082" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3081;"><span id="cb75-3082"><a href="#cb75-3082" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>(</span>
<span id="cb75-3083"><a href="#cb75-3083" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">"Reset"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb75-3084"><a href="#cb75-3084" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAValue_<span class="op">,</span> defaultAValue)<span class="op">;</span></span>
<span id="cb75-3085"><a href="#cb75-3085" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputASupply_<span class="op">,</span> defaultASupply)<span class="op">;</span></span>
<span id="cb75-3086"><a href="#cb75-3086" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputLiquidTonnes<span class="op">,</span> defaultLiquidTonnes)<span class="op">;</span></span>
<span id="cb75-3087"><a href="#cb75-3087" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputABurnt<span class="op">,</span> defaultABurnt)<span class="op">;</span></span>
<span id="cb75-3088"><a href="#cb75-3088" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAi<span class="op">,</span> defaultAi)<span class="op">;</span></span>
<span id="cb75-3089"><a href="#cb75-3089" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputGi<span class="op">,</span> defaultGi)<span class="op">;</span></span>
<span id="cb75-3090"><a href="#cb75-3090" aria-hidden="true" tabindex="-1"></a>  }]]<span class="op">,</span></span>
<span id="cb75-3091"><a href="#cb75-3091" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-75" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb76" data-startfrom="3096" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3095;"><span id="cb76-3096"><a href="#cb76-3096" aria-hidden="true" tabindex="-1"></a>viewof inputAValue_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e5</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb76-3097"><a href="#cb76-3097" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Market cap. of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb76-3098"><a href="#cb76-3098" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb76-3099"><a href="#cb76-3099" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAValue<span class="op">,</span></span>
<span id="cb76-3100"><a href="#cb76-3100" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3101"><a href="#cb76-3101" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3102"><a href="#cb76-3102" aria-hidden="true" tabindex="-1"></a>viewof inputASupply_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e6</span><span class="op">,</span> <span class="fl">1e10</span>]<span class="op">,</span> {</span>
<span id="cb76-3103"><a href="#cb76-3103" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Supply of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb76-3104"><a href="#cb76-3104" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb76-3105"><a href="#cb76-3105" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultASupply<span class="op">,</span></span>
<span id="cb76-3106"><a href="#cb76-3106" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3107"><a href="#cb76-3107" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3108"><a href="#cb76-3108" aria-hidden="true" tabindex="-1"></a>viewof inputLiquidTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-3</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb76-3109"><a href="#cb76-3109" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } C_{i0}`</span><span class="op">,</span></span>
<span id="cb76-3110"><a href="#cb76-3110" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb76-3111"><a href="#cb76-3111" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultLiquidTonnes<span class="op">,</span></span>
<span id="cb76-3112"><a href="#cb76-3112" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3113"><a href="#cb76-3113" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3114"><a href="#cb76-3114" aria-hidden="true" tabindex="-1"></a>viewof inputABurnt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-1</span><span class="op">,</span> <span class="fl">1e6</span>]<span class="op">,</span> {</span>
<span id="cb76-3115"><a href="#cb76-3115" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{</span><span class="sc">\t</span><span class="vs">extbf{A} tokens burnt}`</span><span class="op">,</span></span>
<span id="cb76-3116"><a href="#cb76-3116" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-1</span><span class="op">,</span></span>
<span id="cb76-3117"><a href="#cb76-3117" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultABurnt<span class="op">,</span></span>
<span id="cb76-3118"><a href="#cb76-3118" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3119"><a href="#cb76-3119" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3120"><a href="#cb76-3120" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb76-3121"><a href="#cb76-3121" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb76-3122"><a href="#cb76-3122" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } A_i`</span><span class="op">,</span></span>
<span id="cb76-3123"><a href="#cb76-3123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb76-3124"><a href="#cb76-3124" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> defaultAi<span class="op">,</span></span>
<span id="cb76-3125"><a href="#cb76-3125" aria-hidden="true" tabindex="-1"></a>    <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb76-3126"><a href="#cb76-3126" aria-hidden="true" tabindex="-1"></a>    <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb76-3127"><a href="#cb76-3127" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb76-3128"><a href="#cb76-3128" aria-hidden="true" tabindex="-1"></a>  viewof inputAi<span class="op">,</span></span>
<span id="cb76-3129"><a href="#cb76-3129" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-5" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb77" data-startfrom="3130" data-source-offset="-901"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3129;"><span id="cb77-3130"><a href="#cb77-3130" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb77-3131"><a href="#cb77-3131" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb77-3132"><a href="#cb77-3132" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } G_i`</span><span class="op">,</span></span>
<span id="cb77-3133"><a href="#cb77-3133" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb77-3134"><a href="#cb77-3134" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> defaultGi<span class="op">,</span></span>
<span id="cb77-3135"><a href="#cb77-3135" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb77-3136"><a href="#cb77-3136" aria-hidden="true" tabindex="-1"></a>  viewof inputGi<span class="op">,</span></span>
<span id="cb77-3137"><a href="#cb77-3137" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-6" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb78" data-startfrom="3141" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3140;"><span id="cb78-3141"><a href="#cb78-3141" aria-hidden="true" tabindex="-1"></a>paramABurnt <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputABurnt</span>
<span id="cb78-3142"><a href="#cb78-3142" aria-hidden="true" tabindex="-1"></a>paramDeltaA_ <span class="op">=</span> paramABurnt <span class="op">/</span> inputASupply_<span class="op">;</span></span>
<span id="cb78-3143"><a href="#cb78-3143" aria-hidden="true" tabindex="-1"></a>paramDeltaCi <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="op">-</span><span class="dv">0</span> <span class="op">:</span> <span class="fu">computeDeltaCi</span>(</span>
<span id="cb78-3144"><a href="#cb78-3144" aria-hidden="true" tabindex="-1"></a>  inputAi<span class="op">,</span></span>
<span id="cb78-3145"><a href="#cb78-3145" aria-hidden="true" tabindex="-1"></a>  inputGi<span class="op">,</span></span>
<span id="cb78-3146"><a href="#cb78-3146" aria-hidden="true" tabindex="-1"></a>  paramDeltaA_<span class="op">,</span></span>
<span id="cb78-3147"><a href="#cb78-3147" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb78-3148"><a href="#cb78-3148" aria-hidden="true" tabindex="-1"></a>paramDeltaCiTonnes <span class="op">=</span> <span class="op">-</span>paramDeltaCi <span class="op">*</span> inputLiquidTonnes<span class="op">;</span></span>
<span id="cb78-3149"><a href="#cb78-3149" aria-hidden="true" tabindex="-1"></a>paramAPrice_ <span class="op">=</span> inputAValue_ <span class="op">/</span> inputASupply_<span class="op">;</span></span>
<span id="cb78-3150"><a href="#cb78-3150" aria-hidden="true" tabindex="-1"></a>paramCiPrice <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputAValue_ <span class="op">*</span> paramDeltaA_ <span class="op">/</span> paramDeltaCiTonnes<span class="op">;</span></span>
<span id="cb78-3151"><a href="#cb78-3151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3152"><a href="#cb78-3152" aria-hidden="true" tabindex="-1"></a>stringASupply_ <span class="op">=</span> inputASupply_<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3153"><a href="#cb78-3153" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3154"><a href="#cb78-3154" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3155"><a href="#cb78-3155" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3156"><a href="#cb78-3156" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3157"><a href="#cb78-3157" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3158"><a href="#cb78-3158" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb78-3159"><a href="#cb78-3159" aria-hidden="true" tabindex="-1"></a>stringLiquidTonnes <span class="op">=</span> inputLiquidTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3160"><a href="#cb78-3160" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3161"><a href="#cb78-3161" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3162"><a href="#cb78-3162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3163"><a href="#cb78-3163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3164"><a href="#cb78-3164" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3165"><a href="#cb78-3165" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb78-3166"><a href="#cb78-3166" aria-hidden="true" tabindex="-1"></a>stringABurnt <span class="op">=</span> <span class="st">"−"</span> <span class="op">+</span> paramABurnt<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3167"><a href="#cb78-3167" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3168"><a href="#cb78-3168" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3169"><a href="#cb78-3169" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3170"><a href="#cb78-3170" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3171"><a href="#cb78-3171" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3172"><a href="#cb78-3172" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb78-3173"><a href="#cb78-3173" aria-hidden="true" tabindex="-1"></a>stringDeltaCiTonnes <span class="op">=</span> <span class="st">"−"</span> <span class="op">+</span> paramDeltaCiTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3174"><a href="#cb78-3174" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3175"><a href="#cb78-3175" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3176"><a href="#cb78-3176" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3177"><a href="#cb78-3177" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3178"><a href="#cb78-3178" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3179"><a href="#cb78-3179" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb78-3180"><a href="#cb78-3180" aria-hidden="true" tabindex="-1"></a>stringAPrice_ <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramAPrice_<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3181"><a href="#cb78-3181" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3182"><a href="#cb78-3182" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3183"><a href="#cb78-3183" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice_))<span class="op">,</span></span>
<span id="cb78-3184"><a href="#cb78-3184" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice_))<span class="op">,</span></span>
<span id="cb78-3185"><a href="#cb78-3185" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3186"><a href="#cb78-3186" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb78-3187"><a href="#cb78-3187" aria-hidden="true" tabindex="-1"></a>stringCiPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramCiPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3188"><a href="#cb78-3188" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3189"><a href="#cb78-3189" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3190"><a href="#cb78-3190" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramCiPrice))<span class="op">,</span></span>
<span id="cb78-3191"><a href="#cb78-3191" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramCiPrice))<span class="op">,</span></span>
<span id="cb78-3192"><a href="#cb78-3192" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3193"><a href="#cb78-3193" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-12" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Supply of <strong>A</strong> Tokens</th>
<th style="text-align: right;">Portfolio Carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-9"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-10"></span></span></td>
</tr>
<tr class="even">
<td><strong>Variation</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-11"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-12"></span></span></td>
</tr>
<tr class="odd">
<td><strong>Unit Price</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-13"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-14"></span></span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-klima-2.0-token-distribution" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="sec-klima-2.0-token-distribution"><span class="header-section-number">4</span> Klima&nbsp;2.0 Token Distribution</h2>
<section id="sec-planned-allocations" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="sec-planned-allocations"><span class="header-section-number">4.1</span> Planned Allocations</h3>
<div id="tbl-kvcm-token" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-kvcm-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Cohort</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Quantity (m)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klima Holders</td>
<td style="text-align: right;">87.5%</td>
<td style="text-align: right;">17.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">DAO/Treasury</td>
<td style="text-align: right;">10.0%</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">01X</td>
<td style="text-align: right;">2.5%</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: right;"><strong>100.0%</strong></td>
<td style="text-align: right;"><strong>20.0</strong></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-kvcm-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: <strong>kVCM</strong> token.
</figcaption>
</figure>
</div>
<div id="tbl-k2-token" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[40,10,15,30]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-k2-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 40%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Cohort</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Quantity (m)</th>
<th style="text-align: left;">Liquidity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klima Holders</td>
<td style="text-align: right;">40.0%</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ecosystem Grant</td>
<td style="text-align: right;">5.0%</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Programmatic Incentives</td>
<td style="text-align: right;">40.0%</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: left;">Incentive Curve</td>
</tr>
<tr class="even">
<td style="text-align: left;">pKlima Holders</td>
<td style="text-align: right;">3.0%</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DAO/Treasury</td>
<td style="text-align: right;">4.5%</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: left;">24 month locked LP of <span class="overline"><strong>AG</strong></span></td>
</tr>
<tr class="even">
<td style="text-align: left;">01X</td>
<td style="text-align: right;">2.5%</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: left;">24 month locked LP of <span class="overline"><strong>AG</strong></span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Product Design and Development</td>
<td style="text-align: right;">5.0%</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: right;"><strong>100.0%</strong></td>
<td style="text-align: right;"><strong>100.0</strong></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-k2-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: <strong>K2</strong> token.
</figcaption>
</figure>
</div>
<div id="fig-k2-token-allocations" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token allocations.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-allocations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb79" data-startfrom="3241" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3240;"><span id="cb79-3241"><a href="#cb79-3241" aria-hidden="true" tabindex="-1"></a>allocInitGData <span class="op">=</span> {</span>
<span id="cb79-3242"><a href="#cb79-3242" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocInitGData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb79-3243"><a href="#cb79-3243" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="fl">100.01</span><span class="op">;</span> i <span class="op">+=</span> <span class="fl">0.25</span>) {</span>
<span id="cb79-3244"><a href="#cb79-3244" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="op">&lt;</span> <span class="fl">2.51</span>) {</span>
<span id="cb79-3245"><a href="#cb79-3245" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3246"><a href="#cb79-3246" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3247"><a href="#cb79-3247" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">2.49</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">5.51</span>) {</span>
<span id="cb79-3248"><a href="#cb79-3248" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3249"><a href="#cb79-3249" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3250"><a href="#cb79-3250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">5.49</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">10.01</span>) {</span>
<span id="cb79-3251"><a href="#cb79-3251" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3252"><a href="#cb79-3252" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3253"><a href="#cb79-3253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">9.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">15.01</span>) {</span>
<span id="cb79-3254"><a href="#cb79-3254" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3255"><a href="#cb79-3255" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3256"><a href="#cb79-3256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">14.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">20.01</span>) {</span>
<span id="cb79-3257"><a href="#cb79-3257" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3258"><a href="#cb79-3258" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3259"><a href="#cb79-3259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">19.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">60.01</span>) {</span>
<span id="cb79-3260"><a href="#cb79-3260" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3261"><a href="#cb79-3261" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3262"><a href="#cb79-3262" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">59.99</span> <span class="op">&lt;</span> i) {</span>
<span id="cb79-3263"><a href="#cb79-3263" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3264"><a href="#cb79-3264" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3265"><a href="#cb79-3265" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-3266"><a href="#cb79-3266" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocInitGData<span class="op">;</span></span>
<span id="cb79-3267"><a href="#cb79-3267" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb79-3268"><a href="#cb79-3268" aria-hidden="true" tabindex="-1"></a>longitudeScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>([<span class="dv">180</span><span class="op">,</span> <span class="op">-</span><span class="dv">180</span>])<span class="op">;</span></span>
<span id="cb79-3269"><a href="#cb79-3269" aria-hidden="true" tabindex="-1"></a>getCenter <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb79-3270"><a href="#cb79-3270" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">1.25</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="fl">7.75</span><span class="op">,</span> <span class="fl">12.5</span><span class="op">,</span> <span class="fl">17.5</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">80</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb79-3271"><a href="#cb79-3271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3272"><a href="#cb79-3272" aria-hidden="true" tabindex="-1"></a>cohortsDomain <span class="op">=</span> [</span>
<span id="cb79-3273"><a href="#cb79-3273" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb79-3274"><a href="#cb79-3274" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb79-3275"><a href="#cb79-3275" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb79-3276"><a href="#cb79-3276" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb79-3277"><a href="#cb79-3277" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb79-3278"><a href="#cb79-3278" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb79-3279"><a href="#cb79-3279" aria-hidden="true" tabindex="-1"></a>  <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb79-3280"><a href="#cb79-3280" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb80" data-startfrom="3283" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3282;"><span id="cb80-3283"><a href="#cb80-3283" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb80-3284"><a href="#cb80-3284" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"azimuthal-equidistant"</span><span class="op">,</span> <span class="dt">rotate</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb80-3285"><a href="#cb80-3285" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb80-3286"><a href="#cb80-3286" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb80-3287"><a href="#cb80-3287" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">area</span>(allocInitGData<span class="op">,</span> {</span>
<span id="cb80-3288"><a href="#cb80-3288" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> ({ value }) <span class="kw">=&gt;</span> <span class="fu">longitudeScale</span>(value <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb80-3289"><a href="#cb80-3289" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="op">-</span><span class="dv">20</span><span class="op">,</span></span>
<span id="cb80-3290"><a href="#cb80-3290" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> ({ value }) <span class="kw">=&gt;</span> <span class="fu">longitudeScale</span>(value <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb80-3291"><a href="#cb80-3291" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> <span class="op">-</span><span class="dv">70</span><span class="op">,</span></span>
<span id="cb80-3292"><a href="#cb80-3292" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb80-3293"><a href="#cb80-3293" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb80-3294"><a href="#cb80-3294" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb80-3295"><a href="#cb80-3295" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-79" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-allocations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26: <strong>K2</strong> token allocations.
</figcaption>
</figure>
</div>
</section>
<section id="sec-programmatic-incentive-curve" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="sec-programmatic-incentive-curve"><span class="header-section-number">4.2</span> Programmatic Incentive Curve</h3>
<p>The incentive issuance is built on a logistic function, <span class="math inline">\operatorname{P}</span>, to generate total proportion of supply in issue. It is calibrated from the initial issuance at TGE <span class="math inline">P_0</span> and the inflection point time <span class="math inline">T</span> where 50% of <strong>G</strong> token incentives have been released.</p>
<p>Setting <span class="math inline">x_0</span> from the initial supply parameter:</p>
<p><span id="eq-incentives-issuance-x-0"><span class="math display">
x_0 = \ln\left( \frac{P_0}{1 - P_0} \right)
\tag{31}</span></span></p>
<p>With <span class="math inline">x_t</span> at time point <span class="math inline">t \in (0, \infty)</span>:</p>
<p><span id="eq-incentives-issuance-x-t"><span class="math display">
x_t = x_0 \, \left( 1 - \frac t T \right)
\tag{32}</span></span></p>
<p>Giving supply function <span class="math inline">\operatorname{P}(t)</span> as:</p>
<p><span id="eq-incentives-issuance-curve"><span class="math display">
\operatorname{P}(t) = \frac{\exp(x_t)}{\exp(x_t) + 1}
\tag{33}</span></span></p>
<p><span class="math inline">P_0</span> set at <span><span id="ojs-element-id-15"></span></span> and <span class="math inline">T</span> at <span><span id="ojs-element-id-16"></span></span> months:</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb81" data-startfrom="3343" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3342;"><span id="cb81-3343"><a href="#cb81-3343" aria-hidden="true" tabindex="-1"></a>viewof inputP0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> {</span>
<span id="cb81-3344"><a href="#cb81-3344" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial issuance } P_0`</span><span class="op">,</span></span>
<span id="cb81-3345"><a href="#cb81-3345" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb81-3346"><a href="#cb81-3346" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.07</span><span class="op">,</span></span>
<span id="cb81-3347"><a href="#cb81-3347" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb81-3348"><a href="#cb81-3348" aria-hidden="true" tabindex="-1"></a>viewof inputT <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">2</span><span class="op">,</span> <span class="dv">60</span>]<span class="op">,</span> {</span>
<span id="cb81-3349"><a href="#cb81-3349" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`T </span><span class="sc">\t</span><span class="vs">ext{ (months)}`</span><span class="op">,</span></span>
<span id="cb81-3350"><a href="#cb81-3350" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb81-3351"><a href="#cb81-3351" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span></span>
<span id="cb81-3352"><a href="#cb81-3352" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb81-3353"><a href="#cb81-3353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3354"><a href="#cb81-3354" aria-hidden="true" tabindex="-1"></a>stringInputP0 <span class="op">=</span> inputP0<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb81-3355"><a href="#cb81-3355" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb81-3356"><a href="#cb81-3356" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb81-3357"><a href="#cb81-3357" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb81-3358"><a href="#cb81-3358" aria-hidden="true" tabindex="-1"></a>stringInputT <span class="op">=</span> inputT<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"en-GB"</span><span class="op">,</span> { <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-incentive-issuance" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Incentive Issuance.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentive-issuance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb82" data-startfrom="3370" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3369;"><span id="cb82-3370"><a href="#cb82-3370" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeP</span>(t<span class="op">,</span> P0<span class="op">,</span> T) {</span>
<span id="cb82-3371"><a href="#cb82-3371" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(P0 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> P0))<span class="op">;</span></span>
<span id="cb82-3372"><a href="#cb82-3372" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xt <span class="op">=</span> x0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> t <span class="op">/</span> T)<span class="op">;</span></span>
<span id="cb82-3373"><a href="#cb82-3373" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> exp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(xt)<span class="op">;</span></span>
<span id="cb82-3374"><a href="#cb82-3374" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> exp <span class="op">/</span> (exp <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb82-3375"><a href="#cb82-3375" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-3376"><a href="#cb82-3376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3377"><a href="#cb82-3377" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDerivP</span>(t<span class="op">,</span> P0<span class="op">,</span> T) {</span>
<span id="cb82-3378"><a href="#cb82-3378" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(P0 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> P0))<span class="op">;</span></span>
<span id="cb82-3379"><a href="#cb82-3379" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xt <span class="op">=</span> x0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> t <span class="op">/</span> T)<span class="op">;</span></span>
<span id="cb82-3380"><a href="#cb82-3380" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> exp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(xt)<span class="op">;</span></span>
<span id="cb82-3381"><a href="#cb82-3381" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> P <span class="op">=</span> exp <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp)<span class="op">;</span></span>
<span id="cb82-3382"><a href="#cb82-3382" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">-</span>(x0 <span class="op">/</span> T) <span class="op">*</span> P <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> P)<span class="op">;</span></span>
<span id="cb82-3383"><a href="#cb82-3383" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-3384"><a href="#cb82-3384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3385"><a href="#cb82-3385" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getVesting</span>(vecVesting<span class="op">,</span> t<span class="op">,</span> tStart<span class="op">,</span> tEnd) {</span>
<span id="cb82-3386"><a href="#cb82-3386" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="op">&lt;</span> tStart)</span>
<span id="cb82-3387"><a href="#cb82-3387" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb82-3388"><a href="#cb82-3388" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (t <span class="op">&lt;</span> tEnd) {</span>
<span id="cb82-3389"><a href="#cb82-3389" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vecVesting[t <span class="op">-</span> tStart]<span class="op">;</span></span>
<span id="cb82-3390"><a href="#cb82-3390" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb82-3391"><a href="#cb82-3391" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vecVesting[tEnd <span class="op">-</span> tStart <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb82-3392"><a href="#cb82-3392" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-3393"><a href="#cb82-3393" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb83" data-startfrom="3397" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3396;"><span id="cb83-3397"><a href="#cb83-3397" aria-hidden="true" tabindex="-1"></a>tVestStart <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb83-3398"><a href="#cb83-3398" aria-hidden="true" tabindex="-1"></a>tVestEnd <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> inputT<span class="op">;</span></span>
<span id="cb83-3399"><a href="#cb83-3399" aria-hidden="true" tabindex="-1"></a>tVesting <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(tVestStart<span class="op">,</span> tVestEnd)<span class="op">;</span></span>
<span id="cb83-3400"><a href="#cb83-3400" aria-hidden="true" tabindex="-1"></a>vecVestingDeriv <span class="op">=</span> <span class="fu">normalize</span>(tVesting<span class="op">.</span><span class="fu">map</span>(t <span class="kw">=&gt;</span></span>
<span id="cb83-3401"><a href="#cb83-3401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">computeDerivP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)</span>
<span id="cb83-3402"><a href="#cb83-3402" aria-hidden="true" tabindex="-1"></a>))<span class="op">;</span></span>
<span id="cb83-3403"><a href="#cb83-3403" aria-hidden="true" tabindex="-1"></a>vecVesting <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecVestingDeriv)<span class="op">;</span></span>
<span id="cb83-3404"><a href="#cb83-3404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3405"><a href="#cb83-3405" aria-hidden="true" tabindex="-1"></a>supplyDataAll <span class="op">=</span> {</span>
<span id="cb83-3406"><a href="#cb83-3406" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> paramVestingPrevious <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3407"><a href="#cb83-3407" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecSupplyIncentives <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3408"><a href="#cb83-3408" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecSupplyCirculating <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3409"><a href="#cb83-3409" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> supplyData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3410"><a href="#cb83-3410" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">&lt;=</span> <span class="dv">72</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb83-3411"><a href="#cb83-3411" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramP <span class="op">=</span> <span class="fu">computeP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)<span class="op">;</span></span>
<span id="cb83-3412"><a href="#cb83-3412" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramDerivP <span class="op">=</span> <span class="fu">computeDerivP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)<span class="op">;</span></span>
<span id="cb83-3413"><a href="#cb83-3413" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramVesting <span class="op">=</span> <span class="fu">getVesting</span>(vecVesting<span class="op">,</span> t<span class="op">,</span> tVestStart<span class="op">,</span> tVestEnd)<span class="op">;</span></span>
<span id="cb83-3414"><a href="#cb83-3414" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramVestingDiff <span class="op">=</span> paramVesting <span class="op">-</span> paramVestingPrevious<span class="op">;</span></span>
<span id="cb83-3415"><a href="#cb83-3415" aria-hidden="true" tabindex="-1"></a>    paramVestingPrevious <span class="op">=</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3416"><a href="#cb83-3416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3417"><a href="#cb83-3417" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supply01X <span class="op">=</span> <span class="fl">2.5</span><span class="op">;</span></span>
<span id="cb83-3418"><a href="#cb83-3418" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyPKlima <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3419"><a href="#cb83-3419" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyTreasury <span class="op">=</span> <span class="fl">4.5</span><span class="op">;</span></span>
<span id="cb83-3420"><a href="#cb83-3420" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyGrant <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3421"><a href="#cb83-3421" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyProduct <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3422"><a href="#cb83-3422" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyKlima <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3423"><a href="#cb83-3423" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyIncentives <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramP<span class="op">;</span></span>
<span id="cb83-3424"><a href="#cb83-3424" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives<span class="op">.</span><span class="fu">push</span>(supplyIncentives)<span class="op">;</span></span>
<span id="cb83-3425"><a href="#cb83-3425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3426"><a href="#cb83-3426" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supply01XStacked <span class="op">=</span> supply01X<span class="op">;</span></span>
<span id="cb83-3427"><a href="#cb83-3427" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyPKlimaStacked <span class="op">=</span> supplyPKlima <span class="op">+</span> supply01XStacked<span class="op">;</span></span>
<span id="cb83-3428"><a href="#cb83-3428" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyTreasuryStacked <span class="op">=</span> supplyTreasury <span class="op">+</span> supplyPKlimaStacked<span class="op">;</span></span>
<span id="cb83-3429"><a href="#cb83-3429" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyGrantStacked <span class="op">=</span> supplyGrant <span class="op">+</span> supplyTreasuryStacked<span class="op">;</span></span>
<span id="cb83-3430"><a href="#cb83-3430" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyProductStacked <span class="op">=</span> supplyProduct <span class="op">+</span> supplyGrantStacked<span class="op">;</span></span>
<span id="cb83-3431"><a href="#cb83-3431" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyKlimaStacked <span class="op">=</span> supplyKlima <span class="op">+</span> supplyProductStacked<span class="op">;</span></span>
<span id="cb83-3432"><a href="#cb83-3432" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyIncentivesStacked <span class="op">=</span> supplyIncentives <span class="op">+</span> supplyKlimaStacked<span class="op">;</span></span>
<span id="cb83-3433"><a href="#cb83-3433" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyCirculating <span class="op">=</span> supplyIncentivesStacked <span class="op">/</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb83-3434"><a href="#cb83-3434" aria-hidden="true" tabindex="-1"></a>    vecSupplyCirculating<span class="op">.</span><span class="fu">push</span>(supplyIncentivesStacked)<span class="op">;</span></span>
<span id="cb83-3435"><a href="#cb83-3435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3436"><a href="#cb83-3436" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (t <span class="op">&lt;=</span> <span class="dv">60</span>) {</span>
<span id="cb83-3437"><a href="#cb83-3437" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffIncentives <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> (t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> inputP0 <span class="op">:</span> paramDerivP)<span class="op">;</span></span>
<span id="cb83-3438"><a href="#cb83-3438" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffKlima <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3439"><a href="#cb83-3439" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffProduct <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3440"><a href="#cb83-3440" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffGrant <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3441"><a href="#cb83-3441" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffPKlima <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3442"><a href="#cb83-3442" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffTreasury <span class="op">=</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">4.5</span><span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3443"><a href="#cb83-3443" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diff01X <span class="op">=</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">2.5</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3444"><a href="#cb83-3444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3445"><a href="#cb83-3445" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffIncentivesStacked <span class="op">=</span> diffIncentives<span class="op">;</span></span>
<span id="cb83-3446"><a href="#cb83-3446" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffKlimaStacked <span class="op">=</span> diffKlima <span class="op">+</span> diffIncentivesStacked<span class="op">;</span></span>
<span id="cb83-3447"><a href="#cb83-3447" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffProductStacked <span class="op">=</span> diffProduct <span class="op">+</span> diffKlimaStacked<span class="op">;</span></span>
<span id="cb83-3448"><a href="#cb83-3448" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffGrantStacked <span class="op">=</span> diffGrant <span class="op">+</span> diffProductStacked<span class="op">;</span></span>
<span id="cb83-3449"><a href="#cb83-3449" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffPKlimaStacked <span class="op">=</span> diffPKlima <span class="op">+</span> diffGrantStacked<span class="op">;</span></span>
<span id="cb83-3450"><a href="#cb83-3450" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffTreasuryStacked <span class="op">=</span> diffTreasury <span class="op">+</span> diffPKlimaStacked<span class="op">;</span></span>
<span id="cb83-3451"><a href="#cb83-3451" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diff01XStacked <span class="op">=</span> diff01X <span class="op">+</span> diffTreasuryStacked<span class="op">;</span></span>
<span id="cb83-3452"><a href="#cb83-3452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3453"><a href="#cb83-3453" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3454"><a href="#cb83-3454" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Proportion of Supply"</span><span class="op">,</span></span>
<span id="cb83-3455"><a href="#cb83-3455" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3456"><a href="#cb83-3456" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramP<span class="op">,</span></span>
<span id="cb83-3457"><a href="#cb83-3457" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3458"><a href="#cb83-3458" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3459"><a href="#cb83-3459" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Rate of Change"</span><span class="op">,</span></span>
<span id="cb83-3460"><a href="#cb83-3460" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3461"><a href="#cb83-3461" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDerivP<span class="op">,</span></span>
<span id="cb83-3462"><a href="#cb83-3462" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3463"><a href="#cb83-3463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3464"><a href="#cb83-3464" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3465"><a href="#cb83-3465" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3466"><a href="#cb83-3466" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3467"><a href="#cb83-3467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3468"><a href="#cb83-3468" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01XStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3469"><a href="#cb83-3469" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3470"><a href="#cb83-3470" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3471"><a href="#cb83-3471" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3472"><a href="#cb83-3472" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3473"><a href="#cb83-3473" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3474"><a href="#cb83-3474" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlimaStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3475"><a href="#cb83-3475" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3476"><a href="#cb83-3476" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3477"><a href="#cb83-3477" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3478"><a href="#cb83-3478" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3479"><a href="#cb83-3479" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3480"><a href="#cb83-3480" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasuryStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3481"><a href="#cb83-3481" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3482"><a href="#cb83-3482" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3483"><a href="#cb83-3483" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3484"><a href="#cb83-3484" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3485"><a href="#cb83-3485" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3486"><a href="#cb83-3486" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrantStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3487"><a href="#cb83-3487" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3488"><a href="#cb83-3488" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3489"><a href="#cb83-3489" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3490"><a href="#cb83-3490" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3491"><a href="#cb83-3491" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3492"><a href="#cb83-3492" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProductStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3493"><a href="#cb83-3493" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3494"><a href="#cb83-3494" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3495"><a href="#cb83-3495" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3496"><a href="#cb83-3496" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3497"><a href="#cb83-3497" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3498"><a href="#cb83-3498" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlimaStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3499"><a href="#cb83-3499" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3500"><a href="#cb83-3500" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3501"><a href="#cb83-3501" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3502"><a href="#cb83-3502" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3503"><a href="#cb83-3503" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3504"><a href="#cb83-3504" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentivesStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3505"><a href="#cb83-3505" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3506"><a href="#cb83-3506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3507"><a href="#cb83-3507" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3508"><a href="#cb83-3508" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3509"><a href="#cb83-3509" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3510"><a href="#cb83-3510" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3511"><a href="#cb83-3511" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01X <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3512"><a href="#cb83-3512" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3513"><a href="#cb83-3513" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3514"><a href="#cb83-3514" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3515"><a href="#cb83-3515" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3516"><a href="#cb83-3516" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3517"><a href="#cb83-3517" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlima <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3518"><a href="#cb83-3518" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3519"><a href="#cb83-3519" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3520"><a href="#cb83-3520" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3521"><a href="#cb83-3521" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3522"><a href="#cb83-3522" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3523"><a href="#cb83-3523" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasury <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3524"><a href="#cb83-3524" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3525"><a href="#cb83-3525" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3526"><a href="#cb83-3526" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3527"><a href="#cb83-3527" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3528"><a href="#cb83-3528" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3529"><a href="#cb83-3529" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrant <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3530"><a href="#cb83-3530" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3531"><a href="#cb83-3531" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3532"><a href="#cb83-3532" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3533"><a href="#cb83-3533" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3534"><a href="#cb83-3534" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3535"><a href="#cb83-3535" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProduct <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3536"><a href="#cb83-3536" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3537"><a href="#cb83-3537" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3538"><a href="#cb83-3538" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3539"><a href="#cb83-3539" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3540"><a href="#cb83-3540" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3541"><a href="#cb83-3541" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlima <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3542"><a href="#cb83-3542" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3543"><a href="#cb83-3543" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3544"><a href="#cb83-3544" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3545"><a href="#cb83-3545" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3546"><a href="#cb83-3546" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3547"><a href="#cb83-3547" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentives <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3548"><a href="#cb83-3548" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3549"><a href="#cb83-3549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3550"><a href="#cb83-3550" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3551"><a href="#cb83-3551" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3552"><a href="#cb83-3552" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3553"><a href="#cb83-3553" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3554"><a href="#cb83-3554" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01XStacked<span class="op">,</span></span>
<span id="cb83-3555"><a href="#cb83-3555" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3556"><a href="#cb83-3556" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3557"><a href="#cb83-3557" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3558"><a href="#cb83-3558" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3559"><a href="#cb83-3559" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3560"><a href="#cb83-3560" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlimaStacked<span class="op">,</span></span>
<span id="cb83-3561"><a href="#cb83-3561" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3562"><a href="#cb83-3562" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3563"><a href="#cb83-3563" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3564"><a href="#cb83-3564" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3565"><a href="#cb83-3565" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3566"><a href="#cb83-3566" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasuryStacked<span class="op">,</span></span>
<span id="cb83-3567"><a href="#cb83-3567" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3568"><a href="#cb83-3568" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3569"><a href="#cb83-3569" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3570"><a href="#cb83-3570" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3571"><a href="#cb83-3571" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3572"><a href="#cb83-3572" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrantStacked<span class="op">,</span></span>
<span id="cb83-3573"><a href="#cb83-3573" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3574"><a href="#cb83-3574" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3575"><a href="#cb83-3575" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3576"><a href="#cb83-3576" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3577"><a href="#cb83-3577" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3578"><a href="#cb83-3578" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProductStacked<span class="op">,</span></span>
<span id="cb83-3579"><a href="#cb83-3579" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3580"><a href="#cb83-3580" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3581"><a href="#cb83-3581" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3582"><a href="#cb83-3582" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3583"><a href="#cb83-3583" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3584"><a href="#cb83-3584" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlimaStacked<span class="op">,</span></span>
<span id="cb83-3585"><a href="#cb83-3585" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3586"><a href="#cb83-3586" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3587"><a href="#cb83-3587" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3588"><a href="#cb83-3588" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3589"><a href="#cb83-3589" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3590"><a href="#cb83-3590" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentivesStacked<span class="op">,</span></span>
<span id="cb83-3591"><a href="#cb83-3591" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3592"><a href="#cb83-3592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3593"><a href="#cb83-3593" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3594"><a href="#cb83-3594" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3595"><a href="#cb83-3595" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3596"><a href="#cb83-3596" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3597"><a href="#cb83-3597" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01X<span class="op">,</span></span>
<span id="cb83-3598"><a href="#cb83-3598" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3599"><a href="#cb83-3599" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3600"><a href="#cb83-3600" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3601"><a href="#cb83-3601" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3602"><a href="#cb83-3602" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3603"><a href="#cb83-3603" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlima<span class="op">,</span></span>
<span id="cb83-3604"><a href="#cb83-3604" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3605"><a href="#cb83-3605" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3606"><a href="#cb83-3606" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3607"><a href="#cb83-3607" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3608"><a href="#cb83-3608" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3609"><a href="#cb83-3609" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasury<span class="op">,</span></span>
<span id="cb83-3610"><a href="#cb83-3610" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3611"><a href="#cb83-3611" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3612"><a href="#cb83-3612" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3613"><a href="#cb83-3613" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3614"><a href="#cb83-3614" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3615"><a href="#cb83-3615" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrant<span class="op">,</span></span>
<span id="cb83-3616"><a href="#cb83-3616" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3617"><a href="#cb83-3617" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3618"><a href="#cb83-3618" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3619"><a href="#cb83-3619" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3620"><a href="#cb83-3620" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3621"><a href="#cb83-3621" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProduct<span class="op">,</span></span>
<span id="cb83-3622"><a href="#cb83-3622" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3623"><a href="#cb83-3623" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3624"><a href="#cb83-3624" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3625"><a href="#cb83-3625" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3626"><a href="#cb83-3626" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3627"><a href="#cb83-3627" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlima<span class="op">,</span></span>
<span id="cb83-3628"><a href="#cb83-3628" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3629"><a href="#cb83-3629" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3630"><a href="#cb83-3630" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3631"><a href="#cb83-3631" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3632"><a href="#cb83-3632" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3633"><a href="#cb83-3633" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentives<span class="op">,</span></span>
<span id="cb83-3634"><a href="#cb83-3634" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3635"><a href="#cb83-3635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3636"><a href="#cb83-3636" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3637"><a href="#cb83-3637" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3638"><a href="#cb83-3638" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3639"><a href="#cb83-3639" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3640"><a href="#cb83-3640" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffIncentives<span class="op">,</span></span>
<span id="cb83-3641"><a href="#cb83-3641" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3642"><a href="#cb83-3642" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3643"><a href="#cb83-3643" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3644"><a href="#cb83-3644" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3645"><a href="#cb83-3645" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3646"><a href="#cb83-3646" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffKlima<span class="op">,</span></span>
<span id="cb83-3647"><a href="#cb83-3647" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3648"><a href="#cb83-3648" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3649"><a href="#cb83-3649" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3650"><a href="#cb83-3650" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3651"><a href="#cb83-3651" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3652"><a href="#cb83-3652" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffProduct<span class="op">,</span></span>
<span id="cb83-3653"><a href="#cb83-3653" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3654"><a href="#cb83-3654" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3655"><a href="#cb83-3655" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3656"><a href="#cb83-3656" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3657"><a href="#cb83-3657" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3658"><a href="#cb83-3658" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffGrant<span class="op">,</span></span>
<span id="cb83-3659"><a href="#cb83-3659" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3660"><a href="#cb83-3660" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3661"><a href="#cb83-3661" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3662"><a href="#cb83-3662" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3663"><a href="#cb83-3663" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3664"><a href="#cb83-3664" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffPKlima<span class="op">,</span></span>
<span id="cb83-3665"><a href="#cb83-3665" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3666"><a href="#cb83-3666" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3667"><a href="#cb83-3667" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3668"><a href="#cb83-3668" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3669"><a href="#cb83-3669" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3670"><a href="#cb83-3670" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffTreasury<span class="op">,</span></span>
<span id="cb83-3671"><a href="#cb83-3671" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3672"><a href="#cb83-3672" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3673"><a href="#cb83-3673" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3674"><a href="#cb83-3674" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3675"><a href="#cb83-3675" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3676"><a href="#cb83-3676" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diff01X<span class="op">,</span></span>
<span id="cb83-3677"><a href="#cb83-3677" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3678"><a href="#cb83-3678" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-3679"><a href="#cb83-3679" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-3680"><a href="#cb83-3680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3681"><a href="#cb83-3681" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecNextYearIncentives <span class="op">=</span> vecSupplyIncentives<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3682"><a href="#cb83-3682" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> val)<span class="op">;</span></span>
<span id="cb83-3683"><a href="#cb83-3683" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecAPY <span class="op">=</span> vecSupplyCirculating<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3684"><a href="#cb83-3684" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">*</span> (vecSupplyCirculating[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> val) <span class="op">/</span> val)<span class="op">;</span></span>
<span id="cb83-3685"><a href="#cb83-3685" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecAPR <span class="op">=</span> vecSupplyCirculating<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3686"><a href="#cb83-3686" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">*</span> (vecSupplyCirculating[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> vecNextYearIncentives[t] <span class="op">-</span> val) <span class="op">/</span> val)<span class="op">;</span></span>
<span id="cb83-3687"><a href="#cb83-3687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3688"><a href="#cb83-3688" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">&lt;=</span> <span class="dv">60</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb83-3689"><a href="#cb83-3689" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"APY"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> vecAPY[t] })<span class="op">;</span></span>
<span id="cb83-3690"><a href="#cb83-3690" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"APR"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> vecAPR[t] })<span class="op">;</span></span>
<span id="cb83-3691"><a href="#cb83-3691" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-3692"><a href="#cb83-3692" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb83-3693"><a href="#cb83-3693" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives<span class="op">,</span></span>
<span id="cb83-3694"><a href="#cb83-3694" aria-hidden="true" tabindex="-1"></a>    vecSupplyCirculating<span class="op">,</span></span>
<span id="cb83-3695"><a href="#cb83-3695" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">,</span></span>
<span id="cb83-3696"><a href="#cb83-3696" aria-hidden="true" tabindex="-1"></a>    vecAPY<span class="op">,</span></span>
<span id="cb83-3697"><a href="#cb83-3697" aria-hidden="true" tabindex="-1"></a>    vecAPR<span class="op">,</span></span>
<span id="cb83-3698"><a href="#cb83-3698" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb83-3699"><a href="#cb83-3699" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-3700"><a href="#cb83-3700" aria-hidden="true" tabindex="-1"></a>vecSupplyIncentives <span class="op">=</span> supplyDataAll[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb83-3701"><a href="#cb83-3701" aria-hidden="true" tabindex="-1"></a>vecSupplyCirculating <span class="op">=</span> supplyDataAll[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb83-3702"><a href="#cb83-3702" aria-hidden="true" tabindex="-1"></a>supplyData <span class="op">=</span> supplyDataAll[<span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb83-3703"><a href="#cb83-3703" aria-hidden="true" tabindex="-1"></a>vecAPY <span class="op">=</span> supplyDataAll[<span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb83-3704"><a href="#cb83-3704" aria-hidden="true" tabindex="-1"></a>vecAPR <span class="op">=</span> supplyDataAll[<span class="dv">4</span>]<span class="op">;</span></span>
<span id="cb83-3705"><a href="#cb83-3705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3706"><a href="#cb83-3706" aria-hidden="true" tabindex="-1"></a>getLogisticCurve <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Proportion of Supply"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3707"><a href="#cb83-3707" aria-hidden="true" tabindex="-1"></a>getRateOfChange <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Rate of Change"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3708"><a href="#cb83-3708" aria-hidden="true" tabindex="-1"></a>getCirculatingStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3709"><a href="#cb83-3709" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3710"><a href="#cb83-3710" aria-hidden="true" tabindex="-1"></a>getCirculatingUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3711"><a href="#cb83-3711" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3712"><a href="#cb83-3712" aria-hidden="true" tabindex="-1"></a>getTotalStacked <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3713"><a href="#cb83-3713" aria-hidden="true" tabindex="-1"></a>getTotalUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3714"><a href="#cb83-3714" aria-hidden="true" tabindex="-1"></a>getDiffUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3715"><a href="#cb83-3715" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply Differential (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3716"><a href="#cb83-3716" aria-hidden="true" tabindex="-1"></a>getCohortCirculatingStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3717"><a href="#cb83-3717" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3718"><a href="#cb83-3718" aria-hidden="true" tabindex="-1"></a>getCohortCirculatingUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3719"><a href="#cb83-3719" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3720"><a href="#cb83-3720" aria-hidden="true" tabindex="-1"></a>getCohortTotalStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3721"><a href="#cb83-3721" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3722"><a href="#cb83-3722" aria-hidden="true" tabindex="-1"></a>getCohortTotalUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3723"><a href="#cb83-3723" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3724"><a href="#cb83-3724" aria-hidden="true" tabindex="-1"></a>getCohortDiffUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3725"><a href="#cb83-3725" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply Differential (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3726"><a href="#cb83-3726" aria-hidden="true" tabindex="-1"></a>getAPY <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"APY"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3727"><a href="#cb83-3727" aria-hidden="true" tabindex="-1"></a>getAPR <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"APR"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3728"><a href="#cb83-3728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3729"><a href="#cb83-3729" aria-hidden="true" tabindex="-1"></a>domainRateOfChange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(supplyData<span class="op">,</span> getRateOfChange)]<span class="op">;</span></span>
<span id="cb83-3730"><a href="#cb83-3730" aria-hidden="true" tabindex="-1"></a>scaleRateOfChange <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(domainRateOfChange<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb83-3731"><a href="#cb83-3731" aria-hidden="true" tabindex="-1"></a>mapScaleRateOfChange <span class="op">=</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>(scaleRateOfChange)<span class="op">;</span></span>
<span id="cb83-3732"><a href="#cb83-3732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3733"><a href="#cb83-3733" aria-hidden="true" tabindex="-1"></a>stringP0 <span class="op">=</span> <span class="st">"Initial Issuance P₀ = "</span> <span class="op">+</span> inputP0<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb83-3734"><a href="#cb83-3734" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb83-3735"><a href="#cb83-3735" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb83-3736"><a href="#cb83-3736" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb83-3737"><a href="#cb83-3737" aria-hidden="true" tabindex="-1"></a>stringT <span class="op">=</span> <span class="st">"Inflection Point Time T = "</span> <span class="op">+</span> inputT<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb83-3738"><a href="#cb83-3738" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb83-3739"><a href="#cb83-3739" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb83-3740"><a href="#cb83-3740" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" months"</span><span class="op">;</span></span>
<span id="cb83-3741"><a href="#cb83-3741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3742"><a href="#cb83-3742" aria-hidden="true" tabindex="-1"></a>supplyParams <span class="op">=</span> [</span>
<span id="cb83-3743"><a href="#cb83-3743" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringP0<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> inputP0 }<span class="op">,</span></span>
<span id="cb83-3744"><a href="#cb83-3744" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringT<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> inputT<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">50</span> }<span class="op">,</span></span>
<span id="cb83-3745"><a href="#cb83-3745" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-31" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb84" data-startfrom="3748" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3747;"><span id="cb84-3748"><a href="#cb84-3748" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb84-3749"><a href="#cb84-3749" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb84-3750"><a href="#cb84-3750" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3751"><a href="#cb84-3751" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb84-3752"><a href="#cb84-3752" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Proportion of Supply"</span><span class="op">,</span> <span class="st">"Rate of Change"</span><span class="op">,</span> stringP0<span class="op">,</span> stringT]<span class="op">,</span></span>
<span id="cb84-3753"><a href="#cb84-3753" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb84-3754"><a href="#cb84-3754" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb84-3755"><a href="#cb84-3755" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span></span>
<span id="cb84-3756"><a href="#cb84-3756" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"‘Life’ Span (Months)"</span><span class="op">,</span></span>
<span id="cb84-3757"><a href="#cb84-3757" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3758"><a href="#cb84-3758" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb84-3759"><a href="#cb84-3759" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>] }<span class="op">,</span></span>
<span id="cb84-3760"><a href="#cb84-3760" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb84-3761"><a href="#cb84-3761" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3762"><a href="#cb84-3762" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb84-3763"><a href="#cb84-3763" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb84-3764"><a href="#cb84-3764" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Proportion of Supply (%)"</span> })<span class="op">,</span></span>
<span id="cb84-3765"><a href="#cb84-3765" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>(scaleRateOfChange<span class="op">.</span><span class="fu">ticks</span>()<span class="op">,</span> {</span>
<span id="cb84-3766"><a href="#cb84-3766" aria-hidden="true" tabindex="-1"></a>      <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb84-3767"><a href="#cb84-3767" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> scaleRateOfChange<span class="op">.</span><span class="fu">tickFormat</span>()<span class="op">,</span></span>
<span id="cb84-3768"><a href="#cb84-3768" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Rate of Change (%/Month)"</span><span class="op">,</span></span>
<span id="cb84-3769"><a href="#cb84-3769" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> scaleRateOfChange</span>
<span id="cb84-3770"><a href="#cb84-3770" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3771"><a href="#cb84-3771" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleRateOfChange<span class="op">,</span> {</span>
<span id="cb84-3772"><a href="#cb84-3772" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3773"><a href="#cb84-3773" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getRateOfChange<span class="op">,</span></span>
<span id="cb84-3774"><a href="#cb84-3774" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3775"><a href="#cb84-3775" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3776"><a href="#cb84-3776" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb84-3777"><a href="#cb84-3777" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb84-3778"><a href="#cb84-3778" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb84-3779"><a href="#cb84-3779" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3780"><a href="#cb84-3780" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLogisticCurve<span class="op">,</span></span>
<span id="cb84-3781"><a href="#cb84-3781" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3782"><a href="#cb84-3782" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3783"><a href="#cb84-3783" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3784"><a href="#cb84-3784" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleRateOfChange<span class="op">,</span> {</span>
<span id="cb84-3785"><a href="#cb84-3785" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3786"><a href="#cb84-3786" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getRateOfChange<span class="op">,</span></span>
<span id="cb84-3787"><a href="#cb84-3787" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3788"><a href="#cb84-3788" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb84-3789"><a href="#cb84-3789" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb84-3790"><a href="#cb84-3790" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb84-3791"><a href="#cb84-3791" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3792"><a href="#cb84-3792" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLogisticCurve<span class="op">,</span></span>
<span id="cb84-3793"><a href="#cb84-3793" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3794"><a href="#cb84-3794" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb84-3795"><a href="#cb84-3795" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3796"><a href="#cb84-3796" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(supplyParams<span class="op">,</span> {</span>
<span id="cb84-3797"><a href="#cb84-3797" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> stringT <span class="op">?</span> d<span class="op">.</span><span class="at">x</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb84-3798"><a href="#cb84-3798" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb84-3799"><a href="#cb84-3799" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3800"><a href="#cb84-3800" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3801"><a href="#cb84-3801" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb84-3802"><a href="#cb84-3802" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3803"><a href="#cb84-3803" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(supplyParams<span class="op">,</span> {</span>
<span id="cb84-3804"><a href="#cb84-3804" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3805"><a href="#cb84-3805" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb84-3806"><a href="#cb84-3806" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb84-3807"><a href="#cb84-3807" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3808"><a href="#cb84-3808" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3809"><a href="#cb84-3809" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb84-3810"><a href="#cb84-3810" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-83" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentive-issuance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27: Incentive Issuance
</figcaption>
</figure>
</div>
<div id="fig-k2-token-supply-circulating" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token circulating supply over time.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-supply-circulating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb85" data-startfrom="3824" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3823;"><span id="cb85-3824"><a href="#cb85-3824" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb85-3825"><a href="#cb85-3825" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb85-3826"><a href="#cb85-3826" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb85-3827"><a href="#cb85-3827" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Circulating Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb85-3828"><a href="#cb85-3828" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb85-3829"><a href="#cb85-3829" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb85-3830"><a href="#cb85-3830" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb85-3831"><a href="#cb85-3831" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb85-3832"><a href="#cb85-3832" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb85-3833"><a href="#cb85-3833" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCirculatingStacked<span class="op">,</span></span>
<span id="cb85-3834"><a href="#cb85-3834" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortCirculatingStacked<span class="op">,</span></span>
<span id="cb85-3835"><a href="#cb85-3835" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb85-3836"><a href="#cb85-3836" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb85-3837"><a href="#cb85-3837" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb85-3838"><a href="#cb85-3838" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb85-3839"><a href="#cb85-3839" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCirculatingUnstacked<span class="op">,</span></span>
<span id="cb85-3840"><a href="#cb85-3840" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortCirculatingUnstacked<span class="op">,</span></span>
<span id="cb85-3841"><a href="#cb85-3841" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb85-3842"><a href="#cb85-3842" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb85-3843"><a href="#cb85-3843" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb85-3844"><a href="#cb85-3844" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-84" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-supply-circulating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28: <strong>K2</strong> token circulating supply over time.
</figcaption>
</figure>
</div>
<div id="fig-k2-token-supply-total" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-supply-total-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb86" data-startfrom="3859" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3858;"><span id="cb86-3859"><a href="#cb86-3859" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb86-3860"><a href="#cb86-3860" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb86-3861"><a href="#cb86-3861" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb86-3862"><a href="#cb86-3862" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Total Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb86-3863"><a href="#cb86-3863" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb86-3864"><a href="#cb86-3864" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb86-3865"><a href="#cb86-3865" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb86-3866"><a href="#cb86-3866" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb86-3867"><a href="#cb86-3867" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb86-3868"><a href="#cb86-3868" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalStacked<span class="op">,</span></span>
<span id="cb86-3869"><a href="#cb86-3869" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortTotalStacked<span class="op">,</span></span>
<span id="cb86-3870"><a href="#cb86-3870" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb86-3871"><a href="#cb86-3871" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb86-3872"><a href="#cb86-3872" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb86-3873"><a href="#cb86-3873" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb86-3874"><a href="#cb86-3874" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb86-3875"><a href="#cb86-3875" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb86-3876"><a href="#cb86-3876" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb86-3877"><a href="#cb86-3877" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb86-3878"><a href="#cb86-3878" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb86-3879"><a href="#cb86-3879" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-85" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-85-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-85" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-85-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Total supply (stacked).
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb87" data-startfrom="3884" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3883;"><span id="cb87-3884"><a href="#cb87-3884" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb87-3885"><a href="#cb87-3885" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb87-3886"><a href="#cb87-3886" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb87-3887"><a href="#cb87-3887" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Total Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb87-3888"><a href="#cb87-3888" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb87-3889"><a href="#cb87-3889" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb87-3890"><a href="#cb87-3890" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb87-3891"><a href="#cb87-3891" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb87-3892"><a href="#cb87-3892" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb87-3893"><a href="#cb87-3893" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb87-3894"><a href="#cb87-3894" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3895"><a href="#cb87-3895" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3896"><a href="#cb87-3896" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb87-3897"><a href="#cb87-3897" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb87-3898"><a href="#cb87-3898" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb87-3899"><a href="#cb87-3899" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb87-3900"><a href="#cb87-3900" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb87-3901"><a href="#cb87-3901" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3902"><a href="#cb87-3902" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3903"><a href="#cb87-3903" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb87-3904"><a href="#cb87-3904" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb87-3905"><a href="#cb87-3905" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb87-3906"><a href="#cb87-3906" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-86" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-86-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-86" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-86-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Total supply (unstacked).
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-supply-total-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;29: <strong>K2</strong> token total supply over time.
</figcaption>
</figure>
</div>
<div id="fig-k2-risk-metrics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-risk-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb88" data-startfrom="3929" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3928;"><span id="cb88-3929"><a href="#cb88-3929" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb88-3930"><a href="#cb88-3930" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb88-3931"><a href="#cb88-3931" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb88-3932"><a href="#cb88-3932" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Rate of Growth (%/Month)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb88-3933"><a href="#cb88-3933" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb88-3934"><a href="#cb88-3934" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb88-3935"><a href="#cb88-3935" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb88-3936"><a href="#cb88-3936" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb88-3937"><a href="#cb88-3937" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb88-3938"><a href="#cb88-3938" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb88-3939"><a href="#cb88-3939" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb88-3940"><a href="#cb88-3940" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb88-3941"><a href="#cb88-3941" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb88-3942"><a href="#cb88-3942" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getDiffUnstacked<span class="op">,</span></span>
<span id="cb88-3943"><a href="#cb88-3943" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortDiffUnstacked<span class="op">,</span></span>
<span id="cb88-3944"><a href="#cb88-3944" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb88-3945"><a href="#cb88-3945" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb88-3946"><a href="#cb88-3946" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-87" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-87-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-87" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-87-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Total supply differential (stacked).
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb89" data-startfrom="3951" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3950;"><span id="cb89-3951"><a href="#cb89-3951" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb89-3952"><a href="#cb89-3952" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb89-3953"><a href="#cb89-3953" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3954"><a href="#cb89-3954" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">9</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb89-3955"><a href="#cb89-3955" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"APY"</span><span class="op">,</span> <span class="st">"APR"</span>]<span class="op">,</span></span>
<span id="cb89-3956"><a href="#cb89-3956" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb89-3957"><a href="#cb89-3957" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb89-3958"><a href="#cb89-3958" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb89-3959"><a href="#cb89-3959" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(vecAPR)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(vecAPY))]<span class="op">,</span></span>
<span id="cb89-3960"><a href="#cb89-3960" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Annual Percentage (%)"</span><span class="op">,</span></span>
<span id="cb89-3961"><a href="#cb89-3961" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3962"><a href="#cb89-3962" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb89-3963"><a href="#cb89-3963" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb89-3964"><a href="#cb89-3964" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3965"><a href="#cb89-3965" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb89-3966"><a href="#cb89-3966" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb89-3967"><a href="#cb89-3967" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3968"><a href="#cb89-3968" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3969"><a href="#cb89-3969" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getAPY<span class="op">,</span></span>
<span id="cb89-3970"><a href="#cb89-3970" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3971"><a href="#cb89-3971" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb89-3972"><a href="#cb89-3972" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3973"><a href="#cb89-3973" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3974"><a href="#cb89-3974" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3975"><a href="#cb89-3975" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb89-3976"><a href="#cb89-3976" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> getAPY<span class="op">,</span></span>
<span id="cb89-3977"><a href="#cb89-3977" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3978"><a href="#cb89-3978" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb89-3979"><a href="#cb89-3979" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3980"><a href="#cb89-3980" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3981"><a href="#cb89-3981" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3982"><a href="#cb89-3982" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getAPR<span class="op">,</span></span>
<span id="cb89-3983"><a href="#cb89-3983" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3984"><a href="#cb89-3984" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb89-3985"><a href="#cb89-3985" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb89-3986"><a href="#cb89-3986" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3987"><a href="#cb89-3987" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb89-3988"><a href="#cb89-3988" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-88" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-88-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-88" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-88-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Utility incentive yield.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-risk-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;30: <strong>K2</strong> token supply risk metrics.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-incentive-allocations" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="sec-incentive-allocations"><span class="header-section-number">4.3</span> Incentive Allocations</h3>
<div id="fig-k2-incentive-distribution" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token incentive distribution structure">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-incentive-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/k2-incentive-distribution.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-incentive-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;31: <strong>K2</strong> token incentive distribution structure.
</figcaption>
</figure>
</div>
<p>The <strong>relative utilisation</strong> measurement factor <span class="math inline">\upsilon</span> is calculated as follows.</p>
<p>Defining initially:</p>
<ul>
<li><p><span class="math inline">G</span>: Total <strong>G</strong> tokens staked expressed as a proportion of the circulating supply, <span class="math inline">G \in [0, 1]</span>.</p></li>
<li><p><span class="math inline">L</span>: Total <strong>G</strong> tokens held in the <span class="overline"><strong>AG</strong></span> pool expressed as a proportion of circulating supply, <span class="math inline">L \in (0, 1]</span>.</p></li>
</ul>
<p>Where <span class="math inline">\upsilon = 0</span> if <span class="math inline">G + L = 0</span>, otherwise:</p>
<p><span id="eq-relative-utilisation"><span class="math display">
\upsilon = \left( \frac{2 G L}{G^2 + L^2} \right)^2
\tag{34}</span></span></p>
<div id="fig-relative-utilisation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Upsilon range of values.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-relative-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb90" data-startfrom="4047" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4046;"><span id="cb90-4047"><a href="#cb90-4047" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeUpsilon</span>(G<span class="op">,</span> L) {</span>
<span id="cb90-4048"><a href="#cb90-4048" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb90-4049"><a href="#cb90-4049" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-4050"><a href="#cb90-4050" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb90-4051"><a href="#cb90-4051" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">2</span> <span class="op">*</span> G <span class="op">*</span> L <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>))<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-4052"><a href="#cb90-4052" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-4053"><a href="#cb90-4053" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-89" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb91" data-startfrom="4057" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4056;"><span id="cb91-4057"><a href="#cb91-4057" aria-hidden="true" tabindex="-1"></a>upsilonData <span class="op">=</span> {</span>
<span id="cb91-4058"><a href="#cb91-4058" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> upsilonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb91-4059"><a href="#cb91-4059" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb91-4060"><a href="#cb91-4060" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb91-4061"><a href="#cb91-4061" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb91-4062"><a href="#cb91-4062" aria-hidden="true" tabindex="-1"></a>        upsilonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb91-4063"><a href="#cb91-4063" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"υ"</span><span class="op">,</span></span>
<span id="cb91-4064"><a href="#cb91-4064" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb91-4065"><a href="#cb91-4065" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb91-4066"><a href="#cb91-4066" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeUpsilon</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb91-4067"><a href="#cb91-4067" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb91-4068"><a href="#cb91-4068" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb91-4069"><a href="#cb91-4069" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb91-4070"><a href="#cb91-4070" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-4071"><a href="#cb91-4071" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> upsilonData<span class="op">;</span></span>
<span id="cb91-4072"><a href="#cb91-4072" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-90" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb92" data-startfrom="4076" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4075;"><span id="cb92-4076"><a href="#cb92-4076" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb92-4077"><a href="#cb92-4077" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb92-4078"><a href="#cb92-4078" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb92-4079"><a href="#cb92-4079" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb92-4080"><a href="#cb92-4080" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb92-4081"><a href="#cb92-4081" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb92-4082"><a href="#cb92-4082" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb92-4083"><a href="#cb92-4083" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Relative Utilisation υ"</span><span class="op">,</span></span>
<span id="cb92-4084"><a href="#cb92-4084" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb92-4085"><a href="#cb92-4085" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb92-4086"><a href="#cb92-4086" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb92-4087"><a href="#cb92-4087" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb92-4088"><a href="#cb92-4088" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb92-4089"><a href="#cb92-4089" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb92-4090"><a href="#cb92-4090" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb92-4091"><a href="#cb92-4091" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb92-4092"><a href="#cb92-4092" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb92-4093"><a href="#cb92-4093" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(upsilonData<span class="op">,</span> {</span>
<span id="cb92-4094"><a href="#cb92-4094" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4095"><a href="#cb92-4095" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4096"><a href="#cb92-4096" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4097"><a href="#cb92-4097" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4098"><a href="#cb92-4098" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb92-4099"><a href="#cb92-4099" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb92-4100"><a href="#cb92-4100" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(upsilonData<span class="op">,</span> {</span>
<span id="cb92-4101"><a href="#cb92-4101" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb92-4102"><a href="#cb92-4102" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb92-4103"><a href="#cb92-4103" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb92-4104"><a href="#cb92-4104" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb92-4105"><a href="#cb92-4105" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb92-4106"><a href="#cb92-4106" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb92-4107"><a href="#cb92-4107" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb92-4108"><a href="#cb92-4108" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb92-4109"><a href="#cb92-4109" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb92-4110"><a href="#cb92-4110" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb92-4111"><a href="#cb92-4111" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb92-4112"><a href="#cb92-4112" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-91" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-relative-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32: Upsilon <span class="math inline">\upsilon</span> range of values.
</figcaption>
</figure>
</div>
<p>The <strong>absolute utilisation</strong> parameter <span class="math inline">\eta</span> is defined as <span class="math inline">\eta = 0</span> if <span class="math inline">G + L = 0</span>, otherwise:</p>
<p><span id="eq-absolute-utilisation"><span class="math display">
\eta = \frac{2 G L}{G (1 - G) + L ( 1 - L)}
\tag{35}</span></span></p>
<div id="fig-absolute-utilisation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Eta range of values.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-absolute-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb93" data-startfrom="4133" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4132;"><span id="cb93-4133"><a href="#cb93-4133" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeEta</span>(G<span class="op">,</span> L) {</span>
<span id="cb93-4134"><a href="#cb93-4134" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb93-4135"><a href="#cb93-4135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb93-4136"><a href="#cb93-4136" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb93-4137"><a href="#cb93-4137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> G <span class="op">*</span> L <span class="op">/</span> (G <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> G) <span class="op">+</span> L <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> L))<span class="op">;</span></span>
<span id="cb93-4138"><a href="#cb93-4138" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-4139"><a href="#cb93-4139" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-92" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb94" data-startfrom="4143" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4142;"><span id="cb94-4143"><a href="#cb94-4143" aria-hidden="true" tabindex="-1"></a>etaData <span class="op">=</span> {</span>
<span id="cb94-4144"><a href="#cb94-4144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> etaData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb94-4145"><a href="#cb94-4145" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb94-4146"><a href="#cb94-4146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb94-4147"><a href="#cb94-4147" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb94-4148"><a href="#cb94-4148" aria-hidden="true" tabindex="-1"></a>        etaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb94-4149"><a href="#cb94-4149" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"η"</span><span class="op">,</span></span>
<span id="cb94-4150"><a href="#cb94-4150" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb94-4151"><a href="#cb94-4151" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb94-4152"><a href="#cb94-4152" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeEta</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb94-4153"><a href="#cb94-4153" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb94-4154"><a href="#cb94-4154" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb94-4155"><a href="#cb94-4155" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-4156"><a href="#cb94-4156" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb94-4157"><a href="#cb94-4157" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> etaData<span class="op">;</span></span>
<span id="cb94-4158"><a href="#cb94-4158" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-93" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb95" data-startfrom="4162" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4161;"><span id="cb95-4162"><a href="#cb95-4162" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb95-4163"><a href="#cb95-4163" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb95-4164"><a href="#cb95-4164" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb95-4165"><a href="#cb95-4165" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb95-4166"><a href="#cb95-4166" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb95-4167"><a href="#cb95-4167" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb95-4168"><a href="#cb95-4168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb95-4169"><a href="#cb95-4169" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Absolute Utilisation η"</span><span class="op">,</span></span>
<span id="cb95-4170"><a href="#cb95-4170" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb95-4171"><a href="#cb95-4171" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb95-4172"><a href="#cb95-4172" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb95-4173"><a href="#cb95-4173" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb95-4174"><a href="#cb95-4174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb95-4175"><a href="#cb95-4175" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb95-4176"><a href="#cb95-4176" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb95-4177"><a href="#cb95-4177" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb95-4178"><a href="#cb95-4178" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb95-4179"><a href="#cb95-4179" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(etaData<span class="op">,</span> {</span>
<span id="cb95-4180"><a href="#cb95-4180" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4181"><a href="#cb95-4181" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4182"><a href="#cb95-4182" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4183"><a href="#cb95-4183" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4184"><a href="#cb95-4184" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb95-4185"><a href="#cb95-4185" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb95-4186"><a href="#cb95-4186" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(etaData<span class="op">,</span> {</span>
<span id="cb95-4187"><a href="#cb95-4187" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb95-4188"><a href="#cb95-4188" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb95-4189"><a href="#cb95-4189" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb95-4190"><a href="#cb95-4190" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb95-4191"><a href="#cb95-4191" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb95-4192"><a href="#cb95-4192" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb95-4193"><a href="#cb95-4193" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb95-4194"><a href="#cb95-4194" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb95-4195"><a href="#cb95-4195" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb95-4196"><a href="#cb95-4196" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb95-4197"><a href="#cb95-4197" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb95-4198"><a href="#cb95-4198" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-94" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-absolute-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33: Eta <span class="math inline">\eta</span> range of values.
</figcaption>
</figure>
</div>
<p>Incentives <span class="math inline">I</span> are allocated as follows:</p>
<section id="treasury" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="treasury"><span class="header-section-number">4.3.1</span> Treasury</h4>
<p>The allocation to the Treasury <span class="math inline">I_T</span> is the imbalance generated from <span class="math inline">\upsilon</span>:</p>
<p><span id="eq-allocation-treasury"><span class="math display">
I_T = 1 - \upsilon \, \eta
\tag{36}</span></span></p>
</section>
<section id="post-treasury" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="post-treasury"><span class="header-section-number">4.3.2</span> Post Treasury</h4>
<p>The residual post-treasury allocation is shared four ways within 2 buckets:</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong> &amp; user-locked <strong>G</strong> tokens</p>
<p>Where <span class="math inline">S</span> is the proportion of time-locked <strong>A</strong> tokens&nbsp;(as defined previously in <a href="#sec-time-locked-market" class="quarto-xref">Section&nbsp;3.1</a>):</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong>, <span class="math inline">I_S</span>:</p>
<p><span id="eq-allocation-locked-a"><span class="math display">
I_S = S \, \frac{L^2}{G^2 + L^2}
  \tag{37}</span></span></p></li>
<li><p>User-locked <strong>G</strong>, <span class="math inline">I_G</span>:</p>
<p><span id="eq-allocation-locked-g"><span class="math display">
I_G = (1 - S) \, \frac{L^2}{G^2 + L^2}
  \tag{38}</span></span></p></li>
</ol></li>
<li><p>Liquidity</p>
<p>With <span class="math inline">\lambda_G</span>, <span class="math inline">\lambda_Q</span>, <span class="math inline">\lambda_{GG}</span> as defined in <a href="#sec-share-of-risk-premium" class="quarto-xref">Section&nbsp;3.3.4</a>:</p>
<ol start="3" type="1">
<li><p><span class="overline"><strong>AG</strong></span> pool <span class="math inline">I_{AG}</span>:</p>
<p><span id="eq-allocation-pool-ag"><span class="math display">
I_{AG} = \frac{\lambda_G}{1 - \lambda_{GG}} \, \frac{G^2}{G^2 + L^2}
  \tag{39}</span></span></p></li>
<li><p><span class="overline"><strong>AQ</strong></span> pool <span class="math inline">I_{AQ}</span>:</p>
<p><span id="eq-allocation-pool-aq"><span class="math display">
I_{AQ} = \frac{\lambda_Q}{1 - \lambda_{GG}} \, \frac{G^2}{G^2 + L^2}
  \tag{40}</span></span></p></li>
</ol></li>
</ol>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb96" data-startfrom="4271" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4270;"><span id="cb96-4271"><a href="#cb96-4271" aria-hidden="true" tabindex="-1"></a>viewof inputS_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb96-4272"><a href="#cb96-4272" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Time-Locked } S`</span><span class="op">,</span></span>
<span id="cb96-4273"><a href="#cb96-4273" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb96-4274"><a href="#cb96-4274" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb96-4275"><a href="#cb96-4275" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb96-4276"><a href="#cb96-4276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4277"><a href="#cb96-4277" aria-hidden="true" tabindex="-1"></a>viewof inputWeightAG <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb96-4278"><a href="#cb96-4278" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{LP split}`</span><span class="op">,</span></span>
<span id="cb96-4279"><a href="#cb96-4279" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb96-4280"><a href="#cb96-4280" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb96-4281"><a href="#cb96-4281" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb96-4282"><a href="#cb96-4282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4283"><a href="#cb96-4283" aria-hidden="true" tabindex="-1"></a>paramWeightAQ <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> inputWeightAG<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-incentives-non-treasury" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentives-non-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb97" data-startfrom="4294" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4293;"><span id="cb97-4294"><a href="#cb97-4294" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeTreasury</span>(G<span class="op">,</span> L) {</span>
<span id="cb97-4295"><a href="#cb97-4295" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> <span class="fu">computeUpsilon</span>(G<span class="op">,</span> L) <span class="op">*</span> <span class="fu">computeEta</span>(G<span class="op">,</span> L))<span class="op">;</span></span>
<span id="cb97-4296"><a href="#cb97-4296" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-96" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb98" data-startfrom="4301" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4300;"><span id="cb98-4301"><a href="#cb98-4301" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIBonds</span>(G<span class="op">,</span> L<span class="op">,</span> S) {</span>
<span id="cb98-4302"><a href="#cb98-4302" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb98-4303"><a href="#cb98-4303" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb98-4304"><a href="#cb98-4304" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb98-4305"><a href="#cb98-4305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S <span class="op">*</span> L<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb98-4306"><a href="#cb98-4306" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-4307"><a href="#cb98-4307" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-4308"><a href="#cb98-4308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4309"><a href="#cb98-4309" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIStaking</span>(G<span class="op">,</span> L<span class="op">,</span> S) {</span>
<span id="cb98-4310"><a href="#cb98-4310" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb98-4311"><a href="#cb98-4311" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb98-4312"><a href="#cb98-4312" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb98-4313"><a href="#cb98-4313" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> S) <span class="op">*</span> L<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb98-4314"><a href="#cb98-4314" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-4315"><a href="#cb98-4315" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-97-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-97-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb99" data-startfrom="4318" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4317;"><span id="cb99-4318"><a href="#cb99-4318" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIPool</span>(G<span class="op">,</span> L<span class="op">,</span> weight) {</span>
<span id="cb99-4319"><a href="#cb99-4319" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb99-4320"><a href="#cb99-4320" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb99-4321"><a href="#cb99-4321" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb99-4322"><a href="#cb99-4322" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weight <span class="op">*</span> G<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb99-4323"><a href="#cb99-4323" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb99-4324"><a href="#cb99-4324" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-98" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb100" data-startfrom="4328" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4327;"><span id="cb100-4328"><a href="#cb100-4328" aria-hidden="true" tabindex="-1"></a>allocationSQData <span class="op">=</span> {</span>
<span id="cb100-4329"><a href="#cb100-4329" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocationSQData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb100-4330"><a href="#cb100-4330" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb100-4331"><a href="#cb100-4331" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb100-4332"><a href="#cb100-4332" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb100-4333"><a href="#cb100-4333" aria-hidden="true" tabindex="-1"></a>        allocationSQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb100-4334"><a href="#cb100-4334" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔 Time-locks Allocation"</span><span class="op">,</span></span>
<span id="cb100-4335"><a href="#cb100-4335" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb100-4336"><a href="#cb100-4336" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb100-4337"><a href="#cb100-4337" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIBonds</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputS_)<span class="op">,</span></span>
<span id="cb100-4338"><a href="#cb100-4338" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb100-4339"><a href="#cb100-4339" aria-hidden="true" tabindex="-1"></a>        allocationSQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb100-4340"><a href="#cb100-4340" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗚 User-locks Allocation"</span><span class="op">,</span></span>
<span id="cb100-4341"><a href="#cb100-4341" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb100-4342"><a href="#cb100-4342" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb100-4343"><a href="#cb100-4343" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIStaking</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputS_)<span class="op">,</span></span>
<span id="cb100-4344"><a href="#cb100-4344" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb100-4345"><a href="#cb100-4345" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb100-4346"><a href="#cb100-4346" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb100-4347"><a href="#cb100-4347" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb100-4348"><a href="#cb100-4348" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocationSQData<span class="op">;</span></span>
<span id="cb100-4349"><a href="#cb100-4349" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-99" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb101" data-startfrom="4354" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4353;"><span id="cb101-4354"><a href="#cb101-4354" aria-hidden="true" tabindex="-1"></a>plotAllocationSQ <span class="op">=</span> {</span>
<span id="cb101-4355"><a href="#cb101-4355" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotAllocationSQ <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb101-4356"><a href="#cb101-4356" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb101-4357"><a href="#cb101-4357" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb101-4358"><a href="#cb101-4358" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb101-4359"><a href="#cb101-4359" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb101-4360"><a href="#cb101-4360" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb101-4361"><a href="#cb101-4361" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb101-4362"><a href="#cb101-4362" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb101-4363"><a href="#cb101-4363" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb101-4364"><a href="#cb101-4364" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb101-4365"><a href="#cb101-4365" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb101-4366"><a href="#cb101-4366" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb101-4367"><a href="#cb101-4367" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb101-4368"><a href="#cb101-4368" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb101-4369"><a href="#cb101-4369" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb101-4370"><a href="#cb101-4370" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb101-4371"><a href="#cb101-4371" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb101-4372"><a href="#cb101-4372" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb101-4373"><a href="#cb101-4373" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(allocationSQData<span class="op">,</span> {</span>
<span id="cb101-4374"><a href="#cb101-4374" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4375"><a href="#cb101-4375" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4376"><a href="#cb101-4376" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4377"><a href="#cb101-4377" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4378"><a href="#cb101-4378" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb101-4379"><a href="#cb101-4379" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb101-4380"><a href="#cb101-4380" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb101-4381"><a href="#cb101-4381" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(allocationSQData<span class="op">,</span> {</span>
<span id="cb101-4382"><a href="#cb101-4382" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb101-4383"><a href="#cb101-4383" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb101-4384"><a href="#cb101-4384" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb101-4385"><a href="#cb101-4385" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb101-4386"><a href="#cb101-4386" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb101-4387"><a href="#cb101-4387" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb101-4388"><a href="#cb101-4388" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb101-4389"><a href="#cb101-4389" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb101-4390"><a href="#cb101-4390" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb101-4391"><a href="#cb101-4391" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb101-4392"><a href="#cb101-4392" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb101-4393"><a href="#cb101-4393" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb101-4394"><a href="#cb101-4394" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb101-4395"><a href="#cb101-4395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4396"><a href="#cb101-4396" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotAllocationSQ)</span>
<span id="cb101-4397"><a href="#cb101-4397" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb101-4398"><a href="#cb101-4398" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb101-4399"><a href="#cb101-4399" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb101-4400"><a href="#cb101-4400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4401"><a href="#cb101-4401" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotAllocationSQ<span class="op">;</span></span>
<span id="cb101-4402"><a href="#cb101-4402" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-100" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-100-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-100" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-100-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Time-locked <strong>A</strong> and user-locked <strong>G</strong> allocations.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb102" data-startfrom="4406" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4405;"><span id="cb102-4406"><a href="#cb102-4406" aria-hidden="true" tabindex="-1"></a>allocationPoolData <span class="op">=</span> {</span>
<span id="cb102-4407"><a href="#cb102-4407" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocationPoolData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb102-4408"><a href="#cb102-4408" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb102-4409"><a href="#cb102-4409" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb102-4410"><a href="#cb102-4410" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb102-4411"><a href="#cb102-4411" aria-hidden="true" tabindex="-1"></a>        allocationPoolData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb102-4412"><a href="#cb102-4412" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔𝗚 Pool Allocation"</span><span class="op">,</span></span>
<span id="cb102-4413"><a href="#cb102-4413" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb102-4414"><a href="#cb102-4414" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb102-4415"><a href="#cb102-4415" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIPool</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputWeightAG)<span class="op">,</span></span>
<span id="cb102-4416"><a href="#cb102-4416" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb102-4417"><a href="#cb102-4417" aria-hidden="true" tabindex="-1"></a>        allocationPoolData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb102-4418"><a href="#cb102-4418" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔𝗤 Pool Allocation"</span><span class="op">,</span></span>
<span id="cb102-4419"><a href="#cb102-4419" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb102-4420"><a href="#cb102-4420" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb102-4421"><a href="#cb102-4421" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIPool</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> paramWeightAQ)<span class="op">,</span></span>
<span id="cb102-4422"><a href="#cb102-4422" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb102-4423"><a href="#cb102-4423" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb102-4424"><a href="#cb102-4424" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb102-4425"><a href="#cb102-4425" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-4426"><a href="#cb102-4426" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocationPoolData<span class="op">;</span></span>
<span id="cb102-4427"><a href="#cb102-4427" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-101" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb103" data-startfrom="4432" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4431;"><span id="cb103-4432"><a href="#cb103-4432" aria-hidden="true" tabindex="-1"></a>plotAllocationPool <span class="op">=</span> {</span>
<span id="cb103-4433"><a href="#cb103-4433" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotAllocationPool <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb103-4434"><a href="#cb103-4434" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb103-4435"><a href="#cb103-4435" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb103-4436"><a href="#cb103-4436" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb103-4437"><a href="#cb103-4437" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb103-4438"><a href="#cb103-4438" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb103-4439"><a href="#cb103-4439" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb103-4440"><a href="#cb103-4440" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb103-4441"><a href="#cb103-4441" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb103-4442"><a href="#cb103-4442" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb103-4443"><a href="#cb103-4443" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb103-4444"><a href="#cb103-4444" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb103-4445"><a href="#cb103-4445" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb103-4446"><a href="#cb103-4446" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb103-4447"><a href="#cb103-4447" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb103-4448"><a href="#cb103-4448" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb103-4449"><a href="#cb103-4449" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb103-4450"><a href="#cb103-4450" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb103-4451"><a href="#cb103-4451" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(allocationPoolData<span class="op">,</span> {</span>
<span id="cb103-4452"><a href="#cb103-4452" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4453"><a href="#cb103-4453" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4454"><a href="#cb103-4454" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4455"><a href="#cb103-4455" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4456"><a href="#cb103-4456" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb103-4457"><a href="#cb103-4457" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb103-4458"><a href="#cb103-4458" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb103-4459"><a href="#cb103-4459" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(allocationPoolData<span class="op">,</span> {</span>
<span id="cb103-4460"><a href="#cb103-4460" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb103-4461"><a href="#cb103-4461" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb103-4462"><a href="#cb103-4462" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb103-4463"><a href="#cb103-4463" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb103-4464"><a href="#cb103-4464" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb103-4465"><a href="#cb103-4465" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb103-4466"><a href="#cb103-4466" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb103-4467"><a href="#cb103-4467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb103-4468"><a href="#cb103-4468" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb103-4469"><a href="#cb103-4469" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb103-4470"><a href="#cb103-4470" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb103-4471"><a href="#cb103-4471" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb103-4472"><a href="#cb103-4472" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb103-4473"><a href="#cb103-4473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4474"><a href="#cb103-4474" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotAllocationPool)</span>
<span id="cb103-4475"><a href="#cb103-4475" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb103-4476"><a href="#cb103-4476" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb103-4477"><a href="#cb103-4477" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb103-4478"><a href="#cb103-4478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4479"><a href="#cb103-4479" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotAllocationPool<span class="op">;</span></span>
<span id="cb103-4480"><a href="#cb103-4480" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-102" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-102-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-102" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-102-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Liquidity pools allocations.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentives-non-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;34: Share of non-treasury incentives <span class="math inline">I_S</span>, <span class="math inline">I_G</span>, <span class="math inline">I_{AG}</span> and <span class="math inline">I_{AQ}</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<div id="fig-incentives-treasury" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Treasury incentives.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentives-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb104" data-startfrom="4505" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4504;"><span id="cb104-4505"><a href="#cb104-4505" aria-hidden="true" tabindex="-1"></a>treasuryData <span class="op">=</span> {</span>
<span id="cb104-4506"><a href="#cb104-4506" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> treasuryData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb104-4507"><a href="#cb104-4507" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb104-4508"><a href="#cb104-4508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb104-4509"><a href="#cb104-4509" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb104-4510"><a href="#cb104-4510" aria-hidden="true" tabindex="-1"></a>        treasuryData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb104-4511"><a href="#cb104-4511" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"I_T"</span><span class="op">,</span></span>
<span id="cb104-4512"><a href="#cb104-4512" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb104-4513"><a href="#cb104-4513" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb104-4514"><a href="#cb104-4514" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeTreasury</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb104-4515"><a href="#cb104-4515" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb104-4516"><a href="#cb104-4516" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb104-4517"><a href="#cb104-4517" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb104-4518"><a href="#cb104-4518" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-4519"><a href="#cb104-4519" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> treasuryData<span class="op">;</span></span>
<span id="cb104-4520"><a href="#cb104-4520" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-103" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb105" data-startfrom="4524" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4523;"><span id="cb105-4524"><a href="#cb105-4524" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb105-4525"><a href="#cb105-4525" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb105-4526"><a href="#cb105-4526" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb105-4527"><a href="#cb105-4527" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb105-4528"><a href="#cb105-4528" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb105-4529"><a href="#cb105-4529" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb105-4530"><a href="#cb105-4530" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb105-4531"><a href="#cb105-4531" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb105-4532"><a href="#cb105-4532" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb105-4533"><a href="#cb105-4533" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb105-4534"><a href="#cb105-4534" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb105-4535"><a href="#cb105-4535" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb105-4536"><a href="#cb105-4536" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb105-4537"><a href="#cb105-4537" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb105-4538"><a href="#cb105-4538" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb105-4539"><a href="#cb105-4539" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb105-4540"><a href="#cb105-4540" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb105-4541"><a href="#cb105-4541" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(treasuryData<span class="op">,</span> {</span>
<span id="cb105-4542"><a href="#cb105-4542" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4543"><a href="#cb105-4543" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4544"><a href="#cb105-4544" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4545"><a href="#cb105-4545" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4546"><a href="#cb105-4546" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb105-4547"><a href="#cb105-4547" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb105-4548"><a href="#cb105-4548" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(treasuryData<span class="op">,</span> {</span>
<span id="cb105-4549"><a href="#cb105-4549" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb105-4550"><a href="#cb105-4550" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb105-4551"><a href="#cb105-4551" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb105-4552"><a href="#cb105-4552" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb105-4553"><a href="#cb105-4553" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb105-4554"><a href="#cb105-4554" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb105-4555"><a href="#cb105-4555" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb105-4556"><a href="#cb105-4556" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb105-4557"><a href="#cb105-4557" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb105-4558"><a href="#cb105-4558" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb105-4559"><a href="#cb105-4559" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb105-4560"><a href="#cb105-4560" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-104" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentives-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;35: Treasury incentives <span class="math inline">I_T</span>.
</figcaption>
</figure>
</div>


<div class="ojs-auto-generated hidden">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nU308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0l9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdBU3VwcGx5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMyJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nUHJlc2VudFRvbm5lc308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0FFbWl0dGVkfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nRGVsdGFUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC02In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdBUHJpY2V9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdCYXJDaVByaWNlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQVN1cHBseV99PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC05In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdMaXF1aWRUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQUJ1cm50fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0RlbHRhQ2lUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQVByaWNlX308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEzIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdDaVByaWNlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0lucHV0UDB9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nSW5wdXRUfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTYifV19
</script>
</div>
</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note the development of liquidity pool pricing functionality may be applicable.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dFMgPSBJbnB1dHMucmFuZ2UoWzFlLTQsIDFdLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7VGltZS1Mb2NrZWQgfSBTYCxcclxuICBzdGVwOiAxZS00LFxyXG4gIHZhbHVlOiAwLjU1LFxyXG59KTtcclxudmlld29mIGlucHV0RCA9IElucHV0cy5yYW5nZShbMC4yNSwgMTBdLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7UGFyYW1ldGVyIH0gRGAsXHJcbiAgc3RlcDogMC4wMSxcclxuICB2YWx1ZTogNC42OSxcclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbnN0QXJlYUxpbmVhcihyYW5nZSwgYXJlYSwgaW5wdXRTbG9wZSwgc2xvcGVGYWN0b3IgPSAwLjAwNykge1xyXG4gIGlmIChyYW5nZS5sZW5ndGggPT09IDEpIHtcclxuICAgIHJldHVybiBbYXJlYV07XHJcbiAgfVxyXG5cclxuICBsZXQgeTEgPSAwO1xyXG4gIGxldCB5MiA9IHJhbmdlLmxlbmd0aCAtIDE7XHJcbiAgbGV0IHNsb3BlID0gc2xvcGVGYWN0b3IgKiBNYXRoLmF0YW5oKGlucHV0U2xvcGUpO1xyXG4gIGxldCBpbnRlcmNlcHQgPSBhcmVhIC8gcmFuZ2UubGVuZ3RoO1xyXG5cclxuICBpZiAoTWF0aC5hYnMoc2xvcGUpID4gMiAqIGludGVyY2VwdCAvICh5MiAtIHkxIC0gMSkpIHtcclxuICAgIGNvbnN0IHlFeGFjdFNoaWZ0ID0gTWF0aC5zcXJ0KE1hdGguYWJzKDIgKiBhcmVhIC8gc2xvcGUpKTtcclxuICAgIGNvbnN0IHlSb3VuZFNoaWZ0ID0gTWF0aC5tYXgoMSwgTWF0aC5yb3VuZCh5RXhhY3RTaGlmdCkpO1xyXG4gICAgaWYgKHNsb3BlID4gMCkge1xyXG4gICAgICB5MSA9IHkyIC0geVJvdW5kU2hpZnQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB5MiA9IHkxICsgeVJvdW5kU2hpZnQ7XHJcbiAgICB9XHJcbiAgICBzbG9wZSA9IE1hdGguc2lnbihzbG9wZSkgKiAyICogYXJlYSAvIE1hdGgucG93KCh5MiAtIHkxKSwgMik7XHJcbiAgICBpbnRlcmNlcHQgPSBNYXRoLmFicyhzbG9wZSkgKiAoeTIgLSB5MSAtIDEpIC8gMjtcclxuICB9XHJcblxyXG4gIGNvbnN0IHlDb25zdEFyZWEgPSBbXTtcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IHJhbmdlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBjb25zdCB5ID0gaSAtICh5MSArIHkyKSAvIDI7XHJcbiAgICB5Q29uc3RBcmVhLnB1c2goTWF0aC5tYXgoMCwgc2xvcGUgKiB5ICsgaW50ZXJjZXB0KSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4geUNvbnN0QXJlYTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNFID0gZDMucmFuZ2UoMC4yNSwgMTAuMSwgMC4yNSk7XHJcblxyXG5zY2FsZUUgPSBkMy5zY2FsZUxpbmVhcihkMy5leHRlbnQodmVjRSksIFstMSwgMV0pO1xyXG5cclxudmVjUyA9IGNvbnN0QXJlYUxpbmVhcih2ZWNFLCAwLjU1LCBzY2FsZUUoaW5wdXREKSkubWFwKFxyXG4gIHggPT4geCAqIGlucHV0UyAvIDAuNTUsXHJcbik7XHJcblxyXG52ZWNSZXZlcnNlQ3Vtc3VtUyA9IGQzLmN1bXN1bSh2ZWNTLnNsaWNlKCkucmV2ZXJzZSgpKS5yZXZlcnNlKCk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGRvdFByb2R1Y3Qodiwgdykge1xyXG4gIGlmICh2Lmxlbmd0aCAhPT0gdy5sZW5ndGgpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIlZlY3RvcnMgbXVzdCBoYXZlIHRoZSBzYW1lIGxlbmd0aFwiKTtcclxuICB9XHJcbiAgcmV0dXJuIHYucmVkdWNlKChhY2MsIHZhbCwgaSkgPT4gYWNjICsgdmFsICogd1tpXSwgMCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHdlaWdodGVkQXJpdGhtZXRpY01lYW4odiwgd2VpZ2h0cykge1xyXG4gIHJldHVybiBkb3RQcm9kdWN0KHYsIHdlaWdodHMpIC8gZDMuc3VtKHdlaWdodHMpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBhcmFtRCA9IHdlaWdodGVkQXJpdGhtZXRpY01lYW4odmVjRSwgdmVjUyk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBhcmFtQyA9IHdlaWdodGVkQXJpdGhtZXRpY01lYW4odmVjRS5tYXAoZSA9PiBlICogZSksIHZlY1MpO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlR2FtbWEodmVjRSwgcGFyYW1ELCBwYXJhbUMpIHtcclxuICBjb25zdCB0d29DID0gMiAqIHBhcmFtQztcclxuICByZXR1cm4gdmVjRS5tYXAoZSA9PiBNYXRoLm1heCgwLCBlL3BhcmFtRCAtIGUqZS90d29DKSk7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjR2FtbWEgPSBjb21wdXRlR2FtbWEodmVjRSwgcGFyYW1ELCBwYXJhbUMpO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBub3JtYWxpemUodikge1xyXG4gIGNvbnN0IHN1bSA9IGQzLnN1bSh2KTtcclxuICByZXR1cm4gdi5tYXAodmFsID0+IHZhbCAvIHN1bSk7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZlY05vcm1HYW1tYSA9IG5vcm1hbGl6ZSh2ZWNHYW1tYSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNDdW1TdW1HYW1tYSA9IGQzLmN1bXN1bSh2ZWNOb3JtR2FtbWEpO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVoocGFyYW1TLCB2ZWNDdW1TdW1HYW1tYSwgdmVjRSkge1xyXG4gIHJldHVybiB2ZWNDdW1TdW1HYW1tYS5tYXAoKGcsIHQpID0+ICgxIC0gcGFyYW1TKSAqIGcgLyB2ZWNFW3RdKTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjWiA9IGNvbXB1dGVaKGlucHV0UywgdmVjQ3VtU3VtR2FtbWEsIHZlY0UpO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUIodmVjWiwgdmVjRSkge1xyXG4gIHJldHVybiB2ZWNaLm1hcCgoeiwgdCkgPT4gTWF0aC5leHAoLXogKiB2ZWNFW3RdKSk7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZlY0IgPSBjb21wdXRlQih2ZWNaLCB2ZWNFKTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVZKHZlY1opIHtcclxuICByZXR1cm4gdmVjWi5tYXAoeiA9PiBNYXRoLmV4cG0xKHopKTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjWSA9IGNvbXB1dGVZKHZlY1opO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1JID0gZG90UHJvZHVjdCh2ZWNTLCB2ZWNZKTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InlpZWxkRGF0YSA9IHtcclxuICAgY29uc3QgeWllbGREYXRhID0gW107XHJcbiAgIGZvciAobGV0IHQgPSAzOyB0IDwgdmVjRS5sZW5ndGg7IHQgKz0gNCkge1xyXG4gICAgICB5aWVsZERhdGEucHVzaCh7XHJcbiAgICAgICAgIGtleTogXCJTdGFrZSBBXCIsXHJcbiAgICAgICAgIHZhbHVlOiAxMDAgKiBkMy5zdW0odmVjUy5zbGljZSh0IC0gMywgdCArIDEpKSxcclxuICAgICAgICAgdGltZTogdmVjRVt0XSxcclxuICAgICAgfSk7XHJcbiAgICAgIHlpZWxkRGF0YS5wdXNoKHtcclxuICAgICAgICAga2V5OiBcIllpZWxkIFRlcm0gU3RydWN0dXJlXCIsXHJcbiAgICAgICAgIHZhbHVlOiAxMDAgKiB2ZWNaW3RdLFxyXG4gICAgICAgICB0aW1lOiB2ZWNFW3RdLFxyXG4gICAgICB9KTtcclxuICAgICAgeWllbGREYXRhLnB1c2goe1xyXG4gICAgICAgICBrZXk6IFwiUmVhbCBZaWVsZFwiLFxyXG4gICAgICAgICB2YWx1ZTogMTAwICogKHZlY1pbdF0gLSBwYXJhbUkpLFxyXG4gICAgICAgICB0aW1lOiB2ZWNFW3RdLFxyXG4gICAgICB9KTtcclxuICAgICAgeWllbGREYXRhLnB1c2goe1xyXG4gICAgICAgICBrZXk6IFwiRGlzY291bnQgQ3VydmVcIixcclxuICAgICAgICAgdmFsdWU6IDEwMCAqIHZlY0JbdF0sXHJcbiAgICAgICAgIHRpbWU6IHZlY0VbdF0sXHJcbiAgICAgIH0pO1xyXG4gICAgICB5aWVsZERhdGEucHVzaCh7XHJcbiAgICAgICAgIGtleTogXCJDdW11bGF0aXZlIFN0YWtlIEFcIixcclxuICAgICAgICAgdmFsdWU6IDEwMCAqIHZlY1JldmVyc2VDdW1zdW1TW3QgLSAzXSxcclxuICAgICAgICAgdGltZTogdmVjRVt0XSxcclxuICAgICAgfSk7XHJcbiAgIH1cclxuICAgcmV0dXJuIHlpZWxkRGF0YTtcclxufTtcclxuZ2V0U3Rha2UgPSBkID0+IGQua2V5ID09PSBcIlN0YWtlIEFcIiA/IGQudmFsdWUgOiBOYU47XHJcbmdldFlpZWxkVGVybSA9IGQgPT4gZC5rZXkgPT09IFwiWWllbGQgVGVybSBTdHJ1Y3R1cmVcIiA/IGQudmFsdWUgOiBOYU47XHJcbmdldFJlYWxZaWVsZCA9IGQgPT4gZC5rZXkgPT09IFwiUmVhbCBZaWVsZFwiID8gZC52YWx1ZSA6IE5hTjtcclxuZ2V0RGlzY291bnQgPSBkID0+IGQua2V5ID09PSBcIkRpc2NvdW50IEN1cnZlXCIgPyBkLnZhbHVlIDogTmFOO1xyXG5nZXRDdW1TdGFrZSA9IGQgPT4gZC5rZXkgPT09IFwiQ3VtdWxhdGl2ZSBTdGFrZSBBXCIgPyBkLnZhbHVlIDogTmFOO1xyXG5cclxuc3RyaW5nUyA9IFwiVG90YWwgU3Rha2UgPSBcIiArIGlucHV0Uy50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbik7XHJcbnN0cmluZ0kgPSBcIkluZmxhdGlvbiA9IFwiICsgcGFyYW1JLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcclxuKTtcclxuc3RyaW5nRCA9IGBEID0gJHtwYXJhbUQudG9Mb2NhbGVTdHJpbmcoXHJcbiAgXCJlbi1HQlwiLFxyXG4gIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcclxuKX0geWVhcnNgO1xyXG5zdHJpbmdDID0gYOKImkMgPSAke01hdGguc3FydChwYXJhbUMpLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbil9IHllYXJzYDtcclxuXHJcbnlpZWxkUGFyYW1zID0gW1xyXG4gIHsga2V5OiBzdHJpbmdELCB0aW1lOiBwYXJhbUQgfSxcclxuICB7IGtleTogc3RyaW5nQywgdGltZTogTWF0aC5zcXJ0KHBhcmFtQykgfSxcclxuXTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHJhbmdlOiBkMy5zY2hlbWVDYXRlZ29yeTEwLFxyXG4gICAgZG9tYWluOiBbXCJTdGFrZSBBXCIsIFwiWWllbGQgVGVybSBTdHJ1Y3R1cmVcIiwgXCJSZWFsIFlpZWxkXCIsIHN0cmluZ0QsIHN0cmluZ0NdLFxyXG4gIH0sXHJcbiAgeDoge1xyXG4gICAgdGlja3M6IGQzLnJhbmdlKDEsIDExKSxcclxuICAgIGRvbWFpbjogWzAuMjUsIDEwLjQ1XSxcclxuICAgIGxhYmVsOiBcIlRpbWUgdG8gRXhwaXJ5IChZZWFycylcIixcclxuICB9LFxyXG4gIHk6IHtcclxuICAgIGRvbWFpbjogW1xyXG4gICAgICAwLFxyXG4gICAgICBNYXRoLm1heChkMy5tYXgoeWllbGREYXRhLCBnZXRTdGFrZSksIGQzLm1heCh5aWVsZERhdGEsIGdldFlpZWxkVGVybSkpLFxyXG4gICAgXSxcclxuICAgIGdyaWQ6IHRydWUsXHJcbiAgfSxcclxuICBpbnNldFRvcDogMTYsXHJcbiAgaW5zZXRMZWZ0OiA4LFxyXG4gIGluc2V0UmlnaHQ6IDgsXHJcbiAgY2xpcDogdHJ1ZSxcclxuICBtYXJrczogW1xyXG4gICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJsZWZ0XCIsIGxhYmVsOiBcIlN0YWtlIEEgYnkgTWF0dXJpdHkgKCUpXCIgfSksXHJcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIllpZWxkIFJhdGVzICglKVwiIH0pLFxyXG4gICAgUGxvdC5yZWN0WSh5aWVsZERhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC50aW1lIC0gMC40NSxcclxuICAgICAgeDI6IGQgPT4gZC50aW1lICsgMC40NSxcclxuICAgICAgeTogZ2V0U3Rha2UsXHJcbiAgICAgIGZpbGw6IFwia2V5XCIsXHJcbiAgICB9KSxcclxuICAgIFBsb3QucnVsZVgoeWllbGRQYXJhbXMsIHtcclxuICAgICAgeDogXCJ0aW1lXCIsXHJcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcclxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxyXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXHJcbiAgICB9KSxcclxuICAgIFBsb3QubGluZVkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXRZaWVsZFRlcm0sIHN0cm9rZTogXCJrZXlcIiB9KSxcclxuICAgIFBsb3QuZG90WSh5aWVsZERhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldFlpZWxkVGVybSwgZmlsbDogXCJrZXlcIiB9KSxcclxuICAgIFBsb3QubGluZVkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXRSZWFsWWllbGQsIHN0cm9rZTogXCJrZXlcIiB9KSxcclxuICAgIFBsb3QuZG90WSh5aWVsZERhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldFJlYWxZaWVsZCwgZmlsbDogXCJrZXlcIiB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHJhbmdlOiBbOCwgNSwgMywgNF0ubWFwKGkgPT4gZDMuc2NoZW1lQ2F0ZWdvcnkxMFtpXSksXHJcbiAgICBkb21haW46IFtcIkN1bXVsYXRpdmUgU3Rha2UgQVwiLCBcIkRpc2NvdW50IEN1cnZlXCIsIHN0cmluZ0QsIHN0cmluZ0NdLFxyXG4gIH0sXHJcbiAgeDoge1xyXG4gICAgdGlja3M6IGQzLnJhbmdlKDEsIDExKSxcclxuICAgIGRvbWFpbjogWzAuMjUsIDEwLjQ1XSxcclxuICAgIGxhYmVsOiBcIlRpbWUgdG8gRXhwaXJ5IChZZWFycylcIlxyXG4gIH0sXHJcbiAgeTogeyBkb21haW46IFswLCAxMDBdLCBncmlkOiB0cnVlIH0sXHJcbiAgY2xpcDogdHJ1ZSxcclxuICBpbnNldFRvcDogMTYsXHJcbiAgaW5zZXRMZWZ0OiA4LFxyXG4gIGluc2V0UmlnaHQ6IDgsXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwibGVmdFwiLCBsYWJlbDogXCJDdW11bGF0aXZlIFN0YWtlICglKVwiIH0pLFxyXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJyaWdodFwiLCBsYWJlbDogXCJEaXNjb3VudCAoJSlcIiB9KSxcclxuICAgIFBsb3QucmVjdFkoeWllbGREYXRhLCB7XHJcbiAgICAgIHgxOiBkID0+IGQudGltZSAtIDAuNDUsXHJcbiAgICAgIHgyOiBkID0+IGQudGltZSArIDAuNDUsXHJcbiAgICAgIHk6IGdldEN1bVN0YWtlLFxyXG4gICAgICBmaWxsOiBcImtleVwiLFxyXG4gICAgfSksXHJcbiAgICBQbG90LnJ1bGVYKHlpZWxkUGFyYW1zLCB7XHJcbiAgICAgIHg6IFwidGltZVwiLFxyXG4gICAgICBzdHJva2U6IFwia2V5XCIsXHJcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcclxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxyXG4gICAgfSksXHJcbiAgICBQbG90LmxpbmVZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0RGlzY291bnQsIHN0cm9rZTogXCJrZXlcIiB9KSxcclxuICAgIFBsb3QuZG90WSh5aWVsZERhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldERpc2NvdW50LCBmaWxsOiBcImtleVwiIH0pLFxyXG4gIF0sXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29udHJhc3RpbmdUZXh0Q29sb3IoYmFja2dyb3VuZENvbG9yKSB7XHJcbiAgaWYgKGQzLmhzbChiYWNrZ3JvdW5kQ29sb3IpLmwgPCAwLjUpIHtcclxuICAgIHJldHVybiBcIndoaXRlXCI7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBcImJsYWNrXCI7XHJcbiAgfVxyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlQXBwcm94RGVsdGFBKHBhcmFtUywgcGFyYW1FKSB7XHJcbiAgcmV0dXJuIHBhcmFtUyAqICgxIC0gcGFyYW1TKSAvIHBhcmFtRTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW5mbGF0aW9uRGF0YSA9IHtcclxuICBjb25zdCBpbmZsYXRpb25EYXRhID0gW107XHJcbiAgZm9yIChsZXQgcGFyYW1TID0gMDsgcGFyYW1TIDwgMS4wMTsgcGFyYW1TICs9IDAuMSkge1xyXG4gICAgZm9yIChsZXQgcGFyYW1FID0gMTsgcGFyYW1FIDw9IDEwOyBwYXJhbUUrKykge1xyXG4gICAgICBpbmZsYXRpb25EYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCLOlEFcIixcclxuICAgICAgICBlOiBwYXJhbUUsXHJcbiAgICAgICAgczogcGFyYW1TLFxyXG4gICAgICAgIHZhbHVlOiBjb21wdXRlQXBwcm94RGVsdGFBKHBhcmFtUywgcGFyYW1FKSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiBpbmZsYXRpb25EYXRhO1xyXG59O1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcclxuICBjb2xvcjogeyBsZWdlbmQ6IHRydWUsIHNjaGVtZTogXCJTcGVjdHJhbFwiLCB0eXBlOiBcInNlcXVlbnRpYWxcIiwgbGFiZWw6IFwizpRTXCIgfSxcclxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgxLCAxMC4xLCAxKSwgZG9tYWluOiBbMTAuNSwgMC41XSwgbGFiZWw6IFwiRXhwaXJ5IFRpbWUgRVwiIH0sXHJcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJTdGFraW5nIFNcIiB9LFxyXG4gIG1hcmtzOiBbXHJcbiAgICBQbG90LmZyYW1lKCksXHJcbiAgICBQbG90LnJlY3QoaW5mbGF0aW9uRGF0YSwge1xyXG4gICAgICB4MTogZCA9PiBkLmUgLSAwLjUsXHJcbiAgICAgIHgyOiBkID0+IGQuZSArIDAuNSxcclxuICAgICAgeTE6IGQgPT4gZC5zIC0gMC4wNSxcclxuICAgICAgeTI6IGQgPT4gZC5zICsgMC4wNSxcclxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxyXG4gICAgfSksXHJcbiAgICBQbG90LnRleHQoaW5mbGF0aW9uRGF0YSwge1xyXG4gICAgICB4OiBcImVcIixcclxuICAgICAgeTogXCJzXCIsXHJcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXHJcbiAgICAgICAgXCJlbi1HQlwiLFxyXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcclxuICAgICAgKSxcclxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcclxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXHJcbiAgICAgICAgICBbMCwgY29tcHV0ZUFwcHJveERlbHRhQSgwLjUsIDEpXSxcclxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXHJcbiAgICAgICAgKShkLnZhbHVlKSxcclxuICAgICAgKSxcclxuICAgIH0pLFxyXG4gIF0sXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0Q2kwID0gSW5wdXRzLnJhbmdlKFswLCAxXSwge1xyXG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1BvcnRmb2xpbyB9IENfe2kwfWAsXHJcbiAgc3RlcDogMWUtMyxcclxufSk7XHJcbnZpZXdvZiBpbnB1dExpcVNoYXBlID0gSW5wdXRzLnJhbmdlKFstMSwgMV0sIHtcclxuICBsYWJlbDogdGV4YFxcdGV4dHtTY2hlZHVsZSBzaGFwZX1gLFxyXG4gIHN0ZXA6IDFlLTMsXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjQ2kgPSBjb25zdEFyZWFMaW5lYXIodmVjRSwgMSAtIGlucHV0Q2kwLCBpbnB1dExpcVNoYXBlLCAwLjAxKTtcclxuXHJcbnBhcmFtQmFyQ2kgPSBpbnB1dENpMCArIGRvdFByb2R1Y3QodmVjQiwgdmVjQ2kpO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiY2FyYm9uSGVsZERhdGEgPSB7XHJcbiAgY29uc3QgY2FyYm9uSGVsZERhdGEgPSBbXTtcclxuICBjYXJib25IZWxkRGF0YS5wdXNoKHtcclxuICAgIGtleTogXCJMaXF1aWRpdHkgU2NoZWR1bGVcIixcclxuICAgIHZhbHVlOiAxMDAgKiBpbnB1dENpMCxcclxuICAgIHRpbWU6IDAsXHJcbiAgfSk7XHJcbiAgZm9yIChsZXQgdCA9IDM7IHQgPCB2ZWNFLmxlbmd0aDsgdCArPSA0KSB7XHJcbiAgICBjYXJib25IZWxkRGF0YS5wdXNoKHtcclxuICAgICAga2V5OiBcIkxpcXVpZGl0eSBTY2hlZHVsZVwiLFxyXG4gICAgICB2YWx1ZTogMTAwICogZDMuc3VtKHZlY0NpLnNsaWNlKHQgLSAzLCB0ICsgMSkpLFxyXG4gICAgICB0aW1lOiB2ZWNFW3RdLFxyXG4gICAgfSk7XHJcbiAgICBjYXJib25IZWxkRGF0YS5wdXNoKHtcclxuICAgICAga2V5OiBcIkRpc2NvdW50IEN1cnZlXCIsXHJcbiAgICAgIHZhbHVlOiAxMDAgKiB2ZWNCW3RdLFxyXG4gICAgICB0aW1lOiB2ZWNFW3RdLFxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHJldHVybiBjYXJib25IZWxkRGF0YTtcclxufTtcclxuZ2V0TGlxU2NoZWR1bGUgPSBkID0+IGQua2V5ID09PSBcIkxpcXVpZGl0eSBTY2hlZHVsZVwiID8gZC52YWx1ZSA6IE5hTjtcclxuXHJcbnN0cmluZ0JhckNpID0gYFByZXNlbnQtVmFsdWUgQ2FyYm9uIEPMhOG1oiA9ICR7cGFyYW1CYXJDaS50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMCB9LFxyXG4pfWA7XHJcblxyXG5oZWxkQ2FyYm9uUGFyYW0gPSBbeyBrZXk6IHN0cmluZ0JhckNpLCB2YWx1ZTogMTAwICogcGFyYW1CYXJDaSB9XTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHJhbmdlOiBbMiwgNSwgNl0ubWFwKGkgPT4gZDMuc2NoZW1lQ2F0ZWdvcnkxMFtpXSksXHJcbiAgICBkb21haW46IFtcIkxpcXVpZGl0eSBTY2hlZHVsZVwiLCBcIkRpc2NvdW50IEN1cnZlXCIsIHN0cmluZ0JhckNpXSxcclxuICB9LFxyXG4gIHg6IHtcclxuICAgIGxhYmVsOiBcIlRpbWUgdG8gRXhwaXJ5IChZZWFycylcIixcclxuICAgIGxhYmVsQW5jaG9yOiBcInJpZ2h0XCIsXHJcbiAgICBsYWJlbEFycm93OiB0cnVlLFxyXG4gIH0sXHJcbiAgeTogeyBkb21haW46IFswLCAxMDBdLCBncmlkOiB0cnVlIH0sXHJcbiAgaW5zZXRUb3A6IDE2LFxyXG4gIGluc2V0TGVmdDogOCxcclxuICBpbnNldFJpZ2h0OiA4LFxyXG4gIGNsaXA6IHRydWUsXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwibGVmdFwiLCBsYWJlbDogXCJRdWFudGl0eSBvZiBDYXJib24gKCUpXCIgfSksXHJcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIkRpc2NvdW50ICglKVwiIH0pLFxyXG4gICAgUGxvdC5yZWN0WShjYXJib25IZWxkRGF0YSwge1xyXG4gICAgICB4MTogZCA9PiBkLnRpbWUgLSAwLjQ1LFxyXG4gICAgICB4MjogZCA9PiBkLnRpbWUgKyAwLjQ1LFxyXG4gICAgICB5OiBnZXRMaXFTY2hlZHVsZSxcclxuICAgICAgZmlsbDogXCJrZXlcIixcclxuICAgIH0pLFxyXG4gICAgUGxvdC5ydWxlWShoZWxkQ2FyYm9uUGFyYW0sIHtcclxuICAgICAgeTogXCJ2YWx1ZVwiLFxyXG4gICAgICBzdHJva2U6IFwia2V5XCIsXHJcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcclxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxyXG4gICAgfSksXHJcbiAgICBQbG90LmxpbmVZKGNhcmJvbkhlbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXREaXNjb3VudCwgc3Ryb2tlOiBcImtleVwiIH0pLFxyXG4gICAgUGxvdC5kb3RZKGNhcmJvbkhlbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXREaXNjb3VudCwgZmlsbDogXCJrZXlcIiB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQ2kgPSBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7UHVyY2hhc2VkIH0gXFxEZWx0YSBDX2lgLFxyXG4gIHN0ZXA6IDFlLTMsXHJcbiAgdmFsdWU6IDEsXHJcbn0pO1xyXG52aWV3b2YgaW5wdXRFdCA9IElucHV0cy5yYW5nZShbMCwgMTBdLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7RXhwaXJ5IH0gRV90IFxcdGV4dHsgKHllYXJzKX1gLFxyXG4gIHN0ZXA6IDEsXHJcbiAgdmFsdWU6IDYsXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZURlbHRhQ2kwKGRlbHRhQ2ksIHQpIHtcclxuICByZXR1cm4gdCA9PT0gMCA/IGRlbHRhQ2kgOiAwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb21wdXRlVmVjRGVsdGFDaShkZWx0YUNpLCB0KSB7XHJcbiAgY29uc3QgdmVjRGVsdGFDaSA9IEFycmF5KDQwKS5maWxsKDApO1xyXG4gIGlmICh0ICE9PSAwKSB7XHJcbiAgICB2ZWNEZWx0YUNpW3QgLSAxXSA9IGRlbHRhQ2k7XHJcbiAgfVxyXG4gIHJldHVybiB2ZWNEZWx0YUNpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwYXJhbU1hdHVyaXR5SWR4ID0gNCAqIGlucHV0RXQ7XHJcblxyXG5wYXJhbURlbHRhQ2kwID0gY29tcHV0ZURlbHRhQ2kwKGlucHV0RGVsdGFDaSwgcGFyYW1NYXR1cml0eUlkeCk7XHJcblxyXG52ZWNEZWx0YUNpID0gY29tcHV0ZVZlY0RlbHRhQ2koaW5wdXREZWx0YUNpLCBwYXJhbU1hdHVyaXR5SWR4KTtcclxuXHJcbnBhcmFtRGVsdGFCYXJDaSA9IHBhcmFtRGVsdGFDaTAgKyBkb3RQcm9kdWN0KHZlY0IsIHZlY0RlbHRhQ2kpO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiY2FyYm9uQnV5RGF0YSA9IHtcclxuICBjb25zdCBjYXJib25CdXlEYXRhID0gW107XHJcbiAgY2FyYm9uQnV5RGF0YS5wdXNoKHtcclxuICAgIGtleTogXCJDYXJib24gQm91Z2h0IGJ5IEFBTVwiLFxyXG4gICAgdmFsdWU6IDEwMCAqIHBhcmFtRGVsdGFDaTAsXHJcbiAgICB0aW1lOiAwLFxyXG4gIH0pO1xyXG4gIGZvciAobGV0IHQgPSAzOyB0IDwgdmVjRS5sZW5ndGg7IHQgKz0gNCkge1xyXG4gICAgY2FyYm9uQnV5RGF0YS5wdXNoKHtcclxuICAgICAga2V5OiBcIkNhcmJvbiBCb3VnaHQgYnkgQUFNXCIsXHJcbiAgICAgIHZhbHVlOiAxMDAgKiBkMy5zdW0odmVjRGVsdGFDaS5zbGljZSh0IC0gMywgdCArIDEpKSxcclxuICAgICAgdGltZTogdmVjRVt0XSxcclxuICAgIH0pO1xyXG4gICAgY2FyYm9uQnV5RGF0YS5wdXNoKHtcclxuICAgICAga2V5OiBcIkRpc2NvdW50IEN1cnZlXCIsXHJcbiAgICAgIHZhbHVlOiAxMDAgKiB2ZWNCW3RdLFxyXG4gICAgICB0aW1lOiB2ZWNFW3RdLFxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHJldHVybiBjYXJib25CdXlEYXRhO1xyXG59O1xyXG5nZXRDYXJib25Cb3VnaHQgPSBkID0+IGQua2V5ID09PSBcIkNhcmJvbiBCb3VnaHQgYnkgQUFNXCIgPyBkLnZhbHVlIDogTmFOO1xyXG5cclxuc3RyaW5nRGVsdGFCYXJDaSA9IFwiUHJlc2VudC1WYWx1ZSBDYXJib24gQm91Z2h0IGJ5IEFBTSDOlEPMhOG1oiA9IFwiICtcclxuICAgICAgICBwYXJhbURlbHRhQmFyQ2kudG9Mb2NhbGVTdHJpbmcoXHJcbiAgICAgICAgICBcImVuLUdCXCIsXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHN0eWxlOiBcInBlcmNlbnRcIixcclxuICAgICAgICAgICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAxLFxyXG4gICAgICAgICAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDEsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICk7XHJcbmJvdWdodENhcmJvblBhcmFtID0gW3sga2V5OiBzdHJpbmdEZWx0YUJhckNpLCB2YWx1ZTogMTAwICogcGFyYW1EZWx0YUJhckNpIH1dO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcclxuICBjb2xvcjoge1xyXG4gICAgbGVnZW5kOiB0cnVlLFxyXG4gICAgcmFuZ2U6IFszLCA1LCA3XS5tYXAoaSA9PiBkMy5zY2hlbWVDYXRlZ29yeTEwW2ldKSxcclxuICAgIGRvbWFpbjogW1wiQ2FyYm9uIEJvdWdodCBieSBBQU1cIiwgXCJEaXNjb3VudCBDdXJ2ZVwiLCBzdHJpbmdEZWx0YUJhckNpXSxcclxuICB9LFxyXG4gIHg6IHtcclxuICAgIGxhYmVsOiBcIlRpbWUgdG8gRXhwaXJ5IChZZWFycylcIixcclxuICAgIGxhYmVsQW5jaG9yOiBcInJpZ2h0XCIsXHJcbiAgICBsYWJlbEFycm93OiB0cnVlLFxyXG4gIH0sXHJcbiAgeTogeyBkb21haW46IFswLCAxMDBdLCBncmlkOiB0cnVlIH0sXHJcbiAgaW5zZXRUb3A6IDE2LFxyXG4gIGluc2V0TGVmdDogOCxcclxuICBpbnNldFJpZ2h0OiA4LFxyXG4gIGNsaXA6IHRydWUsXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwibGVmdFwiLCBsYWJlbDogXCJRdWFudGl0eSBvZiBDYXJib24gKCUpXCIgfSksXHJcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIkRpc2NvdW50ICglKVwiIH0pLFxyXG4gICAgUGxvdC5yZWN0WShjYXJib25CdXlEYXRhLCB7XHJcbiAgICAgIHgxOiBkID0+IGQudGltZSAtIDAuNDUsXHJcbiAgICAgIHgyOiBkID0+IGQudGltZSArIDAuNDUsXHJcbiAgICAgIHk6IGdldENhcmJvbkJvdWdodCxcclxuICAgICAgZmlsbDogXCJrZXlcIixcclxuICAgIH0pLFxyXG4gICAgUGxvdC5ydWxlWShib3VnaHRDYXJib25QYXJhbSwge1xyXG4gICAgICB5OiBcInZhbHVlXCIsXHJcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcclxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxyXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXHJcbiAgICB9KSxcclxuICAgIFBsb3QubGluZVkoY2FyYm9uQnV5RGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0RGlzY291bnQsIHN0cm9rZTogXCJrZXlcIiB9KSxcclxuICAgIFBsb3QuZG90WShjYXJib25CdXlEYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXREaXNjb3VudCwgZmlsbDogXCJrZXlcIiB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQmFyQ2kgPSBJbnB1dHMucmFuZ2UoWzAuMDEsIDFdLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7UHVyY2hhc2VkIH0gXFxEZWx0YSBcXGJhciBDX2lgLFxyXG4gIHN0ZXA6IDAuMDEsXHJcbiAgdmFsdWU6IDEsXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZURlbHRhQShBaSwgR2ksIGRlbHRhQ2kpIHtcclxuICByZXR1cm4gTWF0aC5leHBtMSgoQWkgLSAoQWkqKjIgKiAoMSAtIEdpKSoqMiAvIDIpKSAqIE1hdGgubG9nMXAoZGVsdGFDaSkpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwcmljaW5nRGF0YSA9IHtcclxuICBjb25zdCBwcmljaW5nRGF0YSA9IFtdO1xyXG4gIGZvciAobGV0IHBhcmFtR2kgPSAwOyBwYXJhbUdpIDwgMS4wMTsgcGFyYW1HaSArPSAwLjEpIHtcclxuICAgIHByaWNpbmdEYXRhLnB1c2goe1xyXG4gICAgICBrZXk6IFwizpRBXCIsXHJcbiAgICAgIGFpOiAwLFxyXG4gICAgICBnaTogcGFyYW1HaSxcclxuICAgICAgdmFsdWU6IE5hTixcclxuICAgIH0pO1xyXG4gICAgcHJpY2luZ0RhdGEucHVzaCh7XHJcbiAgICAgIGtleTogXCJOb3JtYWxpc2VkIM6UQVwiLFxyXG4gICAgICBhaTogMCxcclxuICAgICAgZ2k6IHBhcmFtR2ksXHJcbiAgICAgIHZhbHVlOiBOYU4sXHJcbiAgICB9KTtcclxuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xyXG4gICAgICBwcmljaW5nRGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwizpRBXCIsXHJcbiAgICAgICAgYWk6IHBhcmFtQWksXHJcbiAgICAgICAgZ2k6IHBhcmFtR2ksXHJcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVEZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUJhckNpKSxcclxuICAgICAgfSk7XHJcbiAgICAgIHByaWNpbmdEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJOb3JtYWxpc2VkIM6UQVwiLFxyXG4gICAgICAgIGFpOiBwYXJhbUFpLFxyXG4gICAgICAgIGdpOiBwYXJhbUdpLFxyXG4gICAgICAgIHZhbHVlOiBjb21wdXRlRGVsdGFBKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFCYXJDaSkgL1xyXG4gICAgICAgICAgICAgICAgKGlucHV0RGVsdGFCYXJDaSAqIHBhcmFtQWkpLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHByaWNpbmdEYXRhO1xyXG59O1xyXG5nZXREZWx0YUEgPSBkID0+IGQua2V5ID09PSBcIs6UQVwiID8gZC52YWx1ZSA6IE5hTjtcclxuZ2V0Tm9ybURlbHRhQSA9IGQgPT4gZC5rZXkgPT09IFwiTm9ybWFsaXNlZCDOlEFcIiA/IGQudmFsdWUgOiBOYU47XHJcblxyXG5zdHJpbmdJbnB1dERlbHRhQmFyQ2kgPSBpbnB1dERlbHRhQmFyQ2kudG9Mb2NhbGVTdHJpbmcoXHJcbiAgXCJlbi1HQlwiLFxyXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSxcclxuKTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxyXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICBsYWJlbDogYM6UQSwgd2hlcmUgzpRDzIThtaIgPSAke3N0cmluZ0lucHV0RGVsdGFCYXJDaX1gLFxyXG4gIH0sXHJcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXHJcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcclxuICBtYXJrczogW1xyXG4gICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgUGxvdC5yZWN0KHByaWNpbmdEYXRhLCB7XHJcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxyXG4gICAgICB4MjogZCA9PiBkLmFpICsgMC4wNSxcclxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXHJcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxyXG4gICAgICBmaWxsOiBnZXREZWx0YUEsXHJcbiAgICB9KSxcclxuICAgIFBsb3QudGV4dChwcmljaW5nRGF0YSwge1xyXG4gICAgICB4OiBcImFpXCIsXHJcbiAgICAgIHk6IFwiZ2lcIixcclxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0RGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgIFwiZW4tR0JcIixcclxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbiAgICAgICksXHJcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXHJcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxyXG4gICAgICAgICAgW1xyXG4gICAgICAgICAgICBjb21wdXRlRGVsdGFBKDAuMSwgMSwgaW5wdXREZWx0YUJhckNpKSxcclxuICAgICAgICAgICAgY29tcHV0ZURlbHRhQSgxLCAxLCBpbnB1dERlbHRhQmFyQ2kpLFxyXG4gICAgICAgICAgXSxcclxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXHJcbiAgICAgICAgKShkLnZhbHVlKSxcclxuICAgICAgKSxcclxuICAgIH0pLFxyXG4gIF0sXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcclxuICBjb2xvcjoge1xyXG4gICAgbGVnZW5kOiB0cnVlLFxyXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXHJcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcclxuICAgIGxhYmVsOiBgTm9ybWFsaXNlZCDOlEEsIHdoZXJlIM6UQ8yE4bWiID0gJHtzdHJpbmdJbnB1dERlbHRhQmFyQ2l9YCxcclxuICB9LFxyXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxyXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QucmVjdChwcmljaW5nRGF0YSwge1xyXG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcclxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXHJcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxyXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcclxuICAgICAgZmlsbDogZ2V0Tm9ybURlbHRhQSxcclxuICAgIH0pLFxyXG4gICAgUGxvdC50ZXh0KHByaWNpbmdEYXRhLCB7XHJcbiAgICAgIHg6IFwiYWlcIixcclxuICAgICAgeTogXCJnaVwiLFxyXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXROb3JtRGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgIFwiZW4tR0JcIixcclxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbiAgICAgICksXHJcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXHJcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxyXG4gICAgICAgICAgW1xyXG4gICAgICAgICAgICBjb21wdXRlRGVsdGFBKDEsIDAsIGlucHV0RGVsdGFCYXJDaSkgLyBpbnB1dERlbHRhQmFyQ2ksXHJcbiAgICAgICAgICAgIGNvbXB1dGVEZWx0YUEoMSwgMSwgaW5wdXREZWx0YUJhckNpKSAvIGlucHV0RGVsdGFCYXJDaSxcclxuICAgICAgICAgIF0sXHJcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxyXG4gICAgICAgICkoZC52YWx1ZSksXHJcbiAgICAgICksXHJcbiAgICB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQmFyQ251bGwgPSBJbnB1dHMucmFuZ2UoWzFlLTEsIDFlNV0sIHtcclxuICBsYWJlbDogdGV4YFxcdGV4dHtQdXJjaGFzZWQgfSBcXERlbHRhIFxcYmFyIENfXFxlbXB0eXNldGAsXHJcbiAgc3RlcDogMWUtMSxcclxuICB2YWx1ZTogMWUyLFxyXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVplcm9DYXJib25EZWx0YUEoQWksIEdpLCBkZWx0YUNudWxsKSB7XHJcbiAgcmV0dXJuIChkZWx0YUNudWxsIC8gKDEgKyBkZWx0YUNudWxsKSkgKiAoQWkgLSAoQWkqKjIgKiAoMSAtIEdpKSoqMiAvIDIpKSoqMjtcclxufVxyXG5cclxuZnVuY3Rpb24gY29tcHV0ZVRydWVEZWx0YUEoQWksIEdpLCBiYXJDaVRvbm5lcywgZGVsdGFCYXJDaVRvbm5lcykge1xyXG4gIGlmIChiYXJDaVRvbm5lcyA9PT0gMCkge1xyXG4gICAgcmV0dXJuIGNvbXB1dGVaZXJvQ2FyYm9uRGVsdGFBKEFpLCBHaSwgZGVsdGFCYXJDaVRvbm5lcyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IGRlbHRhQmFyQ2kgPSBkZWx0YUJhckNpVG9ubmVzIC8gYmFyQ2lUb25uZXM7XHJcbiAgICByZXR1cm4gY29tcHV0ZURlbHRhQShBaSwgR2ksIGRlbHRhQmFyQ2kpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gbnVtYmVyT2ZEaWdpdHMoeCkge1xyXG4gIHJldHVybiB4ID09PSAwID8gMSA6ICgxICsgTWF0aC5mbG9vcihNYXRoLmxvZzEwKHgpKSk7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Inplcm9DYXJib25EYXRhID0ge1xyXG4gIGNvbnN0IHplcm9DYXJib25EYXRhID0gW107XHJcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xyXG4gICAgemVyb0NhcmJvbkRhdGEucHVzaCh7XHJcbiAgICAgIGtleTogXCLOlEFcIixcclxuICAgICAgYWk6IDAsXHJcbiAgICAgIGdpOiBwYXJhbUdpLFxyXG4gICAgICB2YWx1ZTogTmFOLFxyXG4gICAgfSk7XHJcbiAgICB6ZXJvQ2FyYm9uRGF0YS5wdXNoKHtcclxuICAgICAga2V5OiBcIk5vcm1hbGlzZWQgzpRBXCIsXHJcbiAgICAgIGFpOiAwLFxyXG4gICAgICBnaTogcGFyYW1HaSxcclxuICAgICAgdmFsdWU6IE5hTixcclxuICAgIH0pO1xyXG4gICAgZm9yIChsZXQgcGFyYW1BaSA9IDAuMTsgcGFyYW1BaSA8IDEuMDE7IHBhcmFtQWkgKz0gMC4xKSB7XHJcbiAgICAgIHplcm9DYXJib25EYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCLOlEFcIixcclxuICAgICAgICBhaTogcGFyYW1BaSxcclxuICAgICAgICBnaTogcGFyYW1HaSxcclxuICAgICAgICB2YWx1ZTogY29tcHV0ZVplcm9DYXJib25EZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUJhckNudWxsKSxcclxuICAgICAgfSk7XHJcbiAgICAgIHplcm9DYXJib25EYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJOb3JtYWxpc2VkIM6UQVwiLFxyXG4gICAgICAgIGFpOiBwYXJhbUFpLFxyXG4gICAgICAgIGdpOiBwYXJhbUdpLFxyXG4gICAgICAgIHZhbHVlOiBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQmFyQ251bGwpIC9cclxuICAgICAgICAgICAgICAgICgoaW5wdXREZWx0YUJhckNudWxsIC8gKDEgKyBpbnB1dERlbHRhQmFyQ251bGwpKSAqIHBhcmFtQWkqKjIpLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHplcm9DYXJib25EYXRhO1xyXG59O1xyXG5cclxuc3RyaW5nRGVsdGFCYXJDbnVsbCA9IGlucHV0RGVsdGFCYXJDbnVsbC50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAge1xyXG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgxLCBudW1iZXJPZkRpZ2l0cyhpbnB1dERlbHRhQmFyQ251bGwpKSxcclxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMSwgbnVtYmVyT2ZEaWdpdHMoaW5wdXREZWx0YUJhckNudWxsKSksXHJcbiAgfSxcclxuKTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxyXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICBsYWJlbDogYM6UQSwgd2hlcmUgzpRDzITiiIUgPSAke3N0cmluZ0RlbHRhQmFyQ251bGx9IHRDTzJlcWAsXHJcbiAgfSxcclxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcclxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxyXG4gIG1hcmtzOiBbXHJcbiAgICBQbG90LmZyYW1lKCksXHJcbiAgICBQbG90LnJlY3QoemVyb0NhcmJvbkRhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXHJcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxyXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcclxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXHJcbiAgICAgIGZpbGw6IGdldERlbHRhQSxcclxuICAgIH0pLFxyXG4gICAgUGxvdC50ZXh0KHplcm9DYXJib25EYXRhLCB7XHJcbiAgICAgIHg6IFwiYWlcIixcclxuICAgICAgeTogXCJnaVwiLFxyXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXREZWx0YUEoZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXHJcbiAgICAgICAgXCJlbi1HQlwiLFxyXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiA0LCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDQgfSxcclxuICAgICAgKSxcclxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcclxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXHJcbiAgICAgICAgICBbXHJcbiAgICAgICAgICAgIGNvbXB1dGVaZXJvQ2FyYm9uRGVsdGFBKDAuMSwgMSwgaW5wdXREZWx0YUJhckNudWxsKSxcclxuICAgICAgICAgICAgY29tcHV0ZVplcm9DYXJib25EZWx0YUEoMSwgMSwgaW5wdXREZWx0YUJhckNudWxsKSxcclxuICAgICAgICAgIF0sXHJcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxyXG4gICAgICAgICkoZC52YWx1ZSksXHJcbiAgICAgICksXHJcbiAgICB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxyXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICBsYWJlbDogYE5vcm1hbGlzZWQgzpRBLCB3aGVyZSDOlEPMhOKIhSA9ICR7c3RyaW5nRGVsdGFCYXJDbnVsbH0gdENPMmVxYCxcclxuICB9LFxyXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxyXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QucmVjdCh6ZXJvQ2FyYm9uRGF0YSwge1xyXG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcclxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXHJcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxyXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcclxuICAgICAgZmlsbDogZ2V0Tm9ybURlbHRhQSxcclxuICAgIH0pLFxyXG4gICAgUGxvdC50ZXh0KHplcm9DYXJib25EYXRhLCB7XHJcbiAgICAgIHg6IFwiYWlcIixcclxuICAgICAgeTogXCJnaVwiLFxyXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXROb3JtRGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgIFwiZW4tR0JcIixcclxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbiAgICAgICksXHJcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXHJcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxyXG4gICAgICAgICAgW1xyXG4gICAgICAgICAgICBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQSgxLCAwLCBpbnB1dERlbHRhQmFyQ251bGwpIC9cclxuICAgICAgICAgICAgICAgICAgICAoaW5wdXREZWx0YUJhckNudWxsIC8gKDEgKyBpbnB1dERlbHRhQmFyQ251bGwpKSxcclxuICAgICAgICAgICAgY29tcHV0ZVplcm9DYXJib25EZWx0YUEoMSwgMSwgaW5wdXREZWx0YUJhckNudWxsKSAvXHJcbiAgICAgICAgICAgICAgICAgICAgKGlucHV0RGVsdGFCYXJDbnVsbCAvICgxICsgaW5wdXREZWx0YUJhckNudWxsKSksXHJcbiAgICAgICAgICBdLFxyXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCxcclxuICAgICAgICApKGQudmFsdWUpLFxyXG4gICAgICApLFxyXG4gICAgfSksXHJcbiAgXSxcclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXREZWx0YUEgPSBJbnB1dHMucmFuZ2UoWzAuMDAxLCAwLjk5OV0sIHtcclxuICBsYWJlbDogdGV4YFxcdGV4dHtCdXJudCB9IFxcRGVsdGEgQWAsXHJcbiAgc3RlcDogMC4wMDEsXHJcbiAgdmFsdWU6IDAuMSxcclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlRGVsdGFDaShBaSwgR2ksIGRlbHRhQSkge1xyXG4gIHJldHVybiBNYXRoLmV4cG0xKC1NYXRoLmxvZzFwKGRlbHRhQSkgLyAoQWkgKyAoQWkqKjIgKiAoMSAtIEdpKSoqMiAvIDIpKSk7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJldGlyZW1lbnREYXRhID0ge1xyXG4gIGNvbnN0IHJldGlyZW1lbnREYXRhID0gW107XHJcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xyXG4gICAgcmV0aXJlbWVudERhdGEucHVzaCh7XHJcbiAgICAgIGtleTogXCItzpRD4bWiXCIsXHJcbiAgICAgIGFpOiAwLFxyXG4gICAgICBnaTogcGFyYW1HaSxcclxuICAgICAgdmFsdWU6IE5hTixcclxuICAgIH0pO1xyXG4gICAgZm9yIChsZXQgcGFyYW1BaSA9IDAuMTsgcGFyYW1BaSA8IDEuMDE7IHBhcmFtQWkgKz0gMC4xKSB7XHJcbiAgICAgIHJldGlyZW1lbnREYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCItzpRD4bWiXCIsXHJcbiAgICAgICAgYWk6IHBhcmFtQWksXHJcbiAgICAgICAgZ2k6IHBhcmFtR2ksXHJcbiAgICAgICAgdmFsdWU6IC1jb21wdXRlRGVsdGFDaShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQSksXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gcmV0aXJlbWVudERhdGE7XHJcbn07XHJcblxyXG5zdHJpbmdJbnB1dERlbHRhQSA9IGlucHV0RGVsdGFBLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAxLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDEgfSxcclxuKTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxyXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICBsYWJlbDogYC3OlEPhtaIsIHdoZXJlIM6UQSA9ICR7c3RyaW5nSW5wdXREZWx0YUF9YCxcclxuICB9LFxyXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxyXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QucmVjdChyZXRpcmVtZW50RGF0YSwge1xyXG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcclxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXHJcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxyXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcclxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxyXG4gICAgfSksXHJcbiAgICBQbG90LnRleHQocmV0aXJlbWVudERhdGEsIHtcclxuICAgICAgeDogXCJhaVwiLFxyXG4gICAgICB5OiBcImdpXCIsXHJcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXHJcbiAgICAgICAgXCJlbi1HQlwiLFxyXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcclxuICAgICAgKSxcclxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcclxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXHJcbiAgICAgICAgICBbXHJcbiAgICAgICAgICAgIC1jb21wdXRlRGVsdGFDaSgxLCAwLCBpbnB1dERlbHRhQSksXHJcbiAgICAgICAgICAgIC1jb21wdXRlRGVsdGFDaSgwLjEsIDEsIGlucHV0RGVsdGFBKSxcclxuICAgICAgICAgIF0sXHJcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxyXG4gICAgICAgICkoZC52YWx1ZSksXHJcbiAgICAgICksXHJcbiAgICB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQ2luaXRpYWwgPSBJbnB1dHMucmFuZ2UoWzAuMDAxLCAxXSwge1xyXG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0luaXRpYWwgfVxcRGVsdGEgQ2AsXHJcbiAgc3RlcDogMC4wMDEsXHJcbiAgdmFsdWU6IDAuMSxcclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlU3ByZWFkKEFpLCBHaSwgZGVsdGFDaW5pdGlhbCkge1xyXG4gIGNvbnN0IGRlbHRhQSA9IGNvbXB1dGVEZWx0YUEoQWksIEdpLCBkZWx0YUNpbml0aWFsKTtcclxuICBjb25zdCBkZWx0YUNmaW5hbCA9IC1jb21wdXRlRGVsdGFDaShBaSwgR2ksIGRlbHRhQSk7XHJcbiAgcmV0dXJuIChkZWx0YUNpbml0aWFsIC0gZGVsdGFDZmluYWwpIC8gZGVsdGFDaW5pdGlhbDtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibGlxdWlkYXRpb25EYXRhID0ge1xyXG4gIGNvbnN0IGxpcXVpZGF0aW9uRGF0YSA9IFtdO1xyXG4gIGZvciAobGV0IHBhcmFtR2kgPSAwOyBwYXJhbUdpIDwgMS4wMTsgcGFyYW1HaSArPSAwLjEpIHtcclxuICAgIGxpcXVpZGF0aW9uRGF0YS5wdXNoKHsga2V5OiBcImRlbHRhYVwiLCBhaTogMCwgZ2k6IHBhcmFtR2ksIHZhbHVlOiBOYU4gfSk7XHJcbiAgICBsaXF1aWRhdGlvbkRhdGEucHVzaCh7IGtleTogXCJkZWx0YWNcIiwgYWk6IDAsIGdpOiBwYXJhbUdpLCB2YWx1ZTogTmFOIH0pO1xyXG4gICAgbGlxdWlkYXRpb25EYXRhLnB1c2goeyBrZXk6IFwic3ByZWFkXCIsIGFpOiAwLCBnaTogcGFyYW1HaSwgdmFsdWU6IE5hTiB9KTtcclxuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xyXG4gICAgICBjb25zdCBkZWx0YUEgPSBjb21wdXRlRGVsdGFBKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFDaW5pdGlhbClcclxuICAgICAgbGlxdWlkYXRpb25EYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJkZWx0YWFcIixcclxuICAgICAgICBhaTogcGFyYW1BaSxcclxuICAgICAgICBnaTogcGFyYW1HaSxcclxuICAgICAgICB2YWx1ZTogY29tcHV0ZURlbHRhQShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQ2luaXRpYWwpIC9cclxuICAgICAgICAgICAgICAgIGlucHV0RGVsdGFDaW5pdGlhbCxcclxuICAgICAgfSk7XHJcbiAgICAgIGxpcXVpZGF0aW9uRGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiZGVsdGFjXCIsXHJcbiAgICAgICAgYWk6IHBhcmFtQWksXHJcbiAgICAgICAgZ2k6IHBhcmFtR2ksXHJcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVEZWx0YUNpKHBhcmFtQWksIHBhcmFtR2ksIGRlbHRhQSkgLyBpbnB1dERlbHRhQ2luaXRpYWwsXHJcbiAgICAgIH0pO1xyXG4gICAgICBsaXF1aWRhdGlvbkRhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcInNwcmVhZFwiLFxyXG4gICAgICAgIGFpOiBwYXJhbUFpLFxyXG4gICAgICAgIGdpOiBwYXJhbUdpLFxyXG4gICAgICAgIHZhbHVlOiBjb21wdXRlU3ByZWFkKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFDaW5pdGlhbCksXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gbGlxdWlkYXRpb25EYXRhO1xyXG59O1xyXG5nZXRMaXFEZWx0YUEgPSBkID0+IGQua2V5ID09PSBcImRlbHRhYVwiID8gZC52YWx1ZSA6IE5hTjtcclxuZ2V0TGlxRGVsdGFDaSA9IGQgPT4gZC5rZXkgPT09IFwiZGVsdGFjXCIgPyBkLnZhbHVlIDogTmFOO1xyXG5nZXRMaXFTcHJlYWQgPSBkID0+IGQua2V5ID09PSBcInNwcmVhZFwiID8gZC52YWx1ZSA6IE5hTjtcclxuXHJcbnN0cmluZ0lucHV0RGVsdGFDaW5pdGlhbCA9IGlucHV0RGVsdGFDaW5pdGlhbC50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMSwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAxIH0sXHJcbik7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xyXG4gIGNvbG9yOiB7XHJcbiAgICBsZWdlbmQ6IHRydWUsXHJcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcclxuICAgIGRvbWFpbjogWzAsIGNvbXB1dGVTcHJlYWQoMSwgMCwgMSldLFxyXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICBsYWJlbDogYENhcmJvbiBTcHJlYWQgzrUsIHdoZXJlIGluaXRpYWwgzpRDID0gJHtzdHJpbmdJbnB1dERlbHRhQ2luaXRpYWx9YCxcclxuICB9LFxyXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxyXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QucmVjdChsaXF1aWRhdGlvbkRhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXHJcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxyXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcclxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXHJcbiAgICAgIGZpbGw6IGdldExpcVNwcmVhZCxcclxuICAgIH0pLFxyXG4gICAgUGxvdC50ZXh0KGxpcXVpZGF0aW9uRGF0YSwge1xyXG4gICAgICB4OiBcImFpXCIsXHJcbiAgICAgIHk6IFwiZ2lcIixcclxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0TGlxU3ByZWFkKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgIFwiZW4tR0JcIixcclxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbiAgICAgICksXHJcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXHJcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxyXG4gICAgICAgICAgWzAsIGNvbXB1dGVTcHJlYWQoMSwgMCwgaW5wdXREZWx0YUNpbml0aWFsKV0sXHJcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxyXG4gICAgICAgICkoZC52YWx1ZSksXHJcbiAgICAgICksXHJcbiAgICB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IklucHV0cy5iaW5kKFxyXG4gIElucHV0cy5yYW5nZShbMC4wMDEsIDFdLCB7XHJcbiAgICBsYWJlbDogdGV4YFxcdGV4dHtJbml0aWFsIH1cXERlbHRhIENgLFxyXG4gICAgc3RlcDogMC4wMDEsXHJcbiAgICB2YWx1ZTogMC4xLFxyXG4gIH0pLFxyXG4gIHZpZXdvZiBpbnB1dERlbHRhQ2luaXRpYWwsXHJcbik7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xyXG4gIGNvbG9yOiB7XHJcbiAgICBsZWdlbmQ6IHRydWUsXHJcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcclxuICAgIGRvbWFpbjogWzAsIDFdLFxyXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICBsYWJlbDogYENvbXBvbmVudCDOlEEsIHdoZXJlIGluaXRpYWwgzpRDID0gJHtcclxuICAgICAgc3RyaW5nSW5wdXREZWx0YUNpbml0aWFsXHJcbiAgICB9YCxcclxuICB9LFxyXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxyXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QucmVjdChsaXF1aWRhdGlvbkRhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXHJcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxyXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcclxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXHJcbiAgICAgIGZpbGw6IGdldExpcURlbHRhQSxcclxuICAgIH0pLFxyXG4gICAgUGxvdC50ZXh0KGxpcXVpZGF0aW9uRGF0YSwge1xyXG4gICAgICB4OiBcImFpXCIsXHJcbiAgICAgIHk6IFwiZ2lcIixcclxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0TGlxRGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgIFwiZW4tR0JcIixcclxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbiAgICAgICksXHJcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoZDMuaW50ZXJwb2xhdGVTcGVjdHJhbChkLnZhbHVlKSksXHJcbiAgICB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHNjaGVtZTogXCJHcmV5c1wiLFxyXG4gICAgZG9tYWluOiBbXHJcbiAgICAgIC0xLFxyXG4gICAgICBjb21wdXRlRGVsdGFDaShcclxuICAgICAgICAxLFxyXG4gICAgICAgIDAsXHJcbiAgICAgICAgY29tcHV0ZURlbHRhQSgxLCAwLCBpbnB1dERlbHRhQ2luaXRpYWwpIC8gaW5wdXREZWx0YUNpbml0aWFsLFxyXG4gICAgICApLFxyXG4gICAgXSxcclxuICAgIGxhYmVsOiBgQ29tcG9uZW50IM6UQywgd2hlcmUgaW5pdGlhbCDOlEMgPSAke1xyXG4gICAgICBzdHJpbmdJbnB1dERlbHRhQ2luaXRpYWxcclxuICAgIH1gLFxyXG4gIH0sXHJcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXHJcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcclxuICBtYXJrczogW1xyXG4gICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgUGxvdC5yZWN0KGxpcXVpZGF0aW9uRGF0YSwge1xyXG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcclxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXHJcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxyXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcclxuICAgICAgZmlsbDogZ2V0TGlxRGVsdGFDaSxcclxuICAgIH0pLFxyXG4gICAgUGxvdC50ZXh0KGxpcXVpZGF0aW9uRGF0YSwge1xyXG4gICAgICB4OiBcImFpXCIsXHJcbiAgICAgIHk6IFwiZ2lcIixcclxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0TGlxRGVsdGFDaShkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcclxuICAgICAgICBcImVuLUdCXCIsXHJcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxyXG4gICAgICApLFxyXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxyXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcclxuICAgICAgICAgIFtcclxuICAgICAgICAgICAgLTEsXHJcbiAgICAgICAgICAgIGNvbXB1dGVEZWx0YUNpKFxyXG4gICAgICAgICAgICAgIDEsXHJcbiAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICBjb21wdXRlRGVsdGFBKDEsIDAsIGlucHV0RGVsdGFDaW5pdGlhbCkgLyBpbnB1dERlbHRhQ2luaXRpYWwsXHJcbiAgICAgICAgICAgICksXHJcbiAgICAgICAgICBdLFxyXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVHcmV5cyxcclxuICAgICAgICApKGQudmFsdWUpLFxyXG4gICAgICApLFxyXG4gICAgfSksXHJcbiAgXSxcclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlQmV0YSh2ZWNBaSwgdmVjR2kpIHtcclxuICBjb25zdCBiZXRhMiA9IHZlY0FpLnJlZHVjZShcclxuICAgIChhY2MsIEFpLCBpKSA9PiBhY2MgKyBBaSAtIEFpICogKDEgLSB2ZWNHaVtpXSkqKjIsXHJcbiAgICAwLFxyXG4gICk7XHJcbiAgcmV0dXJuIE1hdGguc3FydChiZXRhMik7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVCZXRhaShBaSwgR2kpIHtcclxuICByZXR1cm4gTWF0aC5zcXJ0KEFpIC0gQWkgKiAoMSAtIEdpKSoqMik7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJldGFEYXRhID0ge1xyXG4gIGNvbnN0IGJldGFEYXRhID0gW107XHJcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xyXG4gICAgYmV0YURhdGEucHVzaCh7XHJcbiAgICAgIGtleTogXCLOsuG1olwiLFxyXG4gICAgICBhaTogMCxcclxuICAgICAgZ2k6IHBhcmFtR2ksXHJcbiAgICAgIHZhbHVlOiBOYU4sXHJcbiAgICB9KTtcclxuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xyXG4gICAgICBiZXRhRGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwizrLhtaJcIixcclxuICAgICAgICBhaTogcGFyYW1BaSxcclxuICAgICAgICBnaTogcGFyYW1HaSxcclxuICAgICAgICB2YWx1ZTogY29tcHV0ZUJldGFpKHBhcmFtQWksIHBhcmFtR2kpLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGJldGFEYXRhO1xyXG59O1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcclxuICBjb2xvcjoge1xyXG4gICAgbGVnZW5kOiB0cnVlLFxyXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXHJcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcclxuICAgIGxhYmVsOiBcIs6y4bWiXCIsXHJcbiAgfSxcclxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcclxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxyXG4gIG1hcmtzOiBbXHJcbiAgICBQbG90LmZyYW1lKCksXHJcbiAgICBQbG90LnJlY3QoYmV0YURhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXHJcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxyXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcclxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXHJcbiAgICAgIGZpbGw6IFwidmFsdWVcIixcclxuICAgIH0pLFxyXG4gICAgUGxvdC50ZXh0KGJldGFEYXRhLCB7XHJcbiAgICAgIHg6IFwiYWlcIixcclxuICAgICAgeTogXCJnaVwiLFxyXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgIFwiZW4tR0JcIixcclxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbiAgICAgICksXHJcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoZDMuaW50ZXJwb2xhdGVTcGVjdHJhbChkLnZhbHVlKSksXHJcbiAgICB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFycmF5QWkgPSBbMC41LCAwLjIsIDAuMSwgMC4wNV07XHJcbmFycmF5SW5pdGlhbEdpID0gWzAuMywgMC4xLCAwLjA1LCAwLjAxXTtcclxuYXJyYXlOZXdHaSA9IGFycmF5SW5pdGlhbEdpLnRvUmV2ZXJzZWQoKTtcclxuYmV0YUNvbnRyaWJEYXRhID0ge1xyXG4gIGNvbnN0IGJldGFDb250cmliRGF0YSA9IFtdO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXlBaS5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3QgQWkgPSBhcnJheUFpW2ldO1xyXG4gICAgY29uc3QgaW5pdGlhbEdpID0gYXJyYXlJbml0aWFsR2lbaV07XHJcbiAgICBjb25zdCBpbml0aWFsQmV0YTIgPSBjb21wdXRlQmV0YWkoQWksIGluaXRpYWxHaSkqKjI7XHJcbiAgICBjb25zdCBuZXdHaSA9IGFycmF5TmV3R2lbaV07XHJcbiAgICBjb25zdCBuZXdCZXRhMiA9IGNvbXB1dGVCZXRhaShBaSwgbmV3R2kpKioyO1xyXG4gICAgYmV0YUNvbnRyaWJEYXRhLnB1c2goeyBrZXk6IFwiSW5pdGlhbCBH4bWiXCIsIGNsYXNzOiBpLCB2YWx1ZTogaW5pdGlhbEdpIH0pO1xyXG4gICAgYmV0YUNvbnRyaWJEYXRhLnB1c2goeyBrZXk6IFwiSW5pdGlhbCDOsuG1osKyXCIsIGNsYXNzOiBpLCB2YWx1ZTogaW5pdGlhbEJldGEyIH0pO1xyXG4gICAgYmV0YUNvbnRyaWJEYXRhLnB1c2goeyBrZXk6IFwiTmV3IEfhtaJcIiwgY2xhc3M6IGksIHZhbHVlOiBuZXdHaSB9KTtcclxuICAgIGJldGFDb250cmliRGF0YS5wdXNoKHsga2V5OiBcIk5ldyDOsuG1osKyXCIsIGNsYXNzOiBpLCB2YWx1ZTogbmV3QmV0YTIgfSk7XHJcbiAgfVxyXG4gIHJldHVybiBiZXRhQ29udHJpYkRhdGE7XHJcbn07XHJcbmdldEluaXRpYWxHID0gZCA9PiBkLmtleSA9PT0gXCJJbml0aWFsIEfhtaJcIiA/IGQudmFsdWUgOiBOYU47XHJcbmdldEluaXRpYWxCZXRhMiA9IGQgPT4gZC5rZXkgPT09IFwiSW5pdGlhbCDOsuG1osKyXCIgPyBkLnZhbHVlIDogTmFOO1xyXG5nZXROZXdHID0gZCA9PiBkLmtleSA9PT0gXCJOZXcgR+G1olwiID8gZC52YWx1ZSA6IE5hTjtcclxuZ2V0TmV3QmV0YTIgPSBkID0+IGQua2V5ID09PSBcIk5ldyDOsuG1osKyXCIgPyBkLnZhbHVlIDogTmFOO1xyXG5cclxuZG9tYWluRyA9IFswLCBNYXRoLm1heChkMy5tYXgoYXJyYXlJbml0aWFsR2kpLCBkMy5tYXgoYXJyYXlOZXdHaSkpXTtcclxucmFuZ2VCZXRhMiA9IFtcclxuICAwLFxyXG4gIE1hdGgubWF4KFxyXG4gICAgZDMubWF4KGJldGFDb250cmliRGF0YSwgZ2V0SW5pdGlhbEJldGEyKSxcclxuICAgIGQzLm1heChiZXRhQ29udHJpYkRhdGEsIGdldE5ld0JldGEyKSxcclxuICApLFxyXG5dO1xyXG5zY2FsZUcgPSBkMy5zY2FsZUxpbmVhcihkb21haW5HLCByYW5nZUJldGEyKTtcclxubWFwU2NhbGVHID0geCA9PiB4Lm1hcChzY2FsZUcpO1xyXG5cclxucGFyYW1Jbml0aWFsQmV0YSA9IGNvbXB1dGVCZXRhKGFycmF5QWksIGFycmF5SW5pdGlhbEdpKTtcclxucGFyYW1OZXdCZXRhID0gY29tcHV0ZUJldGEoYXJyYXlBaSwgYXJyYXlOZXdHaSk7XHJcblxyXG5zdHJpbmdJbml0aWFsQmV0YSA9IFwiSW5pdGlhbCDOsiA9IFwiICsgcGFyYW1Jbml0aWFsQmV0YS50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDQsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogNCB9LFxyXG4pO1xyXG5zdHJpbmdOZXdCZXRhID0gXCJOZXcgzrIgPSBcIiArIHBhcmFtTmV3QmV0YS50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDQsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogNCB9LFxyXG4pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcclxuICBjb2xvcjoge1xyXG4gICAgbGVnZW5kOiB0cnVlLFxyXG4gICAgcmFuZ2U6IFtcImdyYXlcIiwgXCJibGFja1wiLCBcImJsdWVcIiwgXCJyZWRcIl0sXHJcbiAgICBkb21haW46IFtcIkluaXRpYWwgzrLhtaLCslwiLCBcIk5ldyDOsuG1osKyXCIsIFwiSW5pdGlhbCBH4bWiXCIsIFwiTmV3IEfhtaJcIl0sXHJcbiAgfSxcclxuICB4OiB7XHJcbiAgICB0aWNrczogZDMucmFuZ2UoNCksXHJcbiAgICBsYWJlbDogXCJB4bWiIE92ZXIgNCBDbGFzc2VzXCIsXHJcbiAgICB0aWNrRm9ybWF0OiBkID0+IGFycmF5QWlbZF0sXHJcbiAgfSxcclxuICB5OiB7IGRvbWFpbjogcmFuZ2VCZXRhMiB9LFxyXG4gIGluc2V0VG9wOiAxNixcclxuICBpbnNldExlZnQ6IDgsXHJcbiAgaW5zZXRSaWdodDogOCxcclxuICBtYXJrczogW1xyXG4gICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJsZWZ0XCIsIGxhYmVsOiBcIs6y4bWiwrJcIiB9KSxcclxuICAgIFBsb3QuYXhpc1koc2NhbGVHLnRpY2tzKCksIHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIkfhtaJcIiwgeTogc2NhbGVHIH0pLFxyXG4gICAgUGxvdC5yZWN0WShiZXRhQ29udHJpYkRhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC5jbGFzcyAtIDAuNDUsXHJcbiAgICAgIHgyOiBkID0+IGQuY2xhc3MsXHJcbiAgICAgIHk6IGdldEluaXRpYWxCZXRhMixcclxuICAgICAgZmlsbDogXCJrZXlcIixcclxuICAgIH0pLFxyXG4gICAgUGxvdC5yZWN0WShiZXRhQ29udHJpYkRhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC5jbGFzcyxcclxuICAgICAgeDI6IGQgPT4gZC5jbGFzcyArIDAuNDUsXHJcbiAgICAgIHk6IGdldE5ld0JldGEyLFxyXG4gICAgICBmaWxsOiBcImtleVwiLFxyXG4gICAgfSksXHJcbiAgICBQbG90LmxpbmVZKGJldGFDb250cmliRGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlRywge1xyXG4gICAgICB4OiBcImNsYXNzXCIsXHJcbiAgICAgIHk6IGdldEluaXRpYWxHLFxyXG4gICAgICBzdHJva2U6IFwia2V5XCIsXHJcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcclxuICAgIH0pKSxcclxuICAgIFBsb3QuZG90WShiZXRhQ29udHJpYkRhdGEsIFBsb3QubWFwWShtYXBTY2FsZUcsIHtcclxuICAgICAgeDogXCJjbGFzc1wiLFxyXG4gICAgICB5OiBnZXRJbml0aWFsRyxcclxuICAgICAgZmlsbDogXCJrZXlcIixcclxuICAgIH0pKSxcclxuICAgIFBsb3QubGluZVkoYmV0YUNvbnRyaWJEYXRhLCBQbG90Lm1hcFkobWFwU2NhbGVHLCB7XHJcbiAgICAgIHg6IFwiY2xhc3NcIixcclxuICAgICAgeTogZ2V0TmV3RyxcclxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxyXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXHJcbiAgICB9KSksXHJcbiAgICBQbG90LmRvdFkoYmV0YUNvbnRyaWJEYXRhLCBQbG90Lm1hcFkobWFwU2NhbGVHLCB7XHJcbiAgICAgIHg6IFwiY2xhc3NcIixcclxuICAgICAgeTogZ2V0TmV3RyxcclxuICAgICAgZmlsbDogXCJrZXlcIixcclxuICAgIH0pKSxcclxuICAgIFBsb3QudGV4dChbc3RyaW5nSW5pdGlhbEJldGFdLCB7IHg6IDAuNSwgeTogMC4yMywgZmlsbDogZCA9PiBcImJsdWVcIiB9KSxcclxuICAgIFBsb3QudGV4dChbc3RyaW5nTmV3QmV0YV0sIHsgeDogMi41LCB5OiAwLjIzLCBmaWxsOiBkID0+IFwicmVkXCIgfSksXHJcbiAgXSxcclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlTGFtYmRhR0coQVEsIEdpLCBHRykge1xyXG4gIHJldHVybiAoMSAtIEFRKSAvICgxICsgKEdpIC8gR0cpKioyKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hhbmdlVHJhbnNsYXRpb24oZHgsIGR5KSB7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IHN2Z1RyYW5zZm9ybUxpc3QgPSB0aGlzLnRyYW5zZm9ybS5iYXNlVmFsO1xyXG4gICAgaWYgKHN2Z1RyYW5zZm9ybUxpc3QubGVuZ3RoID4gMSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTVkdUcmFuc2Zvcm1MaXN0IG11c3Qgb25seSBjb250YWluIG9uZSB0cmFuc2xhdGlvblwiKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHtlLCBmfSA9IHN2Z1RyYW5zZm9ybUxpc3QuY29uc29saWRhdGUoKS5tYXRyaXg7XHJcbiAgICByZXR1cm4gYHRyYW5zbGF0ZSgke2UgKyBkeH0sJHtmICsgZHl9KWA7XHJcbiAgfVxyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJsYW1iZGFHR0RhdGEgPSB7XHJcbiAgY29uc3QgbGFtYmRhR0dEYXRhID0gW107XHJcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xyXG4gICAgZm9yIChsZXQgcGFyYW1BUSA9IDA7IHBhcmFtQVEgPCAxLjAxOyBwYXJhbUFRICs9IDAuMSkge1xyXG4gICAgICBsYW1iZGFHR0RhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIs67XCIsXHJcbiAgICAgICAgYXE6IHBhcmFtQVEsXHJcbiAgICAgICAgZ2k6IHBhcmFtR2ksXHJcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVMYW1iZGFHRyhwYXJhbUFRLCBwYXJhbUdpLCAxIC0gcGFyYW1HaSksXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gbGFtYmRhR0dEYXRhO1xyXG59O1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGxvdExhbWJkYUdHID0ge1xyXG4gIGNvbnN0IHBsb3RMYW1iZGFHRyA9IFBsb3QucGxvdCh7XHJcbiAgICBjb2xvcjoge1xyXG4gICAgICBsZWdlbmQ6IHRydWUsXHJcbiAgICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxyXG4gICAgICBkb21haW46IFswLCAxXSxcclxuICAgICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICAgIGxhYmVsOiBcIs67XCIsXHJcbiAgICB9LFxyXG4gICAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQSAgXCIgfSxcclxuICAgIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXHJcbiAgICBtYXJrczogW1xyXG4gICAgICBQbG90LmZyYW1lKCksXHJcbiAgICAgIFBsb3QucmVjdChsYW1iZGFHR0RhdGEsIHtcclxuICAgICAgICB4MTogZCA9PiBkLmFxIC0gMC4wNSxcclxuICAgICAgICB4MjogZCA9PiBkLmFxICsgMC4wNSxcclxuICAgICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcclxuICAgICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcclxuICAgICAgICBmaWxsOiBcInZhbHVlXCIsXHJcbiAgICAgIH0pLFxyXG4gICAgICBQbG90LnRleHQobGFtYmRhR0dEYXRhLCB7XHJcbiAgICAgICAgeDogXCJhcVwiLFxyXG4gICAgICAgIHk6IFwiZ2lcIixcclxuICAgICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgICAgXCJlbi1HQlwiLFxyXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxyXG4gICAgICAgICksXHJcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcclxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxyXG4gICAgICAgICksXHJcbiAgICAgIH0pLFxyXG4gICAgXSxcclxuICB9KTtcclxuXHJcbiAgZDMuc2VsZWN0KHBsb3RMYW1iZGFHRylcclxuICAgIC5zZWxlY3QoXCJnW2FyaWEtbGFiZWw9J3gtYXhpcyBsYWJlbCddXCIpXHJcbiAgICAuc2VsZWN0KFwidGV4dFwiKVxyXG4gICAgICAuY2xvbmUoZmFsc2UpXHJcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGNoYW5nZVRyYW5zbGF0aW9uKC0xMiwgMS41KSlcclxuICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIwLjZlbVwiKVxyXG4gICAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiNjAwXCIpXHJcbiAgICAgIC50ZXh0KFwiUVwiKTtcclxuXHJcbiAgcmV0dXJuIHBsb3RMYW1iZGFHRztcclxufTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVMYW1iZGFHKEFRLCBBRykge1xyXG4gIHJldHVybiAyICogQUcgLyAoMiAqIEFHICsgQVEgKiBNYXRoLnNxcnQoMikpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlTGFtYmRhUShBUSwgQUcpIHtcclxuICByZXR1cm4gMSAtIGNvbXB1dGVMYW1iZGFHKEFRLCBBRyk7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImxhbWJkYUdRRGF0YSA9IHtcclxuICBjb25zdCBsYW1iZGFHUURhdGEgPSBbXTtcclxuICBmb3IgKGxldCBwYXJhbUFHID0gMDsgcGFyYW1BRyA8IDEuMDE7IHBhcmFtQUcgKz0gMC4xKSB7XHJcbiAgICBmb3IgKGxldCBwYXJhbUFRID0gMDsgcGFyYW1BUSA8IDEuMDE7IHBhcmFtQVEgKz0gMC4xKSB7XHJcbiAgICAgIGlmIChwYXJhbUFHICsgcGFyYW1BUSA8IDEuMDEpIHtcclxuICAgICAgICBsYW1iZGFHUURhdGEucHVzaCh7XHJcbiAgICAgICAgICBrZXk6IFwiUmVsYXRpdmUg8J2XlPCdl5ogTGlxdWlkaXR5IFBvb2wgU2hhcmVcIixcclxuICAgICAgICAgIGFxOiBwYXJhbUFRLFxyXG4gICAgICAgICAgYWc6IHBhcmFtQUcsXHJcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUxhbWJkYUcocGFyYW1BUSwgcGFyYW1BRyksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgbGFtYmRhR1FEYXRhLnB1c2goe1xyXG4gICAgICAgICAga2V5OiBcIlJlbGF0aXZlIPCdl5TwnZekIExpcXVpZGl0eSBQb29sIFNoYXJlXCIsXHJcbiAgICAgICAgICBhcTogcGFyYW1BUSxcclxuICAgICAgICAgIGFnOiBwYXJhbUFHLFxyXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVMYW1iZGFRKHBhcmFtQVEsIHBhcmFtQUcpLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiBsYW1iZGFHUURhdGE7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwbG90TGFtYmRhR1EgPSB7XHJcbiAgY29uc3QgcGxvdExhbWJkYUdRID0gUGxvdC5wbG90KHtcclxuICAgIGFzcGVjdFJhdGlvOiAxLFxyXG4gICAgY29sb3I6IHtcclxuICAgICAgbGVnZW5kOiB0cnVlLFxyXG4gICAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcclxuICAgICAgZG9tYWluOiBbMCwgMV0sXHJcbiAgICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxyXG4gICAgICBsYWJlbDogXCLOu1wiLFxyXG4gICAgfSxcclxuICAgIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkEgIFwiIH0sXHJcbiAgICB5OiB7XHJcbiAgICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxyXG4gICAgICBkb21haW46IFsxLjA1LCAtMC4wNV0sXHJcbiAgICAgIGxhYmVsOiBcIkFcIixcclxuICAgIH0sXHJcbiAgICBmeDogeyBsYWJlbDogbnVsbCB9LFxyXG4gICAgY2xhc3NOYW1lOiBcIkxhbWJkYUdRXCIsXHJcbiAgICBtYXJrczogW1xyXG4gICAgICBQbG90LmZyYW1lKCksXHJcbiAgICAgIFBsb3QucmVjdChsYW1iZGFHUURhdGEsIHtcclxuICAgICAgICB4MTogZCA9PiBkLmFxIC0gMC4wNSxcclxuICAgICAgICB4MjogZCA9PiBkLmFxICsgMC4wNSxcclxuICAgICAgICB5MTogZCA9PiBkLmFnIC0gMC4wNSxcclxuICAgICAgICB5MjogZCA9PiBkLmFnICsgMC4wNSxcclxuICAgICAgICBmeDogXCJrZXlcIixcclxuICAgICAgICBmaWxsOiBcInZhbHVlXCIsXHJcbiAgICAgIH0pLFxyXG4gICAgICBQbG90LnRleHQobGFtYmRhR1FEYXRhLCB7XHJcbiAgICAgICAgeDogXCJhcVwiLFxyXG4gICAgICAgIHk6IFwiYWdcIixcclxuICAgICAgICBmeDogXCJrZXlcIixcclxuICAgICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgICAgXCJlbi1HQlwiLFxyXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxyXG4gICAgICAgICksXHJcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcclxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxyXG4gICAgICAgICksXHJcbiAgICAgIH0pLFxyXG4gICAgXSxcclxuICB9KTtcclxuXHJcbiAgZDMuc2VsZWN0KHBsb3RMYW1iZGFHUSlcclxuICAgIC5zZWxlY3QoXCJnW2FyaWEtbGFiZWw9J3gtYXhpcyBsYWJlbCddXCIpXHJcbiAgICAuc2VsZWN0KFwidGV4dFwiKVxyXG4gICAgLmNsb25lKGZhbHNlKVxyXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigtMTIsIDEuNSkpXHJcbiAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMC42ZW1cIilcclxuICAgICAgLmF0dHIoXCJmb250LXdlaWdodFwiLCBcIjYwMFwiKVxyXG4gICAgICAudGV4dChcIlFcIik7XHJcblxyXG4gIGQzLnNlbGVjdChwbG90TGFtYmRhR1EpXHJcbiAgICAuc2VsZWN0KFwiZ1thcmlhLWxhYmVsPSd5LWF4aXMgbGFiZWwnXVwiKVxyXG4gICAgLnNlbGVjdChcInRleHRcIilcclxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY2hhbmdlVHJhbnNsYXRpb24oMCwgMTApKVxyXG4gICAgLmNsb25lKGZhbHNlKVxyXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigxNCwgNC4xKSlcclxuICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIwLjZlbVwiKVxyXG4gICAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiNjAwXCIpXHJcbiAgICAgIC50ZXh0KFwiR1wiKTtcclxuXHJcbiAgcmV0dXJuIHBsb3RMYW1iZGFHUTtcclxufTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIHBpZWNld2lzZUxvZ1RyYW5zZm9ybSh4VHJhbiA9IDEpIHtcclxuICByZXR1cm4geCA9PiB4ID4geFRyYW4gPyBNYXRoLmxvZyh4KSA6IHggLSB4VHJhbiArIE1hdGgubG9nKHhUcmFuKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGllY2V3aXNlTG9nSW52ZXJ0KHhUcmFuID0gMSkge1xyXG4gIHJldHVybiB5ID0+IHkgPiBNYXRoLmxvZyh4VHJhbikgPyBNYXRoLmV4cCh5KSA6IHkgLSBNYXRoLmxvZzEwKHhUcmFuKSArIHhUcmFuO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRJbnB1dChpbnB1dCwgdmFsdWUpIHtcclxuICBpbnB1dC52YWx1ZSA9IHZhbHVlO1xyXG4gIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbnVtRGlnaXRzKHgpIHtcclxuICByZXR1cm4geCA9PT0gMCA/IDEgOiAoMSArIE1hdGguZmxvb3IoTWF0aC5sb2cxMCh4KSkpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkZWZhdWx0QVZhbHVlID0gMmU2O1xyXG5kZWZhdWx0QVN1cHBseSA9IDJlNztcclxuZGVmYXVsdFByZXNlbnRUb25uZXMgPSAxZTc7XHJcbmRlZmF1bHREZWx0YVRvbm5lcyA9IDFlMjtcclxuZGVmYXVsdEFpID0gMC41O1xyXG5kZWZhdWx0R2kgPSAwLjU7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJJbnB1dHMuYnV0dG9uKFxyXG4gIFtbXCJSZXNldFwiLCAoKSA9PiB7XHJcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBVmFsdWUsIGRlZmF1bHRBVmFsdWUpO1xyXG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QVN1cHBseSwgZGVmYXVsdEFTdXBwbHkpO1xyXG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0UHJlc2VudFRvbm5lcywgZGVmYXVsdFByZXNlbnRUb25uZXMpO1xyXG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0RGVsdGFUb25uZXMsIGRlZmF1bHREZWx0YVRvbm5lcyk7XHJcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBaSwgZGVmYXVsdEFpKTtcclxuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dEdpLCBkZWZhdWx0R2kpO1xyXG4gIH1dXSxcclxuKTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dEFWYWx1ZSA9IElucHV0cy5yYW5nZShbMWU1LCAxZTldLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7TWFya2V0IGNhcC4gb2YgXFx0ZXh0YmZ7QX19YCxcclxuICBzdGVwOiAxLFxyXG4gIHZhbHVlOiBkZWZhdWx0QVZhbHVlLFxyXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXHJcbn0pO1xyXG52aWV3b2YgaW5wdXRBU3VwcGx5ID0gSW5wdXRzLnJhbmdlKFsxZTYsIDFlMTBdLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7U3VwcGx5IG9mIFxcdGV4dGJme0F9fWAsXHJcbiAgc3RlcDogMSxcclxuICB2YWx1ZTogZGVmYXVsdEFTdXBwbHksXHJcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcclxufSk7XHJcbnZpZXdvZiBpbnB1dFByZXNlbnRUb25uZXMgPSBJbnB1dHMucmFuZ2UoWzAsIDFlOV0sIHtcclxuICBsYWJlbDogdGV4YFxcdGV4dHtQb3J0Zm9saW8gfSBcXGJhciBDX2lgLFxyXG4gIHN0ZXA6IDFlLTMsXHJcbiAgdmFsdWU6IGRlZmF1bHRQcmVzZW50VG9ubmVzLFxyXG4gIHRyYW5zZm9ybTogcGllY2V3aXNlTG9nVHJhbnNmb3JtKDFlLTMpLFxyXG4gIGludmVydDogcGllY2V3aXNlTG9nSW52ZXJ0KDFlLTMpLFxyXG59KTtcclxudmlld29mIGlucHV0RGVsdGFUb25uZXMgPSBJbnB1dHMucmFuZ2UoWzFlLTMsIDFlN10sIHtcclxuICBsYWJlbDogdGV4YFxcdGV4dHtQdXJjaGFzZWQgdG9ubmVzfWAsXHJcbiAgc3RlcDogMWUtMyxcclxuICB2YWx1ZTogZGVmYXVsdERlbHRhVG9ubmVzLFxyXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXHJcbn0pO1xyXG52aWV3b2YgaW5wdXRBaSA9IElucHV0cy5yYW5nZShbMCwgMV0sIHtcclxuICBsYWJlbDogdGV4YFxcdGV4dHtBbGxvY2F0aW9uIH0gQV9pYCxcclxuICBzdGVwOiAxZS02LFxyXG4gIHZhbHVlOiBkZWZhdWx0QWksXHJcbiAgdHJhbnNmb3JtOiBwaWVjZXdpc2VMb2dUcmFuc2Zvcm0oMWUtNiksXHJcbiAgaW52ZXJ0OiBwaWVjZXdpc2VMb2dJbnZlcnQoMWUtNiksXHJcbn0pO1xyXG52aWV3b2YgaW5wdXRHaSA9IElucHV0cy5yYW5nZShbMCwgMV0sIHtcclxuICBsYWJlbDogdGV4YFxcdGV4dHtBbGxvY2F0aW9uIH0gR19pYCxcclxuICBzdGVwOiAxZS02LFxyXG4gIHZhbHVlOiBkZWZhdWx0R2ksXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTczIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1EZWx0YUEgPSBjb21wdXRlVHJ1ZURlbHRhQShcclxuICBpbnB1dEFpLFxyXG4gIGlucHV0R2ksXHJcbiAgaW5wdXRQcmVzZW50VG9ubmVzLFxyXG4gIGlucHV0RGVsdGFUb25uZXMsXHJcbik7XHJcbnBhcmFtRGVsdGFUb25uZXMgPSBwYXJhbURlbHRhQSA9PT0gMCA/IDAgOiBpbnB1dERlbHRhVG9ubmVzO1xyXG5wYXJhbUFFbWl0dGVkID0gcGFyYW1EZWx0YUEgKiBpbnB1dEFTdXBwbHk7XHJcbnBhcmFtQVByaWNlID0gaW5wdXRBVmFsdWUgLyBpbnB1dEFTdXBwbHk7XHJcbnBhcmFtQmFyQ2lQcmljZSA9IGlucHV0QVZhbHVlICogcGFyYW1EZWx0YUEgLyBpbnB1dERlbHRhVG9ubmVzO1xyXG5cclxuc3RyaW5nQVN1cHBseSA9IGlucHV0QVN1cHBseS50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAge1xyXG4gICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAyIC0gbnVtRGlnaXRzKHBhcmFtQUVtaXR0ZWQpKSxcclxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMiAtIG51bURpZ2l0cyhwYXJhbUFFbWl0dGVkKSksXHJcbiAgfSxcclxuKSArIFwiIGtWQ01cIjtcclxuc3RyaW5nUHJlc2VudFRvbm5lcyA9IGlucHV0UHJlc2VudFRvbm5lcy50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAge1xyXG4gICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAzIC0gbnVtRGlnaXRzKHBhcmFtRGVsdGFUb25uZXMpKSxcclxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMyAtIG51bURpZ2l0cyhwYXJhbURlbHRhVG9ubmVzKSksXHJcbiAgfSxcclxuKSArIFwiIHRDTzJlcVwiO1xyXG5zdHJpbmdBRW1pdHRlZCA9IFwiK1wiICsgcGFyYW1BRW1pdHRlZC50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAge1xyXG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCBudW1EaWdpdHMocGFyYW1BRW1pdHRlZCkpLFxyXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCBudW1EaWdpdHMocGFyYW1BRW1pdHRlZCkpLFxyXG4gIH0sXHJcbikgKyBcIiBrVkNNXCI7XHJcbnN0cmluZ0RlbHRhVG9ubmVzID0gXCIrXCIgKyBwYXJhbURlbHRhVG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7XHJcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDMsIG51bURpZ2l0cyhwYXJhbURlbHRhVG9ubmVzKSksXHJcbiAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDMsIG51bURpZ2l0cyhwYXJhbURlbHRhVG9ubmVzKSksXHJcbiAgfSxcclxuKSArIFwiIHRDTzJlcVwiO1xyXG5zdHJpbmdBUHJpY2UgPSBcIiRcIiArIHBhcmFtQVByaWNlLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7XHJcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1BUHJpY2UpKSxcclxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgMiArIG51bURpZ2l0cyhwYXJhbUFQcmljZSkpLFxyXG4gIH0sXHJcbik7XHJcbnN0cmluZ0JhckNpUHJpY2UgPSBcIiRcIiArIHBhcmFtQmFyQ2lQcmljZS50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAge1xyXG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQmFyQ2lQcmljZSkpLFxyXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQmFyQ2lQcmljZSkpLFxyXG4gIH0sXHJcbik7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkZWZhdWx0TGlxdWlkVG9ubmVzID0gMWU3O1xyXG5kZWZhdWx0QUJ1cm50ID0gMWUyO1xyXG5kZWZhdWx0R251bGwgPSAwLjU7XHJcbmRlZmF1bHRBID0gMC41O1xyXG5kZWZhdWx0UyA9IDAuNTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IklucHV0cy5idXR0b24oXHJcbiAgW1tcIlJlc2V0XCIsICgpID0+IHtcclxuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dEFWYWx1ZV8sIGRlZmF1bHRBVmFsdWUpO1xyXG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QVN1cHBseV8sIGRlZmF1bHRBU3VwcGx5KTtcclxuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dExpcXVpZFRvbm5lcywgZGVmYXVsdExpcXVpZFRvbm5lcyk7XHJcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBQnVybnQsIGRlZmF1bHRBQnVybnQpO1xyXG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QWksIGRlZmF1bHRBaSk7XHJcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRHaSwgZGVmYXVsdEdpKTtcclxuICB9XV0sXHJcbik7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXRBVmFsdWVfID0gSW5wdXRzLnJhbmdlKFsxZTUsIDFlOV0sIHtcclxuICBsYWJlbDogdGV4YFxcdGV4dHtNYXJrZXQgY2FwLiBvZiBcXHRleHRiZntBfX1gLFxyXG4gIHN0ZXA6IDEsXHJcbiAgdmFsdWU6IGRlZmF1bHRBVmFsdWUsXHJcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcclxufSk7XHJcbnZpZXdvZiBpbnB1dEFTdXBwbHlfID0gSW5wdXRzLnJhbmdlKFsxZTYsIDFlMTBdLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7U3VwcGx5IG9mIFxcdGV4dGJme0F9fWAsXHJcbiAgc3RlcDogMSxcclxuICB2YWx1ZTogZGVmYXVsdEFTdXBwbHksXHJcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcclxufSk7XHJcbnZpZXdvZiBpbnB1dExpcXVpZFRvbm5lcyA9IElucHV0cy5yYW5nZShbMWUtMywgMWU5XSwge1xyXG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1BvcnRmb2xpbyB9IENfe2kwfWAsXHJcbiAgc3RlcDogMWUtMyxcclxuICB2YWx1ZTogZGVmYXVsdExpcXVpZFRvbm5lcyxcclxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxyXG59KTtcclxudmlld29mIGlucHV0QUJ1cm50ID0gSW5wdXRzLnJhbmdlKFsxZS0xLCAxZTZdLCB7XHJcbiAgbGFiZWw6IHRleGBcXHRleHR7XFx0ZXh0YmZ7QX0gdG9rZW5zIGJ1cm50fWAsXHJcbiAgc3RlcDogMWUtMSxcclxuICB2YWx1ZTogZGVmYXVsdEFCdXJudCxcclxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxyXG59KTtcclxuSW5wdXRzLmJpbmQoXHJcbiAgSW5wdXRzLnJhbmdlKFswLCAxXSwge1xyXG4gICAgbGFiZWw6IHRleGBcXHRleHR7QWxsb2NhdGlvbiB9IEFfaWAsXHJcbiAgICBzdGVwOiAxZS02LFxyXG4gICAgdmFsdWU6IGRlZmF1bHRBaSxcclxuICAgIHRyYW5zZm9ybTogcGllY2V3aXNlTG9nVHJhbnNmb3JtKDFlLTYpLFxyXG4gICAgaW52ZXJ0OiBwaWVjZXdpc2VMb2dJbnZlcnQoMWUtNiksXHJcbiAgfSksXHJcbiAgdmlld29mIGlucHV0QWksXHJcbik7XHJcbklucHV0cy5iaW5kKFxyXG4gIElucHV0cy5yYW5nZShbMCwgMV0sIHtcclxuICAgIGxhYmVsOiB0ZXhgXFx0ZXh0e0FsbG9jYXRpb24gfSBHX2lgLFxyXG4gICAgc3RlcDogMWUtNixcclxuICAgIHZhbHVlOiBkZWZhdWx0R2ksXHJcbiAgfSksXHJcbiAgdmlld29mIGlucHV0R2ksXHJcbik7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwYXJhbUFCdXJudCA9IGlucHV0QWkgPT09IDAgPyAwIDogaW5wdXRBQnVybnRcclxucGFyYW1EZWx0YUFfID0gcGFyYW1BQnVybnQgLyBpbnB1dEFTdXBwbHlfO1xyXG5wYXJhbURlbHRhQ2kgPSBpbnB1dEFpID09PSAwID8gLTAgOiBjb21wdXRlRGVsdGFDaShcclxuICBpbnB1dEFpLFxyXG4gIGlucHV0R2ksXHJcbiAgcGFyYW1EZWx0YUFfLFxyXG4pO1xyXG5wYXJhbURlbHRhQ2lUb25uZXMgPSAtcGFyYW1EZWx0YUNpICogaW5wdXRMaXF1aWRUb25uZXM7XHJcbnBhcmFtQVByaWNlXyA9IGlucHV0QVZhbHVlXyAvIGlucHV0QVN1cHBseV87XHJcbnBhcmFtQ2lQcmljZSA9IGlucHV0QWkgPT09IDAgPyAwIDogaW5wdXRBVmFsdWVfICogcGFyYW1EZWx0YUFfIC8gcGFyYW1EZWx0YUNpVG9ubmVzO1xyXG5cclxuc3RyaW5nQVN1cHBseV8gPSBpbnB1dEFTdXBwbHlfLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7XHJcbiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1BQnVybnQpKSxcclxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMiAtIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxyXG4gIH0sXHJcbikgKyBcIiBrVkNNXCI7XHJcbnN0cmluZ0xpcXVpZFRvbm5lcyA9IGlucHV0TGlxdWlkVG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7XHJcbiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1EZWx0YUNpVG9ubmVzKSksXHJcbiAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1EZWx0YUNpVG9ubmVzKSksXHJcbiAgfSxcclxuKSArIFwiIHRDTzJlcVwiO1xyXG5zdHJpbmdBQnVybnQgPSBcIuKIklwiICsgcGFyYW1BQnVybnQudG9Mb2NhbGVTdHJpbmcoXHJcbiAgXCJlbi1HQlwiLFxyXG4gIHtcclxuICAgIG1pbmltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtQUJ1cm50KSksXHJcbiAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxyXG4gIH0sXHJcbikgKyBcIiBrVkNNXCI7XHJcbnN0cmluZ0RlbHRhQ2lUb25uZXMgPSBcIuKIklwiICsgcGFyYW1EZWx0YUNpVG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7XHJcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbURlbHRhQ2lUb25uZXMpKSxcclxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtRGVsdGFDaVRvbm5lcykpLFxyXG4gIH0sXHJcbikgKyBcIiB0Q08yZXFcIjtcclxuc3RyaW5nQVByaWNlXyA9IFwiJFwiICsgcGFyYW1BUHJpY2VfLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7XHJcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1BUHJpY2VfKSksXHJcbiAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1BUHJpY2VfKSksXHJcbiAgfSxcclxuKTtcclxuc3RyaW5nQ2lQcmljZSA9IFwiJFwiICsgcGFyYW1DaVByaWNlLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7XHJcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1DaVByaWNlKSksXHJcbiAgICBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1DaVByaWNlKSksXHJcbiAgfSxcclxuKTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFsbG9jSW5pdEdEYXRhID0ge1xyXG4gIGNvbnN0IGFsbG9jSW5pdEdEYXRhID0gW107XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAuMDE7IGkgKz0gMC4yNSkge1xyXG4gICAgaWYgKGkgPCAyLjUxKSB7XHJcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiMDFYXCIsIHZhbHVlOiBpIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKDIuNDkgPCBpICYmIGkgPCA1LjUxKSB7XHJcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwicEtsaW1hIEhvbGRlcnNcIiwgdmFsdWU6IGkgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoNS40OSA8IGkgJiYgaSA8IDEwLjAxKSB7XHJcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiREFPL1RyZWFzdXJ5XCIsIHZhbHVlOiBpIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKDkuOTkgPCBpICYmIGkgPCAxNS4wMSkge1xyXG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIkVjb3N5c3RlbSBHcmFudFwiLCB2YWx1ZTogaSB9KTtcclxuICAgIH1cclxuICAgIGlmICgxNC45OSA8IGkgJiYgaSA8IDIwLjAxKSB7XHJcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiUHJvZHVjdCBEZXNpZ25cIiwgdmFsdWU6IGkgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoMTkuOTkgPCBpICYmIGkgPCA2MC4wMSkge1xyXG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIktsaW1hIEhvbGRlcnNcIiwgdmFsdWU6IGkgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoNTkuOTkgPCBpKSB7XHJcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiSW5jZW50aXZlc1wiLCB2YWx1ZTogaSB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGFsbG9jSW5pdEdEYXRhO1xyXG59O1xyXG5sb25naXR1ZGVTY2FsZSA9IGQzLnNjYWxlTGluZWFyKFsxODAsIC0xODBdKTtcclxuZ2V0Q2VudGVyID0gZCA9PlxyXG4gICAgICAgIFsxLjI1LCA0LCA3Ljc1LCAxMi41LCAxNy41LCA0MCwgODBdLmluY2x1ZGVzKGQudmFsdWUpID8gZC52YWx1ZSA6IE5hTjtcclxuXHJcbmNvaG9ydHNEb21haW4gPSBbXHJcbiAgXCJJbmNlbnRpdmVzXCIsXHJcbiAgXCJLbGltYSBIb2xkZXJzXCIsXHJcbiAgXCJQcm9kdWN0IERlc2lnblwiLFxyXG4gIFwiRWNvc3lzdGVtIEdyYW50XCIsXHJcbiAgXCJEQU8vVHJlYXN1cnlcIixcclxuICBcInBLbGltYSBIb2xkZXJzXCIsXHJcbiAgXCIwMVhcIixcclxuXTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgcHJvamVjdGlvbjogeyB0eXBlOiBcImF6aW11dGhhbC1lcXVpZGlzdGFudFwiLCByb3RhdGU6IFswLCAtOTBdLCBzY2FsZTogMiB9LFxyXG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxyXG4gIG1hcmtzOiBbXHJcbiAgICBQbG90LmFyZWEoYWxsb2NJbml0R0RhdGEsIHtcclxuICAgICAgeDE6ICh7IHZhbHVlIH0pID0+IGxvbmdpdHVkZVNjYWxlKHZhbHVlIC8gMTAwKSxcclxuICAgICAgeTE6IC0yMCxcclxuICAgICAgeDI6ICh7IHZhbHVlIH0pID0+IGxvbmdpdHVkZVNjYWxlKHZhbHVlIC8gMTAwKSxcclxuICAgICAgeTI6IC03MCxcclxuICAgICAgZmlsbDogXCJrZXlcIixcclxuICAgIH0pLFxyXG4gIF1cclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXRQMCA9IElucHV0cy5yYW5nZShbMC4wMSwgMC41XSwge1xyXG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0luaXRpYWwgaXNzdWFuY2UgfSBQXzBgLFxyXG4gIHN0ZXA6IDAuMDEsXHJcbiAgdmFsdWU6IDAuMDcsXHJcbn0pO1xyXG52aWV3b2YgaW5wdXRUID0gSW5wdXRzLnJhbmdlKFsyLCA2MF0sIHtcclxuICBsYWJlbDogdGV4YFQgXFx0ZXh0eyAobW9udGhzKX1gLFxyXG4gIHN0ZXA6IDEsXHJcbiAgdmFsdWU6IDI0LFxyXG59KTtcclxuXHJcbnN0cmluZ0lucHV0UDAgPSBpbnB1dFAwLnRvTG9jYWxlU3RyaW5nKFxyXG4gIFwiZW4tR0JcIixcclxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwIH0sXHJcbik7XHJcbnN0cmluZ0lucHV0VCA9IGlucHV0VC50b0xvY2FsZVN0cmluZyhcImVuLUdCXCIsIHsgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwIH0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVAodCwgUDAsIFQpIHtcclxuICBjb25zdCB4MCA9IE1hdGgubG9nKFAwIC8gKDEgLSBQMCkpO1xyXG4gIGNvbnN0IHh0ID0geDAgKiAoMSAtIHQgLyBUKTtcclxuICBjb25zdCBleHAgPSBNYXRoLmV4cCh4dCk7XHJcbiAgcmV0dXJuIGV4cCAvIChleHAgKyAxKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY29tcHV0ZURlcml2UCh0LCBQMCwgVCkge1xyXG4gIGNvbnN0IHgwID0gTWF0aC5sb2coUDAgLyAoMSAtIFAwKSk7XHJcbiAgY29uc3QgeHQgPSB4MCAqICgxIC0gdCAvIFQpO1xyXG4gIGNvbnN0IGV4cCA9IE1hdGguZXhwKHh0KTtcclxuICBjb25zdCBQID0gZXhwIC8gKDEgKyBleHApO1xyXG4gIHJldHVybiAtKHgwIC8gVCkgKiBQICogKDEgLSBQKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VmVzdGluZyh2ZWNWZXN0aW5nLCB0LCB0U3RhcnQsIHRFbmQpIHtcclxuICBpZiAodCA8IHRTdGFydClcclxuICAgIHJldHVybiAwO1xyXG4gIGVsc2UgaWYgKHQgPCB0RW5kKSB7XHJcbiAgICByZXR1cm4gdmVjVmVzdGluZ1t0IC0gdFN0YXJ0XTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIHZlY1Zlc3RpbmdbdEVuZCAtIHRTdGFydCAtIDFdO1xyXG4gIH1cclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidFZlc3RTdGFydCA9IDM7XHJcbnRWZXN0RW5kID0gMiAqIGlucHV0VDtcclxudFZlc3RpbmcgPSBkMy5yYW5nZSh0VmVzdFN0YXJ0LCB0VmVzdEVuZCk7XHJcbnZlY1Zlc3RpbmdEZXJpdiA9IG5vcm1hbGl6ZSh0VmVzdGluZy5tYXAodCA9PlxyXG4gIGNvbXB1dGVEZXJpdlAodCwgaW5wdXRQMCwgaW5wdXRUKVxyXG4pKTtcclxudmVjVmVzdGluZyA9IGQzLmN1bXN1bSh2ZWNWZXN0aW5nRGVyaXYpO1xyXG5cclxuc3VwcGx5RGF0YUFsbCA9IHtcclxuICBsZXQgcGFyYW1WZXN0aW5nUHJldmlvdXMgPSAwO1xyXG4gIGNvbnN0IHZlY1N1cHBseUluY2VudGl2ZXMgPSBbXTtcclxuICBjb25zdCB2ZWNTdXBwbHlDaXJjdWxhdGluZyA9IFtdO1xyXG4gIGNvbnN0IHN1cHBseURhdGEgPSBbXTtcclxuICBmb3IgKGxldCB0ID0gMDsgdCA8PSA3MjsgdCsrKSB7XHJcbiAgICBjb25zdCBwYXJhbVAgPSBjb21wdXRlUCh0LCBpbnB1dFAwLCBpbnB1dFQpO1xyXG4gICAgY29uc3QgcGFyYW1EZXJpdlAgPSBjb21wdXRlRGVyaXZQKHQsIGlucHV0UDAsIGlucHV0VCk7XHJcbiAgICBjb25zdCBwYXJhbVZlc3RpbmcgPSBnZXRWZXN0aW5nKHZlY1Zlc3RpbmcsIHQsIHRWZXN0U3RhcnQsIHRWZXN0RW5kKTtcclxuICAgIGNvbnN0IHBhcmFtVmVzdGluZ0RpZmYgPSBwYXJhbVZlc3RpbmcgLSBwYXJhbVZlc3RpbmdQcmV2aW91cztcclxuICAgIHBhcmFtVmVzdGluZ1ByZXZpb3VzID0gcGFyYW1WZXN0aW5nO1xyXG5cclxuICAgIGNvbnN0IHN1cHBseTAxWCA9IDIuNTtcclxuICAgIGNvbnN0IHN1cHBseVBLbGltYSA9IDMgKiBwYXJhbVZlc3Rpbmc7XHJcbiAgICBjb25zdCBzdXBwbHlUcmVhc3VyeSA9IDQuNTtcclxuICAgIGNvbnN0IHN1cHBseUdyYW50ID0gNSAqIHBhcmFtVmVzdGluZztcclxuICAgIGNvbnN0IHN1cHBseVByb2R1Y3QgPSA1ICogcGFyYW1WZXN0aW5nO1xyXG4gICAgY29uc3Qgc3VwcGx5S2xpbWEgPSA0MCAqIHBhcmFtVmVzdGluZztcclxuICAgIGNvbnN0IHN1cHBseUluY2VudGl2ZXMgPSA0MCAqIHBhcmFtUDtcclxuICAgIHZlY1N1cHBseUluY2VudGl2ZXMucHVzaChzdXBwbHlJbmNlbnRpdmVzKTtcclxuXHJcbiAgICBjb25zdCBzdXBwbHkwMVhTdGFja2VkID0gc3VwcGx5MDFYO1xyXG4gICAgY29uc3Qgc3VwcGx5UEtsaW1hU3RhY2tlZCA9IHN1cHBseVBLbGltYSArIHN1cHBseTAxWFN0YWNrZWQ7XHJcbiAgICBjb25zdCBzdXBwbHlUcmVhc3VyeVN0YWNrZWQgPSBzdXBwbHlUcmVhc3VyeSArIHN1cHBseVBLbGltYVN0YWNrZWQ7XHJcbiAgICBjb25zdCBzdXBwbHlHcmFudFN0YWNrZWQgPSBzdXBwbHlHcmFudCArIHN1cHBseVRyZWFzdXJ5U3RhY2tlZDtcclxuICAgIGNvbnN0IHN1cHBseVByb2R1Y3RTdGFja2VkID0gc3VwcGx5UHJvZHVjdCArIHN1cHBseUdyYW50U3RhY2tlZDtcclxuICAgIGNvbnN0IHN1cHBseUtsaW1hU3RhY2tlZCA9IHN1cHBseUtsaW1hICsgc3VwcGx5UHJvZHVjdFN0YWNrZWQ7XHJcbiAgICBjb25zdCBzdXBwbHlJbmNlbnRpdmVzU3RhY2tlZCA9IHN1cHBseUluY2VudGl2ZXMgKyBzdXBwbHlLbGltYVN0YWNrZWQ7XHJcbiAgICBjb25zdCBzdXBwbHlDaXJjdWxhdGluZyA9IHN1cHBseUluY2VudGl2ZXNTdGFja2VkIC8gMTAwO1xyXG4gICAgdmVjU3VwcGx5Q2lyY3VsYXRpbmcucHVzaChzdXBwbHlJbmNlbnRpdmVzU3RhY2tlZCk7XHJcblxyXG4gICAgaWYgKHQgPD0gNjApIHtcclxuICAgICAgY29uc3QgZGlmZkluY2VudGl2ZXMgPSA0MCAqICh0ID09PSAwID8gaW5wdXRQMCA6IHBhcmFtRGVyaXZQKTtcclxuICAgICAgY29uc3QgZGlmZktsaW1hID0gNDAgKiBwYXJhbVZlc3RpbmdEaWZmO1xyXG4gICAgICBjb25zdCBkaWZmUHJvZHVjdCA9IDUgKiBwYXJhbVZlc3RpbmdEaWZmO1xyXG4gICAgICBjb25zdCBkaWZmR3JhbnQgPSA1ICogcGFyYW1WZXN0aW5nRGlmZjtcclxuICAgICAgY29uc3QgZGlmZlBLbGltYSA9IDMgKiBwYXJhbVZlc3RpbmdEaWZmO1xyXG4gICAgICBjb25zdCBkaWZmVHJlYXN1cnkgPSB0ID09PSAwID8gNC41OiAwO1xyXG4gICAgICBjb25zdCBkaWZmMDFYID0gdCA9PT0gMCA/IDIuNSA6IDA7XHJcblxyXG4gICAgICBjb25zdCBkaWZmSW5jZW50aXZlc1N0YWNrZWQgPSBkaWZmSW5jZW50aXZlcztcclxuICAgICAgY29uc3QgZGlmZktsaW1hU3RhY2tlZCA9IGRpZmZLbGltYSArIGRpZmZJbmNlbnRpdmVzU3RhY2tlZDtcclxuICAgICAgY29uc3QgZGlmZlByb2R1Y3RTdGFja2VkID0gZGlmZlByb2R1Y3QgKyBkaWZmS2xpbWFTdGFja2VkO1xyXG4gICAgICBjb25zdCBkaWZmR3JhbnRTdGFja2VkID0gZGlmZkdyYW50ICsgZGlmZlByb2R1Y3RTdGFja2VkO1xyXG4gICAgICBjb25zdCBkaWZmUEtsaW1hU3RhY2tlZCA9IGRpZmZQS2xpbWEgKyBkaWZmR3JhbnRTdGFja2VkO1xyXG4gICAgICBjb25zdCBkaWZmVHJlYXN1cnlTdGFja2VkID0gZGlmZlRyZWFzdXJ5ICsgZGlmZlBLbGltYVN0YWNrZWQ7XHJcbiAgICAgIGNvbnN0IGRpZmYwMVhTdGFja2VkID0gZGlmZjAxWCArIGRpZmZUcmVhc3VyeVN0YWNrZWQ7XHJcblxyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJQcm9wb3J0aW9uIG9mIFN1cHBseVwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogMTAwICogcGFyYW1QLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiUmF0ZSBvZiBDaGFuZ2VcIixcclxuICAgICAgICB4OiB0LFxyXG4gICAgICAgIHk6IDEwMCAqIHBhcmFtRGVyaXZQLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiMDFYXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHkwMVhTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcInBLbGltYSBIb2xkZXJzXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHlQS2xpbWFTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIkRBTy9UcmVhc3VyeVwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5VHJlYXN1cnlTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5R3JhbnRTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIlByb2R1Y3QgRGVzaWduXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHlQcm9kdWN0U3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJLbGltYSBIb2xkZXJzXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHlLbGltYVN0YWNrZWQgLyBzdXBwbHlDaXJjdWxhdGluZyxcclxuICAgICAgfSk7XHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQgLyBzdXBwbHlDaXJjdWxhdGluZyxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiMDFYXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHkwMVggLyBzdXBwbHlDaXJjdWxhdGluZyxcclxuICAgICAgfSk7XHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJwS2xpbWEgSG9sZGVyc1wiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHlUcmVhc3VyeSAvIHN1cHBseUNpcmN1bGF0aW5nLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5R3JhbnQgLyBzdXBwbHlDaXJjdWxhdGluZyxcclxuICAgICAgfSk7XHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJQcm9kdWN0IERlc2lnblwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdCAvIHN1cHBseUNpcmN1bGF0aW5nLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcclxuICAgICAgICB4OiB0LFxyXG4gICAgICAgIHk6IHN1cHBseUtsaW1hIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5SW5jZW50aXZlcyAvIHN1cHBseUNpcmN1bGF0aW5nLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiMDFYXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHkwMVhTdGFja2VkLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJwS2xpbWEgSG9sZGVyc1wiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hU3RhY2tlZCxcclxuICAgICAgfSk7XHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHlUcmVhc3VyeVN0YWNrZWQsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5R3JhbnRTdGFja2VkLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJQcm9kdWN0IERlc2lnblwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdFN0YWNrZWQsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcclxuICAgICAgICB4OiB0LFxyXG4gICAgICAgIHk6IHN1cHBseUtsaW1hU3RhY2tlZCxcclxuICAgICAgfSk7XHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIjAxWFwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogc3VwcGx5MDFYLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcInBLbGltYSBIb2xkZXJzXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHlQS2xpbWEsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHlUcmVhc3VyeSxcclxuICAgICAgfSk7XHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJFY29zeXN0ZW0gR3JhbnRcIixcclxuICAgICAgICB4OiB0LFxyXG4gICAgICAgIHk6IHN1cHBseUdyYW50LFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIlByb2R1Y3QgRGVzaWduXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBzdXBwbHlQcm9kdWN0LFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcclxuICAgICAgICB4OiB0LFxyXG4gICAgICAgIHk6IHN1cHBseUtsaW1hLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIkluY2VudGl2ZXNcIixcclxuICAgICAgICB4OiB0LFxyXG4gICAgICAgIHk6IHN1cHBseUluY2VudGl2ZXMsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJJbmNlbnRpdmVzXCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBkaWZmSW5jZW50aXZlcyxcclxuICAgICAgfSk7XHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiS2xpbWEgSG9sZGVyc1wiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogZGlmZktsaW1hLFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJQcm9kdWN0IERlc2lnblwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogZGlmZlByb2R1Y3QsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogZGlmZkdyYW50LFxyXG4gICAgICB9KTtcclxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcclxuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxyXG4gICAgICAgIGNvaG9ydDogXCJwS2xpbWEgSG9sZGVyc1wiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogZGlmZlBLbGltYSxcclxuICAgICAgfSk7XHJcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XHJcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIixcclxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXHJcbiAgICAgICAgeDogdCxcclxuICAgICAgICB5OiBkaWZmVHJlYXN1cnksXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xyXG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXHJcbiAgICAgICAgY29ob3J0OiBcIjAxWFwiLFxyXG4gICAgICAgIHg6IHQsXHJcbiAgICAgICAgeTogZGlmZjAxWCxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCB2ZWNOZXh0WWVhckluY2VudGl2ZXMgPSB2ZWNTdXBwbHlJbmNlbnRpdmVzLm1hcCgodmFsLCB0KSA9PlxyXG4gICAgdmVjU3VwcGx5SW5jZW50aXZlc1t0ICsgMTJdIC0gdmFsKTtcclxuICBjb25zdCB2ZWNBUFkgPSB2ZWNTdXBwbHlDaXJjdWxhdGluZy5tYXAoKHZhbCwgdCkgPT5cclxuICAgIDEwMCAqICh2ZWNTdXBwbHlDaXJjdWxhdGluZ1t0ICsgMTJdIC0gdmFsKSAvIHZhbCk7XHJcbiAgY29uc3QgdmVjQVBSID0gdmVjU3VwcGx5Q2lyY3VsYXRpbmcubWFwKCh2YWwsIHQpID0+XHJcbiAgICAxMDAgKiAodmVjU3VwcGx5Q2lyY3VsYXRpbmdbdCArIDEyXSAtIHZlY05leHRZZWFySW5jZW50aXZlc1t0XSAtIHZhbCkgLyB2YWwpO1xyXG5cclxuICBmb3IgKGxldCB0ID0gMDsgdCA8PSA2MDsgdCsrKSB7XHJcbiAgICBzdXBwbHlEYXRhLnB1c2goeyBrZXk6IFwiQVBZXCIsIHg6IHQsIHk6IHZlY0FQWVt0XSB9KTtcclxuICAgIHN1cHBseURhdGEucHVzaCh7IGtleTogXCJBUFJcIiwgeDogdCwgeTogdmVjQVBSW3RdIH0pO1xyXG4gIH1cclxuICByZXR1cm4gW1xyXG4gICAgdmVjU3VwcGx5SW5jZW50aXZlcyxcclxuICAgIHZlY1N1cHBseUNpcmN1bGF0aW5nLFxyXG4gICAgc3VwcGx5RGF0YSxcclxuICAgIHZlY0FQWSxcclxuICAgIHZlY0FQUixcclxuICBdO1xyXG59XHJcbnZlY1N1cHBseUluY2VudGl2ZXMgPSBzdXBwbHlEYXRhQWxsWzBdO1xyXG52ZWNTdXBwbHlDaXJjdWxhdGluZyA9IHN1cHBseURhdGFBbGxbMV07XHJcbnN1cHBseURhdGEgPSBzdXBwbHlEYXRhQWxsWzJdO1xyXG52ZWNBUFkgPSBzdXBwbHlEYXRhQWxsWzNdO1xyXG52ZWNBUFIgPSBzdXBwbHlEYXRhQWxsWzRdO1xyXG5cclxuZ2V0TG9naXN0aWNDdXJ2ZSA9IGQgPT4gZC5rZXkgPT09IFwiUHJvcG9ydGlvbiBvZiBTdXBwbHlcIiA/IGQueSA6IE5hTjtcclxuZ2V0UmF0ZU9mQ2hhbmdlID0gZCA9PiBkLmtleSA9PT0gXCJSYXRlIG9mIENoYW5nZVwiID8gZC55IDogTmFOO1xyXG5nZXRDaXJjdWxhdGluZ1N0YWNrZWQgPSBkID0+XHJcbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiID8gZC55IDogTmFOO1xyXG5nZXRDaXJjdWxhdGluZ1Vuc3RhY2tlZCA9IGQgPT5cclxuICAgICAgICBkLmtleSA9PT0gXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIiA/IGQueSA6IE5hTjtcclxuZ2V0VG90YWxTdGFja2VkID0gZCA9PiBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XHJcbmdldFRvdGFsVW5zdGFja2VkID0gZCA9PiBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIiA/IGQueSA6IE5hTjtcclxuZ2V0RGlmZlVuc3RhY2tlZCA9IGQgPT5cclxuICAgICAgICBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XHJcbmdldENvaG9ydENpcmN1bGF0aW5nU3RhY2tlZCA9IGQgPT5cclxuICAgICAgICBkLmtleSA9PT0gXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIgPyBkLmNvaG9ydCA6IE5hTjtcclxuZ2V0Q29ob3J0Q2lyY3VsYXRpbmdVbnN0YWNrZWQgPSBkID0+XHJcbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIgPyBkLmNvaG9ydCA6IE5hTjtcclxuZ2V0Q29ob3J0VG90YWxTdGFja2VkID0gZCA9PlxyXG4gICAgICAgIGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIiA/IGQuY29ob3J0IDogTmFOO1xyXG5nZXRDb2hvcnRUb3RhbFVuc3RhY2tlZCA9IGQgPT5cclxuICAgICAgICBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIiA/IGQuY29ob3J0IDogTmFOO1xyXG5nZXRDb2hvcnREaWZmVW5zdGFja2VkID0gZCA9PlxyXG4gICAgICAgIGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIiA/IGQuY29ob3J0IDogTmFOO1xyXG5nZXRBUFkgPSBkID0+IGQua2V5ID09PSBcIkFQWVwiID8gZC55IDogTmFOO1xyXG5nZXRBUFIgPSBkID0+IGQua2V5ID09PSBcIkFQUlwiID8gZC55IDogTmFOO1xyXG5cclxuZG9tYWluUmF0ZU9mQ2hhbmdlID0gWzAsIGQzLm1heChzdXBwbHlEYXRhLCBnZXRSYXRlT2ZDaGFuZ2UpXTtcclxuc2NhbGVSYXRlT2ZDaGFuZ2UgPSBkMy5zY2FsZUxpbmVhcihkb21haW5SYXRlT2ZDaGFuZ2UsIFswLCAxMDBdKTtcclxubWFwU2NhbGVSYXRlT2ZDaGFuZ2UgPSB4ID0+IHgubWFwKHNjYWxlUmF0ZU9mQ2hhbmdlKTtcclxuXHJcbnN0cmluZ1AwID0gXCJJbml0aWFsIElzc3VhbmNlIFDigoAgPSBcIiArIGlucHV0UDAudG9Mb2NhbGVTdHJpbmcoXHJcbiAgXCJlbi1HQlwiLFxyXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSxcclxuKTtcclxuc3RyaW5nVCA9IFwiSW5mbGVjdGlvbiBQb2ludCBUaW1lIFQgPSBcIiArIGlucHV0VC50b0xvY2FsZVN0cmluZyhcclxuICBcImVuLUdCXCIsXHJcbiAgeyBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSxcclxuKSArIFwiIG1vbnRoc1wiO1xyXG5cclxuc3VwcGx5UGFyYW1zID0gW1xyXG4gIHsga2V5OiBzdHJpbmdQMCwgeDogMC41LCB5OiAxMDAgKiBpbnB1dFAwIH0sXHJcbiAgeyBrZXk6IHN0cmluZ1QsIHg6IGlucHV0VCwgeTogNTAgfSxcclxuXTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHJhbmdlOiBbNSwgNywgMCwgMl0ubWFwKGkgPT4gZDMuc2NoZW1lQ2F0ZWdvcnkxMFtpXSksXHJcbiAgICBkb21haW46IFtcIlByb3BvcnRpb24gb2YgU3VwcGx5XCIsIFwiUmF0ZSBvZiBDaGFuZ2VcIiwgc3RyaW5nUDAsIHN0cmluZ1RdLFxyXG4gIH0sXHJcbiAgeDoge1xyXG4gICAgdGlja3M6IGQzLnJhbmdlKDAsIDYwLjEsIDEyKSxcclxuICAgIGxhYmVsOiBcIuKAmExpZmXigJkgU3BhbiAoTW9udGhzKVwiLFxyXG4gICAgZ3JpZDogdHJ1ZSxcclxuICB9LFxyXG4gIHk6IHsgZG9tYWluOiBbMCwgMTAwXSB9LFxyXG4gIGluc2V0VG9wOiAxNixcclxuICBjbGlwOiB0cnVlLFxyXG4gIG1hcmtzOiBbXHJcbiAgICBQbG90LmZyYW1lKCksXHJcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcImxlZnRcIiwgbGFiZWw6IFwiUHJvcG9ydGlvbiBvZiBTdXBwbHkgKCUpXCIgfSksXHJcbiAgICBQbG90LmF4aXNZKHNjYWxlUmF0ZU9mQ2hhbmdlLnRpY2tzKCksIHtcclxuICAgICAgYW5jaG9yOiBcInJpZ2h0XCIsXHJcbiAgICAgIHRpY2tGb3JtYXQ6IHNjYWxlUmF0ZU9mQ2hhbmdlLnRpY2tGb3JtYXQoKSxcclxuICAgICAgbGFiZWw6IFwiUmF0ZSBvZiBDaGFuZ2UgKCUvTW9udGgpXCIsXHJcbiAgICAgIHk6IHNjYWxlUmF0ZU9mQ2hhbmdlXHJcbiAgICB9KSxcclxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlUmF0ZU9mQ2hhbmdlLCB7XHJcbiAgICAgIHg6IFwieFwiLFxyXG4gICAgICB5OiBnZXRSYXRlT2ZDaGFuZ2UsXHJcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcclxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxyXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXHJcbiAgICB9KSksXHJcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcclxuICAgICAgeDogXCJ4XCIsXHJcbiAgICAgIHk6IGdldExvZ2lzdGljQ3VydmUsXHJcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcclxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxyXG4gICAgfSksXHJcbiAgICBQbG90LmFyZWFZKHN1cHBseURhdGEsIFBsb3QubWFwWShtYXBTY2FsZVJhdGVPZkNoYW5nZSwge1xyXG4gICAgICB4OiBcInhcIixcclxuICAgICAgeTogZ2V0UmF0ZU9mQ2hhbmdlLFxyXG4gICAgICBmaWxsOiBcImtleVwiLFxyXG4gICAgICBmaWxsT3BhY2l0eTogMC4zLFxyXG4gICAgfSkpLFxyXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XHJcbiAgICAgIHg6IFwieFwiLFxyXG4gICAgICB5OiBnZXRMb2dpc3RpY0N1cnZlLFxyXG4gICAgICBmaWxsOiBcImtleVwiLFxyXG4gICAgICBmaWxsT3BhY2l0eTogMC4zLFxyXG4gICAgfSksXHJcbiAgICBQbG90LnJ1bGVYKHN1cHBseVBhcmFtcywge1xyXG4gICAgICB4OiBkID0+IGQua2V5ID09PSBzdHJpbmdUID8gZC54IDogTmFOLFxyXG4gICAgICB5OiBcInlcIixcclxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxyXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXHJcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcclxuICAgIH0pLFxyXG4gICAgUGxvdC5kb3RZKHN1cHBseVBhcmFtcywge1xyXG4gICAgICB4OiBcInhcIixcclxuICAgICAgeTogXCJ5XCIsXHJcbiAgICAgIHI6IDUsXHJcbiAgICAgIGZpbGw6IFwia2V5XCIsXHJcbiAgICB9KSxcclxuICBdXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTg0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcclxuICBjb2xvcjogeyBsZWdlbmQ6IHRydWUsIHJhbmdlOiBkMy5zY2hlbWVDYXRlZ29yeTEwLCBkb21haW46IGNvaG9ydHNEb21haW4gfSxcclxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxyXG4gIHk6IHsgZG9tYWluOiBbMCwgMTAwXSwgbGFiZWw6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5ICglKVwiLCBncmlkOiB0cnVlIH0sXHJcbiAgY2xpcDogdHJ1ZSxcclxuICBtYXJrczogW1xyXG4gICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgUGxvdC5saW5lWShzdXBwbHlEYXRhLCB7XHJcbiAgICAgIHg6IFwieFwiLFxyXG4gICAgICB5OiBnZXRDaXJjdWxhdGluZ1N0YWNrZWQsXHJcbiAgICAgIHN0cm9rZTogZ2V0Q29ob3J0Q2lyY3VsYXRpbmdTdGFja2VkLFxyXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXHJcbiAgICB9KSxcclxuICAgIFBsb3QuYXJlYVkoc3VwcGx5RGF0YSwge1xyXG4gICAgICB4OiBcInhcIixcclxuICAgICAgeTogZ2V0Q2lyY3VsYXRpbmdVbnN0YWNrZWQsXHJcbiAgICAgIGZpbGw6IGdldENvaG9ydENpcmN1bGF0aW5nVW5zdGFja2VkLFxyXG4gICAgICBmaWxsT3BhY2l0eTogMC41LFxyXG4gICAgfSksXHJcbiAgXVxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHsgbGVnZW5kOiB0cnVlLCByYW5nZTogZDMuc2NoZW1lQ2F0ZWdvcnkxMCwgZG9tYWluOiBjb2hvcnRzRG9tYWluIH0sXHJcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgNjAuMSwgMTIpLCBsYWJlbDogXCJUaW1lIChNb250aHMpXCIsIGdyaWQ6IHRydWUgfSxcclxuICB5OiB7IGRvbWFpbjogWzAsIDEwMF0sIGxhYmVsOiBcIlRvdGFsIFN1cHBseSAoJSlcIiwgZ3JpZDogdHJ1ZSB9LFxyXG4gIGNsaXA6IHRydWUsXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwge1xyXG4gICAgICB4OiBcInhcIixcclxuICAgICAgeTogZ2V0VG90YWxTdGFja2VkLFxyXG4gICAgICBzdHJva2U6IGdldENvaG9ydFRvdGFsU3RhY2tlZCxcclxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxyXG4gICAgfSksXHJcbiAgICBQbG90LmFyZWFZKHN1cHBseURhdGEsIHtcclxuICAgICAgeDogXCJ4XCIsXHJcbiAgICAgIHk6IGdldFRvdGFsVW5zdGFja2VkLFxyXG4gICAgICBmaWxsOiBnZXRDb2hvcnRUb3RhbFVuc3RhY2tlZCxcclxuICAgICAgZmlsbE9wYWNpdHk6IDAuNSxcclxuICAgIH0pLFxyXG4gIF1cclxufSlcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgY29sb3I6IHsgbGVnZW5kOiB0cnVlLCByYW5nZTogZDMuc2NoZW1lQ2F0ZWdvcnkxMCwgZG9tYWluOiBjb2hvcnRzRG9tYWluIH0sXHJcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgNjAuMSwgMTIpLCBsYWJlbDogXCJUaW1lIChNb250aHMpXCIsIGdyaWQ6IHRydWUgfSxcclxuICB5OiB7IGxhYmVsOiBcIlRvdGFsIFN1cHBseSAoJSlcIiwgZ3JpZDogdHJ1ZSB9LFxyXG4gIGluc2V0VG9wOiAxNixcclxuICBjbGlwOiB0cnVlLFxyXG4gIG1hcmtzOiBbXHJcbiAgICBQbG90LmZyYW1lKCksXHJcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcclxuICAgICAgeDogXCJ4XCIsXHJcbiAgICAgIHk6IGdldFRvdGFsVW5zdGFja2VkLFxyXG4gICAgICBzdHJva2U6IGdldENvaG9ydFRvdGFsVW5zdGFja2VkLFxyXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXHJcbiAgICB9KSxcclxuICAgIFBsb3QuYXJlYVkoc3VwcGx5RGF0YSwge1xyXG4gICAgICB4OiBcInhcIixcclxuICAgICAgeTE6IDAsXHJcbiAgICAgIHkyOiBnZXRUb3RhbFVuc3RhY2tlZCxcclxuICAgICAgZmlsbDogZ2V0Q29ob3J0VG90YWxVbnN0YWNrZWQsXHJcbiAgICAgIGZpbGxPcGFjaXR5OiAwLjIsXHJcbiAgICB9KSxcclxuICBdXHJcbn0pXHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xyXG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxyXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDYwLjEsIDEyKSwgbGFiZWw6IFwiVGltZSAoTW9udGhzKVwiLCBncmlkOiB0cnVlIH0sXHJcbiAgeTogeyBsYWJlbDogXCJSYXRlIG9mIEdyb3d0aCAoJS9Nb250aClcIiwgZ3JpZDogdHJ1ZSB9LFxyXG4gIGluc2V0VG9wOiAxNixcclxuICBpbnNldExlZnQ6IDgsXHJcbiAgaW5zZXRSaWdodDogOCxcclxuICBjbGlwOiB0cnVlLFxyXG4gIG1hcmtzOiBbXHJcbiAgICBQbG90LmZyYW1lKCksXHJcbiAgICBQbG90LnJlY3RZKHN1cHBseURhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC54IC0gMC40NSxcclxuICAgICAgeDI6IGQgPT4gZC54ICsgMC40NSxcclxuICAgICAgeTogZ2V0RGlmZlVuc3RhY2tlZCxcclxuICAgICAgZmlsbDogZ2V0Q29ob3J0RGlmZlVuc3RhY2tlZCxcclxuICAgIH0pLFxyXG4gIF1cclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xyXG4gIGNvbG9yOiB7XHJcbiAgICBsZWdlbmQ6IHRydWUsXHJcbiAgICByYW5nZTogWzksIDhdLm1hcChpID0+IGQzLnNjaGVtZUNhdGVnb3J5MTBbaV0pLFxyXG4gICAgZG9tYWluOiBbXCJBUFlcIiwgXCJBUFJcIl0sXHJcbiAgfSxcclxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxyXG4gIHk6IHtcclxuICAgIGRvbWFpbjogWzAsIE1hdGgubWF4KGQzLm1heCh2ZWNBUFIpLCBkMy5tYXgodmVjQVBZKSldLFxyXG4gICAgbGFiZWw6IFwiQW5udWFsIFBlcmNlbnRhZ2UgKCUpXCIsXHJcbiAgICBncmlkOiB0cnVlLFxyXG4gIH0sXHJcbiAgaW5zZXRUb3A6IDE2LFxyXG4gIGNsaXA6IHRydWUsXHJcbiAgbWFya3M6IFtcclxuICAgIFBsb3QuZnJhbWUoKSxcclxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwge1xyXG4gICAgICB4OiBcInhcIixcclxuICAgICAgeTogZ2V0QVBZLFxyXG4gICAgICBzdHJva2U6IFwia2V5XCIsXHJcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcclxuICAgIH0pLFxyXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XHJcbiAgICAgIHg6IFwieFwiLFxyXG4gICAgICB5MTogMCxcclxuICAgICAgeTI6IGdldEFQWSxcclxuICAgICAgZmlsbDogXCJrZXlcIixcclxuICAgICAgZmlsbE9wYWNpdHk6IDAuMixcclxuICAgIH0pLFxyXG4gICAgUGxvdC5saW5lWShzdXBwbHlEYXRhLCB7XHJcbiAgICAgIHg6IFwieFwiLFxyXG4gICAgICB5OiBnZXRBUFIsXHJcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcclxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxyXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXHJcbiAgICB9KSxcclxuICBdXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTg5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVVwc2lsb24oRywgTCkge1xyXG4gIGlmIChHID09PSAwICYmIEwgPT09IDApIHtcclxuICAgIHJldHVybiAwO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gKDIgKiBHICogTCAvIChHKioyICsgTCoqMikpKioyO1xyXG4gIH1cclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidXBzaWxvbkRhdGEgPSB7XHJcbiAgY29uc3QgdXBzaWxvbkRhdGEgPSBbXTtcclxuICBmb3IgKGxldCBwYXJhbUcgPSAwOyBwYXJhbUcgPCAxLjAxOyBwYXJhbUcgKz0gMC4wNSkge1xyXG4gICAgZm9yIChsZXQgcGFyYW1MID0gMDsgcGFyYW1MIDwgMS4wMTsgcGFyYW1MICs9IDAuMDUpIHtcclxuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcclxuICAgICAgICB1cHNpbG9uRGF0YS5wdXNoKHtcclxuICAgICAgICAgIGtleTogXCLPhVwiLFxyXG4gICAgICAgICAgbDogcGFyYW1MLFxyXG4gICAgICAgICAgZzogcGFyYW1HLFxyXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVVcHNpbG9uKHBhcmFtRywgcGFyYW1MKSxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gdXBzaWxvbkRhdGE7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xyXG4gIGFzcGVjdFJhdGlvOiAxLFxyXG4gIGNvbG9yOiB7XHJcbiAgICBsZWdlbmQ6IHRydWUsXHJcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcclxuICAgIGRvbWFpbjogWzAsIDFdLFxyXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICBsYWJlbDogXCJSZWxhdGl2ZSBVdGlsaXNhdGlvbiDPhVwiLFxyXG4gIH0sXHJcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxyXG4gIHk6IHtcclxuICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxyXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXHJcbiAgICBsYWJlbDogXCJTdGFrZSBHXCIsXHJcbiAgfSxcclxuICBtYXJrczogW1xyXG4gICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgUGxvdC5yZWN0KHVwc2lsb25EYXRhLCB7XHJcbiAgICAgIHgxOiBkID0+IGQubCAtIDAuMDI1LFxyXG4gICAgICB4MjogZCA9PiBkLmwgKyAwLjAyNSxcclxuICAgICAgeTE6IGQgPT4gZC5nIC0gMC4wMjUsXHJcbiAgICAgIHkyOiBkID0+IGQuZyArIDAuMDI1LFxyXG4gICAgICBmaWxsOiBcInZhbHVlXCIsXHJcbiAgICB9KSxcclxuICAgIFBsb3QudGV4dCh1cHNpbG9uRGF0YSwge1xyXG4gICAgICB4OiBcImxcIixcclxuICAgICAgeTogXCJnXCIsXHJcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXHJcbiAgICAgICAgXCJlbi1HQlwiLFxyXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcclxuICAgICAgKSxcclxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcclxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcclxuICAgICAgKSxcclxuICAgIH0pLFxyXG4gIF0sXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUV0YShHLCBMKSB7XHJcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiAyICogRyAqIEwgLyAoRyAqICgxIC0gRykgKyBMICogKDEgLSBMKSk7XHJcbiAgfVxyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJldGFEYXRhID0ge1xyXG4gIGNvbnN0IGV0YURhdGEgPSBbXTtcclxuICBmb3IgKGxldCBwYXJhbUcgPSAwOyBwYXJhbUcgPCAxLjAxOyBwYXJhbUcgKz0gMC4wNSkge1xyXG4gICAgZm9yIChsZXQgcGFyYW1MID0gMDsgcGFyYW1MIDwgMS4wMTsgcGFyYW1MICs9IDAuMDUpIHtcclxuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcclxuICAgICAgICBldGFEYXRhLnB1c2goe1xyXG4gICAgICAgICAga2V5OiBcIs63XCIsXHJcbiAgICAgICAgICBsOiBwYXJhbUwsXHJcbiAgICAgICAgICBnOiBwYXJhbUcsXHJcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUV0YShwYXJhbUcsIHBhcmFtTCksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGV0YURhdGE7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xyXG4gIGFzcGVjdFJhdGlvOiAxLFxyXG4gIGNvbG9yOiB7XHJcbiAgICBsZWdlbmQ6IHRydWUsXHJcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcclxuICAgIGRvbWFpbjogWzAsIDFdLFxyXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICBsYWJlbDogXCJBYnNvbHV0ZSBVdGlsaXNhdGlvbiDOt1wiLFxyXG4gIH0sXHJcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxyXG4gIHk6IHtcclxuICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxyXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXHJcbiAgICBsYWJlbDogXCJTdGFrZSBHXCIsXHJcbiAgfSxcclxuICBtYXJrczogW1xyXG4gICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgUGxvdC5yZWN0KGV0YURhdGEsIHtcclxuICAgICAgeDE6IGQgPT4gZC5sIC0gMC4wMjUsXHJcbiAgICAgIHgyOiBkID0+IGQubCArIDAuMDI1LFxyXG4gICAgICB5MTogZCA9PiBkLmcgLSAwLjAyNSxcclxuICAgICAgeTI6IGQgPT4gZC5nICsgMC4wMjUsXHJcbiAgICAgIGZpbGw6IFwidmFsdWVcIixcclxuICAgIH0pLFxyXG4gICAgUGxvdC50ZXh0KGV0YURhdGEsIHtcclxuICAgICAgeDogXCJsXCIsXHJcbiAgICAgIHk6IFwiZ1wiLFxyXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgIFwiZW4tR0JcIixcclxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXHJcbiAgICAgICksXHJcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXHJcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFswLCAxXSwgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCkoZC52YWx1ZSksXHJcbiAgICAgICksXHJcbiAgICB9KSxcclxuICBdLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dFNfID0gSW5wdXRzLnJhbmdlKFswLCAxXSwge1xyXG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1RpbWUtTG9ja2VkIH0gU2AsXHJcbiAgc3RlcDogMC4wMSxcclxuICB2YWx1ZTogMC41LFxyXG59KTtcclxuXHJcbnZpZXdvZiBpbnB1dFdlaWdodEFHID0gSW5wdXRzLnJhbmdlKFswLCAxXSwge1xyXG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0xQIHNwbGl0fWAsXHJcbiAgc3RlcDogMC4wMSxcclxuICB2YWx1ZTogMC41LFxyXG59KTtcclxuXHJcbnBhcmFtV2VpZ2h0QVEgPSAxIC0gaW5wdXRXZWlnaHRBRztcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVUcmVhc3VyeShHLCBMKSB7XHJcbiAgcmV0dXJuIE1hdGgubWF4KDAsIDEgLSBjb21wdXRlVXBzaWxvbihHLCBMKSAqIGNvbXB1dGVFdGEoRywgTCkpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlSUJvbmRzKEcsIEwsIFMpIHtcclxuICBpZiAoRyA9PT0gMCAmJiBMID09PSAwKSB7XHJcbiAgICByZXR1cm4gMDtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIFMgKiBMKioyIC8gKEcqKjIgKyBMKioyKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbXB1dGVJU3Rha2luZyhHLCBMLCBTKSB7XHJcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiAoMSAtIFMpICogTCoqMiAvIChHKioyICsgTCoqMik7XHJcbiAgfVxyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlSVBvb2woRywgTCwgd2VpZ2h0KSB7XHJcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiB3ZWlnaHQgKiBHKioyIC8gKEcqKjIgKyBMKioyKTtcclxuICB9XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFsbG9jYXRpb25TUURhdGEgPSB7XHJcbiAgY29uc3QgYWxsb2NhdGlvblNRRGF0YSA9IFtdO1xyXG4gIGZvciAobGV0IHBhcmFtRyA9IDA7IHBhcmFtRyA8IDEuMDE7IHBhcmFtRyArPSAwLjEpIHtcclxuICAgIGZvciAobGV0IHBhcmFtTCA9IDA7IHBhcmFtTCA8IDEuMDE7IHBhcmFtTCArPSAwLjEpIHtcclxuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcclxuICAgICAgICBhbGxvY2F0aW9uU1FEYXRhLnB1c2goe1xyXG4gICAgICAgICAga2V5OiBcIvCdl5QgVGltZS1sb2NrcyBBbGxvY2F0aW9uXCIsXHJcbiAgICAgICAgICBsOiBwYXJhbUwsXHJcbiAgICAgICAgICBnOiBwYXJhbUcsXHJcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlCb25kcyhwYXJhbUcsIHBhcmFtTCwgaW5wdXRTXyksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYWxsb2NhdGlvblNRRGF0YS5wdXNoKHtcclxuICAgICAgICAgIGtleTogXCLwnZeaIFVzZXItbG9ja3MgQWxsb2NhdGlvblwiLFxyXG4gICAgICAgICAgbDogcGFyYW1MLFxyXG4gICAgICAgICAgZzogcGFyYW1HLFxyXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVJU3Rha2luZyhwYXJhbUcsIHBhcmFtTCwgaW5wdXRTXyksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGFsbG9jYXRpb25TUURhdGE7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGxvdEFsbG9jYXRpb25TUSA9IHtcclxuICBjb25zdCBwbG90QWxsb2NhdGlvblNRID0gUGxvdC5wbG90KHtcclxuICAgIGFzcGVjdFJhdGlvOiAxLFxyXG4gICAgY29sb3I6IHtcclxuICAgICAgbGVnZW5kOiB0cnVlLFxyXG4gICAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcclxuICAgICAgZG9tYWluOiBbMCwgMV0sXHJcbiAgICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxyXG4gICAgICBsYWJlbDogXCJBbGxvY2F0aW9uIElcIixcclxuICAgIH0sXHJcbiAgICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJMaXF1aWRpdHkgTFwiIH0sXHJcbiAgICB5OiB7XHJcbiAgICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxyXG4gICAgICBkb21haW46IFsxLjA1LCAtMC4wNV0sXHJcbiAgICAgIGxhYmVsOiBcIlN0YWtlIEdcIixcclxuICAgIH0sXHJcbiAgICBmeDogeyBsYWJlbDogbnVsbCB9LFxyXG4gICAgbWFya3M6IFtcclxuICAgICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgICBQbG90LnJlY3QoYWxsb2NhdGlvblNRRGF0YSwge1xyXG4gICAgICAgIHgxOiBkID0+IGQubCAtIDAuMDUsXHJcbiAgICAgICAgeDI6IGQgPT4gZC5sICsgMC4wNSxcclxuICAgICAgICB5MTogZCA9PiBkLmcgLSAwLjA1LFxyXG4gICAgICAgIHkyOiBkID0+IGQuZyArIDAuMDUsXHJcbiAgICAgICAgZng6IFwia2V5XCIsXHJcbiAgICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxyXG4gICAgICB9KSxcclxuICAgICAgUGxvdC50ZXh0KGFsbG9jYXRpb25TUURhdGEsIHtcclxuICAgICAgICB4OiBcImxcIixcclxuICAgICAgICB5OiBcImdcIixcclxuICAgICAgICBmeDogXCJrZXlcIixcclxuICAgICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgICAgXCJlbi1HQlwiLFxyXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxyXG4gICAgICAgICksXHJcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcclxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxyXG4gICAgICAgICksXHJcbiAgICAgIH0pLFxyXG4gICAgXSxcclxuICB9KTtcclxuXHJcbiAgZDMuc2VsZWN0KHBsb3RBbGxvY2F0aW9uU1EpXHJcbiAgICAuc2VsZWN0KFwiZ1thcmlhLWxhYmVsPSd5LWF4aXMgbGFiZWwnXVwiKVxyXG4gICAgLnNlbGVjdChcInRleHRcIilcclxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY2hhbmdlVHJhbnNsYXRpb24oMCwgMTApKTtcclxuXHJcbiAgcmV0dXJuIHBsb3RBbGxvY2F0aW9uU1E7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYWxsb2NhdGlvblBvb2xEYXRhID0ge1xyXG4gIGNvbnN0IGFsbG9jYXRpb25Qb29sRGF0YSA9IFtdO1xyXG4gIGZvciAobGV0IHBhcmFtRyA9IDA7IHBhcmFtRyA8IDEuMDE7IHBhcmFtRyArPSAwLjEpIHtcclxuICAgIGZvciAobGV0IHBhcmFtTCA9IDA7IHBhcmFtTCA8IDEuMDE7IHBhcmFtTCArPSAwLjEpIHtcclxuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcclxuICAgICAgICBhbGxvY2F0aW9uUG9vbERhdGEucHVzaCh7XHJcbiAgICAgICAgICBrZXk6IFwi8J2XlPCdl5ogUG9vbCBBbGxvY2F0aW9uXCIsXHJcbiAgICAgICAgICBsOiBwYXJhbUwsXHJcbiAgICAgICAgICBnOiBwYXJhbUcsXHJcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlQb29sKHBhcmFtRywgcGFyYW1MLCBpbnB1dFdlaWdodEFHKSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBhbGxvY2F0aW9uUG9vbERhdGEucHVzaCh7XHJcbiAgICAgICAgICBrZXk6IFwi8J2XlPCdl6QgUG9vbCBBbGxvY2F0aW9uXCIsXHJcbiAgICAgICAgICBsOiBwYXJhbUwsXHJcbiAgICAgICAgICBnOiBwYXJhbUcsXHJcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlQb29sKHBhcmFtRywgcGFyYW1MLCBwYXJhbVdlaWdodEFRKSxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gYWxsb2NhdGlvblBvb2xEYXRhO1xyXG59O1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBsb3RBbGxvY2F0aW9uUG9vbCA9IHtcclxuICBjb25zdCBwbG90QWxsb2NhdGlvblBvb2wgPSBQbG90LnBsb3Qoe1xyXG4gICAgYXNwZWN0UmF0aW86IDEsXHJcbiAgICBjb2xvcjoge1xyXG4gICAgICBsZWdlbmQ6IHRydWUsXHJcbiAgICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxyXG4gICAgICBkb21haW46IFswLCAxXSxcclxuICAgICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXHJcbiAgICAgIGxhYmVsOiBcIkFsbG9jYXRpb24gSVwiLFxyXG4gICAgfSxcclxuICAgIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkxpcXVpZGl0eSBMXCIgfSxcclxuICAgIHk6IHtcclxuICAgICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXHJcbiAgICAgIGRvbWFpbjogWzEuMDUsIC0wLjA1XSxcclxuICAgICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxyXG4gICAgfSxcclxuICAgIGZ4OiB7IGxhYmVsOiBudWxsIH0sXHJcbiAgICBtYXJrczogW1xyXG4gICAgICBQbG90LmZyYW1lKCksXHJcbiAgICAgIFBsb3QucmVjdChhbGxvY2F0aW9uUG9vbERhdGEsIHtcclxuICAgICAgICB4MTogZCA9PiBkLmwgLSAwLjA1LFxyXG4gICAgICAgIHgyOiBkID0+IGQubCArIDAuMDUsXHJcbiAgICAgICAgeTE6IGQgPT4gZC5nIC0gMC4wNSxcclxuICAgICAgICB5MjogZCA9PiBkLmcgKyAwLjA1LFxyXG4gICAgICAgIGZ4OiBcImtleVwiLFxyXG4gICAgICAgIGZpbGw6IFwidmFsdWVcIixcclxuICAgICAgfSksXHJcbiAgICAgIFBsb3QudGV4dChhbGxvY2F0aW9uUG9vbERhdGEsIHtcclxuICAgICAgICB4OiBcImxcIixcclxuICAgICAgICB5OiBcImdcIixcclxuICAgICAgICBmeDogXCJrZXlcIixcclxuICAgICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxyXG4gICAgICAgICAgXCJlbi1HQlwiLFxyXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxyXG4gICAgICAgICksXHJcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcclxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxyXG4gICAgICAgICksXHJcbiAgICAgIH0pLFxyXG4gICAgXSxcclxuICB9KTtcclxuXHJcbiAgZDMuc2VsZWN0KHBsb3RBbGxvY2F0aW9uUG9vbClcclxuICAgIC5zZWxlY3QoXCJnW2FyaWEtbGFiZWw9J3ktYXhpcyBsYWJlbCddXCIpXHJcbiAgICAuc2VsZWN0KFwidGV4dFwiKVxyXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigwLCAxMCkpO1xyXG5cclxuICByZXR1cm4gcGxvdEFsbG9jYXRpb25Qb29sO1xyXG59O1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InRyZWFzdXJ5RGF0YSA9IHtcclxuICBjb25zdCB0cmVhc3VyeURhdGEgPSBbXTtcclxuICBmb3IgKGxldCBwYXJhbUcgPSAwOyBwYXJhbUcgPCAxLjAxOyBwYXJhbUcgKz0gMC4wNSkge1xyXG4gICAgZm9yIChsZXQgcGFyYW1MID0gMDsgcGFyYW1MIDwgMS4wMTsgcGFyYW1MICs9IDAuMDUpIHtcclxuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcclxuICAgICAgICB0cmVhc3VyeURhdGEucHVzaCh7XHJcbiAgICAgICAgICBrZXk6IFwiSV9UXCIsXHJcbiAgICAgICAgICBsOiBwYXJhbUwsXHJcbiAgICAgICAgICBnOiBwYXJhbUcsXHJcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZVRyZWFzdXJ5KHBhcmFtRywgcGFyYW1MKSxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gdHJlYXN1cnlEYXRhO1xyXG59O1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XHJcbiAgYXNwZWN0UmF0aW86IDEsXHJcbiAgY29sb3I6IHtcclxuICAgIGxlZ2VuZDogdHJ1ZSxcclxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxyXG4gICAgZG9tYWluOiBbMCwgMV0sXHJcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcclxuICAgIGxhYmVsOiBcIkFsbG9jYXRpb24gSVwiLFxyXG4gIH0sXHJcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxyXG4gIHk6IHtcclxuICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxyXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXHJcbiAgICBsYWJlbDogXCJTdGFrZSBHXCIsXHJcbiAgfSxcclxuICBtYXJrczogW1xyXG4gICAgUGxvdC5mcmFtZSgpLFxyXG4gICAgUGxvdC5yZWN0KHRyZWFzdXJ5RGF0YSwge1xyXG4gICAgICB4MTogZCA9PiBkLmwgLSAwLjAyNSxcclxuICAgICAgeDI6IGQgPT4gZC5sICsgMC4wMjUsXHJcbiAgICAgIHkxOiBkID0+IGQuZyAtIDAuMDI1LFxyXG4gICAgICB5MjogZCA9PiBkLmcgKyAwLjAyNSxcclxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxyXG4gICAgfSksXHJcbiAgICBQbG90LnRleHQodHJlYXN1cnlEYXRhLCB7XHJcbiAgICAgIHg6IFwibFwiLFxyXG4gICAgICB5OiBcImdcIixcclxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcclxuICAgICAgICBcImVuLUdCXCIsXHJcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxyXG4gICAgICApLFxyXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxyXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxyXG4gICAgICApLFxyXG4gICAgfSksXHJcbiAgXSxcclxufSlcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0Q2kwJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0TGlxU2hhcGUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREZWx0YUNpJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RXQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREZWx0YUJhckNpJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RGVsdGFCYXJDbnVsbCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dERlbHRhQScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dERlbHRhQ2luaXRpYWwnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBVmFsdWUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBU3VwcGx5JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0UHJlc2VudFRvbm5lcycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dERlbHRhVG9ubmVzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0QWknKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRHaScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEFWYWx1ZV8nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBU3VwcGx5XycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dExpcXVpZFRvbm5lcycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEFCdXJudCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFAwJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0VCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFNfJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0V2VpZ2h0QUcnKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/whitepaper\.klima\.leodesouza\.net");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>