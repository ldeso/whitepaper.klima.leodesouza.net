<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="The Dark Sole Enterprise Ltd ds@darksole.vip with contributions from the Klima and Carbonmark teams">

<title>Klima 2.0</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./brand/favicon.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link rel="icon" type="image/png" sizes="96x96" href="./brand/favicon-96x96.png">
<link rel="shortcut icon" href="./brand/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="./brand/apple-touch-icon.png">

  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Klima 2.0">
<meta property="og:description" content="This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.
The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.
The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.
This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.">
<meta property="og:image" content="https://whitepaper.klima.leodesouza.net/brand/klimaprotocol.svg">
<meta property="og:image:alt" content="Klima Protocol Logo.">
<meta name="twitter:title" content="Klima 2.0">
<meta name="twitter:description" content="This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.
The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.
The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.
This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.">
<meta name="twitter:image" content="https://whitepaper.klima.leodesouza.net/brand/klimaprotocol.svg">
<meta name="twitter:image:alt" content="Klima Protocol Logo.">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-prologue" id="toc-sec-prologue" class="nav-link active" data-scroll-target="#sec-prologue"><span class="header-section-number">1</span> Prologue</a></li>
  <li><a href="#sec-klima-2.0" id="toc-sec-klima-2.0" class="nav-link" data-scroll-target="#sec-klima-2.0"><span class="header-section-number">2</span> Klima&nbsp;2.0</a>
  <ul class="collapse">
  <li><a href="#sec-protocol-tokens" id="toc-sec-protocol-tokens" class="nav-link" data-scroll-target="#sec-protocol-tokens"><span class="header-section-number">2.1</span> Protocol Tokens</a></li>
  <li><a href="#sec-high-level-architecture" id="toc-sec-high-level-architecture" class="nav-link" data-scroll-target="#sec-high-level-architecture"><span class="header-section-number">2.2</span> High-Level Architecture</a></li>
  <li><a href="#sec-incentives-and-participation" id="toc-sec-incentives-and-participation" class="nav-link" data-scroll-target="#sec-incentives-and-participation"><span class="header-section-number">2.3</span> Incentives and Participation</a></li>
  <li><a href="#sec-carbon-inventory" id="toc-sec-carbon-inventory" class="nav-link" data-scroll-target="#sec-carbon-inventory"><span class="header-section-number">2.4</span> Carbon Inventory</a></li>
  <li><a href="#sec-tokens" id="toc-sec-tokens" class="nav-link" data-scroll-target="#sec-tokens"><span class="header-section-number">2.5</span> Tokens</a></li>
  <li><a href="#sec-token-initialisation" id="toc-sec-token-initialisation" class="nav-link" data-scroll-target="#sec-token-initialisation"><span class="header-section-number">2.6</span> Token Initialisation</a></li>
  <li><a href="#sec-participants" id="toc-sec-participants" class="nav-link" data-scroll-target="#sec-participants"><span class="header-section-number">2.7</span> Participants</a></li>
  <li><a href="#sec-protocol-design-principles" id="toc-sec-protocol-design-principles" class="nav-link" data-scroll-target="#sec-protocol-design-principles"><span class="header-section-number">2.8</span> Protocol Design Principles</a></li>
  </ul></li>
  <li><a href="#sec-core-protocol-layers" id="toc-sec-core-protocol-layers" class="nav-link" data-scroll-target="#sec-core-protocol-layers"><span class="header-section-number">3</span> Core Protocol Layers</a>
  <ul class="collapse">
  <li><a href="#sec-time-locking-mechanics" id="toc-sec-time-locking-mechanics" class="nav-link" data-scroll-target="#sec-time-locking-mechanics"><span class="header-section-number">3.1</span> Time-locking Mechanics</a></li>
  <li><a href="#sec-portfolio-manager-detailed" id="toc-sec-portfolio-manager-detailed" class="nav-link" data-scroll-target="#sec-portfolio-manager-detailed"><span class="header-section-number">3.2</span> Portfolio Manager</a></li>
  <li><a href="#sec-liquidity-markets" id="toc-sec-liquidity-markets" class="nav-link" data-scroll-target="#sec-liquidity-markets"><span class="header-section-number">3.3</span> Liquidity Markets</a></li>
  <li><a href="#sec-interactive-model" id="toc-sec-interactive-model" class="nav-link" data-scroll-target="#sec-interactive-model"><span class="header-section-number">3.4</span> Interactive Model</a></li>
  </ul></li>
  <li><a href="#sec-klima-2.0-token-distribution" id="toc-sec-klima-2.0-token-distribution" class="nav-link" data-scroll-target="#sec-klima-2.0-token-distribution"><span class="header-section-number">4</span> Klima&nbsp;2.0 Token Distribution</a>
  <ul class="collapse">
  <li><a href="#sec-planned-allocations" id="toc-sec-planned-allocations" class="nav-link" data-scroll-target="#sec-planned-allocations"><span class="header-section-number">4.1</span> Planned Allocations</a></li>
  <li><a href="#sec-programmatic-incentive-curve" id="toc-sec-programmatic-incentive-curve" class="nav-link" data-scroll-target="#sec-programmatic-incentive-curve"><span class="header-section-number">4.2</span> Programmatic Incentive Curve</a></li>
  <li><a href="#sec-incentive-allocations" id="toc-sec-incentive-allocations" class="nav-link" data-scroll-target="#sec-incentive-allocations"><span class="header-section-number">4.3</span> Incentive Allocations</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="index.md"><i class="bi bi-file-text"></i>Markdown (for LLMs)</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Klima 2.0</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p></p><p>The Dark Sole Enterprise Ltd <a href="mailto:ds@darksole.vip" class="email">ds@darksole.vip</a><br>
with contributions from the Klima and Carbonmark teams</p> <p></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">23 Jan 2026 (Version 1.48)</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Notice to Readers</div>
    <p>This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.<br>
    The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.<br>
    The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.<br>
    This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.</p>
  </div>
</div>


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="brand/klimaprotocol.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%" alt="Klima Protocol Logo."></p>
</figure>
</div>
<p><strong>Copyright Notice</strong></p>
<p>This document represents original work by dark_sole <a href="mailto:ds@darksole.vip" class="email">ds@darksole.vip</a>. While contributions from others are gratefully acknowledged, all intellectual property rights remain with the author. The models, algorithms, processes, products, methodologies, and concepts described herein are licenced exclusively for commercial use by the Klima Protocol. No other party may implement, copy, modify, or derive works from these materials without explicit written permission from the author.</p>
<p>© 2025 dark_sole. All rights reserved.</p>
<section id="sec-prologue" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="sec-prologue"><span class="header-section-number">1</span> Prologue</h2>
<p>Klima&nbsp;2.0 is an autonomous, rules-based coordination protocol designed to support the retirement of carbon credits through transparent pricing, continuous execution, and onchain settlement.</p>
<p>It is not a financial product, investment vehicle, or asset management system, but a piece of market infrastructure that enables carbon supply and retirement demand to interact under predefined conditions.</p>
<p>The protocol operates through a dual-token architecture that facilitates coordination without discretionary control: <strong>kVCM</strong> functions as the internal unit of account and pricing reference for protocol-facilitated carbon retirement, while <strong>K2</strong> provides signalling inputs related to system capacity. Together, these tokens inform protocol parameters through deterministic smart-contract logic. This architecture enables the protocol to:</p>
<ul>
<li><p>price and intake eligible, tokenised carbon credits according to transparent, onchain rules;</p></li>
<li><p>make acquired credits available exclusively for irreversible retirement;</p></li>
<li><p>coordinate liquidity provision and participation incentives required for continuous operation.</p></li>
</ul>
<p>Participant actions such as locking tokens, signalling preferences, or providing liquidity serve as non-custodial inputs into a coordination mechanism that adjusts protocol parameters within predefined bounds. These inputs do not confer ownership rights, redemption rights, or claims on protocol-held carbon, nor do they constitute discretionary management of assets.</p>
<p>The protocol consists of three interdependent functional layers:</p>
<ul>
<li><p>a carbon inventory layer that holds credits solely for the purpose of facilitating retirement;</p></li>
<li><p>a governance layer that aggregates participant signals to inform pricing and intake parameters; and</p></li>
<li><p>a liquidity layer that supports entry and exit from the system through external markets.</p></li>
</ul>
<p>These layers are designed to operate together as a self-contained system, adjusting to observable supply and retirement demand without reliance on external oracles, manual intervention, or fee-extractive intermediaries.</p>
<p>Klima&nbsp;2.0 abstracts complex carbon market interactions into a transparent and auditable execution framework, enabling participants to interact with carbon retirement infrastructure directly, programmatically, and on equal terms.</p>
<p>Any economic effects arising from protocol activity result from predefined rules and market interaction, rather than from asset ownership, portfolio management, or profit extraction.</p>
</section>
<section id="sec-klima-2.0" class="level2 page-columns page-full" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="sec-klima-2.0"><span class="header-section-number">2</span> Klima&nbsp;2.0</h2>
<p>KlimaDAO launched in 2021 on the Polygon blockchain as an early experiment in applying tokenisation and onchain liquidity to voluntary carbon markets. The initial design centred on the KLIMA token and a treasury-based mechanism intended to bootstrap liquidity and participation in a nascent onchain carbon ecosystem.</p>
<p>That first iteration played a meaningful role in demonstrating that carbon credits could be represented, transferred, and retired using blockchain infrastructure. It also catalysed the development of a broader ecosystem of tools and services, including integrations with multiple carbon registries, marketplaces and point-of-sale interfaces, APIs for third-party applications, and direct onchain issuance by project developers.</p>
<p>Over time, it became clear that the original architecture was not well suited to serving large-scale, enterprise carbon buyers or to supporting continuous, rules-based market operation without manual intervention. In particular, treasury-centric designs introduced complexity, opacity, and governance challenges that limited scalability and operational clarity.</p>
<p>Klima&nbsp;2.0 is a ground-up redesign informed by these lessons. Rather than relying on treasury management or discretionary allocation, the new protocol is structured as neutral, non-extractive market infrastructure focused exclusively on facilitating carbon retirement through transparent pricing, programmatic settlement, and open participation.</p>
<p>The Klima&nbsp;2.0 protocol replaces treasury-backed mechanisms with a rules-based coordination model that uses protocol-native tokens to parameterise pricing bounds, intake capacity, and participation incentives. Carbon credits handled by the protocol are acquired solely to fulfil retirement demand and are not held, traded, or managed for financial gain.</p>
<p>This shift reflects a deliberate move away from capital-centric designs toward infrastructure that prioritises auditability, predictability, and long-term operational resilience. Klima&nbsp;2.0 is intended to function as a shared execution layer for carbon markets, enabling suppliers, buyers, and integrators to interact under predefined conditions without reliance on discretionary intermediaries.</p>
<section id="sec-protocol-tokens" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="sec-protocol-tokens"><span class="header-section-number">2.1</span> Protocol Tokens</h3>
<p>Klima&nbsp;2.0 operates using two protocol-native tokens, <strong>kVCM</strong> and <strong>K2</strong>, which together enable rules-based coordination of pricing, capacity, and participation within the system. These tokens do not confer ownership rights, redemption rights, or claims on protocol-handled carbon, and do not represent investment interests.</p>
<p><strong>kVCM</strong> functions as the internal unit of account and pricing reference for protocol-facilitated carbon retirement, while <strong>K2</strong> provides signalling inputs related to system capacity. Both tokens are used exclusively to parameterise protocol behaviour through deterministic smart-contract logic.</p>
<p><strong>kVCM</strong> tokens set core allocation choices, whereas <strong>K2</strong> acts as the calibration mechanism for inventory development.</p>
</section>
<section id="sec-high-level-architecture" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="sec-high-level-architecture"><span class="header-section-number">2.2</span> High-Level Architecture</h3>
<p>Klima&nbsp;2.0 is composed of three interdependent functional layers that together support continuous, non-discretionary operation:</p>
<ol type="1">
<li><p><strong>Carbon Inventory Layer</strong>:</p>
<ul>
<li>Accumulates carbon credits by minting <strong>kVCM</strong>.</li>
<li>Sells carbon certificates by burning <strong>kVCM</strong>.</li>
<li>Prices carbon based on the system’s code.</li>
</ul>
<p>Carbon credits handled by the protocol cannot be withdrawn, transferred, or resold.</p></li>
<li><p><strong>Governance Layer</strong>:</p>
<ul>
<li><strong>kVCM</strong> holders may <strong>time-lock</strong> their <strong>kVCM</strong> for a fixed time period and become eligible to select carbon assets for the inventory.</li>
<li>This action creates a <strong>kVCM</strong> Base Accrual curve, which is distributed to the time-locked holders. This is utilised to derive discount rates and governance weightings.</li>
</ul></li>
<li><p><strong>Liquidity Layer</strong>:</p>
<ul>
<li><strong>kVCM</strong> and <strong>K2</strong> holders are able to pair their tokens together, or in the case of <strong>kVCM</strong> with USDC, in order to generate liquidity fees.</li>
<li>Staking the resulting liquidity provider tokens may generate a share of protocol incentives.</li>
<li>Liquidity locked in the <strong>kVCM</strong>/<strong>K2</strong> liquidity pool participates in general governance alongside time-locked <strong>kVCM</strong> holders.</li>
</ul></li>
</ol>
<p>These layers operate together as a self-contained system that responds only to its own observable state, without reliance on external oracles or centralised intervention.</p>
</section>
<section id="sec-incentives-and-participation" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="sec-incentives-and-participation"><span class="header-section-number">2.3</span> Incentives and Participation</h3>
<p>The protocol issues incentives to participants who provide defined services necessary for system operation.</p>
<section id="sec-kvcm-incentives" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="sec-kvcm-incentives"><span class="header-section-number">2.3.1</span> kVCM Incentives</h4>
<p><strong>kVCM</strong> incentives are continuously emitted to:</p>
<ol type="1">
<li><p>Time-locked <strong>kVCM</strong> (‘<strong>kVCM</strong> Base Accrual’).</p></li>
<li><p>User-locked <strong>K2</strong>.</p></li>
<li><p>Both <strong>kVCM</strong> and <strong>K2</strong> liquidity providers.</p></li>
</ol>
</section>
<section id="sec-k2-incentives" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="sec-k2-incentives"><span class="header-section-number">2.3.2</span> K2 Incentives</h4>
<p>The supply of K2 is allocated to stakeholders at various rates, depending on overall system balances:</p>
<ol type="1">
<li><p>Time-locked <strong>kVCM</strong>.</p></li>
<li><p>User-locked <strong>K2</strong>.</p></li>
<li><p>Both <strong>kVCM</strong> and <strong>K2</strong> liquidity providers.</p></li>
</ol>
</section>
</section>
<section id="sec-carbon-inventory" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="sec-carbon-inventory"><span class="header-section-number">2.4</span> Carbon Inventory</h3>
<p>The protocol’s carbon inventory layer accumulates and distributes carbon. It is driven by parameters determined by its rules-based smart contracts, and token holder actions.</p>
<div id="fig-carbon-inventory" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 Carbon Inventory.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-inventory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/carbon-inventory.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-inventory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Klima&nbsp;2.0 Carbon Inventory.
</figcaption>
</figure>
</div>
<p>Carbon credits are acquired from suppliers, and consumed by offset buyers. Carbon credits are grouped by pre-defined classifications called <strong>carbon classes</strong>. The protocol does <u>not</u> sell carbon credits.</p>
<p>Aggregate token holder allocations collectively set the parameters for the pricing of <strong>each class</strong> by defining:</p>
<ul>
<li><p>Inventory weighting.</p></li>
<li><p>Capacity.</p></li>
</ul>
<p>Additional <strong>global</strong> parameters are also determined by the aggregate allocations, including the <strong>kVCM</strong> incentive curve.</p>
<p>There are no oracles or external inputs required for Klima&nbsp;2.0 as it is fully autonomous and responds to its own native state of token balances.</p>
<p>The protocol does not facilitate the trading of unretired carbon credits and does not engage in discretionary allocation, resale, or optimisation of carbon inventory.</p>
</section>
<section id="sec-tokens" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="sec-tokens"><span class="header-section-number">2.5</span> Tokens</h3>
<p>Locking or staking the protocol’s tokens allows participants to signal pricing preferences and capacity parameters within the protocol. However, holding or locking the tokens does not represent risk ownership, profit participation, or exposure to carbon price movements. Participants may receive protocol incentives for performing defined coordination functions, distributed according to transparent, rules-based mechanisms.</p>
<p>Together, <strong>kVCM</strong> and <strong>K2</strong> enable the protocol to operate as neutral, non-extractive infrastructure, coordinating participation and execution without discretionary management.</p>
<section id="sec-kvcm" class="level4" data-number="2.5.1">
<h4 data-number="2.5.1" class="anchored" data-anchor-id="sec-kvcm"><span class="header-section-number">2.5.1</span> kVCM</h4>
<p><strong>kVCM</strong> is the protocol’s primary utility token. Its supply is <u>not capped</u>: it grows when new carbon is supplied to the protocol, and contracts when it is retired.</p>
<ul>
<li><p>When <strong>time-locked</strong>:</p>
<ul>
<li><p>It <em>may</em> vote for carbon classes for inventory weighting.</p></li>
<li><p>It receives <strong>kVCM</strong> base accrual and <strong>K2</strong> incentives.</p></li>
<li><p>In aggregate, it determines the rate of incentive issuance.</p></li>
</ul></li>
<li><p><strong>Transactional</strong> usage:</p>
<ul>
<li><p><strong>Mint</strong>: when suppliers deliver carbon to the protocol.</p></li>
<li><p><strong>Burn</strong>: when credits are retired from the protocol.</p></li>
</ul></li>
<li><p>When <strong>staked</strong> in liquidity pools it is also eligible for incentives, based on the position’s relative share.</p></li>
</ul>
<div id="fig-token-utility" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token utility.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-utility.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Token utility.
</figcaption>
</figure>
</div>
</section>
<section id="sec-k2" class="level4" data-number="2.5.2">
<h4 data-number="2.5.2" class="anchored" data-anchor-id="sec-k2"><span class="header-section-number">2.5.2</span> K2</h4>
<p><strong>K2</strong> is a <u>fixed-supply</u> token distributed programmatically over time.</p>
<ul>
<li><p>When <strong>user-locked</strong>:</p>
<ul>
<li><p>It <em>may</em> vote for carbon classes to reduce the difference between execution terms on carbon intake and retirements.</p></li>
<li><p>It receives <strong>kVCM</strong> and <strong>K2</strong> incentives.</p></li>
<li><p>In aggregate, it influences the rates of incentive issuance.</p></li>
</ul></li>
<li><p>When <strong>staked</strong> in the kVCM/K2 liquidity pool it is also eligible for incentives, based on the position’s relative share.</p></li>
</ul>
</section>
<section id="sec-utility-functions" class="level4" data-number="2.5.3">
<h4 data-number="2.5.3" class="anchored" data-anchor-id="sec-utility-functions"><span class="header-section-number">2.5.3</span> Utility Functions</h4>
<p>The <strong>kVCM</strong> token has <u>two</u> utility functions which are not independent:</p>
<div id="fig-kvcm-utility" class="quarto-float quarto-figure quarto-figure-center anchored" alt="kVCM utility functions.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kvcm-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/kvcm-utility.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kvcm-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: <strong>kVCM</strong> utility functions.
</figcaption>
</figure>
</div>
<ol type="1">
<li><p><strong>Time lock</strong>: The <strong>kVCM</strong> token is locked for a specific period of time which determines a kVCM ‘base accrual’ rate. This cannot be amended.</p></li>
<li><p><strong>Price allocation</strong>: Collective selection of carbon classes by <strong>kVCM</strong> allocations determines the <strong>real-time</strong> execution ratio for carbon intake and retirements, in kVCM terms. This selection can be amended and withdrawn at any time to allow modulation of protocol parameters.</p></li>
</ol>
<p>The <strong>K2</strong> token also has <u>two</u> utility functions:</p>
<ol type="1">
<li><p><strong>User lock</strong>: The <strong>K2</strong> token remains locked for at least 24 hours.</p></li>
<li><p><strong>Capacity allocation</strong>: Collective selection of carbon classes by <strong>K2</strong> allocations determines the rate of issuance or retirement of <strong>kVCM</strong> for the specified carbon class. More capacity allocations on a given carbon class reduce the impact that new transactions have on the execution ratio created by price allocations.</p></li>
</ol>
<p>Both tokens facilitate the carbon market to function efficiently, with the <strong>kVCM</strong> token responsible for setting execution ratios, and the <strong>K2</strong> token modulating capacity.</p>
</section>
</section>
<section id="sec-token-initialisation" class="level3 page-columns page-full" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="sec-token-initialisation"><span class="header-section-number">2.6</span> Token Initialisation</h3>
<p>There is an initial issuance of tokens at the genesis of Klima&nbsp;2.0. All future emissions are distributed autonomously via incentives.</p>
<div id="tbl-token-summary" class="column-body-outset quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[10,15,75]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-token-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Token</th>
<th style="text-align: left;">Supply</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>kVCM</strong></td>
<td style="text-align: left;">20 million</td>
<td style="text-align: left;"><ul>
<li>Supply expands and contracts programmatically in response to carbon intake and retirement activity.</li>
<li>A portion of the initial supply is allocated to existing KLIMA holders.</li>
</ul></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>K2</strong></td>
<td style="text-align: left;">100 million</td>
<td style="text-align: left;"><ul>
<li>Fixed supply.</li>
<li>Distributed programatically over time, with a portion allocated to existing KLIMA holders.</li>
</ul></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-token-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Token Summary
</figcaption>
</figure>
</div>
<p><strong>kVCM</strong> is issued when carbon credits are supplied to the protocol for the purpose of facilitating future retirement, and permanently removed from circulation when carbon is retired. This mint-and-burn process serves as an internal accounting mechanism and does not represent asset ownership or claims on protocol-held carbon.</p>
</section>
<section id="sec-participants" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="sec-participants"><span class="header-section-number">2.7</span> Participants</h3>
<ol type="1">
<li><p><strong>Carbon Suppliers &amp; Retirees</strong></p>
<p>Participants may supply or retire eligible, tokenised carbon credits to the protocol at quoted execution rates. Supplied credits are handled solely for retirement and cannot be withdrawn, transferred, resold or otherwise arbitraged.</p>
<p><strong>Carbon inventory</strong>: Real-time execution terms for suppliers are continuously updated based on protocol token balances.</p></li>
<li><p><strong>Liquidity Providers</strong></p>
<p>Participants may provide liquidity in supported token pairs to facilitate entry and exit from the system. Liquidity provision supports continuous execution and is incentivised according to predefined protocol rules.</p>
<p><strong>Staked liquidity</strong>: Provides continuous incentives for those contributing liquidity to the system.</p></li>
<li><p><strong>Governance Users</strong></p>
<p>Participants who wish to affect carbon price and capacity may do so by allocating <strong>kVCM</strong> and <strong>K2</strong> tokens.</p>
<p><strong>Time locks &amp; user locks</strong>: Provide continuous incentives for those contributing activities that coordinate the protocol.</p></li>
</ol>
</section>
<section id="sec-protocol-design-principles" class="level3" data-number="2.8">
<h3 data-number="2.8" class="anchored" data-anchor-id="sec-protocol-design-principles"><span class="header-section-number">2.8</span> Protocol Design Principles</h3>
<ol type="1">
<li><p><strong>Infrastructure, Not Extraction</strong>:</p>
<p>Klima&nbsp;2.0 is designed as shared market infrastructure rather than an extractive financial product. The protocol does not charge fees, take spreads, or operate profit-taking mechanisms for any sponsor, foundation, or investor. All protocol behaviour is rules-based and applies uniformly to all participants, with no privileged economic positions or revenue capture layers.</p>
<p><strong>Design intent</strong>: Reduce opaque intermediation and hidden margins common in carbon markets, not replace them with a new rent-seeking intermediary.</p></li>
<li><p><strong>Consumption-only Carbon Access</strong>:</p>
<p>Carbon credits handled by the protocol are not exposed for resale, speculation, or secondary trading. Once accepted by the protocol, credits may only be accessed for irreversible retirement through protocol-defined processes.</p>
<p><strong>Design intent</strong>: Align the system with carbon’s end use (retirement), rather than treating credits as financial instruments.</p></li>
<li><p><strong>Coordination Through Signalling</strong>:</p>
<p>Protocol tokens do not represent ownership of carbon, claims on protocol-held assets, or entitlement to surplus value. Instead, tokens function as signalling and coordination inputs that influence protocol parameters&nbsp;(such as execution conditions and capacity) within predefined bounds.</p>
<p><strong>Design intent</strong>: Enable decentralised coordination in a complex and competitive environment.</p></li>
<li><p><strong>Autonomous, Rules-based Operation</strong></p>
<p>All protocol behaviour — including pricing logic, intake conditions, retirement execution, and incentive distribution — is governed by deterministic smart contracts. Once deployed, the system operates autonomously and does not rely on discretionary decisions by any individual, committee, or organisation.</p>
<p><strong>Design intent</strong>: Build a trustless, auditable system, that is not based on subjective, opaque intervention.</p></li>
<li><p><strong>Equal Access and Uniform Treatment</strong></p>
<p>All participants interact with the protocol on identical terms. There are no side agreements, preferential execution paths, differentiated rights, or bespoke economic arrangements. Protocol rules apply uniformly to all users, including the protocol’s creators and affiliated entities.</p>
<p><strong>Design intent</strong>: Ensure credibility, neutrality, and resistance to capture.</p></li>
<li><p><strong>Market-driven Outcomes, Not Managed returns</strong></p>
<p>Any economic effects associated with protocol participation arise solely from predefined rules and participant interaction with the system. The protocol does not manage assets on behalf of users, target returns, or seek to optimise outcomes for any class of participant.</p>
<p><strong>Design intent</strong>: Enable transparent market coordination without positioning the protocol as an asset manager or investment vehicle</p></li>
</ol>
</section>
</section>
<section id="sec-core-protocol-layers" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="sec-core-protocol-layers"><span class="header-section-number">3</span> Core Protocol Layers</h2>
<p>From this section we refer to <strong>kVCM</strong> tokens as <strong>A</strong>, <strong>K2</strong> tokens as <strong>G</strong>, USDC tokens as <strong>Q</strong>, carbon credits as <strong>C</strong>, and carbon offset certificates as <strong>C*</strong>.</p>
<p>Three layers enable the Klima Protocol to find equilibrium through continuous dynamic feedback loops and overall system balances&nbsp;(supply, demand, token holder positions). There is no centralised management entity with discretionary powers, or fees that can be turned on.</p>
<ol type="1">
<li><p><strong>Carbon inventory layer</strong>: the protocol swaps <strong>A</strong> for carbon credits <strong>C</strong>&nbsp;(in) or carbon offset certificates <strong>C*</strong>&nbsp;(out).</p>
<ul>
<li>Both allocations of time-locked <strong>A</strong> tokens and user-locked <strong>G</strong> tokens are used in the protocol: allocations of <strong>A</strong> determine the pricing of carbon, and allocations of <strong>G</strong> determine capacity.</li>
</ul></li>
<li><p><strong>Governance layer</strong>: <strong>A</strong> token holders can time-lock their tokens until a set date to define system parameters and to have the ability to select carbon classes for system weighting.</p>
<ul>
<li>The collective locks influence the <strong>A</strong> rewards, as well as the real-time execution price for carbon credit acquisitions or retirements.</li>
</ul></li>
<li><p><strong>Liquidity layer</strong>: External liquidity pools enable conversion between <strong>kVCM</strong> and supported settlement assets. Liquidity provision supports system availability and users may receive incentivises through the transparent, rule-based approach.</p>
<ul>
<li><p><span class="overline"><strong>AG</strong></span> liquidity pool: Native token swap <strong>A</strong> and <strong>G</strong>.</p></li>
<li><p><span class="overline"><strong>AQ</strong></span> liquidity pool: The asset token <strong>A</strong> with USDC <strong>Q</strong>.</p></li>
</ul></li>
</ol>
<p>The Klima system enables each participant to contribute to various aspects of the model, in the interests of their own utility. This, in conjunction with the autonomous model, enables the protocol to fulfill its mandate of facilitating retirement demand into the carbon markets.</p>
<section id="sec-time-locking-mechanics" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="sec-time-locking-mechanics"><span class="header-section-number">3.1</span> Time-locking Mechanics</h3>
<p>Time-locking <strong>A</strong> tokens represents a non-custodial commitment to protocol participation for a fixed duration. Lock durations are standardised at 90 days increments and expire on a rolling schedule. There are always 40 durations, extending out to approximately 10 years.</p>
<ul>
<li><p><strong>Discount curve</strong>: Aggregate time-locking determines the shape of the discount curve of the <strong>A</strong> token with regards to execution prices.</p></li>
<li><p><strong>Incentives</strong>: Time-locked <strong>A</strong> tokens may receive incentives, with a rate determined by the base accrual. The base accrual is calculated daily based on user positions, via the ‘time-weighted incentive curve’.</p></li>
<li><p><strong>Locks</strong>: Time-locked tokens and any associated <strong>A</strong> incentives are released only upon time-lock expiration. Early exit is not possible.</p></li>
</ul>
<p><strong>G</strong> tokens are <u>not</u> involved in the time-locking mechanics. The discount curve is agnostic to carbon class although only time-locked <strong>A</strong> token holders can allocate their token to carbon classes for portfolio pricing.</p>
<section id="sec-time-weighted-incentive-curve" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="sec-time-weighted-incentive-curve"><span class="header-section-number">3.1.1</span> Time-weighted Incentive Curve</h4>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">S</span>: Total time-locked <strong>A</strong> tokens expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
<li><p><span class="math inline">S_t</span>: Total <strong>A</strong> tokens time-locked in bucket <span class="math inline">t</span>, expressed as a proportion of the outstanding supply of <strong>A</strong>, where <span class="math inline">{\sum S_t = S}</span>, and <span class="math inline">t</span> is the index of standard durations <span class="math inline">t \in \{1, 2, 3, \dots, 40\}</span>.</p></li>
<li><p><span class="math inline">E_t</span>: Duration expressed in years.</p></li>
</ul>
<p>Calculating curve parameters <span class="math inline">D</span> and <span class="math inline">C</span>:</p>
<p><span id="eq-curve-parameter-d"><span class="math display">
D = \frac{1}{S} \sum_{t=1}^{40} S_t \, E_t
\tag{1}</span></span></p>
<p><span id="eq-curve-parameter-c"><span class="math display">
C = \frac{1}{S} \sum_{t=1}^{40} S_t \, E_t^2
\tag{2}</span></span></p>
<p>The shape of the time-weighted incentive curve is produced:</p>
<p><span id="eq-time-weighted-incentive-curve-shape"><span class="math display">
\gamma_t = \max \left( \frac{E_t}{D} - \frac{E_t^2}{2 \, C}, \, 0 \right)
\tag{3}</span></span></p>
<p>Normalising <span class="math inline">\gamma_t</span> to <span class="math inline">\hat \gamma_t</span>:</p>
<p><span id="eq-time-weighted-incentive-curve-normalised"><span class="math display">
\hat \gamma_t = \frac{\gamma_t}{\sum_{t=1}^{40} \gamma_t}
\tag{4}</span></span></p>
<p>With the cumulative sum of the normalised values expressed as <span class="math inline">\Gamma_t</span>:</p>
<p><span id="eq-time-weighted-incentive-curve-normalized-sum"><span class="math display">
\Gamma_t = \sum_{i=1}^t \hat \gamma_i \quad \text{for } t = 1, \dots, 40
\tag{5}</span></span></p>
<p>The time-weighted incentive curve <span class="math inline">Z_t</span> is solved:</p>
<p><span id="eq-time-weighted-incentive-curve"><span class="math display">
Z_t = (1 - S) \, \frac{\Gamma_t}{E_t}
\tag{6}</span></span></p>
<p>Whereupon, the discount rate <span class="math inline">B_t</span> that forms the discount curve is derived:</p>
<p><span id="eq-discount-rate"><span class="math display">
B_t = \exp(-Z_t \, E_t)
\tag{7}</span></span></p>
<p>The incentives due on time-locked <strong>A</strong> tokens are calculated daily and added to the locked principal, hence the daily accrual for each duration is calculated:</p>
<p><span id="eq-daily-time-weighted-incentives"><span class="math display">
Y_t = \exp \left( \frac{Z_t}{365} \right) - 1
\tag{8}</span></span></p>
<p>Hence, any time-locked <strong>A</strong> stake <span class="math inline">S_t</span> will increase by a base accrual <span class="math inline">\Delta S_t</span>:</p>
<p><span id="eq-base-accrual"><span class="math display">
\Delta S_t = S_t \, Y_t
\tag{9}</span></span></p>
<p>With the total <strong>A</strong> tokens created on a daily basis for time-locked inflation as</p>
<p><span id="eq-inflation"><span class="math display">
R = \sum_{t=1}^{40} \Delta S_t
\tag{10}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="631" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 630;"><span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a>viewof inputS <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-4</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Time-Locked } S`</span><span class="op">,</span></span>
<span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-4</span><span class="op">,</span></span>
<span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.55</span><span class="op">,</span></span>
<span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-636"><a href="#cb1-636" aria-hidden="true" tabindex="-1"></a>viewof inputD <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.25</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {</span>
<span id="cb1-637"><a href="#cb1-637" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Parameter } D`</span><span class="op">,</span></span>
<span id="cb1-638"><a href="#cb1-638" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb1-639"><a href="#cb1-639" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">4.69</span><span class="op">,</span></span>
<span id="cb1-640"><a href="#cb1-640" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-time-locked-incentives-example" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-time-locked-incentives-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="651" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 650;"><span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">constAreaLinear</span>(range<span class="op">,</span> area<span class="op">,</span> inputSlope<span class="op">,</span> slopeFactor <span class="op">=</span> <span class="fl">0.007</span>) {</span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (range<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [area]<span class="op">;</span></span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y2 <span class="op">=</span> range<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> slope <span class="op">=</span> slopeFactor <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atanh</span>(inputSlope)<span class="op">;</span></span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> intercept <span class="op">=</span> area <span class="op">/</span> range<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(slope) <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">*</span> intercept <span class="op">/</span> (y2 <span class="op">-</span> y1 <span class="op">-</span> <span class="dv">1</span>)) {</span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yExactShift <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="dv">2</span> <span class="op">*</span> area <span class="op">/</span> slope))<span class="op">;</span></span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yRoundShift <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(yExactShift))<span class="op">;</span></span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (slope <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a>      y1 <span class="op">=</span> y2 <span class="op">-</span> yRoundShift<span class="op">;</span></span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a>      y2 <span class="op">=</span> y1 <span class="op">+</span> yRoundShift<span class="op">;</span></span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a>    slope <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(slope) <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> area <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>((y2 <span class="op">-</span> y1)<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a>    intercept <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(slope) <span class="op">*</span> (y2 <span class="op">-</span> y1 <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yConstArea <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> range<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> i <span class="op">-</span> (y1 <span class="op">+</span> y2) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a>    yConstArea<span class="op">.</span><span class="fu">push</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> slope <span class="op">*</span> y <span class="op">+</span> intercept))<span class="op">;</span></span>
<span id="cb2-677"><a href="#cb2-677" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-678"><a href="#cb2-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-679"><a href="#cb2-679" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> yConstArea<span class="op">;</span></span>
<span id="cb2-680"><a href="#cb2-680" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="685" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 684;"><span id="cb3-685"><a href="#cb3-685" aria-hidden="true" tabindex="-1"></a>vecE <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.1</span><span class="op">,</span> <span class="fl">0.25</span>)<span class="op">;</span></span>
<span id="cb3-686"><a href="#cb3-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-687"><a href="#cb3-687" aria-hidden="true" tabindex="-1"></a>scaleE <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(d3<span class="op">.</span><span class="fu">extent</span>(vecE)<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb3-688"><a href="#cb3-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-689"><a href="#cb3-689" aria-hidden="true" tabindex="-1"></a>vecS <span class="op">=</span> <span class="fu">constAreaLinear</span>(vecE<span class="op">,</span> <span class="fl">0.55</span><span class="op">,</span> <span class="fu">scaleE</span>(inputD))<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb3-690"><a href="#cb3-690" aria-hidden="true" tabindex="-1"></a>  x <span class="kw">=&gt;</span> x <span class="op">*</span> inputS <span class="op">/</span> <span class="fl">0.55</span><span class="op">,</span></span>
<span id="cb3-691"><a href="#cb3-691" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb3-692"><a href="#cb3-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-693"><a href="#cb3-693" aria-hidden="true" tabindex="-1"></a>vecReverseCumsumS <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecS<span class="op">.</span><span class="fu">slice</span>()<span class="op">.</span><span class="fu">reverse</span>())<span class="op">.</span><span class="fu">reverse</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="697" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 696;"><span id="cb4-697"><a href="#cb4-697" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dotProduct</span>(v<span class="op">,</span> w) {</span>
<span id="cb4-698"><a href="#cb4-698" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (v<span class="op">.</span><span class="at">length</span> <span class="op">!==</span> w<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb4-699"><a href="#cb4-699" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"Vectors must have the same length"</span>)<span class="op">;</span></span>
<span id="cb4-700"><a href="#cb4-700" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-701"><a href="#cb4-701" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> val<span class="op">,</span> i) <span class="kw">=&gt;</span> acc <span class="op">+</span> val <span class="op">*</span> w[i]<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb4-702"><a href="#cb4-702" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-703"><a href="#cb4-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-704"><a href="#cb4-704" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">weightedArithmeticMean</span>(v<span class="op">,</span> weights) {</span>
<span id="cb4-705"><a href="#cb4-705" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">dotProduct</span>(v<span class="op">,</span> weights) <span class="op">/</span> d3<span class="op">.</span><span class="fu">sum</span>(weights)<span class="op">;</span></span>
<span id="cb4-706"><a href="#cb4-706" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="709" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 708;"><span id="cb5-709"><a href="#cb5-709" aria-hidden="true" tabindex="-1"></a>paramD <span class="op">=</span> <span class="fu">weightedArithmeticMean</span>(vecE<span class="op">,</span> vecS)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="713" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 712;"><span id="cb6-713"><a href="#cb6-713" aria-hidden="true" tabindex="-1"></a>paramC <span class="op">=</span> <span class="fu">weightedArithmeticMean</span>(vecE<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> e <span class="op">*</span> e)<span class="op">,</span> vecS)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="717" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 716;"><span id="cb7-717"><a href="#cb7-717" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeGamma</span>(vecE<span class="op">,</span> paramD<span class="op">,</span> paramC) {</span>
<span id="cb7-718"><a href="#cb7-718" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> twoC <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> paramC<span class="op">;</span></span>
<span id="cb7-719"><a href="#cb7-719" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecE<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> e<span class="op">/</span>paramD <span class="op">-</span> e<span class="op">*</span>e<span class="op">/</span>twoC))<span class="op">;</span></span>
<span id="cb7-720"><a href="#cb7-720" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="724" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 723;"><span id="cb8-724"><a href="#cb8-724" aria-hidden="true" tabindex="-1"></a>vecGamma <span class="op">=</span> <span class="fu">computeGamma</span>(vecE<span class="op">,</span> paramD<span class="op">,</span> paramC)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="728" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 727;"><span id="cb9-728"><a href="#cb9-728" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">normalize</span>(v) {</span>
<span id="cb9-729"><a href="#cb9-729" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sum <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(v)<span class="op">;</span></span>
<span id="cb9-730"><a href="#cb9-730" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">.</span><span class="fu">map</span>(val <span class="kw">=&gt;</span> val <span class="op">/</span> sum)<span class="op">;</span></span>
<span id="cb9-731"><a href="#cb9-731" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="735" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 734;"><span id="cb10-735"><a href="#cb10-735" aria-hidden="true" tabindex="-1"></a>vecNormGamma <span class="op">=</span> <span class="fu">normalize</span>(vecGamma)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="739" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 738;"><span id="cb11-739"><a href="#cb11-739" aria-hidden="true" tabindex="-1"></a>vecCumSumGamma <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecNormGamma)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="743" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 742;"><span id="cb12-743"><a href="#cb12-743" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeZ</span>(paramS<span class="op">,</span> vecCumSumGamma<span class="op">,</span> vecE) {</span>
<span id="cb12-744"><a href="#cb12-744" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecCumSumGamma<span class="op">.</span><span class="fu">map</span>((g<span class="op">,</span> t) <span class="kw">=&gt;</span> (<span class="dv">1</span> <span class="op">-</span> paramS) <span class="op">*</span> g <span class="op">/</span> vecE[t])<span class="op">;</span></span>
<span id="cb12-745"><a href="#cb12-745" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="749" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 748;"><span id="cb13-749"><a href="#cb13-749" aria-hidden="true" tabindex="-1"></a>vecZ <span class="op">=</span> <span class="fu">computeZ</span>(inputS<span class="op">,</span> vecCumSumGamma<span class="op">,</span> vecE)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="753" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 752;"><span id="cb14-753"><a href="#cb14-753" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeB</span>(vecZ<span class="op">,</span> vecE) {</span>
<span id="cb14-754"><a href="#cb14-754" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecZ<span class="op">.</span><span class="fu">map</span>((z<span class="op">,</span> t) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>z <span class="op">*</span> vecE[t]))<span class="op">;</span></span>
<span id="cb14-755"><a href="#cb14-755" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="759" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 758;"><span id="cb15-759"><a href="#cb15-759" aria-hidden="true" tabindex="-1"></a>vecB <span class="op">=</span> <span class="fu">computeB</span>(vecZ<span class="op">,</span> vecE)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="763" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 762;"><span id="cb16-763"><a href="#cb16-763" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeY</span>(vecZ) {</span>
<span id="cb16-764"><a href="#cb16-764" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecZ<span class="op">.</span><span class="fu">map</span>(z <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>(z))<span class="op">;</span></span>
<span id="cb16-765"><a href="#cb16-765" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="769" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 768;"><span id="cb17-769"><a href="#cb17-769" aria-hidden="true" tabindex="-1"></a>vecY <span class="op">=</span> <span class="fu">computeY</span>(vecZ)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="773" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 772;"><span id="cb18-773"><a href="#cb18-773" aria-hidden="true" tabindex="-1"></a>paramI <span class="op">=</span> <span class="fu">dotProduct</span>(vecS<span class="op">,</span> vecY)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="778" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 777;"><span id="cb19-778"><a href="#cb19-778" aria-hidden="true" tabindex="-1"></a>yieldData <span class="op">=</span> {</span>
<span id="cb19-779"><a href="#cb19-779" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> yieldData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb19-780"><a href="#cb19-780" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb19-781"><a href="#cb19-781" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-782"><a href="#cb19-782" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Stake A"</span><span class="op">,</span></span>
<span id="cb19-783"><a href="#cb19-783" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecS<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb19-784"><a href="#cb19-784" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-785"><a href="#cb19-785" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-786"><a href="#cb19-786" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-787"><a href="#cb19-787" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Time-weighted Incentive Curve"</span><span class="op">,</span></span>
<span id="cb19-788"><a href="#cb19-788" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecZ[t]<span class="op">,</span></span>
<span id="cb19-789"><a href="#cb19-789" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-790"><a href="#cb19-790" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-791"><a href="#cb19-791" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-792"><a href="#cb19-792" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Inflation-adjusted Incentives"</span><span class="op">,</span></span>
<span id="cb19-793"><a href="#cb19-793" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> (vecZ[t] <span class="op">-</span> paramI)<span class="op">,</span></span>
<span id="cb19-794"><a href="#cb19-794" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-795"><a href="#cb19-795" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-796"><a href="#cb19-796" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-797"><a href="#cb19-797" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb19-798"><a href="#cb19-798" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb19-799"><a href="#cb19-799" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-800"><a href="#cb19-800" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-801"><a href="#cb19-801" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-802"><a href="#cb19-802" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Cumulative Stake A"</span><span class="op">,</span></span>
<span id="cb19-803"><a href="#cb19-803" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecReverseCumsumS[t <span class="op">-</span> <span class="dv">3</span>]<span class="op">,</span></span>
<span id="cb19-804"><a href="#cb19-804" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-805"><a href="#cb19-805" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-806"><a href="#cb19-806" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb19-807"><a href="#cb19-807" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> yieldData<span class="op">;</span></span>
<span id="cb19-808"><a href="#cb19-808" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb19-809"><a href="#cb19-809" aria-hidden="true" tabindex="-1"></a>getStake <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Stake A"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-810"><a href="#cb19-810" aria-hidden="true" tabindex="-1"></a>getYieldTerm <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Time-weighted Incentive Curve"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-811"><a href="#cb19-811" aria-hidden="true" tabindex="-1"></a>getRealYield <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Inflation-adjusted Incentives"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-812"><a href="#cb19-812" aria-hidden="true" tabindex="-1"></a>getDiscount <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Discount Curve"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-813"><a href="#cb19-813" aria-hidden="true" tabindex="-1"></a>getCumStake <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Cumulative Stake A"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-814"><a href="#cb19-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-815"><a href="#cb19-815" aria-hidden="true" tabindex="-1"></a>stringS <span class="op">=</span> <span class="st">"Total Stake = "</span> <span class="op">+</span> inputS<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-816"><a href="#cb19-816" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-817"><a href="#cb19-817" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-818"><a href="#cb19-818" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb19-819"><a href="#cb19-819" aria-hidden="true" tabindex="-1"></a>stringI <span class="op">=</span> <span class="st">"Inflation = "</span> <span class="op">+</span> paramI<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-820"><a href="#cb19-820" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-821"><a href="#cb19-821" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-822"><a href="#cb19-822" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb19-823"><a href="#cb19-823" aria-hidden="true" tabindex="-1"></a>stringD <span class="op">=</span> <span class="vs">`D = </span><span class="sc">${</span>paramD<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-824"><a href="#cb19-824" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-825"><a href="#cb19-825" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-826"><a href="#cb19-826" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> years`</span><span class="op">;</span></span>
<span id="cb19-827"><a href="#cb19-827" aria-hidden="true" tabindex="-1"></a>stringC <span class="op">=</span> <span class="vs">`√C = </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(paramC)<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-828"><a href="#cb19-828" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-829"><a href="#cb19-829" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-830"><a href="#cb19-830" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> years`</span><span class="op">;</span></span>
<span id="cb19-831"><a href="#cb19-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-832"><a href="#cb19-832" aria-hidden="true" tabindex="-1"></a>yieldParams <span class="op">=</span> [</span>
<span id="cb19-833"><a href="#cb19-833" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringD<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> paramD }<span class="op">,</span></span>
<span id="cb19-834"><a href="#cb19-834" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringC<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(paramC) }<span class="op">,</span></span>
<span id="cb19-835"><a href="#cb19-835" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="839" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 838;"><span id="cb20-839"><a href="#cb20-839" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb20-840"><a href="#cb20-840" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb20-841"><a href="#cb20-841" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-842"><a href="#cb20-842" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span></span>
<span id="cb20-843"><a href="#cb20-843" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb20-844"><a href="#cb20-844" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Stake A"</span><span class="op">,</span></span>
<span id="cb20-845"><a href="#cb20-845" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Time-weighted Incentive Curve"</span><span class="op">,</span></span>
<span id="cb20-846"><a href="#cb20-846" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Inflation-adjusted Incentives"</span><span class="op">,</span></span>
<span id="cb20-847"><a href="#cb20-847" aria-hidden="true" tabindex="-1"></a>      stringD<span class="op">,</span></span>
<span id="cb20-848"><a href="#cb20-848" aria-hidden="true" tabindex="-1"></a>      stringC<span class="op">,</span></span>
<span id="cb20-849"><a href="#cb20-849" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb20-850"><a href="#cb20-850" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-851"><a href="#cb20-851" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb20-852"><a href="#cb20-852" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">,</span></span>
<span id="cb20-853"><a href="#cb20-853" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.45</span>]<span class="op">,</span></span>
<span id="cb20-854"><a href="#cb20-854" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Duration E (Years)"</span><span class="op">,</span></span>
<span id="cb20-855"><a href="#cb20-855" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-856"><a href="#cb20-856" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb20-857"><a href="#cb20-857" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb20-858"><a href="#cb20-858" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span></span>
<span id="cb20-859"><a href="#cb20-859" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(yieldData<span class="op">,</span> getStake)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(yieldData<span class="op">,</span> getYieldTerm))<span class="op">,</span></span>
<span id="cb20-860"><a href="#cb20-860" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb20-861"><a href="#cb20-861" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-862"><a href="#cb20-862" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-863"><a href="#cb20-863" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb20-864"><a href="#cb20-864" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb20-865"><a href="#cb20-865" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb20-866"><a href="#cb20-866" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-867"><a href="#cb20-867" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb20-868"><a href="#cb20-868" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb20-869"><a href="#cb20-869" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake A (%)"</span> })<span class="op">,</span></span>
<span id="cb20-870"><a href="#cb20-870" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Incentive Rates (%)"</span> })<span class="op">,</span></span>
<span id="cb20-871"><a href="#cb20-871" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(yieldData<span class="op">,</span> {</span>
<span id="cb20-872"><a href="#cb20-872" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb20-873"><a href="#cb20-873" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb20-874"><a href="#cb20-874" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getStake<span class="op">,</span></span>
<span id="cb20-875"><a href="#cb20-875" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb20-876"><a href="#cb20-876" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-877"><a href="#cb20-877" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(yieldParams<span class="op">,</span> {</span>
<span id="cb20-878"><a href="#cb20-878" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span></span>
<span id="cb20-879"><a href="#cb20-879" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb20-880"><a href="#cb20-880" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb20-881"><a href="#cb20-881" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb20-882"><a href="#cb20-882" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-883"><a href="#cb20-883" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getYieldTerm<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-884"><a href="#cb20-884" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getYieldTerm<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-885"><a href="#cb20-885" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getRealYield<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-886"><a href="#cb20-886" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getRealYield<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-887"><a href="#cb20-887" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb20-888"><a href="#cb20-888" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-20" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-20" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Time-weighted incentives <span>(<span id="ojs-element-id-1"></span>,</span> <span><span id="ojs-element-id-2"></span>).</span>
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="893" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 892;"><span id="cb21-893"><a href="#cb21-893" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb21-894"><a href="#cb21-894" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb21-895"><a href="#cb21-895" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-896"><a href="#cb21-896" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">8</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb21-897"><a href="#cb21-897" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Cumulative Stake A"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringD<span class="op">,</span> stringC]<span class="op">,</span></span>
<span id="cb21-898"><a href="#cb21-898" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-899"><a href="#cb21-899" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb21-900"><a href="#cb21-900" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">,</span></span>
<span id="cb21-901"><a href="#cb21-901" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.45</span>]<span class="op">,</span></span>
<span id="cb21-902"><a href="#cb21-902" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Duration E (Years)"</span></span>
<span id="cb21-903"><a href="#cb21-903" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-904"><a href="#cb21-904" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb21-905"><a href="#cb21-905" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-906"><a href="#cb21-906" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb21-907"><a href="#cb21-907" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb21-908"><a href="#cb21-908" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb21-909"><a href="#cb21-909" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb21-910"><a href="#cb21-910" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb21-911"><a href="#cb21-911" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Cumulative Stake (%)"</span> })<span class="op">,</span></span>
<span id="cb21-912"><a href="#cb21-912" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb21-913"><a href="#cb21-913" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(yieldData<span class="op">,</span> {</span>
<span id="cb21-914"><a href="#cb21-914" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb21-915"><a href="#cb21-915" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb21-916"><a href="#cb21-916" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCumStake<span class="op">,</span></span>
<span id="cb21-917"><a href="#cb21-917" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb21-918"><a href="#cb21-918" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb21-919"><a href="#cb21-919" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(yieldParams<span class="op">,</span> {</span>
<span id="cb21-920"><a href="#cb21-920" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span></span>
<span id="cb21-921"><a href="#cb21-921" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb21-922"><a href="#cb21-922" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb21-923"><a href="#cb21-923" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb21-924"><a href="#cb21-924" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb21-925"><a href="#cb21-925" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb21-926"><a href="#cb21-926" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb21-927"><a href="#cb21-927" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb21-928"><a href="#cb21-928" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-21" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-21" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Discount rates.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-time-locked-incentives-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Example of time-locked incentives.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>For visualising the sensitivity of overall <strong>A</strong> inflation rates with respect to staking and duration, <a href="#fig-inflation-rate" class="quarto-xref">Figure&nbsp;5</a> assumes a single duration over the staking range to provide an approximation of inflation <span class="math inline">\Delta S \approx Z \, S</span>.</p>
<div id="fig-inflation-rate" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A inflation rate from base accrual Delta S.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-inflation-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="957" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 956;"><span id="cb22-957"><a href="#cb22-957" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">contrastingTextColor</span>(backgroundColor) {</span>
<span id="cb22-958"><a href="#cb22-958" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d3<span class="op">.</span><span class="fu">hsl</span>(backgroundColor)<span class="op">.</span><span class="at">l</span> <span class="op">&lt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb22-959"><a href="#cb22-959" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"white"</span><span class="op">;</span></span>
<span id="cb22-960"><a href="#cb22-960" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-961"><a href="#cb22-961" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb22-962"><a href="#cb22-962" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-963"><a href="#cb22-963" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="967" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 966;"><span id="cb23-967"><a href="#cb23-967" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeApproxDeltaA</span>(paramS<span class="op">,</span> paramE) {</span>
<span id="cb23-968"><a href="#cb23-968" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> paramS <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> paramS) <span class="op">/</span> paramE<span class="op">;</span></span>
<span id="cb23-969"><a href="#cb23-969" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="973" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 972;"><span id="cb24-973"><a href="#cb24-973" aria-hidden="true" tabindex="-1"></a>inflationData <span class="op">=</span> {</span>
<span id="cb24-974"><a href="#cb24-974" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inflationData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb24-975"><a href="#cb24-975" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramS <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramS <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramS <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb24-976"><a href="#cb24-976" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramE <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> paramE <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">;</span> paramE<span class="op">++</span>) {</span>
<span id="cb24-977"><a href="#cb24-977" aria-hidden="true" tabindex="-1"></a>      inflationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb24-978"><a href="#cb24-978" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb24-979"><a href="#cb24-979" aria-hidden="true" tabindex="-1"></a>        <span class="dt">e</span><span class="op">:</span> paramE<span class="op">,</span></span>
<span id="cb24-980"><a href="#cb24-980" aria-hidden="true" tabindex="-1"></a>        <span class="dt">s</span><span class="op">:</span> paramS<span class="op">,</span></span>
<span id="cb24-981"><a href="#cb24-981" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeApproxDeltaA</span>(paramS<span class="op">,</span> paramE)<span class="op">,</span></span>
<span id="cb24-982"><a href="#cb24-982" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb24-983"><a href="#cb24-983" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-984"><a href="#cb24-984" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-985"><a href="#cb24-985" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> inflationData<span class="op">;</span></span>
<span id="cb24-986"><a href="#cb24-986" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="990" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 989;"><span id="cb25-990"><a href="#cb25-990" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb25-991"><a href="#cb25-991" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"ΔS"</span> }<span class="op">,</span></span>
<span id="cb25-992"><a href="#cb25-992" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="fl">10.1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">10.5</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Duration E (Years)"</span> }<span class="op">,</span></span>
<span id="cb25-993"><a href="#cb25-993" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Staking S"</span> }<span class="op">,</span></span>
<span id="cb25-994"><a href="#cb25-994" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb25-995"><a href="#cb25-995" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb25-996"><a href="#cb25-996" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(inflationData<span class="op">,</span> {</span>
<span id="cb25-997"><a href="#cb25-997" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">e</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-998"><a href="#cb25-998" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">e</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-999"><a href="#cb25-999" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb25-1000"><a href="#cb25-1000" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb25-1001"><a href="#cb25-1001" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb25-1002"><a href="#cb25-1002" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-1003"><a href="#cb25-1003" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(inflationData<span class="op">,</span> {</span>
<span id="cb25-1004"><a href="#cb25-1004" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"e"</span><span class="op">,</span></span>
<span id="cb25-1005"><a href="#cb25-1005" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"s"</span><span class="op">,</span></span>
<span id="cb25-1006"><a href="#cb25-1006" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb25-1007"><a href="#cb25-1007" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb25-1008"><a href="#cb25-1008" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb25-1009"><a href="#cb25-1009" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb25-1010"><a href="#cb25-1010" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb25-1011"><a href="#cb25-1011" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb25-1012"><a href="#cb25-1012" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeApproxDeltaA</span>(<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span></span>
<span id="cb25-1013"><a href="#cb25-1013" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb25-1014"><a href="#cb25-1014" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb25-1015"><a href="#cb25-1015" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb25-1016"><a href="#cb25-1016" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-1017"><a href="#cb25-1017" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb25-1018"><a href="#cb25-1018" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-25" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inflation-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: <strong>A</strong> inflation rate from base accrual <span class="math inline">\Delta S</span>.
</figcaption>
</figure>
</div>
</section>
<section id="sec-governance-weightings" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="sec-governance-weightings"><span class="header-section-number">3.1.2</span> Governance Weightings</h4>
<p>Governance rights, for example the whitelisting&nbsp;(and blacklisting) of carbon classes, and any other matter requiring token stakeholder voting, are allocated to two cohorts:</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong> tokens: <span class="math inline">S_t</span></p></li>
<li><p>Staked liquidity in the <strong>A</strong>-<strong>G</strong> pair <span class="overline"><strong>AG</strong></span>&nbsp;(see <a href="#sec-liquidity-markets" class="quarto-xref">Section&nbsp;3.3</a>), defined here as <span class="math inline">A_{Gt}</span>, representing the quantity of <strong>A</strong> tokens held in the liquidity pool expressed as a proportion of circulating supply.</p></li>
</ol>
<p>Voting power is allocated by time and applied to the respective balance of <strong>A</strong>:</p>
<ol type="1">
<li><p>Initial voting weights for time-locked <strong>A</strong> tokens <span class="math inline">v_t</span>:</p>
<p><span id="eq-voting-weights-time-locks-initial"><span class="math display">
v_t = Z_t \, S_t
  \tag{11}</span></span></p></li>
<li><p>Initial voting weights for staked liquidity <span class="math inline">w_t</span>:</p>
<p><span id="eq-voting-weights-lps-initial"><span class="math display">
w_t = Z_t \, A_{Gt}
  \tag{12}</span></span></p></li>
<li><p>Final voting weights for time-locked <strong>A</strong> tokens <span class="math inline">V_t</span>:</p>
<p><span id="eq-voting-weights-time-locks"><span class="math display">
V_t = \frac{v_t}{\sum_{j=1}^{40} (v_j + 2 w_j)}
  \tag{13}</span></span></p></li>
<li><p>Final voting weights for staked liquidity <span class="math inline">W_t</span>:</p>
<p><span id="eq-voting-weights-lps"><span class="math display">
W_t = \frac{w_t}{\sum_{j=1}^{40} \left( \frac 1 2 v_j + w_j \right)}
  \tag{14}</span></span></p></li>
</ol>
</section>
</section>
<section id="sec-portfolio-manager-detailed" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="sec-portfolio-manager-detailed"><span class="header-section-number">3.2</span> Portfolio Manager</h3>
<p>The Portfolio Manager’s role of swapping <strong>A</strong> for carbon is managed through a set of smart contracts driven by allocation choices from the token system, the balances of assets held, and the discount rates generated by the Time-Locked Market.</p>
<p>The combined allocations of <strong>A</strong> and <strong>G</strong> tokens creates a dynamic pricing matrix by carbon class and by time, enabling spot and forward trading of carbon.</p>
<div id="fig-portfolio-manager-detailed" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 Portfolio Manager.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-portfolio-manager-detailed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/portfolio-manager-detailed.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-portfolio-manager-detailed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Klima&nbsp;2.0 Portfolio Manager.
</figcaption>
</figure>
</div>
<section id="sec-purchase-carbon" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="sec-purchase-carbon"><span class="header-section-number">3.2.1</span> Purchase Carbon</h4>
<p><em>User swaps carbon credits for <strong>A</strong> tokens.</em></p>
<section id="sec-existing-carbon-in-the-portfolio" class="level5" data-number="3.2.1.1">
<h5 data-number="3.2.1.1" class="anchored" data-anchor-id="sec-existing-carbon-in-the-portfolio"><span class="header-section-number">3.2.1.1</span> Existing Carbon in the Portfolio</h5>
<p>Carbon classes <span class="math inline">{i \in \{1, 2, 3, \dots, n\}}</span> are whitelisted through governance by time-locked <strong>A</strong> token and staked <span class="overline"><strong>AG</strong></span> liquidity providers&nbsp;(see <a href="#sec-governance-weightings" class="quarto-xref">Section&nbsp;3.1.2</a>).</p>
<p>For carbon pricing, both <strong>A</strong> tokens and <strong>G</strong> tokens may be allocated to specific carbon classes <span class="math inline">i</span> and these are independent allocations between the two-token systems.</p>
<div id="fig-token-staking-class-structure" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token staking class structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-staking-class-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-staking-class-structure.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-staking-class-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Token staking class structure.
</figcaption>
</figure>
</div>
<p>For a carbon class quantity to be sold to the Automated Asset Manager, it must have a strictly positive quantity of <strong>A</strong> tokens allocated to that carbon class, otherwise there is no price, and the carbon cannot be sold.</p>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">C_i</span>: Total tonnes of carbon class <span class="math inline">i</span> currently held in the portfolio.</p></li>
<li><p><span class="math inline">A_i</span>: <strong>A</strong> tokens allocated to carbon class <span class="math inline">i</span> expressed as a proportion of the outstanding supply of <strong>A</strong> tokens, where <span class="math inline">{\sum A_i = A}</span>.</p></li>
<li><p><span class="math inline">G_i</span>: <strong>G</strong> tokens allocated to carbon class <span class="math inline">i</span> expressed as a proportion of the outstanding supply of <strong>G</strong> Tokens.</p></li>
<li><p><span class="math inline">C_{it}</span>: The quantity of carbon class <span class="math inline">i</span> held in the Automated Asset Manager deliverable per maturity <span class="math inline">t</span> where <span class="math inline">C_{i0}</span> reflects the liquid quantity.</p></li>
</ul>
<p>In order to determine the present-value quantity of carbon, <span class="math inline">\bar C_i</span>, we apply the discount curve from <a href="#eq-discount-rate" class="quarto-xref">Equation&nbsp;7</a> to the liquidity schedule and sum the discounted holdings:</p>
<p><span id="eq-present-value-carbon"><span class="math display">
\bar C_i = C_{i0} + \sum_{t=1}^{40} B_t \, C_{it}
\tag{15}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="1154" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1153;"><span id="cb26-1154"><a href="#cb26-1154" aria-hidden="true" tabindex="-1"></a>viewof inputCi0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb26-1155"><a href="#cb26-1155" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } C_{i0}`</span><span class="op">,</span></span>
<span id="cb26-1156"><a href="#cb26-1156" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb26-1157"><a href="#cb26-1157" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb26-1158"><a href="#cb26-1158" aria-hidden="true" tabindex="-1"></a>viewof inputLiqShape <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb26-1159"><a href="#cb26-1159" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Schedule shape}`</span><span class="op">,</span></span>
<span id="cb26-1160"><a href="#cb26-1160" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb26-1161"><a href="#cb26-1161" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-26-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-26-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-held-in-the-aam" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon held in the portfolio.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-held-in-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="1173" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1172;"><span id="cb27-1173"><a href="#cb27-1173" aria-hidden="true" tabindex="-1"></a>vecCi <span class="op">=</span> <span class="fu">constAreaLinear</span>(vecE<span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> inputCi0<span class="op">,</span> inputLiqShape<span class="op">,</span> <span class="fl">0.01</span>)<span class="op">;</span></span>
<span id="cb27-1174"><a href="#cb27-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1175"><a href="#cb27-1175" aria-hidden="true" tabindex="-1"></a>paramBarCi <span class="op">=</span> inputCi0 <span class="op">+</span> <span class="fu">dotProduct</span>(vecB<span class="op">,</span> vecCi)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-27-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-27-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="1179" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1178;"><span id="cb28-1179"><a href="#cb28-1179" aria-hidden="true" tabindex="-1"></a>carbonHeldData <span class="op">=</span> {</span>
<span id="cb28-1180"><a href="#cb28-1180" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> carbonHeldData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb28-1181"><a href="#cb28-1181" aria-hidden="true" tabindex="-1"></a>  carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1182"><a href="#cb28-1182" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"Liquidity Schedule"</span><span class="op">,</span></span>
<span id="cb28-1183"><a href="#cb28-1183" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> inputCi0<span class="op">,</span></span>
<span id="cb28-1184"><a href="#cb28-1184" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb28-1185"><a href="#cb28-1185" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb28-1186"><a href="#cb28-1186" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb28-1187"><a href="#cb28-1187" aria-hidden="true" tabindex="-1"></a>    carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1188"><a href="#cb28-1188" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Liquidity Schedule"</span><span class="op">,</span></span>
<span id="cb28-1189"><a href="#cb28-1189" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecCi<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb28-1190"><a href="#cb28-1190" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb28-1191"><a href="#cb28-1191" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-1192"><a href="#cb28-1192" aria-hidden="true" tabindex="-1"></a>    carbonHeldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1193"><a href="#cb28-1193" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb28-1194"><a href="#cb28-1194" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb28-1195"><a href="#cb28-1195" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb28-1196"><a href="#cb28-1196" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-1197"><a href="#cb28-1197" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-1198"><a href="#cb28-1198" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> carbonHeldData<span class="op">;</span></span>
<span id="cb28-1199"><a href="#cb28-1199" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb28-1200"><a href="#cb28-1200" aria-hidden="true" tabindex="-1"></a>getLiqSchedule <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Liquidity Schedule"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb28-1201"><a href="#cb28-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1202"><a href="#cb28-1202" aria-hidden="true" tabindex="-1"></a>stringBarCi <span class="op">=</span> <span class="vs">`Present-Value Carbon C̄ᵢ = </span><span class="sc">${</span>paramBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb28-1203"><a href="#cb28-1203" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb28-1204"><a href="#cb28-1204" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb28-1205"><a href="#cb28-1205" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb28-1206"><a href="#cb28-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1207"><a href="#cb28-1207" aria-hidden="true" tabindex="-1"></a>heldCarbonParam <span class="op">=</span> [{ <span class="dt">key</span><span class="op">:</span> stringBarCi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramBarCi }]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="1210" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1209;"><span id="cb29-1210"><a href="#cb29-1210" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb29-1211"><a href="#cb29-1211" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb29-1212"><a href="#cb29-1212" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1213"><a href="#cb29-1213" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb29-1214"><a href="#cb29-1214" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Liquidity Schedule"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringBarCi]<span class="op">,</span></span>
<span id="cb29-1215"><a href="#cb29-1215" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb29-1216"><a href="#cb29-1216" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb29-1217"><a href="#cb29-1217" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span><span class="op">,</span></span>
<span id="cb29-1218"><a href="#cb29-1218" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb29-1219"><a href="#cb29-1219" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelArrow</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1220"><a href="#cb29-1220" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb29-1221"><a href="#cb29-1221" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb29-1222"><a href="#cb29-1222" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb29-1223"><a href="#cb29-1223" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb29-1224"><a href="#cb29-1224" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb29-1225"><a href="#cb29-1225" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1226"><a href="#cb29-1226" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb29-1227"><a href="#cb29-1227" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb29-1228"><a href="#cb29-1228" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Quantity of Carbon (%)"</span> })<span class="op">,</span></span>
<span id="cb29-1229"><a href="#cb29-1229" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb29-1230"><a href="#cb29-1230" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(carbonHeldData<span class="op">,</span> {</span>
<span id="cb29-1231"><a href="#cb29-1231" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb29-1232"><a href="#cb29-1232" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb29-1233"><a href="#cb29-1233" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLiqSchedule<span class="op">,</span></span>
<span id="cb29-1234"><a href="#cb29-1234" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb29-1235"><a href="#cb29-1235" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-1236"><a href="#cb29-1236" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(heldCarbonParam<span class="op">,</span> {</span>
<span id="cb29-1237"><a href="#cb29-1237" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb29-1238"><a href="#cb29-1238" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb29-1239"><a href="#cb29-1239" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb29-1240"><a href="#cb29-1240" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb29-1241"><a href="#cb29-1241" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-1242"><a href="#cb29-1242" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(carbonHeldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb29-1243"><a href="#cb29-1243" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(carbonHeldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb29-1244"><a href="#cb29-1244" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb29-1245"><a href="#cb29-1245" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-29" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-held-in-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Carbon held in the portfolio.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Similarly, taking <span class="math inline">\Delta C_{it}</span> as the quantity of carbon <span class="math inline">i</span> to be sold with a specific maturity index <span class="math inline">t</span>:</p>
<p><span id="eq-present-value-carbon-change"><span class="math display">
\Delta \bar C_i = \Delta C_{i0} + \sum_{t=1}^{40} B_t \, \Delta C_{it}
\tag{16}</span></span></p>
<p>Once standardised by the discount curve, trades can be aggregated in the same class for the defined trade or auction period.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="1272" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1271;"><span id="cb30-1272"><a href="#cb30-1272" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaCi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb30-1273"><a href="#cb30-1273" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta C_i`</span><span class="op">,</span></span>
<span id="cb30-1274"><a href="#cb30-1274" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb30-1275"><a href="#cb30-1275" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb30-1276"><a href="#cb30-1276" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb30-1277"><a href="#cb30-1277" aria-hidden="true" tabindex="-1"></a>viewof inputEt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {</span>
<span id="cb30-1278"><a href="#cb30-1278" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Expiry } E_t </span><span class="sc">\t</span><span class="vs">ext{ (years)}`</span><span class="op">,</span></span>
<span id="cb30-1279"><a href="#cb30-1279" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb30-1280"><a href="#cb30-1280" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb30-1281"><a href="#cb30-1281" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-30-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-30-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-bought-by-the-aam" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon bought by the Portfolio Manager.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-bought-by-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="1293" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1292;"><span id="cb31-1293"><a href="#cb31-1293" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaCi0</span>(deltaCi<span class="op">,</span> t) {</span>
<span id="cb31-1294"><a href="#cb31-1294" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> deltaCi <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb31-1295"><a href="#cb31-1295" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-1296"><a href="#cb31-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1297"><a href="#cb31-1297" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeVecDeltaCi</span>(deltaCi<span class="op">,</span> t) {</span>
<span id="cb31-1298"><a href="#cb31-1298" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecDeltaCi <span class="op">=</span> <span class="bu">Array</span>(<span class="dv">40</span>)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb31-1299"><a href="#cb31-1299" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="op">!==</span> <span class="dv">0</span>) {</span>
<span id="cb31-1300"><a href="#cb31-1300" aria-hidden="true" tabindex="-1"></a>    vecDeltaCi[t <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> deltaCi<span class="op">;</span></span>
<span id="cb31-1301"><a href="#cb31-1301" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-1302"><a href="#cb31-1302" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecDeltaCi<span class="op">;</span></span>
<span id="cb31-1303"><a href="#cb31-1303" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-31-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-31-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="1307" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1306;"><span id="cb32-1307"><a href="#cb32-1307" aria-hidden="true" tabindex="-1"></a>paramMaturityIdx <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> inputEt<span class="op">;</span></span>
<span id="cb32-1308"><a href="#cb32-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1309"><a href="#cb32-1309" aria-hidden="true" tabindex="-1"></a>paramDeltaCi0 <span class="op">=</span> <span class="fu">computeDeltaCi0</span>(inputDeltaCi<span class="op">,</span> paramMaturityIdx)<span class="op">;</span></span>
<span id="cb32-1310"><a href="#cb32-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1311"><a href="#cb32-1311" aria-hidden="true" tabindex="-1"></a>vecDeltaCi <span class="op">=</span> <span class="fu">computeVecDeltaCi</span>(inputDeltaCi<span class="op">,</span> paramMaturityIdx)<span class="op">;</span></span>
<span id="cb32-1312"><a href="#cb32-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1313"><a href="#cb32-1313" aria-hidden="true" tabindex="-1"></a>paramDeltaBarCi <span class="op">=</span> paramDeltaCi0 <span class="op">+</span> <span class="fu">dotProduct</span>(vecB<span class="op">,</span> vecDeltaCi)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="1317" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1316;"><span id="cb33-1317"><a href="#cb33-1317" aria-hidden="true" tabindex="-1"></a>carbonBuyData <span class="op">=</span> {</span>
<span id="cb33-1318"><a href="#cb33-1318" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> carbonBuyData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb33-1319"><a href="#cb33-1319" aria-hidden="true" tabindex="-1"></a>  carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1320"><a href="#cb33-1320" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"Carbon Bought by AAM"</span><span class="op">,</span></span>
<span id="cb33-1321"><a href="#cb33-1321" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDeltaCi0<span class="op">,</span></span>
<span id="cb33-1322"><a href="#cb33-1322" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb33-1323"><a href="#cb33-1323" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-1324"><a href="#cb33-1324" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb33-1325"><a href="#cb33-1325" aria-hidden="true" tabindex="-1"></a>    carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1326"><a href="#cb33-1326" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Carbon Bought by AAM"</span><span class="op">,</span></span>
<span id="cb33-1327"><a href="#cb33-1327" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecDeltaCi<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb33-1328"><a href="#cb33-1328" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb33-1329"><a href="#cb33-1329" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb33-1330"><a href="#cb33-1330" aria-hidden="true" tabindex="-1"></a>    carbonBuyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1331"><a href="#cb33-1331" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb33-1332"><a href="#cb33-1332" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb33-1333"><a href="#cb33-1333" aria-hidden="true" tabindex="-1"></a>      <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb33-1334"><a href="#cb33-1334" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb33-1335"><a href="#cb33-1335" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-1336"><a href="#cb33-1336" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> carbonBuyData<span class="op">;</span></span>
<span id="cb33-1337"><a href="#cb33-1337" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb33-1338"><a href="#cb33-1338" aria-hidden="true" tabindex="-1"></a>getCarbonBought <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Carbon Bought by AAM"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb33-1339"><a href="#cb33-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1340"><a href="#cb33-1340" aria-hidden="true" tabindex="-1"></a>stringDeltaBarCi <span class="op">=</span> <span class="st">"Present-Value Carbon Bought by AAM ΔC̄ᵢ = "</span> <span class="op">+</span></span>
<span id="cb33-1341"><a href="#cb33-1341" aria-hidden="true" tabindex="-1"></a>        paramDeltaBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb33-1342"><a href="#cb33-1342" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb33-1343"><a href="#cb33-1343" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb33-1344"><a href="#cb33-1344" aria-hidden="true" tabindex="-1"></a>            <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span></span>
<span id="cb33-1345"><a href="#cb33-1345" aria-hidden="true" tabindex="-1"></a>            <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb33-1346"><a href="#cb33-1346" aria-hidden="true" tabindex="-1"></a>            <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb33-1347"><a href="#cb33-1347" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb33-1348"><a href="#cb33-1348" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb33-1349"><a href="#cb33-1349" aria-hidden="true" tabindex="-1"></a>boughtCarbonParam <span class="op">=</span> [{ <span class="dt">key</span><span class="op">:</span> stringDeltaBarCi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDeltaBarCi }]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="1352" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1351;"><span id="cb34-1352"><a href="#cb34-1352" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb34-1353"><a href="#cb34-1353" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb34-1354"><a href="#cb34-1354" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1355"><a href="#cb34-1355" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">7</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb34-1356"><a href="#cb34-1356" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Carbon Bought by AAM"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringDeltaBarCi]<span class="op">,</span></span>
<span id="cb34-1357"><a href="#cb34-1357" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1358"><a href="#cb34-1358" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb34-1359"><a href="#cb34-1359" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Time to Expiry (Years)"</span><span class="op">,</span></span>
<span id="cb34-1360"><a href="#cb34-1360" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb34-1361"><a href="#cb34-1361" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelArrow</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1362"><a href="#cb34-1362" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1363"><a href="#cb34-1363" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb34-1364"><a href="#cb34-1364" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb34-1365"><a href="#cb34-1365" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb34-1366"><a href="#cb34-1366" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb34-1367"><a href="#cb34-1367" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1368"><a href="#cb34-1368" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb34-1369"><a href="#cb34-1369" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb34-1370"><a href="#cb34-1370" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Quantity of Carbon (%)"</span> })<span class="op">,</span></span>
<span id="cb34-1371"><a href="#cb34-1371" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb34-1372"><a href="#cb34-1372" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(carbonBuyData<span class="op">,</span> {</span>
<span id="cb34-1373"><a href="#cb34-1373" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb34-1374"><a href="#cb34-1374" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb34-1375"><a href="#cb34-1375" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCarbonBought<span class="op">,</span></span>
<span id="cb34-1376"><a href="#cb34-1376" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb34-1377"><a href="#cb34-1377" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-1378"><a href="#cb34-1378" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(boughtCarbonParam<span class="op">,</span> {</span>
<span id="cb34-1379"><a href="#cb34-1379" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb34-1380"><a href="#cb34-1380" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb34-1381"><a href="#cb34-1381" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb34-1382"><a href="#cb34-1382" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb34-1383"><a href="#cb34-1383" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-1384"><a href="#cb34-1384" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(carbonBuyData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb34-1385"><a href="#cb34-1385" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(carbonBuyData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb34-1386"><a href="#cb34-1386" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb34-1387"><a href="#cb34-1387" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-34" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-bought-by-the-aam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Carbon bought by the Portfolio Manager.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Where <span class="math inline">\Delta \bar C_i</span> is expressed as the relative increment to its respective pool balance, the amount of <strong>A</strong> tokens issued to pay for carbon, <span class="math inline">\Delta A</span>, expressed as a proportion of current supply, is determined as:</p>
<p><span id="eq-a-change-intermediary-step"><span class="math display">
\ln(1 + \Delta A) =
  \left( A_i - \frac{A_i^2 \, (1 - G_i)^2}{2} \right) \ln(1 + \Delta \bar C_i)
\tag{17}</span></span></p>
<p>Denoting the expression on the right hand side of <a href="#eq-a-change-intermediary-step" class="quarto-xref">Equation&nbsp;17</a> as <span class="math inline">\mathsf{RHS}</span>:</p>
<p><span id="eq-a-change"><span class="math display">
\Delta A = \exp(\mathsf{RHS}) - 1
\tag{18}</span></span></p>
<p>Finally, <span class="math inline">\Delta A</span> is applied to the outstanding supply of <strong>A</strong> to solve for token quantities.</p>
<p><a href="#fig-a-price-curves" class="quarto-xref">Figure&nbsp;10</a> illustrates the <strong>G</strong> token’s capacity to maintain the initial portfolio pricing of the <strong>A</strong> token. The data has been normalised in <a href="#fig-a-price-curves-normalised" class="quarto-xref">Figure&nbsp;11</a> to <span class="math inline">\Delta \bar C_i \, A_i</span>.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="1426" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1425;"><span id="cb35-1426"><a href="#cb35-1426" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaBarCi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb35-1427"><a href="#cb35-1427" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta </span><span class="sc">\b</span><span class="vs">ar C_i`</span><span class="op">,</span></span>
<span id="cb35-1428"><a href="#cb35-1428" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb35-1429"><a href="#cb35-1429" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb35-1430"><a href="#cb35-1430" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-35" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-a-price-curves" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A price curves.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="1442" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1441;"><span id="cb36-1442"><a href="#cb36-1442" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCi) {</span>
<span id="cb36-1443"><a href="#cb36-1443" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>((Ai <span class="op">-</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>)) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log1p</span>(deltaCi))<span class="op">;</span></span>
<span id="cb36-1444"><a href="#cb36-1444" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="1449" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1448;"><span id="cb37-1449"><a href="#cb37-1449" aria-hidden="true" tabindex="-1"></a>pricingData <span class="op">=</span> {</span>
<span id="cb37-1450"><a href="#cb37-1450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pricingData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb37-1451"><a href="#cb37-1451" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb37-1452"><a href="#cb37-1452" aria-hidden="true" tabindex="-1"></a>    pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1453"><a href="#cb37-1453" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb37-1454"><a href="#cb37-1454" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb37-1455"><a href="#cb37-1455" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1456"><a href="#cb37-1456" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb37-1457"><a href="#cb37-1457" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb37-1458"><a href="#cb37-1458" aria-hidden="true" tabindex="-1"></a>    pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1459"><a href="#cb37-1459" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb37-1460"><a href="#cb37-1460" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb37-1461"><a href="#cb37-1461" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1462"><a href="#cb37-1462" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb37-1463"><a href="#cb37-1463" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb37-1464"><a href="#cb37-1464" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb37-1465"><a href="#cb37-1465" aria-hidden="true" tabindex="-1"></a>      pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1466"><a href="#cb37-1466" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb37-1467"><a href="#cb37-1467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb37-1468"><a href="#cb37-1468" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1469"><a href="#cb37-1469" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb37-1470"><a href="#cb37-1470" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb37-1471"><a href="#cb37-1471" aria-hidden="true" tabindex="-1"></a>      pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb37-1472"><a href="#cb37-1472" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb37-1473"><a href="#cb37-1473" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb37-1474"><a href="#cb37-1474" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb37-1475"><a href="#cb37-1475" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCi) <span class="op">/</span></span>
<span id="cb37-1476"><a href="#cb37-1476" aria-hidden="true" tabindex="-1"></a>                (inputDeltaBarCi <span class="op">*</span> paramAi)<span class="op">,</span></span>
<span id="cb37-1477"><a href="#cb37-1477" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb37-1478"><a href="#cb37-1478" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-1479"><a href="#cb37-1479" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-1480"><a href="#cb37-1480" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pricingData<span class="op">;</span></span>
<span id="cb37-1481"><a href="#cb37-1481" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb37-1482"><a href="#cb37-1482" aria-hidden="true" tabindex="-1"></a>getDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"ΔA"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb37-1483"><a href="#cb37-1483" aria-hidden="true" tabindex="-1"></a>getNormDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Normalised ΔA"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb37-1484"><a href="#cb37-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1485"><a href="#cb37-1485" aria-hidden="true" tabindex="-1"></a>stringInputDeltaBarCi <span class="op">=</span> inputDeltaBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb37-1486"><a href="#cb37-1486" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb37-1487"><a href="#cb37-1487" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb37-1488"><a href="#cb37-1488" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-37-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="1491" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1490;"><span id="cb38-1491"><a href="#cb38-1491" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb38-1492"><a href="#cb38-1492" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb38-1493"><a href="#cb38-1493" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-1494"><a href="#cb38-1494" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb38-1495"><a href="#cb38-1495" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb38-1496"><a href="#cb38-1496" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`ΔA, where ΔC̄ᵢ = </span><span class="sc">${</span>stringInputDeltaBarCi<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb38-1497"><a href="#cb38-1497" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb38-1498"><a href="#cb38-1498" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb38-1499"><a href="#cb38-1499" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb38-1500"><a href="#cb38-1500" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb38-1501"><a href="#cb38-1501" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb38-1502"><a href="#cb38-1502" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(pricingData<span class="op">,</span> {</span>
<span id="cb38-1503"><a href="#cb38-1503" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1504"><a href="#cb38-1504" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1505"><a href="#cb38-1505" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1506"><a href="#cb38-1506" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb38-1507"><a href="#cb38-1507" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getDeltaA<span class="op">,</span></span>
<span id="cb38-1508"><a href="#cb38-1508" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb38-1509"><a href="#cb38-1509" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(pricingData<span class="op">,</span> {</span>
<span id="cb38-1510"><a href="#cb38-1510" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb38-1511"><a href="#cb38-1511" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb38-1512"><a href="#cb38-1512" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb38-1513"><a href="#cb38-1513" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb38-1514"><a href="#cb38-1514" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb38-1515"><a href="#cb38-1515" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb38-1516"><a href="#cb38-1516" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb38-1517"><a href="#cb38-1517" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb38-1518"><a href="#cb38-1518" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb38-1519"><a href="#cb38-1519" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb38-1520"><a href="#cb38-1520" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb38-1521"><a href="#cb38-1521" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb38-1522"><a href="#cb38-1522" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb38-1523"><a href="#cb38-1523" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb38-1524"><a href="#cb38-1524" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb38-1525"><a href="#cb38-1525" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb38-1526"><a href="#cb38-1526" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb38-1527"><a href="#cb38-1527" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-38" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: <strong>A</strong> price curves (<span class="math inline">\Delta A</span>).
</figcaption>
</figure>
</div>
<div id="fig-a-price-curves-normalised" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Normalised A price curves.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1541" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1540;"><span id="cb39-1541"><a href="#cb39-1541" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb39-1542"><a href="#cb39-1542" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb39-1543"><a href="#cb39-1543" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb39-1544"><a href="#cb39-1544" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb39-1545"><a href="#cb39-1545" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb39-1546"><a href="#cb39-1546" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Normalised ΔA, where ΔC̄ᵢ = </span><span class="sc">${</span>stringInputDeltaBarCi<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb39-1547"><a href="#cb39-1547" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb39-1548"><a href="#cb39-1548" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb39-1549"><a href="#cb39-1549" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb39-1550"><a href="#cb39-1550" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb39-1551"><a href="#cb39-1551" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb39-1552"><a href="#cb39-1552" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(pricingData<span class="op">,</span> {</span>
<span id="cb39-1553"><a href="#cb39-1553" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1554"><a href="#cb39-1554" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1555"><a href="#cb39-1555" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1556"><a href="#cb39-1556" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1557"><a href="#cb39-1557" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getNormDeltaA<span class="op">,</span></span>
<span id="cb39-1558"><a href="#cb39-1558" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb39-1559"><a href="#cb39-1559" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(pricingData<span class="op">,</span> {</span>
<span id="cb39-1560"><a href="#cb39-1560" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb39-1561"><a href="#cb39-1561" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb39-1562"><a href="#cb39-1562" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getNormDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb39-1563"><a href="#cb39-1563" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb39-1564"><a href="#cb39-1564" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb39-1565"><a href="#cb39-1565" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb39-1566"><a href="#cb39-1566" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb39-1567"><a href="#cb39-1567" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb39-1568"><a href="#cb39-1568" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb39-1569"><a href="#cb39-1569" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaBarCi) <span class="op">/</span> inputDeltaBarCi<span class="op">,</span></span>
<span id="cb39-1570"><a href="#cb39-1570" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi) <span class="op">/</span> inputDeltaBarCi<span class="op">,</span></span>
<span id="cb39-1571"><a href="#cb39-1571" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb39-1572"><a href="#cb39-1572" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb39-1573"><a href="#cb39-1573" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb39-1574"><a href="#cb39-1574" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb39-1575"><a href="#cb39-1575" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb39-1576"><a href="#cb39-1576" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb39-1577"><a href="#cb39-1577" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-39" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Normalised <strong>A</strong> price curves.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Noting that the sensitivity to <span class="math inline">G_i</span> increases as <span class="math inline">A_i</span> increases and the effects become more pronounced as <span class="math inline">\Delta \bar C_i</span> increases.</p>
</section>
<section id="sec-zero-carbon-scenario" class="level5" data-number="3.2.1.2">
<h5 data-number="3.2.1.2" class="anchored" data-anchor-id="sec-zero-carbon-scenario"><span class="header-section-number">3.2.1.2</span> Zero Carbon Scenario</h5>
<p>There are circumstances when there is zero carbon held in the portfolio for a particular class, i.e.&nbsp;<span class="math inline">{C_i = 0}</span>, which invalidates the calculation of <span class="math inline">\Delta \bar C_i</span> and a different approach is required.</p>
<p>Taking <span class="math inline">\Delta \bar C_\emptyset</span> as the tonnes of carbon tokens (implying an existing balance of 1 tonne), adjusted for forward discounting, to be sold for any carbon class that has a strictly positive <strong>A</strong> allocation <span class="math inline">A_\emptyset</span>, together with <strong>G</strong> allocation <span class="math inline">G_\emptyset</span>:</p>
<p><span id="eq-a-change-zero-carbon"><span class="math display">
\Delta A =
  \frac{\Delta \bar C_\emptyset}{1 + \Delta \bar C_\emptyset} \,
  \left( A_\emptyset - \frac{A_\emptyset^2 (1 - G_\emptyset)^2}{2} \right)^2
\tag{19}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1613" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1612;"><span id="cb40-1613"><a href="#cb40-1613" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaBarCnull <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-1</span><span class="op">,</span> <span class="fl">1e5</span>]<span class="op">,</span> {</span>
<span id="cb40-1614"><a href="#cb40-1614" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta </span><span class="sc">\b</span><span class="vs">ar C_</span><span class="sc">\e</span><span class="vs">mptyset`</span><span class="op">,</span></span>
<span id="cb40-1615"><a href="#cb40-1615" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-1</span><span class="op">,</span></span>
<span id="cb40-1616"><a href="#cb40-1616" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">1e2</span><span class="op">,</span></span>
<span id="cb40-1617"><a href="#cb40-1617" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb40-1618"><a href="#cb40-1618" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-40" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-a-price-curves-zero-carbon" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A price curves in the zero carbon scenario.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-zero-carbon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1631" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1630;"><span id="cb41-1631"><a href="#cb41-1631" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeZeroCarbonDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCnull) {</span>
<span id="cb41-1632"><a href="#cb41-1632" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (deltaCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> deltaCnull)) <span class="op">*</span> (Ai <span class="op">-</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>))<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb41-1633"><a href="#cb41-1633" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-1634"><a href="#cb41-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1635"><a href="#cb41-1635" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeTrueDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> barCiTonnes<span class="op">,</span> deltaBarCiTonnes) {</span>
<span id="cb41-1636"><a href="#cb41-1636" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (barCiTonnes <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb41-1637"><a href="#cb41-1637" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">computeZeroCarbonDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaBarCiTonnes)<span class="op">;</span></span>
<span id="cb41-1638"><a href="#cb41-1638" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb41-1639"><a href="#cb41-1639" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> deltaBarCi <span class="op">=</span> deltaBarCiTonnes <span class="op">/</span> barCiTonnes<span class="op">;</span></span>
<span id="cb41-1640"><a href="#cb41-1640" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaBarCi)<span class="op">;</span></span>
<span id="cb41-1641"><a href="#cb41-1641" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-1642"><a href="#cb41-1642" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-1643"><a href="#cb41-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1644"><a href="#cb41-1644" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">numberOfDigits</span>(x) {</span>
<span id="cb41-1645"><a href="#cb41-1645" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> (<span class="dv">1</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(x)))<span class="op">;</span></span>
<span id="cb41-1646"><a href="#cb41-1646" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-41-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1650" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1649;"><span id="cb42-1650"><a href="#cb42-1650" aria-hidden="true" tabindex="-1"></a>zeroCarbonData <span class="op">=</span> {</span>
<span id="cb42-1651"><a href="#cb42-1651" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> zeroCarbonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb42-1652"><a href="#cb42-1652" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb42-1653"><a href="#cb42-1653" aria-hidden="true" tabindex="-1"></a>    zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1654"><a href="#cb42-1654" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb42-1655"><a href="#cb42-1655" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb42-1656"><a href="#cb42-1656" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1657"><a href="#cb42-1657" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb42-1658"><a href="#cb42-1658" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb42-1659"><a href="#cb42-1659" aria-hidden="true" tabindex="-1"></a>    zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1660"><a href="#cb42-1660" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb42-1661"><a href="#cb42-1661" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb42-1662"><a href="#cb42-1662" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1663"><a href="#cb42-1663" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb42-1664"><a href="#cb42-1664" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb42-1665"><a href="#cb42-1665" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb42-1666"><a href="#cb42-1666" aria-hidden="true" tabindex="-1"></a>      zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1667"><a href="#cb42-1667" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb42-1668"><a href="#cb42-1668" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1669"><a href="#cb42-1669" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1670"><a href="#cb42-1670" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeZeroCarbonDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb42-1671"><a href="#cb42-1671" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1672"><a href="#cb42-1672" aria-hidden="true" tabindex="-1"></a>      zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1673"><a href="#cb42-1673" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb42-1674"><a href="#cb42-1674" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1675"><a href="#cb42-1675" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1676"><a href="#cb42-1676" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeZeroCarbonDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb42-1677"><a href="#cb42-1677" aria-hidden="true" tabindex="-1"></a>                ((inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull)) <span class="op">*</span> paramAi<span class="op">**</span><span class="dv">2</span>)<span class="op">,</span></span>
<span id="cb42-1678"><a href="#cb42-1678" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1679"><a href="#cb42-1679" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-1680"><a href="#cb42-1680" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-1681"><a href="#cb42-1681" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> zeroCarbonData<span class="op">;</span></span>
<span id="cb42-1682"><a href="#cb42-1682" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb42-1683"><a href="#cb42-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1684"><a href="#cb42-1684" aria-hidden="true" tabindex="-1"></a>stringDeltaBarCnull <span class="op">=</span> inputDeltaBarCnull<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb42-1685"><a href="#cb42-1685" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb42-1686"><a href="#cb42-1686" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb42-1687"><a href="#cb42-1687" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="fu">numberOfDigits</span>(inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb42-1688"><a href="#cb42-1688" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="fu">numberOfDigits</span>(inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb42-1689"><a href="#cb42-1689" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb42-1690"><a href="#cb42-1690" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1693" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1692;"><span id="cb43-1693"><a href="#cb43-1693" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb43-1694"><a href="#cb43-1694" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb43-1695"><a href="#cb43-1695" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-1696"><a href="#cb43-1696" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb43-1697"><a href="#cb43-1697" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb43-1698"><a href="#cb43-1698" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`ΔA, where ΔC̄∅ = </span><span class="sc">${</span>stringDeltaBarCnull<span class="sc">}</span><span class="vs"> tCO2eq`</span><span class="op">,</span></span>
<span id="cb43-1699"><a href="#cb43-1699" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb43-1700"><a href="#cb43-1700" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb43-1701"><a href="#cb43-1701" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb43-1702"><a href="#cb43-1702" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb43-1703"><a href="#cb43-1703" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb43-1704"><a href="#cb43-1704" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb43-1705"><a href="#cb43-1705" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1706"><a href="#cb43-1706" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1707"><a href="#cb43-1707" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1708"><a href="#cb43-1708" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1709"><a href="#cb43-1709" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getDeltaA<span class="op">,</span></span>
<span id="cb43-1710"><a href="#cb43-1710" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb43-1711"><a href="#cb43-1711" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb43-1712"><a href="#cb43-1712" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb43-1713"><a href="#cb43-1713" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb43-1714"><a href="#cb43-1714" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb43-1715"><a href="#cb43-1715" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb43-1716"><a href="#cb43-1716" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb43-1717"><a href="#cb43-1717" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1718"><a href="#cb43-1718" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb43-1719"><a href="#cb43-1719" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb43-1720"><a href="#cb43-1720" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb43-1721"><a href="#cb43-1721" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb43-1722"><a href="#cb43-1722" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb43-1723"><a href="#cb43-1723" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb43-1724"><a href="#cb43-1724" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb43-1725"><a href="#cb43-1725" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb43-1726"><a href="#cb43-1726" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1727"><a href="#cb43-1727" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb43-1728"><a href="#cb43-1728" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb43-1729"><a href="#cb43-1729" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-43" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-zero-carbon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: <strong>A</strong> price curves (<span class="math inline">\Delta A</span>) in the zero carbon scenario.
</figcaption>
</figure>
</div>
<div id="fig-a-price-curves-zero-carbon-normalised" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Normalised A price curves in the zero carbon scenario.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-zero-carbon-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1744" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1743;"><span id="cb44-1744"><a href="#cb44-1744" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb44-1745"><a href="#cb44-1745" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb44-1746"><a href="#cb44-1746" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb44-1747"><a href="#cb44-1747" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb44-1748"><a href="#cb44-1748" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb44-1749"><a href="#cb44-1749" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Normalised ΔA, where ΔC̄∅ = </span><span class="sc">${</span>stringDeltaBarCnull<span class="sc">}</span><span class="vs"> tCO2eq`</span><span class="op">,</span></span>
<span id="cb44-1750"><a href="#cb44-1750" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb44-1751"><a href="#cb44-1751" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb44-1752"><a href="#cb44-1752" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb44-1753"><a href="#cb44-1753" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb44-1754"><a href="#cb44-1754" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb44-1755"><a href="#cb44-1755" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb44-1756"><a href="#cb44-1756" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1757"><a href="#cb44-1757" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1758"><a href="#cb44-1758" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1759"><a href="#cb44-1759" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb44-1760"><a href="#cb44-1760" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getNormDeltaA<span class="op">,</span></span>
<span id="cb44-1761"><a href="#cb44-1761" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb44-1762"><a href="#cb44-1762" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb44-1763"><a href="#cb44-1763" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb44-1764"><a href="#cb44-1764" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb44-1765"><a href="#cb44-1765" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getNormDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb44-1766"><a href="#cb44-1766" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb44-1767"><a href="#cb44-1767" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb44-1768"><a href="#cb44-1768" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb44-1769"><a href="#cb44-1769" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb44-1770"><a href="#cb44-1770" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb44-1771"><a href="#cb44-1771" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb44-1772"><a href="#cb44-1772" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb44-1773"><a href="#cb44-1773" aria-hidden="true" tabindex="-1"></a>                    (inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb44-1774"><a href="#cb44-1774" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb44-1775"><a href="#cb44-1775" aria-hidden="true" tabindex="-1"></a>                    (inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb44-1776"><a href="#cb44-1776" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb44-1777"><a href="#cb44-1777" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb44-1778"><a href="#cb44-1778" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb44-1779"><a href="#cb44-1779" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb44-1780"><a href="#cb44-1780" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb44-1781"><a href="#cb44-1781" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb44-1782"><a href="#cb44-1782" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-44" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-zero-carbon-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Normalised <strong>A</strong> price curves in the zero carbon scenario.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-sell-offset-certificates" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="sec-sell-offset-certificates"><span class="header-section-number">3.2.2</span> Sell Offset Certificates</h4>
<p><em>User swaps <strong>A</strong> tokens for carbon offset certificates.</em></p>
<section id="sec-weighted-carbon-class" class="level5" data-number="3.2.2.1">
<h5 data-number="3.2.2.1" class="anchored" data-anchor-id="sec-weighted-carbon-class"><span class="header-section-number">3.2.2.1</span> Weighted Carbon Class</h5>
<p>For retiring carbon that is <em>weighted</em>, that is for which there is a strictly positive <strong>A</strong> token allocation, an <strong>A</strong> token holder can extract the carbon class offset certificate of their choice <span class="math inline">C_i</span> but the available pool is only the liquid carbon balance, namely the element <span class="math inline">C_{i0}</span>:</p>
<p><span id="eq-carbon-change-intermediary-step"><span class="math display">
\ln(1 + \Delta C_i) =
  \frac{-\ln(1 + \Delta A)}{A_i + \frac 1 2 A_i^2 \, (1 - G_i)^2}
\tag{20}</span></span></p>
<p>As before, denoting the expression on the right hand side of <a href="#eq-carbon-change-intermediary-step" class="quarto-xref">Equation&nbsp;20</a> as <span class="math inline">\mathsf{RHS}</span>:</p>
<p><span id="eq-carbon-change"><span class="math display">
\Delta C_i = \exp(\mathsf{RHS}) - 1
\tag{21}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1821" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1820;"><span id="cb45-1821"><a href="#cb45-1821" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaA <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="fl">0.999</span>]<span class="op">,</span> {</span>
<span id="cb45-1822"><a href="#cb45-1822" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Burnt } </span><span class="sc">\D</span><span class="vs">elta A`</span><span class="op">,</span></span>
<span id="cb45-1823"><a href="#cb45-1823" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb45-1824"><a href="#cb45-1824" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb45-1825"><a href="#cb45-1825" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-45" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-proportion-of-carbon-retired" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Proportion of carbon retired.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-proportion-of-carbon-retired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1837" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1836;"><span id="cb46-1837"><a href="#cb46-1837" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaCi</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaA) {</span>
<span id="cb46-1838"><a href="#cb46-1838" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log1p</span>(deltaA) <span class="op">/</span> (Ai <span class="op">+</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>)))<span class="op">;</span></span>
<span id="cb46-1839"><a href="#cb46-1839" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-46" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1844" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1843;"><span id="cb47-1844"><a href="#cb47-1844" aria-hidden="true" tabindex="-1"></a>retirementData <span class="op">=</span> {</span>
<span id="cb47-1845"><a href="#cb47-1845" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> retirementData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb47-1846"><a href="#cb47-1846" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb47-1847"><a href="#cb47-1847" aria-hidden="true" tabindex="-1"></a>    retirementData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb47-1848"><a href="#cb47-1848" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"-ΔCᵢ"</span><span class="op">,</span></span>
<span id="cb47-1849"><a href="#cb47-1849" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb47-1850"><a href="#cb47-1850" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb47-1851"><a href="#cb47-1851" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb47-1852"><a href="#cb47-1852" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb47-1853"><a href="#cb47-1853" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb47-1854"><a href="#cb47-1854" aria-hidden="true" tabindex="-1"></a>      retirementData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb47-1855"><a href="#cb47-1855" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"-ΔCᵢ"</span><span class="op">,</span></span>
<span id="cb47-1856"><a href="#cb47-1856" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb47-1857"><a href="#cb47-1857" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb47-1858"><a href="#cb47-1858" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="op">-</span><span class="fu">computeDeltaCi</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb47-1859"><a href="#cb47-1859" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb47-1860"><a href="#cb47-1860" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-1861"><a href="#cb47-1861" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-1862"><a href="#cb47-1862" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> retirementData<span class="op">;</span></span>
<span id="cb47-1863"><a href="#cb47-1863" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb47-1864"><a href="#cb47-1864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1865"><a href="#cb47-1865" aria-hidden="true" tabindex="-1"></a>stringInputDeltaA <span class="op">=</span> inputDeltaA<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb47-1866"><a href="#cb47-1866" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb47-1867"><a href="#cb47-1867" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb47-1868"><a href="#cb47-1868" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-47-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-47-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1871" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1870;"><span id="cb48-1871"><a href="#cb48-1871" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb48-1872"><a href="#cb48-1872" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb48-1873"><a href="#cb48-1873" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb48-1874"><a href="#cb48-1874" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb48-1875"><a href="#cb48-1875" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb48-1876"><a href="#cb48-1876" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`-ΔCᵢ, where ΔA = </span><span class="sc">${</span>stringInputDeltaA<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb48-1877"><a href="#cb48-1877" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb48-1878"><a href="#cb48-1878" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb48-1879"><a href="#cb48-1879" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb48-1880"><a href="#cb48-1880" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb48-1881"><a href="#cb48-1881" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb48-1882"><a href="#cb48-1882" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(retirementData<span class="op">,</span> {</span>
<span id="cb48-1883"><a href="#cb48-1883" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1884"><a href="#cb48-1884" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1885"><a href="#cb48-1885" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1886"><a href="#cb48-1886" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb48-1887"><a href="#cb48-1887" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb48-1888"><a href="#cb48-1888" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb48-1889"><a href="#cb48-1889" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(retirementData<span class="op">,</span> {</span>
<span id="cb48-1890"><a href="#cb48-1890" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb48-1891"><a href="#cb48-1891" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb48-1892"><a href="#cb48-1892" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb48-1893"><a href="#cb48-1893" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb48-1894"><a href="#cb48-1894" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb48-1895"><a href="#cb48-1895" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb48-1896"><a href="#cb48-1896" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb48-1897"><a href="#cb48-1897" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb48-1898"><a href="#cb48-1898" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb48-1899"><a href="#cb48-1899" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fu">computeDeltaCi</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb48-1900"><a href="#cb48-1900" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fu">computeDeltaCi</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb48-1901"><a href="#cb48-1901" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb48-1902"><a href="#cb48-1902" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb48-1903"><a href="#cb48-1903" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb48-1904"><a href="#cb48-1904" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb48-1905"><a href="#cb48-1905" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb48-1906"><a href="#cb48-1906" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb48-1907"><a href="#cb48-1907" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-48" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-proportion-of-carbon-retired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Proportion of carbon retired.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-proportion-of-carbon-retired" class="quarto-xref">Figure&nbsp;14</a> shows the cost of carbon increasing with <span class="math inline">A_i</span> and decreasing on <span class="math inline">G_i</span>.</p>
</section>
<section id="sec-unweighted-carbon-class" class="level5" data-number="3.2.2.2">
<h5 data-number="3.2.2.2" class="anchored" data-anchor-id="sec-unweighted-carbon-class"><span class="header-section-number">3.2.2.2</span> Unweighted Carbon Class</h5>
<p>An offset certificate for a carbon class with a zero <strong>A</strong> allocation cannot be extracted from the portfolio by swapping in <strong>A</strong> tokens.</p>
</section>
<section id="sec-liquidation-delta-a-1" class="level5" data-number="3.2.2.3">
<h5 data-number="3.2.2.3" class="anchored" data-anchor-id="sec-liquidation-delta-a-1"><span class="header-section-number">3.2.2.3</span> Liquidation: <span class="math inline">\Delta A = 1</span></h5>
<p>In the event that 100% of <strong>A</strong> tokens are placed into the burn mechanism for carbon offset certificates, the balances of all carbon held in the portfolio post-trade are distributed to all <strong>G</strong> token holders.</p>
<p><a href="#fig-carbon-spread" class="quarto-xref">Figure&nbsp;15</a> below shows the spread captured on a ‘round trip’ by the system where <span class="math inline">\varepsilon</span> is the proportion retained:</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1940" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1939;"><span id="cb49-1940"><a href="#cb49-1940" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaCinitial <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb49-1941"><a href="#cb49-1941" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial }</span><span class="sc">\D</span><span class="vs">elta C`</span><span class="op">,</span></span>
<span id="cb49-1942"><a href="#cb49-1942" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb49-1943"><a href="#cb49-1943" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb49-1944"><a href="#cb49-1944" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-49" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-spread" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon spread.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-spread-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1956" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1955;"><span id="cb50-1956"><a href="#cb50-1956" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeSpread</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCinitial) {</span>
<span id="cb50-1957"><a href="#cb50-1957" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaA <span class="op">=</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCinitial)<span class="op">;</span></span>
<span id="cb50-1958"><a href="#cb50-1958" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaCfinal <span class="op">=</span> <span class="op">-</span><span class="fu">computeDeltaCi</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaA)<span class="op">;</span></span>
<span id="cb50-1959"><a href="#cb50-1959" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (deltaCinitial <span class="op">-</span> deltaCfinal) <span class="op">/</span> deltaCinitial<span class="op">;</span></span>
<span id="cb50-1960"><a href="#cb50-1960" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-50" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1965" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1964;"><span id="cb51-1965"><a href="#cb51-1965" aria-hidden="true" tabindex="-1"></a>liquidationData <span class="op">=</span> {</span>
<span id="cb51-1966"><a href="#cb51-1966" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> liquidationData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb51-1967"><a href="#cb51-1967" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb51-1968"><a href="#cb51-1968" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"deltaa"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-1969"><a href="#cb51-1969" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"deltac"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-1970"><a href="#cb51-1970" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"spread"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb51-1971"><a href="#cb51-1971" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb51-1972"><a href="#cb51-1972" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> deltaA <span class="op">=</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial)</span>
<span id="cb51-1973"><a href="#cb51-1973" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1974"><a href="#cb51-1974" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"deltaa"</span><span class="op">,</span></span>
<span id="cb51-1975"><a href="#cb51-1975" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-1976"><a href="#cb51-1976" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-1977"><a href="#cb51-1977" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial) <span class="op">/</span></span>
<span id="cb51-1978"><a href="#cb51-1978" aria-hidden="true" tabindex="-1"></a>                inputDeltaCinitial<span class="op">,</span></span>
<span id="cb51-1979"><a href="#cb51-1979" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-1980"><a href="#cb51-1980" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1981"><a href="#cb51-1981" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"deltac"</span><span class="op">,</span></span>
<span id="cb51-1982"><a href="#cb51-1982" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-1983"><a href="#cb51-1983" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-1984"><a href="#cb51-1984" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaCi</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> deltaA) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb51-1985"><a href="#cb51-1985" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-1986"><a href="#cb51-1986" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1987"><a href="#cb51-1987" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"spread"</span><span class="op">,</span></span>
<span id="cb51-1988"><a href="#cb51-1988" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb51-1989"><a href="#cb51-1989" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb51-1990"><a href="#cb51-1990" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeSpread</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial)<span class="op">,</span></span>
<span id="cb51-1991"><a href="#cb51-1991" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb51-1992"><a href="#cb51-1992" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-1993"><a href="#cb51-1993" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-1994"><a href="#cb51-1994" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> liquidationData<span class="op">;</span></span>
<span id="cb51-1995"><a href="#cb51-1995" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb51-1996"><a href="#cb51-1996" aria-hidden="true" tabindex="-1"></a>getLiqDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"deltaa"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-1997"><a href="#cb51-1997" aria-hidden="true" tabindex="-1"></a>getLiqDeltaCi <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"deltac"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-1998"><a href="#cb51-1998" aria-hidden="true" tabindex="-1"></a>getLiqSpread <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"spread"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-1999"><a href="#cb51-1999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2000"><a href="#cb51-2000" aria-hidden="true" tabindex="-1"></a>stringInputDeltaCinitial <span class="op">=</span> inputDeltaCinitial<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb51-2001"><a href="#cb51-2001" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb51-2002"><a href="#cb51-2002" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb51-2003"><a href="#cb51-2003" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="2006" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2005;"><span id="cb52-2006"><a href="#cb52-2006" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb52-2007"><a href="#cb52-2007" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb52-2008"><a href="#cb52-2008" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb52-2009"><a href="#cb52-2009" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb52-2010"><a href="#cb52-2010" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeSpread</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span></span>
<span id="cb52-2011"><a href="#cb52-2011" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb52-2012"><a href="#cb52-2012" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Carbon Spread ε, where initial ΔC = </span><span class="sc">${</span>stringInputDeltaCinitial<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb52-2013"><a href="#cb52-2013" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb52-2014"><a href="#cb52-2014" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb52-2015"><a href="#cb52-2015" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb52-2016"><a href="#cb52-2016" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb52-2017"><a href="#cb52-2017" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb52-2018"><a href="#cb52-2018" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb52-2019"><a href="#cb52-2019" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2020"><a href="#cb52-2020" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2021"><a href="#cb52-2021" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2022"><a href="#cb52-2022" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb52-2023"><a href="#cb52-2023" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqSpread<span class="op">,</span></span>
<span id="cb52-2024"><a href="#cb52-2024" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb52-2025"><a href="#cb52-2025" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb52-2026"><a href="#cb52-2026" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb52-2027"><a href="#cb52-2027" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb52-2028"><a href="#cb52-2028" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqSpread</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb52-2029"><a href="#cb52-2029" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb52-2030"><a href="#cb52-2030" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb52-2031"><a href="#cb52-2031" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb52-2032"><a href="#cb52-2032" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb52-2033"><a href="#cb52-2033" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb52-2034"><a href="#cb52-2034" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeSpread</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial)]<span class="op">,</span></span>
<span id="cb52-2035"><a href="#cb52-2035" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb52-2036"><a href="#cb52-2036" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb52-2037"><a href="#cb52-2037" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb52-2038"><a href="#cb52-2038" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb52-2039"><a href="#cb52-2039" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb52-2040"><a href="#cb52-2040" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-52" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-spread-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Carbon ‘spread’.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-carbon-spread-components" class="quarto-xref">Figure&nbsp;16</a> shows the component ‘spread’ contributions on a carbon sale and purchase round trip of a carbon offset certificate.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="2059" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2058;"><span id="cb53-2059"><a href="#cb53-2059" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb53-2060"><a href="#cb53-2060" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb53-2061"><a href="#cb53-2061" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial }</span><span class="sc">\D</span><span class="vs">elta C`</span><span class="op">,</span></span>
<span id="cb53-2062"><a href="#cb53-2062" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb53-2063"><a href="#cb53-2063" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb53-2064"><a href="#cb53-2064" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb53-2065"><a href="#cb53-2065" aria-hidden="true" tabindex="-1"></a>  viewof inputDeltaCinitial<span class="op">,</span></span>
<span id="cb53-2066"><a href="#cb53-2066" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-53" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-spread-components" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-spread-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="2079" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2078;"><span id="cb54-2079"><a href="#cb54-2079" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb54-2080"><a href="#cb54-2080" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb54-2081"><a href="#cb54-2081" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb54-2082"><a href="#cb54-2082" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb54-2083"><a href="#cb54-2083" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb54-2084"><a href="#cb54-2084" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb54-2085"><a href="#cb54-2085" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Component ΔA, where initial ΔC = </span><span class="sc">${</span></span>
<span id="cb54-2086"><a href="#cb54-2086" aria-hidden="true" tabindex="-1"></a>      stringInputDeltaCinitial</span>
<span id="cb54-2087"><a href="#cb54-2087" aria-hidden="true" tabindex="-1"></a>    <span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb54-2088"><a href="#cb54-2088" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb54-2089"><a href="#cb54-2089" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb54-2090"><a href="#cb54-2090" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb54-2091"><a href="#cb54-2091" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb54-2092"><a href="#cb54-2092" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb54-2093"><a href="#cb54-2093" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb54-2094"><a href="#cb54-2094" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2095"><a href="#cb54-2095" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2096"><a href="#cb54-2096" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2097"><a href="#cb54-2097" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb54-2098"><a href="#cb54-2098" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqDeltaA<span class="op">,</span></span>
<span id="cb54-2099"><a href="#cb54-2099" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb54-2100"><a href="#cb54-2100" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb54-2101"><a href="#cb54-2101" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb54-2102"><a href="#cb54-2102" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb54-2103"><a href="#cb54-2103" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb54-2104"><a href="#cb54-2104" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb54-2105"><a href="#cb54-2105" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb54-2106"><a href="#cb54-2106" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb54-2107"><a href="#cb54-2107" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(d3<span class="op">.</span><span class="fu">interpolateSpectral</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">,</span></span>
<span id="cb54-2108"><a href="#cb54-2108" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb54-2109"><a href="#cb54-2109" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb54-2110"><a href="#cb54-2110" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-54" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-54-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-54" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-54-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Carbon ‘spread’ component ΔA.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="2115" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2114;"><span id="cb55-2115"><a href="#cb55-2115" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb55-2116"><a href="#cb55-2116" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb55-2117"><a href="#cb55-2117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb55-2118"><a href="#cb55-2118" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Greys"</span><span class="op">,</span></span>
<span id="cb55-2119"><a href="#cb55-2119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb55-2120"><a href="#cb55-2120" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2121"><a href="#cb55-2121" aria-hidden="true" tabindex="-1"></a>      <span class="fu">computeDeltaCi</span>(</span>
<span id="cb55-2122"><a href="#cb55-2122" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2123"><a href="#cb55-2123" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span></span>
<span id="cb55-2124"><a href="#cb55-2124" aria-hidden="true" tabindex="-1"></a>        <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb55-2125"><a href="#cb55-2125" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2126"><a href="#cb55-2126" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb55-2127"><a href="#cb55-2127" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Component ΔC, where initial ΔC = </span><span class="sc">${</span></span>
<span id="cb55-2128"><a href="#cb55-2128" aria-hidden="true" tabindex="-1"></a>      stringInputDeltaCinitial</span>
<span id="cb55-2129"><a href="#cb55-2129" aria-hidden="true" tabindex="-1"></a>    <span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb55-2130"><a href="#cb55-2130" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb55-2131"><a href="#cb55-2131" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb55-2132"><a href="#cb55-2132" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb55-2133"><a href="#cb55-2133" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb55-2134"><a href="#cb55-2134" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb55-2135"><a href="#cb55-2135" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb55-2136"><a href="#cb55-2136" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2137"><a href="#cb55-2137" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2138"><a href="#cb55-2138" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2139"><a href="#cb55-2139" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2140"><a href="#cb55-2140" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqDeltaCi<span class="op">,</span></span>
<span id="cb55-2141"><a href="#cb55-2141" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb55-2142"><a href="#cb55-2142" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb55-2143"><a href="#cb55-2143" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb55-2144"><a href="#cb55-2144" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb55-2145"><a href="#cb55-2145" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqDeltaCi</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb55-2146"><a href="#cb55-2146" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb55-2147"><a href="#cb55-2147" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb55-2148"><a href="#cb55-2148" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2149"><a href="#cb55-2149" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb55-2150"><a href="#cb55-2150" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb55-2151"><a href="#cb55-2151" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb55-2152"><a href="#cb55-2152" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2153"><a href="#cb55-2153" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaCi</span>(</span>
<span id="cb55-2154"><a href="#cb55-2154" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span><span class="op">,</span></span>
<span id="cb55-2155"><a href="#cb55-2155" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span><span class="op">,</span></span>
<span id="cb55-2156"><a href="#cb55-2156" aria-hidden="true" tabindex="-1"></a>              <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb55-2157"><a href="#cb55-2157" aria-hidden="true" tabindex="-1"></a>            )<span class="op">,</span></span>
<span id="cb55-2158"><a href="#cb55-2158" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb55-2159"><a href="#cb55-2159" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateGreys</span><span class="op">,</span></span>
<span id="cb55-2160"><a href="#cb55-2160" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb55-2161"><a href="#cb55-2161" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb55-2162"><a href="#cb55-2162" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb55-2163"><a href="#cb55-2163" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb55-2164"><a href="#cb55-2164" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-55" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-55-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-55" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-55-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Carbon ‘spread’ component ΔC.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-spread-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Carbon ‘spread’ components.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-liquidity-markets" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="sec-liquidity-markets"><span class="header-section-number">3.3</span> Liquidity Markets</h3>
<p>Both <strong>A</strong> and <strong>G</strong> tokens can be used for providing liquidity.</p>
<div id="fig-token-liquidity" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token liquidity and pricing structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-liquidity.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Token liquidity and pricing structure.
</figcaption>
</figure>
</div>
<p>There are two core liquidity pools:</p>
<ol type="1">
<li><p>An AAM 50:50 pairing of <strong>A</strong> and <strong>G</strong>&nbsp;tokens: pool <span class="overline"><strong>AG</strong></span>.</p></li>
<li><p>A hard currency USDC denoted as <strong>Q</strong> paired with <strong>A</strong>: pool <span class="overline"><strong>AQ</strong></span>.</p></li>
</ol>
<section id="sec-liquidity-fees" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="sec-liquidity-fees"><span class="header-section-number">3.3.1</span> Liquidity Fees</h4>
<p>The <span class="overline"><strong>AQ</strong></span> pool will have its own set of fees in the normal way.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The <span class="overline"><strong>AG</strong></span> pool has different economics as the assets are highly correlated since they represent the same economy. For this reason, the fees are extremely low.</p>
<p>By staking liquidity&nbsp;(liquidity provider tokens) to the <strong>standard maturities</strong>, both pools may receive a distribution of <strong>A</strong> tokens determined from the Risk Premium calculation below. This is an <u>additional</u> primary issuance to the Base Accrual already discussed.</p>
</section>
<section id="sec-risk-premium-beta-determination" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="sec-risk-premium-beta-determination"><span class="header-section-number">3.3.2</span> Risk Premium: Beta Determination</h4>
<p>We can consider the Time-Locked Market yield as the system’s <em>risk-free</em> rate. In addition to this mechanism, a <em>risky</em> spread is determined that is ultimately paid to the staked liquidity providers of the <strong>A</strong> and <strong>G</strong> tokens as compensation for the risk levels assumed.</p>
<p>As we have seen, the <strong>G</strong> token has an impact on risk-pricing of <strong>A</strong>. As <strong>G</strong> staking increases, the relationship between the carbon class selected under <span class="math inline">G_i</span> and the portfolio token <strong>A</strong> strengthens. We can consider <span class="math inline">G_i</span> staking as an estimate of residual or idiosyncratic risk in the carbon class and this allows us to calculate a portfolio beta <span class="math inline">\beta</span> from the implied betas of each carbon class <span class="math inline">i</span>.</p>
<p><span id="eq-beta"><span class="math display">
\beta = \sqrt{\sum_{i=1}^n A_i - A_i \, (1 - G_i)^2}
\tag{22}</span></span></p>
<p>The portfolio <span class="math inline">\beta</span> determines a yield factor for the liquidity pools of <strong>A</strong> to compensate for the implied risk levels.</p>
<p>For intuition, the map in <a href="#fig-range-of-beta-i" class="quarto-xref">Figure&nbsp;18</a> shows the various outputs of the function per carbon class.</p>
<div id="fig-range-of-beta-i" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Range of Beta i.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-range-of-beta-i-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="2269" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2268;"><span id="cb56-2269"><a href="#cb56-2269" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeBeta</span>(vecAi<span class="op">,</span> vecGi) {</span>
<span id="cb56-2270"><a href="#cb56-2270" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> beta2 <span class="op">=</span> vecAi<span class="op">.</span><span class="fu">reduce</span>(</span>
<span id="cb56-2271"><a href="#cb56-2271" aria-hidden="true" tabindex="-1"></a>    (acc<span class="op">,</span> Ai<span class="op">,</span> i) <span class="kw">=&gt;</span> acc <span class="op">+</span> Ai <span class="op">-</span> Ai <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> vecGi[i])<span class="op">**</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb56-2272"><a href="#cb56-2272" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span><span class="op">,</span></span>
<span id="cb56-2273"><a href="#cb56-2273" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb56-2274"><a href="#cb56-2274" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(beta2)<span class="op">;</span></span>
<span id="cb56-2275"><a href="#cb56-2275" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-56" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb57" data-startfrom="2279" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2278;"><span id="cb57-2279"><a href="#cb57-2279" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> Gi) {</span>
<span id="cb57-2280"><a href="#cb57-2280" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(Ai <span class="op">-</span> Ai <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb57-2281"><a href="#cb57-2281" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-57" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb58" data-startfrom="2285" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2284;"><span id="cb58-2285"><a href="#cb58-2285" aria-hidden="true" tabindex="-1"></a>betaData <span class="op">=</span> {</span>
<span id="cb58-2286"><a href="#cb58-2286" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> betaData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb58-2287"><a href="#cb58-2287" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb58-2288"><a href="#cb58-2288" aria-hidden="true" tabindex="-1"></a>    betaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb58-2289"><a href="#cb58-2289" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb58-2290"><a href="#cb58-2290" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb58-2291"><a href="#cb58-2291" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb58-2292"><a href="#cb58-2292" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb58-2293"><a href="#cb58-2293" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb58-2294"><a href="#cb58-2294" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb58-2295"><a href="#cb58-2295" aria-hidden="true" tabindex="-1"></a>      betaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb58-2296"><a href="#cb58-2296" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb58-2297"><a href="#cb58-2297" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb58-2298"><a href="#cb58-2298" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb58-2299"><a href="#cb58-2299" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeBetai</span>(paramAi<span class="op">,</span> paramGi)<span class="op">,</span></span>
<span id="cb58-2300"><a href="#cb58-2300" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb58-2301"><a href="#cb58-2301" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-2302"><a href="#cb58-2302" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-2303"><a href="#cb58-2303" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> betaData<span class="op">;</span></span>
<span id="cb58-2304"><a href="#cb58-2304" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-58" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb59" data-startfrom="2308" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2307;"><span id="cb59-2308"><a href="#cb59-2308" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb59-2309"><a href="#cb59-2309" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb59-2310"><a href="#cb59-2310" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb59-2311"><a href="#cb59-2311" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb59-2312"><a href="#cb59-2312" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb59-2313"><a href="#cb59-2313" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb59-2314"><a href="#cb59-2314" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb59-2315"><a href="#cb59-2315" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb59-2316"><a href="#cb59-2316" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb59-2317"><a href="#cb59-2317" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb59-2318"><a href="#cb59-2318" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb59-2319"><a href="#cb59-2319" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(betaData<span class="op">,</span> {</span>
<span id="cb59-2320"><a href="#cb59-2320" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2321"><a href="#cb59-2321" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2322"><a href="#cb59-2322" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2323"><a href="#cb59-2323" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2324"><a href="#cb59-2324" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb59-2325"><a href="#cb59-2325" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb59-2326"><a href="#cb59-2326" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(betaData<span class="op">,</span> {</span>
<span id="cb59-2327"><a href="#cb59-2327" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb59-2328"><a href="#cb59-2328" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb59-2329"><a href="#cb59-2329" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb59-2330"><a href="#cb59-2330" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb59-2331"><a href="#cb59-2331" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb59-2332"><a href="#cb59-2332" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb59-2333"><a href="#cb59-2333" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(d3<span class="op">.</span><span class="fu">interpolateSpectral</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">,</span></span>
<span id="cb59-2334"><a href="#cb59-2334" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb59-2335"><a href="#cb59-2335" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb59-2336"><a href="#cb59-2336" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-59" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-range-of-beta-i-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Range of <span class="math inline">\beta_i</span>.
</figcaption>
</figure>
</div>
<p>The table and figure below show an example of the effects on <span class="math inline">\beta</span> of allocating large <span class="math inline">G_i</span> values to small <span class="math inline">A_i</span> values where the shift in <span class="math inline">G_i</span> results in a lower <span class="math inline">\beta</span>&nbsp;(0.27 from 0.55) with no change to total <strong>G</strong> and <strong>A</strong> allocations.</p>
<div id="tbl-effect-on-beta-from-outsized-g-staking" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[15,10,10,10,10,10]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-effect-on-beta-from-outsized-g-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Class</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
<th style="text-align: left;">3</th>
<th style="text-align: left;">4</th>
<th style="text-align: left;"><span class="math inline">\beta</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">A_i</span></td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">0.20</td>
<td style="text-align: left;">0.10</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Initial <span class="math inline">G_i</span></td>
<td style="text-align: left;"><span class="blue">0.30</span></td>
<td style="text-align: left;"><span class="blue">0.10</span></td>
<td style="text-align: left;"><span class="blue">0.05</span></td>
<td style="text-align: left;"><span class="blue">0.01</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Initial <span class="math inline">\beta_i^2</span></td>
<td style="text-align: left;">0.2550</td>
<td style="text-align: left;">0.0380</td>
<td style="text-align: left;">0.0098</td>
<td style="text-align: left;">0.0010</td>
<td style="text-align: left;"><span class="blue">0.5511</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">New <span class="math inline">G_i</span></td>
<td style="text-align: left;"><span class="red">0.01</span></td>
<td style="text-align: left;"><span class="red">0.05</span></td>
<td style="text-align: left;"><span class="red">0.10</span></td>
<td style="text-align: left;"><span class="red">0.30</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">New <span class="math inline">\beta_i^2</span></td>
<td style="text-align: left;">0.0100</td>
<td style="text-align: left;">0.0195</td>
<td style="text-align: left;">0.0190</td>
<td style="text-align: left;">0.0255</td>
<td style="text-align: left;"><span class="red">0.2719</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\Delta G_i</span></td>
<td style="text-align: left;">(0.29)</td>
<td style="text-align: left;">(0.05)</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;">0.29</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\Delta \beta_i^2</span></td>
<td style="text-align: left;">(0.2451)</td>
<td style="text-align: left;">(0.0185)</td>
<td style="text-align: left;">0.0092</td>
<td style="text-align: left;">0.0245</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-effect-on-beta-from-outsized-g-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Effect on <span class="math inline">\beta</span> from outsized <strong>G</strong> allocation.
</figcaption>
</figure>
</div>
<div id="fig-example-of-g-stake-on-beta" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Example of G allocation on Beta.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-example-of-g-stake-on-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb60" data-startfrom="2384" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2383;"><span id="cb60-2384"><a href="#cb60-2384" aria-hidden="true" tabindex="-1"></a>arrayAi <span class="op">=</span> [<span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.05</span>]<span class="op">;</span></span>
<span id="cb60-2385"><a href="#cb60-2385" aria-hidden="true" tabindex="-1"></a>arrayInitialGi <span class="op">=</span> [<span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.01</span>]<span class="op">;</span></span>
<span id="cb60-2386"><a href="#cb60-2386" aria-hidden="true" tabindex="-1"></a>arrayNewGi <span class="op">=</span> arrayInitialGi<span class="op">.</span><span class="fu">toReversed</span>()<span class="op">;</span></span>
<span id="cb60-2387"><a href="#cb60-2387" aria-hidden="true" tabindex="-1"></a>betaContribData <span class="op">=</span> {</span>
<span id="cb60-2388"><a href="#cb60-2388" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> betaContribData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb60-2389"><a href="#cb60-2389" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> arrayAi<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb60-2390"><a href="#cb60-2390" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> Ai <span class="op">=</span> arrayAi[i]<span class="op">;</span></span>
<span id="cb60-2391"><a href="#cb60-2391" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialGi <span class="op">=</span> arrayInitialGi[i]<span class="op">;</span></span>
<span id="cb60-2392"><a href="#cb60-2392" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialBeta2 <span class="op">=</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> initialGi)<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb60-2393"><a href="#cb60-2393" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newGi <span class="op">=</span> arrayNewGi[i]<span class="op">;</span></span>
<span id="cb60-2394"><a href="#cb60-2394" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newBeta2 <span class="op">=</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> newGi)<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb60-2395"><a href="#cb60-2395" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Initial Gᵢ"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> initialGi })<span class="op">;</span></span>
<span id="cb60-2396"><a href="#cb60-2396" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Initial βᵢ²"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> initialBeta2 })<span class="op">;</span></span>
<span id="cb60-2397"><a href="#cb60-2397" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"New Gᵢ"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> newGi })<span class="op">;</span></span>
<span id="cb60-2398"><a href="#cb60-2398" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"New βᵢ²"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> newBeta2 })<span class="op">;</span></span>
<span id="cb60-2399"><a href="#cb60-2399" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-2400"><a href="#cb60-2400" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> betaContribData<span class="op">;</span></span>
<span id="cb60-2401"><a href="#cb60-2401" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb60-2402"><a href="#cb60-2402" aria-hidden="true" tabindex="-1"></a>getInitialG <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Initial Gᵢ"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2403"><a href="#cb60-2403" aria-hidden="true" tabindex="-1"></a>getInitialBeta2 <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Initial βᵢ²"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2404"><a href="#cb60-2404" aria-hidden="true" tabindex="-1"></a>getNewG <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"New Gᵢ"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2405"><a href="#cb60-2405" aria-hidden="true" tabindex="-1"></a>getNewBeta2 <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"New βᵢ²"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb60-2406"><a href="#cb60-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2407"><a href="#cb60-2407" aria-hidden="true" tabindex="-1"></a>domainG <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(arrayInitialGi)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(arrayNewGi))]<span class="op">;</span></span>
<span id="cb60-2408"><a href="#cb60-2408" aria-hidden="true" tabindex="-1"></a>rangeBeta2 <span class="op">=</span> [</span>
<span id="cb60-2409"><a href="#cb60-2409" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb60-2410"><a href="#cb60-2410" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(</span>
<span id="cb60-2411"><a href="#cb60-2411" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">max</span>(betaContribData<span class="op">,</span> getInitialBeta2)<span class="op">,</span></span>
<span id="cb60-2412"><a href="#cb60-2412" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">max</span>(betaContribData<span class="op">,</span> getNewBeta2)<span class="op">,</span></span>
<span id="cb60-2413"><a href="#cb60-2413" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb60-2414"><a href="#cb60-2414" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb60-2415"><a href="#cb60-2415" aria-hidden="true" tabindex="-1"></a>scaleG <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(domainG<span class="op">,</span> rangeBeta2)<span class="op">;</span></span>
<span id="cb60-2416"><a href="#cb60-2416" aria-hidden="true" tabindex="-1"></a>mapScaleG <span class="op">=</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>(scaleG)<span class="op">;</span></span>
<span id="cb60-2417"><a href="#cb60-2417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2418"><a href="#cb60-2418" aria-hidden="true" tabindex="-1"></a>paramInitialBeta <span class="op">=</span> <span class="fu">computeBeta</span>(arrayAi<span class="op">,</span> arrayInitialGi)<span class="op">;</span></span>
<span id="cb60-2419"><a href="#cb60-2419" aria-hidden="true" tabindex="-1"></a>paramNewBeta <span class="op">=</span> <span class="fu">computeBeta</span>(arrayAi<span class="op">,</span> arrayNewGi)<span class="op">;</span></span>
<span id="cb60-2420"><a href="#cb60-2420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2421"><a href="#cb60-2421" aria-hidden="true" tabindex="-1"></a>stringInitialBeta <span class="op">=</span> <span class="st">"Initial β = "</span> <span class="op">+</span> paramInitialBeta<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb60-2422"><a href="#cb60-2422" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb60-2423"><a href="#cb60-2423" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb60-2424"><a href="#cb60-2424" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb60-2425"><a href="#cb60-2425" aria-hidden="true" tabindex="-1"></a>stringNewBeta <span class="op">=</span> <span class="st">"New β = "</span> <span class="op">+</span> paramNewBeta<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb60-2426"><a href="#cb60-2426" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb60-2427"><a href="#cb60-2427" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb60-2428"><a href="#cb60-2428" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-16" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb61" data-startfrom="2431" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2430;"><span id="cb61-2431"><a href="#cb61-2431" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb61-2432"><a href="#cb61-2432" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb61-2433"><a href="#cb61-2433" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb61-2434"><a href="#cb61-2434" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="st">"gray"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"red"</span>]<span class="op">,</span></span>
<span id="cb61-2435"><a href="#cb61-2435" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Initial βᵢ²"</span><span class="op">,</span> <span class="st">"New βᵢ²"</span><span class="op">,</span> <span class="st">"Initial Gᵢ"</span><span class="op">,</span> <span class="st">"New Gᵢ"</span>]<span class="op">,</span></span>
<span id="cb61-2436"><a href="#cb61-2436" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb61-2437"><a href="#cb61-2437" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb61-2438"><a href="#cb61-2438" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">4</span>)<span class="op">,</span></span>
<span id="cb61-2439"><a href="#cb61-2439" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ Over 4 Classes"</span><span class="op">,</span></span>
<span id="cb61-2440"><a href="#cb61-2440" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> arrayAi[d]<span class="op">,</span></span>
<span id="cb61-2441"><a href="#cb61-2441" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb61-2442"><a href="#cb61-2442" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> rangeBeta2 }<span class="op">,</span></span>
<span id="cb61-2443"><a href="#cb61-2443" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb61-2444"><a href="#cb61-2444" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb61-2445"><a href="#cb61-2445" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb61-2446"><a href="#cb61-2446" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb61-2447"><a href="#cb61-2447" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb61-2448"><a href="#cb61-2448" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"βᵢ²"</span> })<span class="op">,</span></span>
<span id="cb61-2449"><a href="#cb61-2449" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>(scaleG<span class="op">.</span><span class="fu">ticks</span>()<span class="op">,</span> { <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> scaleG })<span class="op">,</span></span>
<span id="cb61-2450"><a href="#cb61-2450" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(betaContribData<span class="op">,</span> {</span>
<span id="cb61-2451"><a href="#cb61-2451" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb61-2452"><a href="#cb61-2452" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span><span class="op">,</span></span>
<span id="cb61-2453"><a href="#cb61-2453" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialBeta2<span class="op">,</span></span>
<span id="cb61-2454"><a href="#cb61-2454" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2455"><a href="#cb61-2455" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb61-2456"><a href="#cb61-2456" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(betaContribData<span class="op">,</span> {</span>
<span id="cb61-2457"><a href="#cb61-2457" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span><span class="op">,</span></span>
<span id="cb61-2458"><a href="#cb61-2458" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb61-2459"><a href="#cb61-2459" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewBeta2<span class="op">,</span></span>
<span id="cb61-2460"><a href="#cb61-2460" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2461"><a href="#cb61-2461" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb61-2462"><a href="#cb61-2462" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2463"><a href="#cb61-2463" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2464"><a href="#cb61-2464" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialG<span class="op">,</span></span>
<span id="cb61-2465"><a href="#cb61-2465" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2466"><a href="#cb61-2466" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb61-2467"><a href="#cb61-2467" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2468"><a href="#cb61-2468" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2469"><a href="#cb61-2469" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2470"><a href="#cb61-2470" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialG<span class="op">,</span></span>
<span id="cb61-2471"><a href="#cb61-2471" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2472"><a href="#cb61-2472" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2473"><a href="#cb61-2473" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2474"><a href="#cb61-2474" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2475"><a href="#cb61-2475" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewG<span class="op">,</span></span>
<span id="cb61-2476"><a href="#cb61-2476" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2477"><a href="#cb61-2477" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb61-2478"><a href="#cb61-2478" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2479"><a href="#cb61-2479" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb61-2480"><a href="#cb61-2480" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb61-2481"><a href="#cb61-2481" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewG<span class="op">,</span></span>
<span id="cb61-2482"><a href="#cb61-2482" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb61-2483"><a href="#cb61-2483" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb61-2484"><a href="#cb61-2484" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([stringInitialBeta]<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fl">0.23</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="st">"blue"</span> })<span class="op">,</span></span>
<span id="cb61-2485"><a href="#cb61-2485" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([stringNewBeta]<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fl">0.23</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="st">"red"</span> })<span class="op">,</span></span>
<span id="cb61-2486"><a href="#cb61-2486" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb61-2487"><a href="#cb61-2487" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-61" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-example-of-g-stake-on-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Example of <strong>G</strong> allocation on <span class="math inline">\beta</span>.
</figcaption>
</figure>
</div>
<p><a href="#fig-example-of-g-stake-on-beta" class="quarto-xref">Figure&nbsp;19</a> shows <span class="math inline">\beta</span>’s sensitivity to <strong>G</strong> allocation as a function of <strong>A</strong> allocation; that is to say that a large <span class="math inline">G_i</span> stake on a small <span class="math inline">A_i</span> stake has limited effects&nbsp;(notwithstanding other consequential factors).</p>
</section>
<section id="sec-allocation-of-risk-premium" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="sec-allocation-of-risk-premium"><span class="header-section-number">3.3.3</span> Allocation of Risk Premium</h4>
<p>The full issuance of <strong>A</strong> tokens is depicted below including now the Risk Premium for the liquidity pools accordingly.</p>
<div id="fig-a-token-flow-structure" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A token flow structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-token-flow-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/a-token-flow-structure.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-token-flow-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: <strong>A</strong> token flow structure.
</figcaption>
</figure>
</div>
</section>
<section id="sec-share-of-risk-premium" class="level4" data-number="3.3.4">
<h4 data-number="3.3.4" class="anchored" data-anchor-id="sec-share-of-risk-premium"><span class="header-section-number">3.3.4</span> Share of Risk Premium</h4>
<p>The Risk Premium allocation is shared between user-locked <strong>G</strong> tokens, <span class="overline"><strong>AG</strong></span>. and <span class="overline"><strong>AQ</strong></span> pools, with shares <span class="math inline">\lambda_{GG}</span>, <span class="math inline">\lambda_G</span>, and <span class="math inline">\lambda_Q</span> respectively.</p>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">G_G</span>: Total <strong>G</strong> tokens in the <span class="overline"><strong>AG</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>G</strong>.</p></li>
<li><p><span class="math inline">A_G</span>: Total <strong>A</strong>&nbsp;tokens in the <span class="overline"><strong>AG</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
<li><p><span class="math inline">A_Q</span>: Total <strong>A</strong>&nbsp;tokens in the <span class="overline"><strong>AQ</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
</ul>
<p>The allocation to user-locked <strong>G</strong> tokens, <span class="math inline">\lambda_{GG}</span>:</p>
<p><span id="eq-lambda-gg"><span class="math display">
\lambda_{GG} = \frac{1 - A_Q}{1 + \left( \frac{\sum_{i=1}^{n}{G_i}}{G_G} \right)^2}
\tag{23}</span></span></p>
<div id="fig-g-stake-allocation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="G stake allocation.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-g-stake-allocation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb62" data-startfrom="2568" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2567;"><span id="cb62-2568"><a href="#cb62-2568" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaGG</span>(AQ<span class="op">,</span> Gi<span class="op">,</span> GG) {</span>
<span id="cb62-2569"><a href="#cb62-2569" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> AQ) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> (Gi <span class="op">/</span> GG)<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb62-2570"><a href="#cb62-2570" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-2571"><a href="#cb62-2571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2572"><a href="#cb62-2572" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">changeTranslation</span>(dx<span class="op">,</span> dy) {</span>
<span id="cb62-2573"><a href="#cb62-2573" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">function</span> () {</span>
<span id="cb62-2574"><a href="#cb62-2574" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svgTransformList <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">transform</span><span class="op">.</span><span class="at">baseVal</span><span class="op">;</span></span>
<span id="cb62-2575"><a href="#cb62-2575" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (svgTransformList<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb62-2576"><a href="#cb62-2576" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"SVGTransformList must only contain one translation"</span>)<span class="op">;</span></span>
<span id="cb62-2577"><a href="#cb62-2577" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-2578"><a href="#cb62-2578" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {e<span class="op">,</span> f} <span class="op">=</span> svgTransformList<span class="op">.</span><span class="fu">consolidate</span>()<span class="op">.</span><span class="at">matrix</span><span class="op">;</span></span>
<span id="cb62-2579"><a href="#cb62-2579" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`translate(</span><span class="sc">${</span>e <span class="op">+</span> dx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>f <span class="op">+</span> dy<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb62-2580"><a href="#cb62-2580" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-2581"><a href="#cb62-2581" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-62-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-62-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb63" data-startfrom="2584" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2583;"><span id="cb63-2584"><a href="#cb63-2584" aria-hidden="true" tabindex="-1"></a>lambdaGGData <span class="op">=</span> {</span>
<span id="cb63-2585"><a href="#cb63-2585" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambdaGGData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb63-2586"><a href="#cb63-2586" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb63-2587"><a href="#cb63-2587" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAQ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAQ <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb63-2588"><a href="#cb63-2588" aria-hidden="true" tabindex="-1"></a>      lambdaGGData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb63-2589"><a href="#cb63-2589" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb63-2590"><a href="#cb63-2590" aria-hidden="true" tabindex="-1"></a>        <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb63-2591"><a href="#cb63-2591" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb63-2592"><a href="#cb63-2592" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaGG</span>(paramAQ<span class="op">,</span> paramGi<span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> paramGi)<span class="op">,</span></span>
<span id="cb63-2593"><a href="#cb63-2593" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb63-2594"><a href="#cb63-2594" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-2595"><a href="#cb63-2595" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-2596"><a href="#cb63-2596" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> lambdaGGData<span class="op">;</span></span>
<span id="cb63-2597"><a href="#cb63-2597" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-63" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb64" data-startfrom="2601" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2600;"><span id="cb64-2601"><a href="#cb64-2601" aria-hidden="true" tabindex="-1"></a>plotLambdaGG <span class="op">=</span> {</span>
<span id="cb64-2602"><a href="#cb64-2602" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotLambdaGG <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb64-2603"><a href="#cb64-2603" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb64-2604"><a href="#cb64-2604" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb64-2605"><a href="#cb64-2605" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb64-2606"><a href="#cb64-2606" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb64-2607"><a href="#cb64-2607" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb64-2608"><a href="#cb64-2608" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb64-2609"><a href="#cb64-2609" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb64-2610"><a href="#cb64-2610" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"A  "</span> }<span class="op">,</span></span>
<span id="cb64-2611"><a href="#cb64-2611" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb64-2612"><a href="#cb64-2612" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb64-2613"><a href="#cb64-2613" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb64-2614"><a href="#cb64-2614" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(lambdaGGData<span class="op">,</span> {</span>
<span id="cb64-2615"><a href="#cb64-2615" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2616"><a href="#cb64-2616" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2617"><a href="#cb64-2617" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2618"><a href="#cb64-2618" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb64-2619"><a href="#cb64-2619" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb64-2620"><a href="#cb64-2620" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb64-2621"><a href="#cb64-2621" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(lambdaGGData<span class="op">,</span> {</span>
<span id="cb64-2622"><a href="#cb64-2622" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"aq"</span><span class="op">,</span></span>
<span id="cb64-2623"><a href="#cb64-2623" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb64-2624"><a href="#cb64-2624" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2625"><a href="#cb64-2625" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2626"><a href="#cb64-2626" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb64-2627"><a href="#cb64-2627" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb64-2628"><a href="#cb64-2628" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb64-2629"><a href="#cb64-2629" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb64-2630"><a href="#cb64-2630" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb64-2631"><a href="#cb64-2631" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb64-2632"><a href="#cb64-2632" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb64-2633"><a href="#cb64-2633" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb64-2634"><a href="#cb64-2634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2635"><a href="#cb64-2635" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGG)</span>
<span id="cb64-2636"><a href="#cb64-2636" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='x-axis label']"</span>)</span>
<span id="cb64-2637"><a href="#cb64-2637" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb64-2638"><a href="#cb64-2638" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb64-2639"><a href="#cb64-2639" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="fl">1.5</span>))</span>
<span id="cb64-2640"><a href="#cb64-2640" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb64-2641"><a href="#cb64-2641" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb64-2642"><a href="#cb64-2642" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb64-2643"><a href="#cb64-2643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2644"><a href="#cb64-2644" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotLambdaGG<span class="op">;</span></span>
<span id="cb64-2645"><a href="#cb64-2645" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-64" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-g-stake-allocation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: <strong>G</strong> stake allocation&nbsp;(assuming <span class="math inline">G_G = 1 - G_i</span>).
</figcaption>
</figure>
</div>
<p>Noting the relationship between <span class="math inline">G</span> and <span class="math inline">\beta</span>, and particularly if <span class="math inline">G = 0</span>, <span class="math inline">\beta = 0</span>.</p>
<p>The residual share, <span class="math inline">1 - \lambda_{GG}</span>, is split between the liquidity pools:</p>
<p><span id="eq-lambda-g"><span class="math display">
\lambda_G = (1 - \lambda_{GG}) \frac{2 A_G}{2 A_G + A_Q \sqrt 2}
\tag{24}</span></span></p>
<p>For completeness:</p>
<p><span id="eq-lambda-q"><span class="math display">
\lambda_Q = 1 - \lambda_{GG} - \lambda_G
\tag{25}</span></span></p>
<div id="fig-liquidity-pool-split" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Liquidity pool split.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-liquidity-pool-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb65" data-startfrom="2674" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2673;"><span id="cb65-2674"><a href="#cb65-2674" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaG</span>(AQ<span class="op">,</span> AG) {</span>
<span id="cb65-2675"><a href="#cb65-2675" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> AG <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> AG <span class="op">+</span> AQ <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb65-2676"><a href="#cb65-2676" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-65" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb66" data-startfrom="2680" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2679;"><span id="cb66-2680"><a href="#cb66-2680" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaQ</span>(AQ<span class="op">,</span> AG) {</span>
<span id="cb66-2681"><a href="#cb66-2681" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> <span class="fu">computeLambdaG</span>(AQ<span class="op">,</span> AG)<span class="op">;</span></span>
<span id="cb66-2682"><a href="#cb66-2682" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-66" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb67" data-startfrom="2686" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2685;"><span id="cb67-2686"><a href="#cb67-2686" aria-hidden="true" tabindex="-1"></a>lambdaGQData <span class="op">=</span> {</span>
<span id="cb67-2687"><a href="#cb67-2687" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambdaGQData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb67-2688"><a href="#cb67-2688" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramAG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb67-2689"><a href="#cb67-2689" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAQ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAQ <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb67-2690"><a href="#cb67-2690" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramAG <span class="op">+</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb67-2691"><a href="#cb67-2691" aria-hidden="true" tabindex="-1"></a>        lambdaGQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb67-2692"><a href="#cb67-2692" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"Relative 𝗔𝗚 Liquidity Pool Share"</span><span class="op">,</span></span>
<span id="cb67-2693"><a href="#cb67-2693" aria-hidden="true" tabindex="-1"></a>          <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb67-2694"><a href="#cb67-2694" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ag</span><span class="op">:</span> paramAG<span class="op">,</span></span>
<span id="cb67-2695"><a href="#cb67-2695" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaG</span>(paramAQ<span class="op">,</span> paramAG)<span class="op">,</span></span>
<span id="cb67-2696"><a href="#cb67-2696" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb67-2697"><a href="#cb67-2697" aria-hidden="true" tabindex="-1"></a>        lambdaGQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb67-2698"><a href="#cb67-2698" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"Relative 𝗔𝗤 Liquidity Pool Share"</span><span class="op">,</span></span>
<span id="cb67-2699"><a href="#cb67-2699" aria-hidden="true" tabindex="-1"></a>          <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb67-2700"><a href="#cb67-2700" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ag</span><span class="op">:</span> paramAG<span class="op">,</span></span>
<span id="cb67-2701"><a href="#cb67-2701" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaQ</span>(paramAQ<span class="op">,</span> paramAG)<span class="op">,</span></span>
<span id="cb67-2702"><a href="#cb67-2702" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb67-2703"><a href="#cb67-2703" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-2704"><a href="#cb67-2704" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb67-2705"><a href="#cb67-2705" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb67-2706"><a href="#cb67-2706" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> lambdaGQData<span class="op">;</span></span>
<span id="cb67-2707"><a href="#cb67-2707" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-67" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb68" data-startfrom="2711" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2710;"><span id="cb68-2711"><a href="#cb68-2711" aria-hidden="true" tabindex="-1"></a>plotLambdaGQ <span class="op">=</span> {</span>
<span id="cb68-2712"><a href="#cb68-2712" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotLambdaGQ <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb68-2713"><a href="#cb68-2713" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb68-2714"><a href="#cb68-2714" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb68-2715"><a href="#cb68-2715" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb68-2716"><a href="#cb68-2716" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb68-2717"><a href="#cb68-2717" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb68-2718"><a href="#cb68-2718" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb68-2719"><a href="#cb68-2719" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb68-2720"><a href="#cb68-2720" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb68-2721"><a href="#cb68-2721" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"A  "</span> }<span class="op">,</span></span>
<span id="cb68-2722"><a href="#cb68-2722" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb68-2723"><a href="#cb68-2723" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb68-2724"><a href="#cb68-2724" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb68-2725"><a href="#cb68-2725" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"A"</span><span class="op">,</span></span>
<span id="cb68-2726"><a href="#cb68-2726" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb68-2727"><a href="#cb68-2727" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb68-2728"><a href="#cb68-2728" aria-hidden="true" tabindex="-1"></a>    <span class="dt">className</span><span class="op">:</span> <span class="st">"LambdaGQ"</span><span class="op">,</span></span>
<span id="cb68-2729"><a href="#cb68-2729" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb68-2730"><a href="#cb68-2730" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb68-2731"><a href="#cb68-2731" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(lambdaGQData<span class="op">,</span> {</span>
<span id="cb68-2732"><a href="#cb68-2732" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2733"><a href="#cb68-2733" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2734"><a href="#cb68-2734" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ag</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2735"><a href="#cb68-2735" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ag</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb68-2736"><a href="#cb68-2736" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb68-2737"><a href="#cb68-2737" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb68-2738"><a href="#cb68-2738" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb68-2739"><a href="#cb68-2739" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(lambdaGQData<span class="op">,</span> {</span>
<span id="cb68-2740"><a href="#cb68-2740" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"aq"</span><span class="op">,</span></span>
<span id="cb68-2741"><a href="#cb68-2741" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"ag"</span><span class="op">,</span></span>
<span id="cb68-2742"><a href="#cb68-2742" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb68-2743"><a href="#cb68-2743" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb68-2744"><a href="#cb68-2744" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb68-2745"><a href="#cb68-2745" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb68-2746"><a href="#cb68-2746" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb68-2747"><a href="#cb68-2747" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb68-2748"><a href="#cb68-2748" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb68-2749"><a href="#cb68-2749" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb68-2750"><a href="#cb68-2750" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb68-2751"><a href="#cb68-2751" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb68-2752"><a href="#cb68-2752" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb68-2753"><a href="#cb68-2753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2754"><a href="#cb68-2754" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGQ)</span>
<span id="cb68-2755"><a href="#cb68-2755" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='x-axis label']"</span>)</span>
<span id="cb68-2756"><a href="#cb68-2756" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb68-2757"><a href="#cb68-2757" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb68-2758"><a href="#cb68-2758" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="fl">1.5</span>))</span>
<span id="cb68-2759"><a href="#cb68-2759" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb68-2760"><a href="#cb68-2760" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb68-2761"><a href="#cb68-2761" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb68-2762"><a href="#cb68-2762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2763"><a href="#cb68-2763" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGQ)</span>
<span id="cb68-2764"><a href="#cb68-2764" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb68-2765"><a href="#cb68-2765" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb68-2766"><a href="#cb68-2766" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb68-2767"><a href="#cb68-2767" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb68-2768"><a href="#cb68-2768" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">14</span><span class="op">,</span> <span class="fl">4.1</span>))</span>
<span id="cb68-2769"><a href="#cb68-2769" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb68-2770"><a href="#cb68-2770" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb68-2771"><a href="#cb68-2771" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"G"</span>)<span class="op">;</span></span>
<span id="cb68-2772"><a href="#cb68-2772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2773"><a href="#cb68-2773" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotLambdaGQ<span class="op">;</span></span>
<span id="cb68-2774"><a href="#cb68-2774" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-68" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-liquidity-pool-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22: Liquidity pool split <span class="math inline">\lambda_G, \lambda_Q</span>.
</figcaption>
</figure>
</div>
</section>
<section id="sec-risk-premium-distribution" class="level4" data-number="3.3.5">
<h4 data-number="3.3.5" class="anchored" data-anchor-id="sec-risk-premium-distribution"><span class="header-section-number">3.3.5</span> Risk Premium Distribution</h4>
<p>For <span class="math inline">\lambda_{GG}</span>, <span class="math inline">\lambda_G</span>, <span class="math inline">\lambda_Q</span> we apply <span class="math inline">\beta</span>:</p>
<p><span id="eq-capital-lambda"><span class="math display">
\Lambda_X = \lambda_X \, \beta, \quad \text{for } X \in \{GG, G, Q\}
\tag{26}</span></span></p>
<p>Taking <span class="math inline">b</span> as a discount parameter:</p>
<p><span id="eq-discount-parameter"><span class="math display">
b = \frac{\sum_1^{40} Z_t \, S_t \, B_t}{\sum_1^{40} Z_t \, S_t }
\tag{27}</span></span></p>
<p>The total Risk Premium tokens <span class="math inline">R_\lambda</span>:</p>
<p><span id="eq-risk-premium"><span class="math display">
R_\lambda = b \, R \, (\Lambda_{GG} + \Lambda_G + \Lambda_Q)
\tag{28}</span></span></p>
<p>The allocations of <span class="math inline">R_\lambda</span> are pro-rata to <span class="math inline">\Lambda_{GG}</span>, <span class="math inline">\Lambda_G</span>, <span class="math inline">\Lambda_Q</span>, and thereafter:</p>
<ol type="1">
<li><p>Locked <strong>G</strong>: <span class="math inline">\Lambda_{GG}</span> in proportion to <strong>G</strong>.</p></li>
<li><p>Locked <span class="overline"><strong>AG</strong></span>, <span class="overline"><strong>AQ</strong></span> tokens are allocated a weighting <span class="math inline">G_t</span>, <span class="math inline">Q_t</span> depending on their time bucket <span class="math inline">t</span>:</p>
<p><span id="eq-risky-premium-weighting-ag-pool"><span class="math display">
G_t = \frac{Z_t \, L_{Gt} \, B_t}{\sum Z_t \, L_{Gt} \, B_t}
  \tag{29}</span></span></p>
<p><span id="eq-risky-premium-weighting-aq-pool"><span class="math display">
Q_t = \frac{Z_t \, L_{Qt} \, B_t}{\sum Z_t \, L_{Qt} \, B_t}
  \tag{30}</span></span></p>
<p>Where <span class="math inline">L_{Gt}</span>, <span class="math inline">L_{Qt}</span> are the proportion of all liquidity locked in each time bucket for <span class="overline"><strong>AG</strong></span> and <span class="overline"><strong>AQ</strong></span> respectively.</p></li>
</ol>
<p>Thereafter each time bucket allocation is proportionate to staked liquidity provider token holdings.</p>
</section>
</section>
<section id="sec-interactive-model" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="sec-interactive-model"><span class="header-section-number">3.4</span> Interactive Model</h3>
<p>This additional section is only in the interactive version of the whitepaper. It presents an interactive model of the AAM where each parameter of interest can be adjusted by the reader.</p>
<p>In <a href="#sec-kvcm-tokens-minted-when-the-aam-purchases-carbon" class="quarto-xref">Section&nbsp;3.4.1</a>, a carbon holder sells carbon to the AAM in exchange for <strong>A</strong> tokens; from the point of view of the AAM, this represents a carbon purchase. In <a href="#sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens" class="quarto-xref">Section&nbsp;3.4.2</a>, a holder of <strong>A</strong> tokens burns them to buy carbon from the AAM; from the point of view of the AAM, this represents a carbon sale.</p>
<section id="sec-kvcm-tokens-minted-when-the-aam-purchases-carbon" class="level4" data-number="3.4.1">
<h4 data-number="3.4.1" class="anchored" data-anchor-id="sec-kvcm-tokens-minted-when-the-aam-purchases-carbon"><span class="header-section-number">3.4.1</span> kVCM Tokens Minted When the AAM Purchases Carbon</h4>
<p>In this section, the reader controls how many present-value tonnes of carbon class <span class="math inline">i</span> are purchased by the AAM. The number of <strong>A</strong> tokens emitted in exchange is calculated in real time. The price of carbon class <span class="math inline">i</span> is calculated by dividing the number of <strong>A</strong> tokens emitted by the AAM by the number of present-value tonnes of carbon class <span class="math inline">i</span> purchased by the AAM.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb69" data-startfrom="2872" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2871;"><span id="cb69-2872"><a href="#cb69-2872" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">piecewiseLogTransform</span>(xTran <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb69-2873"><a href="#cb69-2873" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="kw">=&gt;</span> x <span class="op">&gt;</span> xTran <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x) <span class="op">:</span> x <span class="op">-</span> xTran <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(xTran)<span class="op">;</span></span>
<span id="cb69-2874"><a href="#cb69-2874" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2875"><a href="#cb69-2875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2876"><a href="#cb69-2876" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">piecewiseLogInvert</span>(xTran <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb69-2877"><a href="#cb69-2877" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> y <span class="kw">=&gt;</span> y <span class="op">&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(xTran) <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(y) <span class="op">:</span> y <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(xTran) <span class="op">+</span> xTran<span class="op">;</span></span>
<span id="cb69-2878"><a href="#cb69-2878" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2879"><a href="#cb69-2879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2880"><a href="#cb69-2880" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setInput</span>(input<span class="op">,</span> value) {</span>
<span id="cb69-2881"><a href="#cb69-2881" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb69-2882"><a href="#cb69-2882" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb69-2883"><a href="#cb69-2883" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-2884"><a href="#cb69-2884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2885"><a href="#cb69-2885" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">numDigits</span>(x) {</span>
<span id="cb69-2886"><a href="#cb69-2886" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> (<span class="dv">1</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(x)))<span class="op">;</span></span>
<span id="cb69-2887"><a href="#cb69-2887" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb70" data-startfrom="2891" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2890;"><span id="cb70-2891"><a href="#cb70-2891" aria-hidden="true" tabindex="-1"></a>defaultAValue <span class="op">=</span> <span class="fl">2e6</span><span class="op">;</span></span>
<span id="cb70-2892"><a href="#cb70-2892" aria-hidden="true" tabindex="-1"></a>defaultASupply <span class="op">=</span> <span class="fl">2e7</span><span class="op">;</span></span>
<span id="cb70-2893"><a href="#cb70-2893" aria-hidden="true" tabindex="-1"></a>defaultPresentTonnes <span class="op">=</span> <span class="fl">1e7</span><span class="op">;</span></span>
<span id="cb70-2894"><a href="#cb70-2894" aria-hidden="true" tabindex="-1"></a>defaultDeltaTonnes <span class="op">=</span> <span class="fl">1e2</span><span class="op">;</span></span>
<span id="cb70-2895"><a href="#cb70-2895" aria-hidden="true" tabindex="-1"></a>defaultAi <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb70-2896"><a href="#cb70-2896" aria-hidden="true" tabindex="-1"></a>defaultGi <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-70-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb71" data-startfrom="2899" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2898;"><span id="cb71-2899"><a href="#cb71-2899" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>(</span>
<span id="cb71-2900"><a href="#cb71-2900" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">"Reset"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb71-2901"><a href="#cb71-2901" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAValue<span class="op">,</span> defaultAValue)<span class="op">;</span></span>
<span id="cb71-2902"><a href="#cb71-2902" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputASupply<span class="op">,</span> defaultASupply)<span class="op">;</span></span>
<span id="cb71-2903"><a href="#cb71-2903" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputPresentTonnes<span class="op">,</span> defaultPresentTonnes)<span class="op">;</span></span>
<span id="cb71-2904"><a href="#cb71-2904" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputDeltaTonnes<span class="op">,</span> defaultDeltaTonnes)<span class="op">;</span></span>
<span id="cb71-2905"><a href="#cb71-2905" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAi<span class="op">,</span> defaultAi)<span class="op">;</span></span>
<span id="cb71-2906"><a href="#cb71-2906" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputGi<span class="op">,</span> defaultGi)<span class="op">;</span></span>
<span id="cb71-2907"><a href="#cb71-2907" aria-hidden="true" tabindex="-1"></a>  }]]<span class="op">,</span></span>
<span id="cb71-2908"><a href="#cb71-2908" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-71" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb72" data-startfrom="2913" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2912;"><span id="cb72-2913"><a href="#cb72-2913" aria-hidden="true" tabindex="-1"></a>viewof inputAValue <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e5</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb72-2914"><a href="#cb72-2914" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Market cap. of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb72-2915"><a href="#cb72-2915" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb72-2916"><a href="#cb72-2916" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAValue<span class="op">,</span></span>
<span id="cb72-2917"><a href="#cb72-2917" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2918"><a href="#cb72-2918" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2919"><a href="#cb72-2919" aria-hidden="true" tabindex="-1"></a>viewof inputASupply <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e6</span><span class="op">,</span> <span class="fl">1e10</span>]<span class="op">,</span> {</span>
<span id="cb72-2920"><a href="#cb72-2920" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Supply of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb72-2921"><a href="#cb72-2921" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb72-2922"><a href="#cb72-2922" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultASupply<span class="op">,</span></span>
<span id="cb72-2923"><a href="#cb72-2923" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2924"><a href="#cb72-2924" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2925"><a href="#cb72-2925" aria-hidden="true" tabindex="-1"></a>viewof inputPresentTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb72-2926"><a href="#cb72-2926" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } </span><span class="sc">\b</span><span class="vs">ar C_i`</span><span class="op">,</span></span>
<span id="cb72-2927"><a href="#cb72-2927" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb72-2928"><a href="#cb72-2928" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultPresentTonnes<span class="op">,</span></span>
<span id="cb72-2929"><a href="#cb72-2929" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-3</span>)<span class="op">,</span></span>
<span id="cb72-2930"><a href="#cb72-2930" aria-hidden="true" tabindex="-1"></a>  <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-3</span>)<span class="op">,</span></span>
<span id="cb72-2931"><a href="#cb72-2931" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2932"><a href="#cb72-2932" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-3</span><span class="op">,</span> <span class="fl">1e7</span>]<span class="op">,</span> {</span>
<span id="cb72-2933"><a href="#cb72-2933" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased tonnes}`</span><span class="op">,</span></span>
<span id="cb72-2934"><a href="#cb72-2934" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb72-2935"><a href="#cb72-2935" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultDeltaTonnes<span class="op">,</span></span>
<span id="cb72-2936"><a href="#cb72-2936" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb72-2937"><a href="#cb72-2937" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2938"><a href="#cb72-2938" aria-hidden="true" tabindex="-1"></a>viewof inputAi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb72-2939"><a href="#cb72-2939" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } A_i`</span><span class="op">,</span></span>
<span id="cb72-2940"><a href="#cb72-2940" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb72-2941"><a href="#cb72-2941" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAi<span class="op">,</span></span>
<span id="cb72-2942"><a href="#cb72-2942" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb72-2943"><a href="#cb72-2943" aria-hidden="true" tabindex="-1"></a>  <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb72-2944"><a href="#cb72-2944" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-2945"><a href="#cb72-2945" aria-hidden="true" tabindex="-1"></a>viewof inputGi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb72-2946"><a href="#cb72-2946" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } G_i`</span><span class="op">,</span></span>
<span id="cb72-2947"><a href="#cb72-2947" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb72-2948"><a href="#cb72-2948" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultGi<span class="op">,</span></span>
<span id="cb72-2949"><a href="#cb72-2949" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb73" data-startfrom="2953" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2952;"><span id="cb73-2953"><a href="#cb73-2953" aria-hidden="true" tabindex="-1"></a>paramDeltaA <span class="op">=</span> <span class="fu">computeTrueDeltaA</span>(</span>
<span id="cb73-2954"><a href="#cb73-2954" aria-hidden="true" tabindex="-1"></a>  inputAi<span class="op">,</span></span>
<span id="cb73-2955"><a href="#cb73-2955" aria-hidden="true" tabindex="-1"></a>  inputGi<span class="op">,</span></span>
<span id="cb73-2956"><a href="#cb73-2956" aria-hidden="true" tabindex="-1"></a>  inputPresentTonnes<span class="op">,</span></span>
<span id="cb73-2957"><a href="#cb73-2957" aria-hidden="true" tabindex="-1"></a>  inputDeltaTonnes<span class="op">,</span></span>
<span id="cb73-2958"><a href="#cb73-2958" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb73-2959"><a href="#cb73-2959" aria-hidden="true" tabindex="-1"></a>paramDeltaTonnes <span class="op">=</span> paramDeltaA <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputDeltaTonnes<span class="op">;</span></span>
<span id="cb73-2960"><a href="#cb73-2960" aria-hidden="true" tabindex="-1"></a>paramAEmitted <span class="op">=</span> paramDeltaA <span class="op">*</span> inputASupply<span class="op">;</span></span>
<span id="cb73-2961"><a href="#cb73-2961" aria-hidden="true" tabindex="-1"></a>paramAPrice <span class="op">=</span> inputAValue <span class="op">/</span> inputASupply<span class="op">;</span></span>
<span id="cb73-2962"><a href="#cb73-2962" aria-hidden="true" tabindex="-1"></a>paramBarCiPrice <span class="op">=</span> inputAValue <span class="op">*</span> paramDeltaA <span class="op">/</span> inputDeltaTonnes<span class="op">;</span></span>
<span id="cb73-2963"><a href="#cb73-2963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-2964"><a href="#cb73-2964" aria-hidden="true" tabindex="-1"></a>stringASupply <span class="op">=</span> inputASupply<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2965"><a href="#cb73-2965" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2966"><a href="#cb73-2966" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2967"><a href="#cb73-2967" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-2968"><a href="#cb73-2968" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-2969"><a href="#cb73-2969" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2970"><a href="#cb73-2970" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb73-2971"><a href="#cb73-2971" aria-hidden="true" tabindex="-1"></a>stringPresentTonnes <span class="op">=</span> inputPresentTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2972"><a href="#cb73-2972" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2973"><a href="#cb73-2973" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2974"><a href="#cb73-2974" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-2975"><a href="#cb73-2975" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-2976"><a href="#cb73-2976" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2977"><a href="#cb73-2977" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb73-2978"><a href="#cb73-2978" aria-hidden="true" tabindex="-1"></a>stringAEmitted <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> paramAEmitted<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2979"><a href="#cb73-2979" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2980"><a href="#cb73-2980" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2981"><a href="#cb73-2981" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-2982"><a href="#cb73-2982" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb73-2983"><a href="#cb73-2983" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2984"><a href="#cb73-2984" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb73-2985"><a href="#cb73-2985" aria-hidden="true" tabindex="-1"></a>stringDeltaTonnes <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> paramDeltaTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2986"><a href="#cb73-2986" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2987"><a href="#cb73-2987" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2988"><a href="#cb73-2988" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">3</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-2989"><a href="#cb73-2989" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">3</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb73-2990"><a href="#cb73-2990" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2991"><a href="#cb73-2991" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb73-2992"><a href="#cb73-2992" aria-hidden="true" tabindex="-1"></a>stringAPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramAPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-2993"><a href="#cb73-2993" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-2994"><a href="#cb73-2994" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-2995"><a href="#cb73-2995" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice))<span class="op">,</span></span>
<span id="cb73-2996"><a href="#cb73-2996" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice))<span class="op">,</span></span>
<span id="cb73-2997"><a href="#cb73-2997" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-2998"><a href="#cb73-2998" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb73-2999"><a href="#cb73-2999" aria-hidden="true" tabindex="-1"></a>stringBarCiPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramBarCiPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb73-3000"><a href="#cb73-3000" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb73-3001"><a href="#cb73-3001" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb73-3002"><a href="#cb73-3002" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramBarCiPrice))<span class="op">,</span></span>
<span id="cb73-3003"><a href="#cb73-3003" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramBarCiPrice))<span class="op">,</span></span>
<span id="cb73-3004"><a href="#cb73-3004" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb73-3005"><a href="#cb73-3005" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Supply of <strong>A</strong> Tokens</th>
<th style="text-align: right;">Portfolio Carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-3"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-4"></span></span></td>
</tr>
<tr class="even">
<td><strong>Variation</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-5"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-6"></span></span></td>
</tr>
<tr class="odd">
<td><strong>Unit Price</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-7"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-8"></span></span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens" class="level4" data-number="3.4.2">
<h4 data-number="3.4.2" class="anchored" data-anchor-id="sec-carbon-sold-by-the-aam-when-it-burns-kvcm-tokens"><span class="header-section-number">3.4.2</span> Carbon Sold by the AAM When it Burns kVCM Tokens</h4>
<p>In this section, the reader controls how many <strong>A</strong> tokens are burnt by the AAM. The number of liquid tonnes of carbon class <span class="math inline">i</span> sold by the AAM in exchange is calculated in real time. The price of carbon is calculated by dividing the number of <strong>A</strong> tokens burnt by the AAM by the number of liquid tonnes of carbon class <span class="math inline">i</span> sold by the AAM.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb74" data-startfrom="3031" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3030;"><span id="cb74-3031"><a href="#cb74-3031" aria-hidden="true" tabindex="-1"></a>defaultLiquidTonnes <span class="op">=</span> <span class="fl">1e7</span><span class="op">;</span></span>
<span id="cb74-3032"><a href="#cb74-3032" aria-hidden="true" tabindex="-1"></a>defaultABurnt <span class="op">=</span> <span class="fl">1e2</span><span class="op">;</span></span>
<span id="cb74-3033"><a href="#cb74-3033" aria-hidden="true" tabindex="-1"></a>defaultGnull <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb74-3034"><a href="#cb74-3034" aria-hidden="true" tabindex="-1"></a>defaultA <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb74-3035"><a href="#cb74-3035" aria-hidden="true" tabindex="-1"></a>defaultS <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-74-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb75" data-startfrom="3038" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3037;"><span id="cb75-3038"><a href="#cb75-3038" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>(</span>
<span id="cb75-3039"><a href="#cb75-3039" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">"Reset"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb75-3040"><a href="#cb75-3040" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAValue_<span class="op">,</span> defaultAValue)<span class="op">;</span></span>
<span id="cb75-3041"><a href="#cb75-3041" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputASupply_<span class="op">,</span> defaultASupply)<span class="op">;</span></span>
<span id="cb75-3042"><a href="#cb75-3042" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputLiquidTonnes<span class="op">,</span> defaultLiquidTonnes)<span class="op">;</span></span>
<span id="cb75-3043"><a href="#cb75-3043" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputABurnt<span class="op">,</span> defaultABurnt)<span class="op">;</span></span>
<span id="cb75-3044"><a href="#cb75-3044" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAi<span class="op">,</span> defaultAi)<span class="op">;</span></span>
<span id="cb75-3045"><a href="#cb75-3045" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputGi<span class="op">,</span> defaultGi)<span class="op">;</span></span>
<span id="cb75-3046"><a href="#cb75-3046" aria-hidden="true" tabindex="-1"></a>  }]]<span class="op">,</span></span>
<span id="cb75-3047"><a href="#cb75-3047" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-75" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb76" data-startfrom="3052" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3051;"><span id="cb76-3052"><a href="#cb76-3052" aria-hidden="true" tabindex="-1"></a>viewof inputAValue_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e5</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb76-3053"><a href="#cb76-3053" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Market cap. of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb76-3054"><a href="#cb76-3054" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb76-3055"><a href="#cb76-3055" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAValue<span class="op">,</span></span>
<span id="cb76-3056"><a href="#cb76-3056" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3057"><a href="#cb76-3057" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3058"><a href="#cb76-3058" aria-hidden="true" tabindex="-1"></a>viewof inputASupply_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e6</span><span class="op">,</span> <span class="fl">1e10</span>]<span class="op">,</span> {</span>
<span id="cb76-3059"><a href="#cb76-3059" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Supply of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb76-3060"><a href="#cb76-3060" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb76-3061"><a href="#cb76-3061" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultASupply<span class="op">,</span></span>
<span id="cb76-3062"><a href="#cb76-3062" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3063"><a href="#cb76-3063" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3064"><a href="#cb76-3064" aria-hidden="true" tabindex="-1"></a>viewof inputLiquidTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-3</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb76-3065"><a href="#cb76-3065" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Portfolio } C_{i0}`</span><span class="op">,</span></span>
<span id="cb76-3066"><a href="#cb76-3066" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb76-3067"><a href="#cb76-3067" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultLiquidTonnes<span class="op">,</span></span>
<span id="cb76-3068"><a href="#cb76-3068" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3069"><a href="#cb76-3069" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3070"><a href="#cb76-3070" aria-hidden="true" tabindex="-1"></a>viewof inputABurnt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-1</span><span class="op">,</span> <span class="fl">1e6</span>]<span class="op">,</span> {</span>
<span id="cb76-3071"><a href="#cb76-3071" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{</span><span class="sc">\t</span><span class="vs">extbf{A} tokens burnt}`</span><span class="op">,</span></span>
<span id="cb76-3072"><a href="#cb76-3072" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-1</span><span class="op">,</span></span>
<span id="cb76-3073"><a href="#cb76-3073" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultABurnt<span class="op">,</span></span>
<span id="cb76-3074"><a href="#cb76-3074" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb76-3075"><a href="#cb76-3075" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb76-3076"><a href="#cb76-3076" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb76-3077"><a href="#cb76-3077" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb76-3078"><a href="#cb76-3078" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } A_i`</span><span class="op">,</span></span>
<span id="cb76-3079"><a href="#cb76-3079" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb76-3080"><a href="#cb76-3080" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> defaultAi<span class="op">,</span></span>
<span id="cb76-3081"><a href="#cb76-3081" aria-hidden="true" tabindex="-1"></a>    <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb76-3082"><a href="#cb76-3082" aria-hidden="true" tabindex="-1"></a>    <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb76-3083"><a href="#cb76-3083" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb76-3084"><a href="#cb76-3084" aria-hidden="true" tabindex="-1"></a>  viewof inputAi<span class="op">,</span></span>
<span id="cb76-3085"><a href="#cb76-3085" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-5" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb77" data-startfrom="3086" data-source-offset="-867"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3085;"><span id="cb77-3086"><a href="#cb77-3086" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb77-3087"><a href="#cb77-3087" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb77-3088"><a href="#cb77-3088" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } G_i`</span><span class="op">,</span></span>
<span id="cb77-3089"><a href="#cb77-3089" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb77-3090"><a href="#cb77-3090" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> defaultGi<span class="op">,</span></span>
<span id="cb77-3091"><a href="#cb77-3091" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb77-3092"><a href="#cb77-3092" aria-hidden="true" tabindex="-1"></a>  viewof inputGi<span class="op">,</span></span>
<span id="cb77-3093"><a href="#cb77-3093" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-76-6" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb78" data-startfrom="3097" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3096;"><span id="cb78-3097"><a href="#cb78-3097" aria-hidden="true" tabindex="-1"></a>paramABurnt <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputABurnt</span>
<span id="cb78-3098"><a href="#cb78-3098" aria-hidden="true" tabindex="-1"></a>paramDeltaA_ <span class="op">=</span> paramABurnt <span class="op">/</span> inputASupply_<span class="op">;</span></span>
<span id="cb78-3099"><a href="#cb78-3099" aria-hidden="true" tabindex="-1"></a>paramDeltaCi <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="op">-</span><span class="dv">0</span> <span class="op">:</span> <span class="fu">computeDeltaCi</span>(</span>
<span id="cb78-3100"><a href="#cb78-3100" aria-hidden="true" tabindex="-1"></a>  inputAi<span class="op">,</span></span>
<span id="cb78-3101"><a href="#cb78-3101" aria-hidden="true" tabindex="-1"></a>  inputGi<span class="op">,</span></span>
<span id="cb78-3102"><a href="#cb78-3102" aria-hidden="true" tabindex="-1"></a>  paramDeltaA_<span class="op">,</span></span>
<span id="cb78-3103"><a href="#cb78-3103" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb78-3104"><a href="#cb78-3104" aria-hidden="true" tabindex="-1"></a>paramDeltaCiTonnes <span class="op">=</span> <span class="op">-</span>paramDeltaCi <span class="op">*</span> inputLiquidTonnes<span class="op">;</span></span>
<span id="cb78-3105"><a href="#cb78-3105" aria-hidden="true" tabindex="-1"></a>paramAPrice_ <span class="op">=</span> inputAValue_ <span class="op">/</span> inputASupply_<span class="op">;</span></span>
<span id="cb78-3106"><a href="#cb78-3106" aria-hidden="true" tabindex="-1"></a>paramCiPrice <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputAValue_ <span class="op">*</span> paramDeltaA_ <span class="op">/</span> paramDeltaCiTonnes<span class="op">;</span></span>
<span id="cb78-3107"><a href="#cb78-3107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3108"><a href="#cb78-3108" aria-hidden="true" tabindex="-1"></a>stringASupply_ <span class="op">=</span> inputASupply_<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3109"><a href="#cb78-3109" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3110"><a href="#cb78-3110" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3111"><a href="#cb78-3111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3112"><a href="#cb78-3112" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3113"><a href="#cb78-3113" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3114"><a href="#cb78-3114" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb78-3115"><a href="#cb78-3115" aria-hidden="true" tabindex="-1"></a>stringLiquidTonnes <span class="op">=</span> inputLiquidTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3116"><a href="#cb78-3116" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3117"><a href="#cb78-3117" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3118"><a href="#cb78-3118" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3119"><a href="#cb78-3119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3120"><a href="#cb78-3120" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3121"><a href="#cb78-3121" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb78-3122"><a href="#cb78-3122" aria-hidden="true" tabindex="-1"></a>stringABurnt <span class="op">=</span> <span class="st">"−"</span> <span class="op">+</span> paramABurnt<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3123"><a href="#cb78-3123" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3124"><a href="#cb78-3124" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3125"><a href="#cb78-3125" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3126"><a href="#cb78-3126" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb78-3127"><a href="#cb78-3127" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3128"><a href="#cb78-3128" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb78-3129"><a href="#cb78-3129" aria-hidden="true" tabindex="-1"></a>stringDeltaCiTonnes <span class="op">=</span> <span class="st">"−"</span> <span class="op">+</span> paramDeltaCiTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3130"><a href="#cb78-3130" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3131"><a href="#cb78-3131" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3132"><a href="#cb78-3132" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3133"><a href="#cb78-3133" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb78-3134"><a href="#cb78-3134" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3135"><a href="#cb78-3135" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb78-3136"><a href="#cb78-3136" aria-hidden="true" tabindex="-1"></a>stringAPrice_ <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramAPrice_<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3137"><a href="#cb78-3137" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3138"><a href="#cb78-3138" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3139"><a href="#cb78-3139" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice_))<span class="op">,</span></span>
<span id="cb78-3140"><a href="#cb78-3140" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice_))<span class="op">,</span></span>
<span id="cb78-3141"><a href="#cb78-3141" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3142"><a href="#cb78-3142" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb78-3143"><a href="#cb78-3143" aria-hidden="true" tabindex="-1"></a>stringCiPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramCiPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb78-3144"><a href="#cb78-3144" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb78-3145"><a href="#cb78-3145" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb78-3146"><a href="#cb78-3146" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramCiPrice))<span class="op">,</span></span>
<span id="cb78-3147"><a href="#cb78-3147" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramCiPrice))<span class="op">,</span></span>
<span id="cb78-3148"><a href="#cb78-3148" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb78-3149"><a href="#cb78-3149" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-77-12" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Supply of <strong>A</strong> Tokens</th>
<th style="text-align: right;">Portfolio Carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-9"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-10"></span></span></td>
</tr>
<tr class="even">
<td><strong>Variation</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-11"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-12"></span></span></td>
</tr>
<tr class="odd">
<td><strong>Unit Price</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-13"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-14"></span></span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-klima-2.0-token-distribution" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="sec-klima-2.0-token-distribution"><span class="header-section-number">4</span> Klima&nbsp;2.0 Token Distribution</h2>
<section id="sec-planned-allocations" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="sec-planned-allocations"><span class="header-section-number">4.1</span> Planned Allocations</h3>
<div id="tbl-kvcm-token" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-kvcm-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Cohort</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Quantity (m)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klima Holders</td>
<td style="text-align: right;">87.5%</td>
<td style="text-align: right;">17.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">DAO/Treasury</td>
<td style="text-align: right;">10.0%</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">01X</td>
<td style="text-align: right;">2.5%</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: right;"><strong>100.0%</strong></td>
<td style="text-align: right;"><strong>20.0</strong></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-kvcm-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: <strong>kVCM</strong> token.
</figcaption>
</figure>
</div>
<div id="tbl-k2-token" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[40,10,15,30]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-k2-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 40%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Cohort</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Quantity (m)</th>
<th style="text-align: left;">Liquidity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klima Holders</td>
<td style="text-align: right;">40.0%</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ecosystem Grant</td>
<td style="text-align: right;">5.0%</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Programmatic Incentives</td>
<td style="text-align: right;">40.0%</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: left;">Incentive Curve</td>
</tr>
<tr class="even">
<td style="text-align: left;">pKlima Holders</td>
<td style="text-align: right;">3.0%</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DAO/Treasury</td>
<td style="text-align: right;">4.5%</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: left;">24 month locked LP of <span class="overline"><strong>AG</strong></span></td>
</tr>
<tr class="even">
<td style="text-align: left;">01X</td>
<td style="text-align: right;">2.5%</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: left;">24 month locked LP of <span class="overline"><strong>AG</strong></span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Product Design and Development</td>
<td style="text-align: right;">5.0%</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: right;"><strong>100.0%</strong></td>
<td style="text-align: right;"><strong>100.0</strong></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-k2-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: <strong>K2</strong> token.
</figcaption>
</figure>
</div>
<div id="fig-k2-token-allocations" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token allocations.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-allocations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb79" data-startfrom="3197" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3196;"><span id="cb79-3197"><a href="#cb79-3197" aria-hidden="true" tabindex="-1"></a>allocInitGData <span class="op">=</span> {</span>
<span id="cb79-3198"><a href="#cb79-3198" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocInitGData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb79-3199"><a href="#cb79-3199" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="fl">100.01</span><span class="op">;</span> i <span class="op">+=</span> <span class="fl">0.25</span>) {</span>
<span id="cb79-3200"><a href="#cb79-3200" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="op">&lt;</span> <span class="fl">2.51</span>) {</span>
<span id="cb79-3201"><a href="#cb79-3201" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3202"><a href="#cb79-3202" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3203"><a href="#cb79-3203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">2.49</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">5.51</span>) {</span>
<span id="cb79-3204"><a href="#cb79-3204" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3205"><a href="#cb79-3205" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3206"><a href="#cb79-3206" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">5.49</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">10.01</span>) {</span>
<span id="cb79-3207"><a href="#cb79-3207" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3208"><a href="#cb79-3208" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3209"><a href="#cb79-3209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">9.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">15.01</span>) {</span>
<span id="cb79-3210"><a href="#cb79-3210" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3211"><a href="#cb79-3211" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3212"><a href="#cb79-3212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">14.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">20.01</span>) {</span>
<span id="cb79-3213"><a href="#cb79-3213" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3214"><a href="#cb79-3214" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3215"><a href="#cb79-3215" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">19.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">60.01</span>) {</span>
<span id="cb79-3216"><a href="#cb79-3216" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3217"><a href="#cb79-3217" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3218"><a href="#cb79-3218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">59.99</span> <span class="op">&lt;</span> i) {</span>
<span id="cb79-3219"><a href="#cb79-3219" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb79-3220"><a href="#cb79-3220" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-3221"><a href="#cb79-3221" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-3222"><a href="#cb79-3222" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocInitGData<span class="op">;</span></span>
<span id="cb79-3223"><a href="#cb79-3223" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb79-3224"><a href="#cb79-3224" aria-hidden="true" tabindex="-1"></a>longitudeScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>([<span class="dv">180</span><span class="op">,</span> <span class="op">-</span><span class="dv">180</span>])<span class="op">;</span></span>
<span id="cb79-3225"><a href="#cb79-3225" aria-hidden="true" tabindex="-1"></a>getCenter <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb79-3226"><a href="#cb79-3226" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">1.25</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="fl">7.75</span><span class="op">,</span> <span class="fl">12.5</span><span class="op">,</span> <span class="fl">17.5</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">80</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb79-3227"><a href="#cb79-3227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3228"><a href="#cb79-3228" aria-hidden="true" tabindex="-1"></a>cohortsDomain <span class="op">=</span> [</span>
<span id="cb79-3229"><a href="#cb79-3229" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb79-3230"><a href="#cb79-3230" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb79-3231"><a href="#cb79-3231" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb79-3232"><a href="#cb79-3232" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb79-3233"><a href="#cb79-3233" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb79-3234"><a href="#cb79-3234" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb79-3235"><a href="#cb79-3235" aria-hidden="true" tabindex="-1"></a>  <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb79-3236"><a href="#cb79-3236" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-78-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb80" data-startfrom="3239" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3238;"><span id="cb80-3239"><a href="#cb80-3239" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb80-3240"><a href="#cb80-3240" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"azimuthal-equidistant"</span><span class="op">,</span> <span class="dt">rotate</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb80-3241"><a href="#cb80-3241" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb80-3242"><a href="#cb80-3242" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb80-3243"><a href="#cb80-3243" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">area</span>(allocInitGData<span class="op">,</span> {</span>
<span id="cb80-3244"><a href="#cb80-3244" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> ({ value }) <span class="kw">=&gt;</span> <span class="fu">longitudeScale</span>(value <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb80-3245"><a href="#cb80-3245" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="op">-</span><span class="dv">20</span><span class="op">,</span></span>
<span id="cb80-3246"><a href="#cb80-3246" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> ({ value }) <span class="kw">=&gt;</span> <span class="fu">longitudeScale</span>(value <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb80-3247"><a href="#cb80-3247" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> <span class="op">-</span><span class="dv">70</span><span class="op">,</span></span>
<span id="cb80-3248"><a href="#cb80-3248" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb80-3249"><a href="#cb80-3249" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb80-3250"><a href="#cb80-3250" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb80-3251"><a href="#cb80-3251" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-79" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-allocations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23: <strong>K2</strong> token allocations.
</figcaption>
</figure>
</div>
</section>
<section id="sec-programmatic-incentive-curve" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="sec-programmatic-incentive-curve"><span class="header-section-number">4.2</span> Programmatic Incentive Curve</h3>
<p>The incentive issuance is built on a logistic function, <span class="math inline">\operatorname{P}</span>, to generate total proportion of supply in issue. It is calibrated from the initial issuance at TGE <span class="math inline">P_0</span> and the inflection point time <span class="math inline">T</span> where 50% of <strong>G</strong> token incentives have been released.</p>
<p>Setting <span class="math inline">x_0</span> from the initial supply parameter:</p>
<p><span id="eq-incentives-issuance-x-0"><span class="math display">
x_0 = \ln\left( \frac{P_0}{1 - P_0} \right)
\tag{31}</span></span></p>
<p>With <span class="math inline">x_t</span> at time point <span class="math inline">t \in (0, \infty)</span>:</p>
<p><span id="eq-incentives-issuance-x-t"><span class="math display">
x_t = x_0 \, \left( 1 - \frac t T \right)
\tag{32}</span></span></p>
<p>Giving supply function <span class="math inline">\operatorname{P}(t)</span> as:</p>
<p><span id="eq-incentives-issuance-curve"><span class="math display">
\operatorname{P}(t) = \frac{\exp(x_t)}{\exp(x_t) + 1}
\tag{33}</span></span></p>
<p><span class="math inline">P_0</span> set at <span><span id="ojs-element-id-15"></span></span> and <span class="math inline">T</span> at <span><span id="ojs-element-id-16"></span></span> months:</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb81" data-startfrom="3299" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3298;"><span id="cb81-3299"><a href="#cb81-3299" aria-hidden="true" tabindex="-1"></a>viewof inputP0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> {</span>
<span id="cb81-3300"><a href="#cb81-3300" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial issuance } P_0`</span><span class="op">,</span></span>
<span id="cb81-3301"><a href="#cb81-3301" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb81-3302"><a href="#cb81-3302" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.07</span><span class="op">,</span></span>
<span id="cb81-3303"><a href="#cb81-3303" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb81-3304"><a href="#cb81-3304" aria-hidden="true" tabindex="-1"></a>viewof inputT <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">2</span><span class="op">,</span> <span class="dv">60</span>]<span class="op">,</span> {</span>
<span id="cb81-3305"><a href="#cb81-3305" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`T </span><span class="sc">\t</span><span class="vs">ext{ (months)}`</span><span class="op">,</span></span>
<span id="cb81-3306"><a href="#cb81-3306" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb81-3307"><a href="#cb81-3307" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span></span>
<span id="cb81-3308"><a href="#cb81-3308" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb81-3309"><a href="#cb81-3309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3310"><a href="#cb81-3310" aria-hidden="true" tabindex="-1"></a>stringInputP0 <span class="op">=</span> inputP0<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb81-3311"><a href="#cb81-3311" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb81-3312"><a href="#cb81-3312" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb81-3313"><a href="#cb81-3313" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb81-3314"><a href="#cb81-3314" aria-hidden="true" tabindex="-1"></a>stringInputT <span class="op">=</span> inputT<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"en-GB"</span><span class="op">,</span> { <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-80-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-incentive-issuance" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Incentive Issuance.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentive-issuance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb82" data-startfrom="3326" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3325;"><span id="cb82-3326"><a href="#cb82-3326" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeP</span>(t<span class="op">,</span> P0<span class="op">,</span> T) {</span>
<span id="cb82-3327"><a href="#cb82-3327" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(P0 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> P0))<span class="op">;</span></span>
<span id="cb82-3328"><a href="#cb82-3328" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xt <span class="op">=</span> x0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> t <span class="op">/</span> T)<span class="op">;</span></span>
<span id="cb82-3329"><a href="#cb82-3329" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> exp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(xt)<span class="op">;</span></span>
<span id="cb82-3330"><a href="#cb82-3330" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> exp <span class="op">/</span> (exp <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb82-3331"><a href="#cb82-3331" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-3332"><a href="#cb82-3332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3333"><a href="#cb82-3333" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDerivP</span>(t<span class="op">,</span> P0<span class="op">,</span> T) {</span>
<span id="cb82-3334"><a href="#cb82-3334" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(P0 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> P0))<span class="op">;</span></span>
<span id="cb82-3335"><a href="#cb82-3335" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xt <span class="op">=</span> x0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> t <span class="op">/</span> T)<span class="op">;</span></span>
<span id="cb82-3336"><a href="#cb82-3336" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> exp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(xt)<span class="op">;</span></span>
<span id="cb82-3337"><a href="#cb82-3337" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> P <span class="op">=</span> exp <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp)<span class="op">;</span></span>
<span id="cb82-3338"><a href="#cb82-3338" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">-</span>(x0 <span class="op">/</span> T) <span class="op">*</span> P <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> P)<span class="op">;</span></span>
<span id="cb82-3339"><a href="#cb82-3339" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-3340"><a href="#cb82-3340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3341"><a href="#cb82-3341" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getVesting</span>(vecVesting<span class="op">,</span> t<span class="op">,</span> tStart<span class="op">,</span> tEnd) {</span>
<span id="cb82-3342"><a href="#cb82-3342" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="op">&lt;</span> tStart)</span>
<span id="cb82-3343"><a href="#cb82-3343" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb82-3344"><a href="#cb82-3344" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (t <span class="op">&lt;</span> tEnd) {</span>
<span id="cb82-3345"><a href="#cb82-3345" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vecVesting[t <span class="op">-</span> tStart]<span class="op">;</span></span>
<span id="cb82-3346"><a href="#cb82-3346" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb82-3347"><a href="#cb82-3347" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vecVesting[tEnd <span class="op">-</span> tStart <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb82-3348"><a href="#cb82-3348" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-3349"><a href="#cb82-3349" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-81-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb83" data-startfrom="3353" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3352;"><span id="cb83-3353"><a href="#cb83-3353" aria-hidden="true" tabindex="-1"></a>tVestStart <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb83-3354"><a href="#cb83-3354" aria-hidden="true" tabindex="-1"></a>tVestEnd <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> inputT<span class="op">;</span></span>
<span id="cb83-3355"><a href="#cb83-3355" aria-hidden="true" tabindex="-1"></a>tVesting <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(tVestStart<span class="op">,</span> tVestEnd)<span class="op">;</span></span>
<span id="cb83-3356"><a href="#cb83-3356" aria-hidden="true" tabindex="-1"></a>vecVestingDeriv <span class="op">=</span> <span class="fu">normalize</span>(tVesting<span class="op">.</span><span class="fu">map</span>(t <span class="kw">=&gt;</span></span>
<span id="cb83-3357"><a href="#cb83-3357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">computeDerivP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)</span>
<span id="cb83-3358"><a href="#cb83-3358" aria-hidden="true" tabindex="-1"></a>))<span class="op">;</span></span>
<span id="cb83-3359"><a href="#cb83-3359" aria-hidden="true" tabindex="-1"></a>vecVesting <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecVestingDeriv)<span class="op">;</span></span>
<span id="cb83-3360"><a href="#cb83-3360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3361"><a href="#cb83-3361" aria-hidden="true" tabindex="-1"></a>supplyDataAll <span class="op">=</span> {</span>
<span id="cb83-3362"><a href="#cb83-3362" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> paramVestingPrevious <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3363"><a href="#cb83-3363" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecSupplyIncentives <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3364"><a href="#cb83-3364" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecSupplyCirculating <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3365"><a href="#cb83-3365" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> supplyData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb83-3366"><a href="#cb83-3366" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">&lt;=</span> <span class="dv">72</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb83-3367"><a href="#cb83-3367" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramP <span class="op">=</span> <span class="fu">computeP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)<span class="op">;</span></span>
<span id="cb83-3368"><a href="#cb83-3368" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramDerivP <span class="op">=</span> <span class="fu">computeDerivP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)<span class="op">;</span></span>
<span id="cb83-3369"><a href="#cb83-3369" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramVesting <span class="op">=</span> <span class="fu">getVesting</span>(vecVesting<span class="op">,</span> t<span class="op">,</span> tVestStart<span class="op">,</span> tVestEnd)<span class="op">;</span></span>
<span id="cb83-3370"><a href="#cb83-3370" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramVestingDiff <span class="op">=</span> paramVesting <span class="op">-</span> paramVestingPrevious<span class="op">;</span></span>
<span id="cb83-3371"><a href="#cb83-3371" aria-hidden="true" tabindex="-1"></a>    paramVestingPrevious <span class="op">=</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3372"><a href="#cb83-3372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3373"><a href="#cb83-3373" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supply01X <span class="op">=</span> <span class="fl">2.5</span><span class="op">;</span></span>
<span id="cb83-3374"><a href="#cb83-3374" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyPKlima <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3375"><a href="#cb83-3375" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyTreasury <span class="op">=</span> <span class="fl">4.5</span><span class="op">;</span></span>
<span id="cb83-3376"><a href="#cb83-3376" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyGrant <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3377"><a href="#cb83-3377" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyProduct <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3378"><a href="#cb83-3378" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyKlima <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb83-3379"><a href="#cb83-3379" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyIncentives <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramP<span class="op">;</span></span>
<span id="cb83-3380"><a href="#cb83-3380" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives<span class="op">.</span><span class="fu">push</span>(supplyIncentives)<span class="op">;</span></span>
<span id="cb83-3381"><a href="#cb83-3381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3382"><a href="#cb83-3382" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supply01XStacked <span class="op">=</span> supply01X<span class="op">;</span></span>
<span id="cb83-3383"><a href="#cb83-3383" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyPKlimaStacked <span class="op">=</span> supplyPKlima <span class="op">+</span> supply01XStacked<span class="op">;</span></span>
<span id="cb83-3384"><a href="#cb83-3384" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyTreasuryStacked <span class="op">=</span> supplyTreasury <span class="op">+</span> supplyPKlimaStacked<span class="op">;</span></span>
<span id="cb83-3385"><a href="#cb83-3385" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyGrantStacked <span class="op">=</span> supplyGrant <span class="op">+</span> supplyTreasuryStacked<span class="op">;</span></span>
<span id="cb83-3386"><a href="#cb83-3386" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyProductStacked <span class="op">=</span> supplyProduct <span class="op">+</span> supplyGrantStacked<span class="op">;</span></span>
<span id="cb83-3387"><a href="#cb83-3387" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyKlimaStacked <span class="op">=</span> supplyKlima <span class="op">+</span> supplyProductStacked<span class="op">;</span></span>
<span id="cb83-3388"><a href="#cb83-3388" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyIncentivesStacked <span class="op">=</span> supplyIncentives <span class="op">+</span> supplyKlimaStacked<span class="op">;</span></span>
<span id="cb83-3389"><a href="#cb83-3389" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyCirculating <span class="op">=</span> supplyIncentivesStacked <span class="op">/</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb83-3390"><a href="#cb83-3390" aria-hidden="true" tabindex="-1"></a>    vecSupplyCirculating<span class="op">.</span><span class="fu">push</span>(supplyIncentivesStacked)<span class="op">;</span></span>
<span id="cb83-3391"><a href="#cb83-3391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3392"><a href="#cb83-3392" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (t <span class="op">&lt;=</span> <span class="dv">60</span>) {</span>
<span id="cb83-3393"><a href="#cb83-3393" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffIncentives <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> (t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> inputP0 <span class="op">:</span> paramDerivP)<span class="op">;</span></span>
<span id="cb83-3394"><a href="#cb83-3394" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffKlima <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3395"><a href="#cb83-3395" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffProduct <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3396"><a href="#cb83-3396" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffGrant <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3397"><a href="#cb83-3397" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffPKlima <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb83-3398"><a href="#cb83-3398" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffTreasury <span class="op">=</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">4.5</span><span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3399"><a href="#cb83-3399" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diff01X <span class="op">=</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">2.5</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3400"><a href="#cb83-3400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3401"><a href="#cb83-3401" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffIncentivesStacked <span class="op">=</span> diffIncentives<span class="op">;</span></span>
<span id="cb83-3402"><a href="#cb83-3402" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffKlimaStacked <span class="op">=</span> diffKlima <span class="op">+</span> diffIncentivesStacked<span class="op">;</span></span>
<span id="cb83-3403"><a href="#cb83-3403" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffProductStacked <span class="op">=</span> diffProduct <span class="op">+</span> diffKlimaStacked<span class="op">;</span></span>
<span id="cb83-3404"><a href="#cb83-3404" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffGrantStacked <span class="op">=</span> diffGrant <span class="op">+</span> diffProductStacked<span class="op">;</span></span>
<span id="cb83-3405"><a href="#cb83-3405" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffPKlimaStacked <span class="op">=</span> diffPKlima <span class="op">+</span> diffGrantStacked<span class="op">;</span></span>
<span id="cb83-3406"><a href="#cb83-3406" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffTreasuryStacked <span class="op">=</span> diffTreasury <span class="op">+</span> diffPKlimaStacked<span class="op">;</span></span>
<span id="cb83-3407"><a href="#cb83-3407" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diff01XStacked <span class="op">=</span> diff01X <span class="op">+</span> diffTreasuryStacked<span class="op">;</span></span>
<span id="cb83-3408"><a href="#cb83-3408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3409"><a href="#cb83-3409" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3410"><a href="#cb83-3410" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Proportion of Supply"</span><span class="op">,</span></span>
<span id="cb83-3411"><a href="#cb83-3411" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3412"><a href="#cb83-3412" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramP<span class="op">,</span></span>
<span id="cb83-3413"><a href="#cb83-3413" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3414"><a href="#cb83-3414" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3415"><a href="#cb83-3415" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Rate of Change"</span><span class="op">,</span></span>
<span id="cb83-3416"><a href="#cb83-3416" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3417"><a href="#cb83-3417" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDerivP<span class="op">,</span></span>
<span id="cb83-3418"><a href="#cb83-3418" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3419"><a href="#cb83-3419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3420"><a href="#cb83-3420" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3421"><a href="#cb83-3421" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3422"><a href="#cb83-3422" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3423"><a href="#cb83-3423" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3424"><a href="#cb83-3424" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01XStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3425"><a href="#cb83-3425" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3426"><a href="#cb83-3426" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3427"><a href="#cb83-3427" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3428"><a href="#cb83-3428" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3429"><a href="#cb83-3429" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3430"><a href="#cb83-3430" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlimaStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3431"><a href="#cb83-3431" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3432"><a href="#cb83-3432" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3433"><a href="#cb83-3433" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3434"><a href="#cb83-3434" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3435"><a href="#cb83-3435" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3436"><a href="#cb83-3436" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasuryStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3437"><a href="#cb83-3437" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3438"><a href="#cb83-3438" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3439"><a href="#cb83-3439" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3440"><a href="#cb83-3440" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3441"><a href="#cb83-3441" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3442"><a href="#cb83-3442" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrantStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3443"><a href="#cb83-3443" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3444"><a href="#cb83-3444" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3445"><a href="#cb83-3445" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3446"><a href="#cb83-3446" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3447"><a href="#cb83-3447" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3448"><a href="#cb83-3448" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProductStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3449"><a href="#cb83-3449" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3450"><a href="#cb83-3450" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3451"><a href="#cb83-3451" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3452"><a href="#cb83-3452" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3453"><a href="#cb83-3453" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3454"><a href="#cb83-3454" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlimaStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3455"><a href="#cb83-3455" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3456"><a href="#cb83-3456" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3457"><a href="#cb83-3457" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3458"><a href="#cb83-3458" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3459"><a href="#cb83-3459" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3460"><a href="#cb83-3460" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentivesStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3461"><a href="#cb83-3461" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3462"><a href="#cb83-3462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3463"><a href="#cb83-3463" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3464"><a href="#cb83-3464" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3465"><a href="#cb83-3465" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3466"><a href="#cb83-3466" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3467"><a href="#cb83-3467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01X <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3468"><a href="#cb83-3468" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3469"><a href="#cb83-3469" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3470"><a href="#cb83-3470" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3471"><a href="#cb83-3471" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3472"><a href="#cb83-3472" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3473"><a href="#cb83-3473" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlima <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3474"><a href="#cb83-3474" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3475"><a href="#cb83-3475" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3476"><a href="#cb83-3476" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3477"><a href="#cb83-3477" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3478"><a href="#cb83-3478" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3479"><a href="#cb83-3479" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasury <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3480"><a href="#cb83-3480" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3481"><a href="#cb83-3481" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3482"><a href="#cb83-3482" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3483"><a href="#cb83-3483" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3484"><a href="#cb83-3484" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3485"><a href="#cb83-3485" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrant <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3486"><a href="#cb83-3486" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3487"><a href="#cb83-3487" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3488"><a href="#cb83-3488" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3489"><a href="#cb83-3489" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3490"><a href="#cb83-3490" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3491"><a href="#cb83-3491" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProduct <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3492"><a href="#cb83-3492" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3493"><a href="#cb83-3493" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3494"><a href="#cb83-3494" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3495"><a href="#cb83-3495" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3496"><a href="#cb83-3496" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3497"><a href="#cb83-3497" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlima <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3498"><a href="#cb83-3498" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3499"><a href="#cb83-3499" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3500"><a href="#cb83-3500" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3501"><a href="#cb83-3501" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3502"><a href="#cb83-3502" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3503"><a href="#cb83-3503" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentives <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb83-3504"><a href="#cb83-3504" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3505"><a href="#cb83-3505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3506"><a href="#cb83-3506" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3507"><a href="#cb83-3507" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3508"><a href="#cb83-3508" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3509"><a href="#cb83-3509" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3510"><a href="#cb83-3510" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01XStacked<span class="op">,</span></span>
<span id="cb83-3511"><a href="#cb83-3511" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3512"><a href="#cb83-3512" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3513"><a href="#cb83-3513" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3514"><a href="#cb83-3514" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3515"><a href="#cb83-3515" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3516"><a href="#cb83-3516" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlimaStacked<span class="op">,</span></span>
<span id="cb83-3517"><a href="#cb83-3517" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3518"><a href="#cb83-3518" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3519"><a href="#cb83-3519" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3520"><a href="#cb83-3520" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3521"><a href="#cb83-3521" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3522"><a href="#cb83-3522" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasuryStacked<span class="op">,</span></span>
<span id="cb83-3523"><a href="#cb83-3523" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3524"><a href="#cb83-3524" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3525"><a href="#cb83-3525" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3526"><a href="#cb83-3526" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3527"><a href="#cb83-3527" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3528"><a href="#cb83-3528" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrantStacked<span class="op">,</span></span>
<span id="cb83-3529"><a href="#cb83-3529" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3530"><a href="#cb83-3530" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3531"><a href="#cb83-3531" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3532"><a href="#cb83-3532" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3533"><a href="#cb83-3533" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3534"><a href="#cb83-3534" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProductStacked<span class="op">,</span></span>
<span id="cb83-3535"><a href="#cb83-3535" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3536"><a href="#cb83-3536" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3537"><a href="#cb83-3537" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3538"><a href="#cb83-3538" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3539"><a href="#cb83-3539" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3540"><a href="#cb83-3540" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlimaStacked<span class="op">,</span></span>
<span id="cb83-3541"><a href="#cb83-3541" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3542"><a href="#cb83-3542" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3543"><a href="#cb83-3543" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb83-3544"><a href="#cb83-3544" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3545"><a href="#cb83-3545" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3546"><a href="#cb83-3546" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentivesStacked<span class="op">,</span></span>
<span id="cb83-3547"><a href="#cb83-3547" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3548"><a href="#cb83-3548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3549"><a href="#cb83-3549" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3550"><a href="#cb83-3550" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3551"><a href="#cb83-3551" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3552"><a href="#cb83-3552" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3553"><a href="#cb83-3553" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01X<span class="op">,</span></span>
<span id="cb83-3554"><a href="#cb83-3554" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3555"><a href="#cb83-3555" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3556"><a href="#cb83-3556" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3557"><a href="#cb83-3557" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3558"><a href="#cb83-3558" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3559"><a href="#cb83-3559" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlima<span class="op">,</span></span>
<span id="cb83-3560"><a href="#cb83-3560" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3561"><a href="#cb83-3561" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3562"><a href="#cb83-3562" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3563"><a href="#cb83-3563" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3564"><a href="#cb83-3564" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3565"><a href="#cb83-3565" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasury<span class="op">,</span></span>
<span id="cb83-3566"><a href="#cb83-3566" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3567"><a href="#cb83-3567" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3568"><a href="#cb83-3568" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3569"><a href="#cb83-3569" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3570"><a href="#cb83-3570" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3571"><a href="#cb83-3571" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrant<span class="op">,</span></span>
<span id="cb83-3572"><a href="#cb83-3572" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3573"><a href="#cb83-3573" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3574"><a href="#cb83-3574" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3575"><a href="#cb83-3575" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3576"><a href="#cb83-3576" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3577"><a href="#cb83-3577" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProduct<span class="op">,</span></span>
<span id="cb83-3578"><a href="#cb83-3578" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3579"><a href="#cb83-3579" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3580"><a href="#cb83-3580" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3581"><a href="#cb83-3581" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3582"><a href="#cb83-3582" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3583"><a href="#cb83-3583" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlima<span class="op">,</span></span>
<span id="cb83-3584"><a href="#cb83-3584" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3585"><a href="#cb83-3585" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3586"><a href="#cb83-3586" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3587"><a href="#cb83-3587" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3588"><a href="#cb83-3588" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3589"><a href="#cb83-3589" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentives<span class="op">,</span></span>
<span id="cb83-3590"><a href="#cb83-3590" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3591"><a href="#cb83-3591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3592"><a href="#cb83-3592" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3593"><a href="#cb83-3593" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3594"><a href="#cb83-3594" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb83-3595"><a href="#cb83-3595" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3596"><a href="#cb83-3596" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffIncentives<span class="op">,</span></span>
<span id="cb83-3597"><a href="#cb83-3597" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3598"><a href="#cb83-3598" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3599"><a href="#cb83-3599" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3600"><a href="#cb83-3600" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb83-3601"><a href="#cb83-3601" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3602"><a href="#cb83-3602" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffKlima<span class="op">,</span></span>
<span id="cb83-3603"><a href="#cb83-3603" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3604"><a href="#cb83-3604" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3605"><a href="#cb83-3605" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3606"><a href="#cb83-3606" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb83-3607"><a href="#cb83-3607" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3608"><a href="#cb83-3608" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffProduct<span class="op">,</span></span>
<span id="cb83-3609"><a href="#cb83-3609" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3610"><a href="#cb83-3610" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3611"><a href="#cb83-3611" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3612"><a href="#cb83-3612" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb83-3613"><a href="#cb83-3613" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3614"><a href="#cb83-3614" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffGrant<span class="op">,</span></span>
<span id="cb83-3615"><a href="#cb83-3615" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3616"><a href="#cb83-3616" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3617"><a href="#cb83-3617" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3618"><a href="#cb83-3618" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb83-3619"><a href="#cb83-3619" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3620"><a href="#cb83-3620" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffPKlima<span class="op">,</span></span>
<span id="cb83-3621"><a href="#cb83-3621" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3622"><a href="#cb83-3622" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3623"><a href="#cb83-3623" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3624"><a href="#cb83-3624" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb83-3625"><a href="#cb83-3625" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3626"><a href="#cb83-3626" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffTreasury<span class="op">,</span></span>
<span id="cb83-3627"><a href="#cb83-3627" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3628"><a href="#cb83-3628" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb83-3629"><a href="#cb83-3629" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb83-3630"><a href="#cb83-3630" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb83-3631"><a href="#cb83-3631" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb83-3632"><a href="#cb83-3632" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diff01X<span class="op">,</span></span>
<span id="cb83-3633"><a href="#cb83-3633" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb83-3634"><a href="#cb83-3634" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-3635"><a href="#cb83-3635" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-3636"><a href="#cb83-3636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3637"><a href="#cb83-3637" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecNextYearIncentives <span class="op">=</span> vecSupplyIncentives<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3638"><a href="#cb83-3638" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> val)<span class="op">;</span></span>
<span id="cb83-3639"><a href="#cb83-3639" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecAPY <span class="op">=</span> vecSupplyCirculating<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3640"><a href="#cb83-3640" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">*</span> (vecSupplyCirculating[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> val) <span class="op">/</span> val)<span class="op">;</span></span>
<span id="cb83-3641"><a href="#cb83-3641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecAPR <span class="op">=</span> vecSupplyCirculating<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb83-3642"><a href="#cb83-3642" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">*</span> (vecSupplyCirculating[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> vecNextYearIncentives[t] <span class="op">-</span> val) <span class="op">/</span> val)<span class="op">;</span></span>
<span id="cb83-3643"><a href="#cb83-3643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3644"><a href="#cb83-3644" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">&lt;=</span> <span class="dv">60</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb83-3645"><a href="#cb83-3645" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"APY"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> vecAPY[t] })<span class="op">;</span></span>
<span id="cb83-3646"><a href="#cb83-3646" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"APR"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> vecAPR[t] })<span class="op">;</span></span>
<span id="cb83-3647"><a href="#cb83-3647" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-3648"><a href="#cb83-3648" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb83-3649"><a href="#cb83-3649" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives<span class="op">,</span></span>
<span id="cb83-3650"><a href="#cb83-3650" aria-hidden="true" tabindex="-1"></a>    vecSupplyCirculating<span class="op">,</span></span>
<span id="cb83-3651"><a href="#cb83-3651" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">,</span></span>
<span id="cb83-3652"><a href="#cb83-3652" aria-hidden="true" tabindex="-1"></a>    vecAPY<span class="op">,</span></span>
<span id="cb83-3653"><a href="#cb83-3653" aria-hidden="true" tabindex="-1"></a>    vecAPR<span class="op">,</span></span>
<span id="cb83-3654"><a href="#cb83-3654" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb83-3655"><a href="#cb83-3655" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-3656"><a href="#cb83-3656" aria-hidden="true" tabindex="-1"></a>vecSupplyIncentives <span class="op">=</span> supplyDataAll[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb83-3657"><a href="#cb83-3657" aria-hidden="true" tabindex="-1"></a>vecSupplyCirculating <span class="op">=</span> supplyDataAll[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb83-3658"><a href="#cb83-3658" aria-hidden="true" tabindex="-1"></a>supplyData <span class="op">=</span> supplyDataAll[<span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb83-3659"><a href="#cb83-3659" aria-hidden="true" tabindex="-1"></a>vecAPY <span class="op">=</span> supplyDataAll[<span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb83-3660"><a href="#cb83-3660" aria-hidden="true" tabindex="-1"></a>vecAPR <span class="op">=</span> supplyDataAll[<span class="dv">4</span>]<span class="op">;</span></span>
<span id="cb83-3661"><a href="#cb83-3661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3662"><a href="#cb83-3662" aria-hidden="true" tabindex="-1"></a>getLogisticCurve <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Proportion of Supply"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3663"><a href="#cb83-3663" aria-hidden="true" tabindex="-1"></a>getRateOfChange <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Rate of Change"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3664"><a href="#cb83-3664" aria-hidden="true" tabindex="-1"></a>getCirculatingStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3665"><a href="#cb83-3665" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3666"><a href="#cb83-3666" aria-hidden="true" tabindex="-1"></a>getCirculatingUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3667"><a href="#cb83-3667" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3668"><a href="#cb83-3668" aria-hidden="true" tabindex="-1"></a>getTotalStacked <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3669"><a href="#cb83-3669" aria-hidden="true" tabindex="-1"></a>getTotalUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3670"><a href="#cb83-3670" aria-hidden="true" tabindex="-1"></a>getDiffUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3671"><a href="#cb83-3671" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply Differential (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3672"><a href="#cb83-3672" aria-hidden="true" tabindex="-1"></a>getCohortCirculatingStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3673"><a href="#cb83-3673" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3674"><a href="#cb83-3674" aria-hidden="true" tabindex="-1"></a>getCohortCirculatingUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3675"><a href="#cb83-3675" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3676"><a href="#cb83-3676" aria-hidden="true" tabindex="-1"></a>getCohortTotalStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3677"><a href="#cb83-3677" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3678"><a href="#cb83-3678" aria-hidden="true" tabindex="-1"></a>getCohortTotalUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3679"><a href="#cb83-3679" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3680"><a href="#cb83-3680" aria-hidden="true" tabindex="-1"></a>getCohortDiffUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb83-3681"><a href="#cb83-3681" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply Differential (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3682"><a href="#cb83-3682" aria-hidden="true" tabindex="-1"></a>getAPY <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"APY"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3683"><a href="#cb83-3683" aria-hidden="true" tabindex="-1"></a>getAPR <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"APR"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb83-3684"><a href="#cb83-3684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3685"><a href="#cb83-3685" aria-hidden="true" tabindex="-1"></a>domainRateOfChange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(supplyData<span class="op">,</span> getRateOfChange)]<span class="op">;</span></span>
<span id="cb83-3686"><a href="#cb83-3686" aria-hidden="true" tabindex="-1"></a>scaleRateOfChange <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(domainRateOfChange<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb83-3687"><a href="#cb83-3687" aria-hidden="true" tabindex="-1"></a>mapScaleRateOfChange <span class="op">=</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>(scaleRateOfChange)<span class="op">;</span></span>
<span id="cb83-3688"><a href="#cb83-3688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3689"><a href="#cb83-3689" aria-hidden="true" tabindex="-1"></a>stringP0 <span class="op">=</span> <span class="st">"Initial Issuance P₀ = "</span> <span class="op">+</span> inputP0<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb83-3690"><a href="#cb83-3690" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb83-3691"><a href="#cb83-3691" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb83-3692"><a href="#cb83-3692" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb83-3693"><a href="#cb83-3693" aria-hidden="true" tabindex="-1"></a>stringT <span class="op">=</span> <span class="st">"Inflection Point Time T = "</span> <span class="op">+</span> inputT<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb83-3694"><a href="#cb83-3694" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb83-3695"><a href="#cb83-3695" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb83-3696"><a href="#cb83-3696" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" months"</span><span class="op">;</span></span>
<span id="cb83-3697"><a href="#cb83-3697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3698"><a href="#cb83-3698" aria-hidden="true" tabindex="-1"></a>supplyParams <span class="op">=</span> [</span>
<span id="cb83-3699"><a href="#cb83-3699" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringP0<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> inputP0 }<span class="op">,</span></span>
<span id="cb83-3700"><a href="#cb83-3700" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringT<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> inputT<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">50</span> }<span class="op">,</span></span>
<span id="cb83-3701"><a href="#cb83-3701" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-82-31" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb84" data-startfrom="3704" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3703;"><span id="cb84-3704"><a href="#cb84-3704" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb84-3705"><a href="#cb84-3705" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb84-3706"><a href="#cb84-3706" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3707"><a href="#cb84-3707" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb84-3708"><a href="#cb84-3708" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Proportion of Supply"</span><span class="op">,</span> <span class="st">"Rate of Change"</span><span class="op">,</span> stringP0<span class="op">,</span> stringT]<span class="op">,</span></span>
<span id="cb84-3709"><a href="#cb84-3709" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb84-3710"><a href="#cb84-3710" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb84-3711"><a href="#cb84-3711" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span></span>
<span id="cb84-3712"><a href="#cb84-3712" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"‘Life’ Span (Months)"</span><span class="op">,</span></span>
<span id="cb84-3713"><a href="#cb84-3713" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3714"><a href="#cb84-3714" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb84-3715"><a href="#cb84-3715" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>] }<span class="op">,</span></span>
<span id="cb84-3716"><a href="#cb84-3716" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb84-3717"><a href="#cb84-3717" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-3718"><a href="#cb84-3718" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb84-3719"><a href="#cb84-3719" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb84-3720"><a href="#cb84-3720" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Proportion of Supply (%)"</span> })<span class="op">,</span></span>
<span id="cb84-3721"><a href="#cb84-3721" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>(scaleRateOfChange<span class="op">.</span><span class="fu">ticks</span>()<span class="op">,</span> {</span>
<span id="cb84-3722"><a href="#cb84-3722" aria-hidden="true" tabindex="-1"></a>      <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb84-3723"><a href="#cb84-3723" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> scaleRateOfChange<span class="op">.</span><span class="fu">tickFormat</span>()<span class="op">,</span></span>
<span id="cb84-3724"><a href="#cb84-3724" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Rate of Change (%/Month)"</span><span class="op">,</span></span>
<span id="cb84-3725"><a href="#cb84-3725" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> scaleRateOfChange</span>
<span id="cb84-3726"><a href="#cb84-3726" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3727"><a href="#cb84-3727" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleRateOfChange<span class="op">,</span> {</span>
<span id="cb84-3728"><a href="#cb84-3728" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3729"><a href="#cb84-3729" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getRateOfChange<span class="op">,</span></span>
<span id="cb84-3730"><a href="#cb84-3730" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3731"><a href="#cb84-3731" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3732"><a href="#cb84-3732" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb84-3733"><a href="#cb84-3733" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb84-3734"><a href="#cb84-3734" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb84-3735"><a href="#cb84-3735" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3736"><a href="#cb84-3736" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLogisticCurve<span class="op">,</span></span>
<span id="cb84-3737"><a href="#cb84-3737" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3738"><a href="#cb84-3738" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3739"><a href="#cb84-3739" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3740"><a href="#cb84-3740" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleRateOfChange<span class="op">,</span> {</span>
<span id="cb84-3741"><a href="#cb84-3741" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3742"><a href="#cb84-3742" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getRateOfChange<span class="op">,</span></span>
<span id="cb84-3743"><a href="#cb84-3743" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3744"><a href="#cb84-3744" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb84-3745"><a href="#cb84-3745" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb84-3746"><a href="#cb84-3746" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb84-3747"><a href="#cb84-3747" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3748"><a href="#cb84-3748" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLogisticCurve<span class="op">,</span></span>
<span id="cb84-3749"><a href="#cb84-3749" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3750"><a href="#cb84-3750" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb84-3751"><a href="#cb84-3751" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3752"><a href="#cb84-3752" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(supplyParams<span class="op">,</span> {</span>
<span id="cb84-3753"><a href="#cb84-3753" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> stringT <span class="op">?</span> d<span class="op">.</span><span class="at">x</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb84-3754"><a href="#cb84-3754" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb84-3755"><a href="#cb84-3755" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3756"><a href="#cb84-3756" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb84-3757"><a href="#cb84-3757" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb84-3758"><a href="#cb84-3758" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3759"><a href="#cb84-3759" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(supplyParams<span class="op">,</span> {</span>
<span id="cb84-3760"><a href="#cb84-3760" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb84-3761"><a href="#cb84-3761" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb84-3762"><a href="#cb84-3762" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb84-3763"><a href="#cb84-3763" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb84-3764"><a href="#cb84-3764" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb84-3765"><a href="#cb84-3765" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb84-3766"><a href="#cb84-3766" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-83" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentive-issuance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24: Incentive Issuance
</figcaption>
</figure>
</div>
<div id="fig-k2-token-supply-circulating" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token circulating supply over time.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-supply-circulating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb85" data-startfrom="3780" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3779;"><span id="cb85-3780"><a href="#cb85-3780" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb85-3781"><a href="#cb85-3781" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb85-3782"><a href="#cb85-3782" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb85-3783"><a href="#cb85-3783" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Circulating Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb85-3784"><a href="#cb85-3784" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb85-3785"><a href="#cb85-3785" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb85-3786"><a href="#cb85-3786" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb85-3787"><a href="#cb85-3787" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb85-3788"><a href="#cb85-3788" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb85-3789"><a href="#cb85-3789" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCirculatingStacked<span class="op">,</span></span>
<span id="cb85-3790"><a href="#cb85-3790" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortCirculatingStacked<span class="op">,</span></span>
<span id="cb85-3791"><a href="#cb85-3791" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb85-3792"><a href="#cb85-3792" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb85-3793"><a href="#cb85-3793" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb85-3794"><a href="#cb85-3794" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb85-3795"><a href="#cb85-3795" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCirculatingUnstacked<span class="op">,</span></span>
<span id="cb85-3796"><a href="#cb85-3796" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortCirculatingUnstacked<span class="op">,</span></span>
<span id="cb85-3797"><a href="#cb85-3797" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb85-3798"><a href="#cb85-3798" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb85-3799"><a href="#cb85-3799" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb85-3800"><a href="#cb85-3800" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-84" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-supply-circulating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25: <strong>K2</strong> token circulating supply over time.
</figcaption>
</figure>
</div>
<div id="fig-k2-token-supply-total" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-supply-total-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb86" data-startfrom="3815" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3814;"><span id="cb86-3815"><a href="#cb86-3815" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb86-3816"><a href="#cb86-3816" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb86-3817"><a href="#cb86-3817" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb86-3818"><a href="#cb86-3818" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Total Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb86-3819"><a href="#cb86-3819" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb86-3820"><a href="#cb86-3820" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb86-3821"><a href="#cb86-3821" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb86-3822"><a href="#cb86-3822" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb86-3823"><a href="#cb86-3823" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb86-3824"><a href="#cb86-3824" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalStacked<span class="op">,</span></span>
<span id="cb86-3825"><a href="#cb86-3825" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortTotalStacked<span class="op">,</span></span>
<span id="cb86-3826"><a href="#cb86-3826" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb86-3827"><a href="#cb86-3827" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb86-3828"><a href="#cb86-3828" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb86-3829"><a href="#cb86-3829" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb86-3830"><a href="#cb86-3830" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb86-3831"><a href="#cb86-3831" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb86-3832"><a href="#cb86-3832" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb86-3833"><a href="#cb86-3833" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb86-3834"><a href="#cb86-3834" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb86-3835"><a href="#cb86-3835" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-85" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-85-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-85" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-85-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Total supply (stacked).
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb87" data-startfrom="3840" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3839;"><span id="cb87-3840"><a href="#cb87-3840" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb87-3841"><a href="#cb87-3841" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb87-3842"><a href="#cb87-3842" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb87-3843"><a href="#cb87-3843" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Total Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb87-3844"><a href="#cb87-3844" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb87-3845"><a href="#cb87-3845" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb87-3846"><a href="#cb87-3846" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb87-3847"><a href="#cb87-3847" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb87-3848"><a href="#cb87-3848" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb87-3849"><a href="#cb87-3849" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb87-3850"><a href="#cb87-3850" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3851"><a href="#cb87-3851" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3852"><a href="#cb87-3852" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb87-3853"><a href="#cb87-3853" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb87-3854"><a href="#cb87-3854" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb87-3855"><a href="#cb87-3855" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb87-3856"><a href="#cb87-3856" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb87-3857"><a href="#cb87-3857" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3858"><a href="#cb87-3858" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb87-3859"><a href="#cb87-3859" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb87-3860"><a href="#cb87-3860" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb87-3861"><a href="#cb87-3861" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb87-3862"><a href="#cb87-3862" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-86" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-86-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-86" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-86-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Total supply (unstacked).
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-supply-total-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26: <strong>K2</strong> token total supply over time.
</figcaption>
</figure>
</div>
<div id="fig-k2-risk-metrics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-risk-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb88" data-startfrom="3885" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3884;"><span id="cb88-3885"><a href="#cb88-3885" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb88-3886"><a href="#cb88-3886" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb88-3887"><a href="#cb88-3887" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb88-3888"><a href="#cb88-3888" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Rate of Growth (%/Month)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb88-3889"><a href="#cb88-3889" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb88-3890"><a href="#cb88-3890" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb88-3891"><a href="#cb88-3891" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb88-3892"><a href="#cb88-3892" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb88-3893"><a href="#cb88-3893" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb88-3894"><a href="#cb88-3894" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb88-3895"><a href="#cb88-3895" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb88-3896"><a href="#cb88-3896" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb88-3897"><a href="#cb88-3897" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb88-3898"><a href="#cb88-3898" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getDiffUnstacked<span class="op">,</span></span>
<span id="cb88-3899"><a href="#cb88-3899" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortDiffUnstacked<span class="op">,</span></span>
<span id="cb88-3900"><a href="#cb88-3900" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb88-3901"><a href="#cb88-3901" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb88-3902"><a href="#cb88-3902" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-87" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-87-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-87" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-87-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Total supply differential (stacked).
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb89" data-startfrom="3907" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3906;"><span id="cb89-3907"><a href="#cb89-3907" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb89-3908"><a href="#cb89-3908" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb89-3909"><a href="#cb89-3909" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3910"><a href="#cb89-3910" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">9</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb89-3911"><a href="#cb89-3911" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"APY"</span><span class="op">,</span> <span class="st">"APR"</span>]<span class="op">,</span></span>
<span id="cb89-3912"><a href="#cb89-3912" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb89-3913"><a href="#cb89-3913" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb89-3914"><a href="#cb89-3914" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb89-3915"><a href="#cb89-3915" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(vecAPR)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(vecAPY))]<span class="op">,</span></span>
<span id="cb89-3916"><a href="#cb89-3916" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Annual Percentage (%)"</span><span class="op">,</span></span>
<span id="cb89-3917"><a href="#cb89-3917" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3918"><a href="#cb89-3918" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb89-3919"><a href="#cb89-3919" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb89-3920"><a href="#cb89-3920" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb89-3921"><a href="#cb89-3921" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb89-3922"><a href="#cb89-3922" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb89-3923"><a href="#cb89-3923" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3924"><a href="#cb89-3924" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3925"><a href="#cb89-3925" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getAPY<span class="op">,</span></span>
<span id="cb89-3926"><a href="#cb89-3926" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3927"><a href="#cb89-3927" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb89-3928"><a href="#cb89-3928" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3929"><a href="#cb89-3929" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3930"><a href="#cb89-3930" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3931"><a href="#cb89-3931" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb89-3932"><a href="#cb89-3932" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> getAPY<span class="op">,</span></span>
<span id="cb89-3933"><a href="#cb89-3933" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3934"><a href="#cb89-3934" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb89-3935"><a href="#cb89-3935" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3936"><a href="#cb89-3936" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb89-3937"><a href="#cb89-3937" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb89-3938"><a href="#cb89-3938" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getAPR<span class="op">,</span></span>
<span id="cb89-3939"><a href="#cb89-3939" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb89-3940"><a href="#cb89-3940" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb89-3941"><a href="#cb89-3941" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb89-3942"><a href="#cb89-3942" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb89-3943"><a href="#cb89-3943" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb89-3944"><a href="#cb89-3944" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-88" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-88-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-88" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-88-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Utility incentive yield.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-risk-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27: <strong>K2</strong> token supply risk metrics.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-incentive-allocations" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="sec-incentive-allocations"><span class="header-section-number">4.3</span> Incentive Allocations</h3>
<div id="fig-k2-incentive-distribution" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token incentive distribution structure">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-incentive-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/k2-incentive-distribution.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-incentive-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28: <strong>K2</strong> token incentive distribution structure.
</figcaption>
</figure>
</div>
<p>The <strong>relative utilisation</strong> measurement factor <span class="math inline">\upsilon</span> is calculated as follows.</p>
<p>Defining initially:</p>
<ul>
<li><p><span class="math inline">G</span>: Total <strong>G</strong> tokens staked expressed as a proportion of the circulating supply, <span class="math inline">G \in [0, 1]</span>.</p></li>
<li><p><span class="math inline">L</span>: Total <strong>G</strong> tokens held in the <span class="overline"><strong>AG</strong></span> pool expressed as a proportion of circulating supply, <span class="math inline">L \in (0, 1]</span>.</p></li>
</ul>
<p>Where <span class="math inline">\upsilon = 0</span> if <span class="math inline">G + L = 0</span>, otherwise:</p>
<p><span id="eq-relative-utilisation"><span class="math display">
\upsilon = \left( \frac{2 G L}{G^2 + L^2} \right)^2
\tag{34}</span></span></p>
<div id="fig-relative-utilisation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Upsilon range of values.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-relative-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb90" data-startfrom="4003" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4002;"><span id="cb90-4003"><a href="#cb90-4003" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeUpsilon</span>(G<span class="op">,</span> L) {</span>
<span id="cb90-4004"><a href="#cb90-4004" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb90-4005"><a href="#cb90-4005" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-4006"><a href="#cb90-4006" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb90-4007"><a href="#cb90-4007" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">2</span> <span class="op">*</span> G <span class="op">*</span> L <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>))<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-4008"><a href="#cb90-4008" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-4009"><a href="#cb90-4009" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-89" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb91" data-startfrom="4013" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4012;"><span id="cb91-4013"><a href="#cb91-4013" aria-hidden="true" tabindex="-1"></a>upsilonData <span class="op">=</span> {</span>
<span id="cb91-4014"><a href="#cb91-4014" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> upsilonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb91-4015"><a href="#cb91-4015" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb91-4016"><a href="#cb91-4016" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb91-4017"><a href="#cb91-4017" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb91-4018"><a href="#cb91-4018" aria-hidden="true" tabindex="-1"></a>        upsilonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb91-4019"><a href="#cb91-4019" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"υ"</span><span class="op">,</span></span>
<span id="cb91-4020"><a href="#cb91-4020" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb91-4021"><a href="#cb91-4021" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb91-4022"><a href="#cb91-4022" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeUpsilon</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb91-4023"><a href="#cb91-4023" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb91-4024"><a href="#cb91-4024" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb91-4025"><a href="#cb91-4025" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb91-4026"><a href="#cb91-4026" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-4027"><a href="#cb91-4027" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> upsilonData<span class="op">;</span></span>
<span id="cb91-4028"><a href="#cb91-4028" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-90" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb92" data-startfrom="4032" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4031;"><span id="cb92-4032"><a href="#cb92-4032" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb92-4033"><a href="#cb92-4033" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb92-4034"><a href="#cb92-4034" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb92-4035"><a href="#cb92-4035" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb92-4036"><a href="#cb92-4036" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb92-4037"><a href="#cb92-4037" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb92-4038"><a href="#cb92-4038" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb92-4039"><a href="#cb92-4039" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Relative Utilisation υ"</span><span class="op">,</span></span>
<span id="cb92-4040"><a href="#cb92-4040" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb92-4041"><a href="#cb92-4041" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb92-4042"><a href="#cb92-4042" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb92-4043"><a href="#cb92-4043" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb92-4044"><a href="#cb92-4044" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb92-4045"><a href="#cb92-4045" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb92-4046"><a href="#cb92-4046" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb92-4047"><a href="#cb92-4047" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb92-4048"><a href="#cb92-4048" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb92-4049"><a href="#cb92-4049" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(upsilonData<span class="op">,</span> {</span>
<span id="cb92-4050"><a href="#cb92-4050" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4051"><a href="#cb92-4051" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4052"><a href="#cb92-4052" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4053"><a href="#cb92-4053" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb92-4054"><a href="#cb92-4054" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb92-4055"><a href="#cb92-4055" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb92-4056"><a href="#cb92-4056" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(upsilonData<span class="op">,</span> {</span>
<span id="cb92-4057"><a href="#cb92-4057" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb92-4058"><a href="#cb92-4058" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb92-4059"><a href="#cb92-4059" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb92-4060"><a href="#cb92-4060" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb92-4061"><a href="#cb92-4061" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb92-4062"><a href="#cb92-4062" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb92-4063"><a href="#cb92-4063" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb92-4064"><a href="#cb92-4064" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb92-4065"><a href="#cb92-4065" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb92-4066"><a href="#cb92-4066" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb92-4067"><a href="#cb92-4067" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb92-4068"><a href="#cb92-4068" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-91" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-relative-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;29: Upsilon <span class="math inline">\upsilon</span> range of values.
</figcaption>
</figure>
</div>
<p>The <strong>absolute utilisation</strong> parameter <span class="math inline">\eta</span> is defined as <span class="math inline">\eta = 0</span> if <span class="math inline">G + L = 0</span>, otherwise:</p>
<p><span id="eq-absolute-utilisation"><span class="math display">
\eta = \frac{2 G L}{G (1 - G) + L ( 1 - L)}
\tag{35}</span></span></p>
<div id="fig-absolute-utilisation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Eta range of values.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-absolute-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb93" data-startfrom="4089" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4088;"><span id="cb93-4089"><a href="#cb93-4089" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeEta</span>(G<span class="op">,</span> L) {</span>
<span id="cb93-4090"><a href="#cb93-4090" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb93-4091"><a href="#cb93-4091" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb93-4092"><a href="#cb93-4092" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb93-4093"><a href="#cb93-4093" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> G <span class="op">*</span> L <span class="op">/</span> (G <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> G) <span class="op">+</span> L <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> L))<span class="op">;</span></span>
<span id="cb93-4094"><a href="#cb93-4094" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-4095"><a href="#cb93-4095" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-92" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb94" data-startfrom="4099" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4098;"><span id="cb94-4099"><a href="#cb94-4099" aria-hidden="true" tabindex="-1"></a>etaData <span class="op">=</span> {</span>
<span id="cb94-4100"><a href="#cb94-4100" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> etaData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb94-4101"><a href="#cb94-4101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb94-4102"><a href="#cb94-4102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb94-4103"><a href="#cb94-4103" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb94-4104"><a href="#cb94-4104" aria-hidden="true" tabindex="-1"></a>        etaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb94-4105"><a href="#cb94-4105" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"η"</span><span class="op">,</span></span>
<span id="cb94-4106"><a href="#cb94-4106" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb94-4107"><a href="#cb94-4107" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb94-4108"><a href="#cb94-4108" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeEta</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb94-4109"><a href="#cb94-4109" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb94-4110"><a href="#cb94-4110" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb94-4111"><a href="#cb94-4111" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-4112"><a href="#cb94-4112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb94-4113"><a href="#cb94-4113" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> etaData<span class="op">;</span></span>
<span id="cb94-4114"><a href="#cb94-4114" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-93" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb95" data-startfrom="4118" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4117;"><span id="cb95-4118"><a href="#cb95-4118" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb95-4119"><a href="#cb95-4119" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb95-4120"><a href="#cb95-4120" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb95-4121"><a href="#cb95-4121" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb95-4122"><a href="#cb95-4122" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb95-4123"><a href="#cb95-4123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb95-4124"><a href="#cb95-4124" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb95-4125"><a href="#cb95-4125" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Absolute Utilisation η"</span><span class="op">,</span></span>
<span id="cb95-4126"><a href="#cb95-4126" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb95-4127"><a href="#cb95-4127" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb95-4128"><a href="#cb95-4128" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb95-4129"><a href="#cb95-4129" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb95-4130"><a href="#cb95-4130" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb95-4131"><a href="#cb95-4131" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb95-4132"><a href="#cb95-4132" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb95-4133"><a href="#cb95-4133" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb95-4134"><a href="#cb95-4134" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb95-4135"><a href="#cb95-4135" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(etaData<span class="op">,</span> {</span>
<span id="cb95-4136"><a href="#cb95-4136" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4137"><a href="#cb95-4137" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4138"><a href="#cb95-4138" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4139"><a href="#cb95-4139" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4140"><a href="#cb95-4140" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb95-4141"><a href="#cb95-4141" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb95-4142"><a href="#cb95-4142" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(etaData<span class="op">,</span> {</span>
<span id="cb95-4143"><a href="#cb95-4143" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb95-4144"><a href="#cb95-4144" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb95-4145"><a href="#cb95-4145" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb95-4146"><a href="#cb95-4146" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb95-4147"><a href="#cb95-4147" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb95-4148"><a href="#cb95-4148" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb95-4149"><a href="#cb95-4149" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb95-4150"><a href="#cb95-4150" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb95-4151"><a href="#cb95-4151" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb95-4152"><a href="#cb95-4152" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb95-4153"><a href="#cb95-4153" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb95-4154"><a href="#cb95-4154" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-94" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-absolute-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;30: Eta <span class="math inline">\eta</span> range of values.
</figcaption>
</figure>
</div>
<p>Incentives <span class="math inline">I</span> are allocated as follows:</p>
<section id="treasury" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="treasury"><span class="header-section-number">4.3.1</span> Treasury</h4>
<p>The allocation to the Treasury <span class="math inline">I_T</span> is the imbalance generated from <span class="math inline">\upsilon</span>:</p>
<p><span id="eq-allocation-treasury"><span class="math display">
I_T = 1 - \upsilon \, \eta
\tag{36}</span></span></p>
</section>
<section id="post-treasury" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="post-treasury"><span class="header-section-number">4.3.2</span> Post Treasury</h4>
<p>The residual post-treasury allocation is shared four ways within 2 buckets:</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong> &amp; user-locked <strong>G</strong> tokens</p>
<p>Where <span class="math inline">S</span> is the proportion of time-locked <strong>A</strong> tokens&nbsp;(as defined previously in <a href="#sec-time-weighted-incentive-curve" class="quarto-xref">Section&nbsp;3.1.1</a>):</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong>, <span class="math inline">I_S</span>:</p>
<p><span id="eq-allocation-locked-a"><span class="math display">
I_S = S \, \frac{L^2}{G^2 + L^2}
  \tag{37}</span></span></p></li>
<li><p>User-locked <strong>G</strong>, <span class="math inline">I_G</span>:</p>
<p><span id="eq-allocation-locked-g"><span class="math display">
I_G = (1 - S) \, \frac{L^2}{G^2 + L^2}
  \tag{38}</span></span></p></li>
</ol></li>
<li><p>Liquidity</p>
<p>With <span class="math inline">\lambda_G</span>, <span class="math inline">\lambda_Q</span>, <span class="math inline">\lambda_{GG}</span> as defined in <a href="#sec-share-of-risk-premium" class="quarto-xref">Section&nbsp;3.3.4</a>:</p>
<ol start="3" type="1">
<li><p><span class="overline"><strong>AG</strong></span> pool <span class="math inline">I_{AG}</span>:</p>
<p><span id="eq-allocation-pool-ag"><span class="math display">
I_{AG} = \frac{\lambda_G}{1 - \lambda_{GG}} \, \frac{G^2}{G^2 + L^2}
  \tag{39}</span></span></p></li>
<li><p><span class="overline"><strong>AQ</strong></span> pool <span class="math inline">I_{AQ}</span>:</p>
<p><span id="eq-allocation-pool-aq"><span class="math display">
I_{AQ} = \frac{\lambda_Q}{1 - \lambda_{GG}} \, \frac{G^2}{G^2 + L^2}
  \tag{40}</span></span></p></li>
</ol></li>
</ol>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb96" data-startfrom="4227" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4226;"><span id="cb96-4227"><a href="#cb96-4227" aria-hidden="true" tabindex="-1"></a>viewof inputS_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb96-4228"><a href="#cb96-4228" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Time-Locked } S`</span><span class="op">,</span></span>
<span id="cb96-4229"><a href="#cb96-4229" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb96-4230"><a href="#cb96-4230" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb96-4231"><a href="#cb96-4231" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb96-4232"><a href="#cb96-4232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4233"><a href="#cb96-4233" aria-hidden="true" tabindex="-1"></a>viewof inputWeightAG <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb96-4234"><a href="#cb96-4234" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{LP split}`</span><span class="op">,</span></span>
<span id="cb96-4235"><a href="#cb96-4235" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb96-4236"><a href="#cb96-4236" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb96-4237"><a href="#cb96-4237" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb96-4238"><a href="#cb96-4238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4239"><a href="#cb96-4239" aria-hidden="true" tabindex="-1"></a>paramWeightAQ <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> inputWeightAG<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-95-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-incentives-non-treasury" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentives-non-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb97" data-startfrom="4250" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4249;"><span id="cb97-4250"><a href="#cb97-4250" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeTreasury</span>(G<span class="op">,</span> L) {</span>
<span id="cb97-4251"><a href="#cb97-4251" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> <span class="fu">computeUpsilon</span>(G<span class="op">,</span> L) <span class="op">*</span> <span class="fu">computeEta</span>(G<span class="op">,</span> L))<span class="op">;</span></span>
<span id="cb97-4252"><a href="#cb97-4252" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-96" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb98" data-startfrom="4257" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4256;"><span id="cb98-4257"><a href="#cb98-4257" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIBonds</span>(G<span class="op">,</span> L<span class="op">,</span> S) {</span>
<span id="cb98-4258"><a href="#cb98-4258" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb98-4259"><a href="#cb98-4259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb98-4260"><a href="#cb98-4260" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb98-4261"><a href="#cb98-4261" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S <span class="op">*</span> L<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb98-4262"><a href="#cb98-4262" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-4263"><a href="#cb98-4263" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-4264"><a href="#cb98-4264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4265"><a href="#cb98-4265" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIStaking</span>(G<span class="op">,</span> L<span class="op">,</span> S) {</span>
<span id="cb98-4266"><a href="#cb98-4266" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb98-4267"><a href="#cb98-4267" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb98-4268"><a href="#cb98-4268" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb98-4269"><a href="#cb98-4269" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> S) <span class="op">*</span> L<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb98-4270"><a href="#cb98-4270" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-4271"><a href="#cb98-4271" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-97-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-97-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb99" data-startfrom="4274" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4273;"><span id="cb99-4274"><a href="#cb99-4274" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIPool</span>(G<span class="op">,</span> L<span class="op">,</span> weight) {</span>
<span id="cb99-4275"><a href="#cb99-4275" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb99-4276"><a href="#cb99-4276" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb99-4277"><a href="#cb99-4277" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb99-4278"><a href="#cb99-4278" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weight <span class="op">*</span> G<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb99-4279"><a href="#cb99-4279" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb99-4280"><a href="#cb99-4280" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-98" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb100" data-startfrom="4284" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4283;"><span id="cb100-4284"><a href="#cb100-4284" aria-hidden="true" tabindex="-1"></a>allocationSQData <span class="op">=</span> {</span>
<span id="cb100-4285"><a href="#cb100-4285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocationSQData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb100-4286"><a href="#cb100-4286" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb100-4287"><a href="#cb100-4287" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb100-4288"><a href="#cb100-4288" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb100-4289"><a href="#cb100-4289" aria-hidden="true" tabindex="-1"></a>        allocationSQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb100-4290"><a href="#cb100-4290" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔 Time-locks Allocation"</span><span class="op">,</span></span>
<span id="cb100-4291"><a href="#cb100-4291" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb100-4292"><a href="#cb100-4292" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb100-4293"><a href="#cb100-4293" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIBonds</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputS_)<span class="op">,</span></span>
<span id="cb100-4294"><a href="#cb100-4294" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb100-4295"><a href="#cb100-4295" aria-hidden="true" tabindex="-1"></a>        allocationSQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb100-4296"><a href="#cb100-4296" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗚 User-locks Allocation"</span><span class="op">,</span></span>
<span id="cb100-4297"><a href="#cb100-4297" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb100-4298"><a href="#cb100-4298" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb100-4299"><a href="#cb100-4299" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIStaking</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputS_)<span class="op">,</span></span>
<span id="cb100-4300"><a href="#cb100-4300" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb100-4301"><a href="#cb100-4301" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb100-4302"><a href="#cb100-4302" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb100-4303"><a href="#cb100-4303" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb100-4304"><a href="#cb100-4304" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocationSQData<span class="op">;</span></span>
<span id="cb100-4305"><a href="#cb100-4305" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-99" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb101" data-startfrom="4310" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4309;"><span id="cb101-4310"><a href="#cb101-4310" aria-hidden="true" tabindex="-1"></a>plotAllocationSQ <span class="op">=</span> {</span>
<span id="cb101-4311"><a href="#cb101-4311" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotAllocationSQ <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb101-4312"><a href="#cb101-4312" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb101-4313"><a href="#cb101-4313" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb101-4314"><a href="#cb101-4314" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb101-4315"><a href="#cb101-4315" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb101-4316"><a href="#cb101-4316" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb101-4317"><a href="#cb101-4317" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb101-4318"><a href="#cb101-4318" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb101-4319"><a href="#cb101-4319" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb101-4320"><a href="#cb101-4320" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb101-4321"><a href="#cb101-4321" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb101-4322"><a href="#cb101-4322" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb101-4323"><a href="#cb101-4323" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb101-4324"><a href="#cb101-4324" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb101-4325"><a href="#cb101-4325" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb101-4326"><a href="#cb101-4326" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb101-4327"><a href="#cb101-4327" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb101-4328"><a href="#cb101-4328" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb101-4329"><a href="#cb101-4329" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(allocationSQData<span class="op">,</span> {</span>
<span id="cb101-4330"><a href="#cb101-4330" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4331"><a href="#cb101-4331" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4332"><a href="#cb101-4332" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4333"><a href="#cb101-4333" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb101-4334"><a href="#cb101-4334" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb101-4335"><a href="#cb101-4335" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb101-4336"><a href="#cb101-4336" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb101-4337"><a href="#cb101-4337" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(allocationSQData<span class="op">,</span> {</span>
<span id="cb101-4338"><a href="#cb101-4338" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb101-4339"><a href="#cb101-4339" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb101-4340"><a href="#cb101-4340" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb101-4341"><a href="#cb101-4341" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb101-4342"><a href="#cb101-4342" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb101-4343"><a href="#cb101-4343" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb101-4344"><a href="#cb101-4344" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb101-4345"><a href="#cb101-4345" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb101-4346"><a href="#cb101-4346" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb101-4347"><a href="#cb101-4347" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb101-4348"><a href="#cb101-4348" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb101-4349"><a href="#cb101-4349" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb101-4350"><a href="#cb101-4350" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb101-4351"><a href="#cb101-4351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4352"><a href="#cb101-4352" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotAllocationSQ)</span>
<span id="cb101-4353"><a href="#cb101-4353" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb101-4354"><a href="#cb101-4354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb101-4355"><a href="#cb101-4355" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb101-4356"><a href="#cb101-4356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4357"><a href="#cb101-4357" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotAllocationSQ<span class="op">;</span></span>
<span id="cb101-4358"><a href="#cb101-4358" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-100" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-100-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-100" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-100-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Time-locked <strong>A</strong> and user-locked <strong>G</strong> allocations.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb102" data-startfrom="4362" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4361;"><span id="cb102-4362"><a href="#cb102-4362" aria-hidden="true" tabindex="-1"></a>allocationPoolData <span class="op">=</span> {</span>
<span id="cb102-4363"><a href="#cb102-4363" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocationPoolData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb102-4364"><a href="#cb102-4364" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb102-4365"><a href="#cb102-4365" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb102-4366"><a href="#cb102-4366" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb102-4367"><a href="#cb102-4367" aria-hidden="true" tabindex="-1"></a>        allocationPoolData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb102-4368"><a href="#cb102-4368" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔𝗚 Pool Allocation"</span><span class="op">,</span></span>
<span id="cb102-4369"><a href="#cb102-4369" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb102-4370"><a href="#cb102-4370" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb102-4371"><a href="#cb102-4371" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIPool</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputWeightAG)<span class="op">,</span></span>
<span id="cb102-4372"><a href="#cb102-4372" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb102-4373"><a href="#cb102-4373" aria-hidden="true" tabindex="-1"></a>        allocationPoolData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb102-4374"><a href="#cb102-4374" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔𝗤 Pool Allocation"</span><span class="op">,</span></span>
<span id="cb102-4375"><a href="#cb102-4375" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb102-4376"><a href="#cb102-4376" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb102-4377"><a href="#cb102-4377" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIPool</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> paramWeightAQ)<span class="op">,</span></span>
<span id="cb102-4378"><a href="#cb102-4378" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb102-4379"><a href="#cb102-4379" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb102-4380"><a href="#cb102-4380" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb102-4381"><a href="#cb102-4381" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-4382"><a href="#cb102-4382" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocationPoolData<span class="op">;</span></span>
<span id="cb102-4383"><a href="#cb102-4383" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-101" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb103" data-startfrom="4388" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4387;"><span id="cb103-4388"><a href="#cb103-4388" aria-hidden="true" tabindex="-1"></a>plotAllocationPool <span class="op">=</span> {</span>
<span id="cb103-4389"><a href="#cb103-4389" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotAllocationPool <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb103-4390"><a href="#cb103-4390" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb103-4391"><a href="#cb103-4391" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb103-4392"><a href="#cb103-4392" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb103-4393"><a href="#cb103-4393" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb103-4394"><a href="#cb103-4394" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb103-4395"><a href="#cb103-4395" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb103-4396"><a href="#cb103-4396" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb103-4397"><a href="#cb103-4397" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb103-4398"><a href="#cb103-4398" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb103-4399"><a href="#cb103-4399" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb103-4400"><a href="#cb103-4400" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb103-4401"><a href="#cb103-4401" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb103-4402"><a href="#cb103-4402" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb103-4403"><a href="#cb103-4403" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb103-4404"><a href="#cb103-4404" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb103-4405"><a href="#cb103-4405" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb103-4406"><a href="#cb103-4406" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb103-4407"><a href="#cb103-4407" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(allocationPoolData<span class="op">,</span> {</span>
<span id="cb103-4408"><a href="#cb103-4408" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4409"><a href="#cb103-4409" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4410"><a href="#cb103-4410" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4411"><a href="#cb103-4411" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb103-4412"><a href="#cb103-4412" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb103-4413"><a href="#cb103-4413" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb103-4414"><a href="#cb103-4414" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb103-4415"><a href="#cb103-4415" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(allocationPoolData<span class="op">,</span> {</span>
<span id="cb103-4416"><a href="#cb103-4416" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb103-4417"><a href="#cb103-4417" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb103-4418"><a href="#cb103-4418" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb103-4419"><a href="#cb103-4419" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb103-4420"><a href="#cb103-4420" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb103-4421"><a href="#cb103-4421" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb103-4422"><a href="#cb103-4422" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb103-4423"><a href="#cb103-4423" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb103-4424"><a href="#cb103-4424" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb103-4425"><a href="#cb103-4425" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb103-4426"><a href="#cb103-4426" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb103-4427"><a href="#cb103-4427" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb103-4428"><a href="#cb103-4428" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb103-4429"><a href="#cb103-4429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4430"><a href="#cb103-4430" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotAllocationPool)</span>
<span id="cb103-4431"><a href="#cb103-4431" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb103-4432"><a href="#cb103-4432" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb103-4433"><a href="#cb103-4433" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb103-4434"><a href="#cb103-4434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4435"><a href="#cb103-4435" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotAllocationPool<span class="op">;</span></span>
<span id="cb103-4436"><a href="#cb103-4436" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-102" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-102-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-102" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-102-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Liquidity pools allocations.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentives-non-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;31: Share of non-treasury incentives <span class="math inline">I_S</span>, <span class="math inline">I_G</span>, <span class="math inline">I_{AG}</span> and <span class="math inline">I_{AQ}</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<div id="fig-incentives-treasury" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Treasury incentives.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentives-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb104" data-startfrom="4461" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4460;"><span id="cb104-4461"><a href="#cb104-4461" aria-hidden="true" tabindex="-1"></a>treasuryData <span class="op">=</span> {</span>
<span id="cb104-4462"><a href="#cb104-4462" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> treasuryData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb104-4463"><a href="#cb104-4463" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb104-4464"><a href="#cb104-4464" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb104-4465"><a href="#cb104-4465" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb104-4466"><a href="#cb104-4466" aria-hidden="true" tabindex="-1"></a>        treasuryData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb104-4467"><a href="#cb104-4467" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"I_T"</span><span class="op">,</span></span>
<span id="cb104-4468"><a href="#cb104-4468" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb104-4469"><a href="#cb104-4469" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb104-4470"><a href="#cb104-4470" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeTreasury</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb104-4471"><a href="#cb104-4471" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb104-4472"><a href="#cb104-4472" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb104-4473"><a href="#cb104-4473" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb104-4474"><a href="#cb104-4474" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-4475"><a href="#cb104-4475" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> treasuryData<span class="op">;</span></span>
<span id="cb104-4476"><a href="#cb104-4476" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-103" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb105" data-startfrom="4480" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4479;"><span id="cb105-4480"><a href="#cb105-4480" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb105-4481"><a href="#cb105-4481" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb105-4482"><a href="#cb105-4482" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb105-4483"><a href="#cb105-4483" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb105-4484"><a href="#cb105-4484" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb105-4485"><a href="#cb105-4485" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb105-4486"><a href="#cb105-4486" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb105-4487"><a href="#cb105-4487" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb105-4488"><a href="#cb105-4488" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb105-4489"><a href="#cb105-4489" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb105-4490"><a href="#cb105-4490" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb105-4491"><a href="#cb105-4491" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb105-4492"><a href="#cb105-4492" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb105-4493"><a href="#cb105-4493" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb105-4494"><a href="#cb105-4494" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb105-4495"><a href="#cb105-4495" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb105-4496"><a href="#cb105-4496" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb105-4497"><a href="#cb105-4497" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(treasuryData<span class="op">,</span> {</span>
<span id="cb105-4498"><a href="#cb105-4498" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4499"><a href="#cb105-4499" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4500"><a href="#cb105-4500" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4501"><a href="#cb105-4501" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb105-4502"><a href="#cb105-4502" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb105-4503"><a href="#cb105-4503" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb105-4504"><a href="#cb105-4504" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(treasuryData<span class="op">,</span> {</span>
<span id="cb105-4505"><a href="#cb105-4505" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb105-4506"><a href="#cb105-4506" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb105-4507"><a href="#cb105-4507" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb105-4508"><a href="#cb105-4508" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb105-4509"><a href="#cb105-4509" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb105-4510"><a href="#cb105-4510" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb105-4511"><a href="#cb105-4511" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb105-4512"><a href="#cb105-4512" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb105-4513"><a href="#cb105-4513" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb105-4514"><a href="#cb105-4514" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb105-4515"><a href="#cb105-4515" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb105-4516"><a href="#cb105-4516" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-104" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentives-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32: Treasury incentives <span class="math inline">I_T</span>.
</figcaption>
</figure>
</div>


<div class="ojs-auto-generated hidden">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nU308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0l9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdBU3VwcGx5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMyJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nUHJlc2VudFRvbm5lc308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0FFbWl0dGVkfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nRGVsdGFUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC02In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdBUHJpY2V9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdCYXJDaVByaWNlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQVN1cHBseV99PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC05In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdMaXF1aWRUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQUJ1cm50fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0RlbHRhQ2lUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQVByaWNlX308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEzIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdDaVByaWNlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0lucHV0UDB9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nSW5wdXRUfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTYifV19
</script>
</div>
</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note the development of liquidity pool pricing functionality may be applicable.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dFMgPSBJbnB1dHMucmFuZ2UoWzFlLTQsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1RpbWUtTG9ja2VkIH0gU2AsXG4gIHN0ZXA6IDFlLTQsXG4gIHZhbHVlOiAwLjU1LFxufSk7XG52aWV3b2YgaW5wdXREID0gSW5wdXRzLnJhbmdlKFswLjI1LCAxMF0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UGFyYW1ldGVyIH0gRGAsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiA0LjY5LFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb25zdEFyZWFMaW5lYXIocmFuZ2UsIGFyZWEsIGlucHV0U2xvcGUsIHNsb3BlRmFjdG9yID0gMC4wMDcpIHtcbiAgaWYgKHJhbmdlLmxlbmd0aCA9PT0gMSkge1xuICAgIHJldHVybiBbYXJlYV07XG4gIH1cblxuICBsZXQgeTEgPSAwO1xuICBsZXQgeTIgPSByYW5nZS5sZW5ndGggLSAxO1xuICBsZXQgc2xvcGUgPSBzbG9wZUZhY3RvciAqIE1hdGguYXRhbmgoaW5wdXRTbG9wZSk7XG4gIGxldCBpbnRlcmNlcHQgPSBhcmVhIC8gcmFuZ2UubGVuZ3RoO1xuXG4gIGlmIChNYXRoLmFicyhzbG9wZSkgPiAyICogaW50ZXJjZXB0IC8gKHkyIC0geTEgLSAxKSkge1xuICAgIGNvbnN0IHlFeGFjdFNoaWZ0ID0gTWF0aC5zcXJ0KE1hdGguYWJzKDIgKiBhcmVhIC8gc2xvcGUpKTtcbiAgICBjb25zdCB5Um91bmRTaGlmdCA9IE1hdGgubWF4KDEsIE1hdGgucm91bmQoeUV4YWN0U2hpZnQpKTtcbiAgICBpZiAoc2xvcGUgPiAwKSB7XG4gICAgICB5MSA9IHkyIC0geVJvdW5kU2hpZnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHkyID0geTEgKyB5Um91bmRTaGlmdDtcbiAgICB9XG4gICAgc2xvcGUgPSBNYXRoLnNpZ24oc2xvcGUpICogMiAqIGFyZWEgLyBNYXRoLnBvdygoeTIgLSB5MSksIDIpO1xuICAgIGludGVyY2VwdCA9IE1hdGguYWJzKHNsb3BlKSAqICh5MiAtIHkxIC0gMSkgLyAyO1xuICB9XG5cbiAgY29uc3QgeUNvbnN0QXJlYSA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHJhbmdlLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeSA9IGkgLSAoeTEgKyB5MikgLyAyO1xuICAgIHlDb25zdEFyZWEucHVzaChNYXRoLm1heCgwLCBzbG9wZSAqIHkgKyBpbnRlcmNlcHQpKTtcbiAgfVxuXG4gIHJldHVybiB5Q29uc3RBcmVhO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjRSA9IGQzLnJhbmdlKDAuMjUsIDEwLjEsIDAuMjUpO1xuXG5zY2FsZUUgPSBkMy5zY2FsZUxpbmVhcihkMy5leHRlbnQodmVjRSksIFstMSwgMV0pO1xuXG52ZWNTID0gY29uc3RBcmVhTGluZWFyKHZlY0UsIDAuNTUsIHNjYWxlRShpbnB1dEQpKS5tYXAoXG4gIHggPT4geCAqIGlucHV0UyAvIDAuNTUsXG4pO1xuXG52ZWNSZXZlcnNlQ3Vtc3VtUyA9IGQzLmN1bXN1bSh2ZWNTLnNsaWNlKCkucmV2ZXJzZSgpKS5yZXZlcnNlKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBkb3RQcm9kdWN0KHYsIHcpIHtcbiAgaWYgKHYubGVuZ3RoICE9PSB3Lmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlZlY3RvcnMgbXVzdCBoYXZlIHRoZSBzYW1lIGxlbmd0aFwiKTtcbiAgfVxuICByZXR1cm4gdi5yZWR1Y2UoKGFjYywgdmFsLCBpKSA9PiBhY2MgKyB2YWwgKiB3W2ldLCAwKTtcbn1cblxuZnVuY3Rpb24gd2VpZ2h0ZWRBcml0aG1ldGljTWVhbih2LCB3ZWlnaHRzKSB7XG4gIHJldHVybiBkb3RQcm9kdWN0KHYsIHdlaWdodHMpIC8gZDMuc3VtKHdlaWdodHMpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1EID0gd2VpZ2h0ZWRBcml0aG1ldGljTWVhbih2ZWNFLCB2ZWNTKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBhcmFtQyA9IHdlaWdodGVkQXJpdGhtZXRpY01lYW4odmVjRS5tYXAoZSA9PiBlICogZSksIHZlY1MpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUdhbW1hKHZlY0UsIHBhcmFtRCwgcGFyYW1DKSB7XG4gIGNvbnN0IHR3b0MgPSAyICogcGFyYW1DO1xuICByZXR1cm4gdmVjRS5tYXAoZSA9PiBNYXRoLm1heCgwLCBlL3BhcmFtRCAtIGUqZS90d29DKSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNHYW1tYSA9IGNvbXB1dGVHYW1tYSh2ZWNFLCBwYXJhbUQsIHBhcmFtQyk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBub3JtYWxpemUodikge1xuICBjb25zdCBzdW0gPSBkMy5zdW0odik7XG4gIHJldHVybiB2Lm1hcCh2YWwgPT4gdmFsIC8gc3VtKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNOb3JtR2FtbWEgPSBub3JtYWxpemUodmVjR2FtbWEpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZlY0N1bVN1bUdhbW1hID0gZDMuY3Vtc3VtKHZlY05vcm1HYW1tYSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVoocGFyYW1TLCB2ZWNDdW1TdW1HYW1tYSwgdmVjRSkge1xuICByZXR1cm4gdmVjQ3VtU3VtR2FtbWEubWFwKChnLCB0KSA9PiAoMSAtIHBhcmFtUykgKiBnIC8gdmVjRVt0XSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjWiA9IGNvbXB1dGVaKGlucHV0UywgdmVjQ3VtU3VtR2FtbWEsIHZlY0UpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVCKHZlY1osIHZlY0UpIHtcbiAgcmV0dXJuIHZlY1oubWFwKCh6LCB0KSA9PiBNYXRoLmV4cCgteiAqIHZlY0VbdF0pKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNCID0gY29tcHV0ZUIodmVjWiwgdmVjRSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVkodmVjWikge1xuICByZXR1cm4gdmVjWi5tYXAoeiA9PiBNYXRoLmV4cG0xKHopKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNZID0gY29tcHV0ZVkodmVjWik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1JID0gZG90UHJvZHVjdCh2ZWNTLCB2ZWNZKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ5aWVsZERhdGEgPSB7XG4gICBjb25zdCB5aWVsZERhdGEgPSBbXTtcbiAgIGZvciAobGV0IHQgPSAzOyB0IDwgdmVjRS5sZW5ndGg7IHQgKz0gNCkge1xuICAgICAgeWllbGREYXRhLnB1c2goe1xuICAgICAgICAga2V5OiBcIlN0YWtlIEFcIixcbiAgICAgICAgIHZhbHVlOiAxMDAgKiBkMy5zdW0odmVjUy5zbGljZSh0IC0gMywgdCArIDEpKSxcbiAgICAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgICB9KTtcbiAgICAgIHlpZWxkRGF0YS5wdXNoKHtcbiAgICAgICAgIGtleTogXCJUaW1lLXdlaWdodGVkIEluY2VudGl2ZSBDdXJ2ZVwiLFxuICAgICAgICAgdmFsdWU6IDEwMCAqIHZlY1pbdF0sXG4gICAgICAgICB0aW1lOiB2ZWNFW3RdLFxuICAgICAgfSk7XG4gICAgICB5aWVsZERhdGEucHVzaCh7XG4gICAgICAgICBrZXk6IFwiSW5mbGF0aW9uLWFkanVzdGVkIEluY2VudGl2ZXNcIixcbiAgICAgICAgIHZhbHVlOiAxMDAgKiAodmVjWlt0XSAtIHBhcmFtSSksXG4gICAgICAgICB0aW1lOiB2ZWNFW3RdLFxuICAgICAgfSk7XG4gICAgICB5aWVsZERhdGEucHVzaCh7XG4gICAgICAgICBrZXk6IFwiRGlzY291bnQgQ3VydmVcIixcbiAgICAgICAgIHZhbHVlOiAxMDAgKiB2ZWNCW3RdLFxuICAgICAgICAgdGltZTogdmVjRVt0XSxcbiAgICAgIH0pO1xuICAgICAgeWllbGREYXRhLnB1c2goe1xuICAgICAgICAga2V5OiBcIkN1bXVsYXRpdmUgU3Rha2UgQVwiLFxuICAgICAgICAgdmFsdWU6IDEwMCAqIHZlY1JldmVyc2VDdW1zdW1TW3QgLSAzXSxcbiAgICAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgICB9KTtcbiAgIH1cbiAgIHJldHVybiB5aWVsZERhdGE7XG59O1xuZ2V0U3Rha2UgPSBkID0+IGQua2V5ID09PSBcIlN0YWtlIEFcIiA/IGQudmFsdWUgOiBOYU47XG5nZXRZaWVsZFRlcm0gPSBkID0+IGQua2V5ID09PSBcIlRpbWUtd2VpZ2h0ZWQgSW5jZW50aXZlIEN1cnZlXCIgPyBkLnZhbHVlIDogTmFOO1xuZ2V0UmVhbFlpZWxkID0gZCA9PiBkLmtleSA9PT0gXCJJbmZsYXRpb24tYWRqdXN0ZWQgSW5jZW50aXZlc1wiID8gZC52YWx1ZSA6IE5hTjtcbmdldERpc2NvdW50ID0gZCA9PiBkLmtleSA9PT0gXCJEaXNjb3VudCBDdXJ2ZVwiID8gZC52YWx1ZSA6IE5hTjtcbmdldEN1bVN0YWtlID0gZCA9PiBkLmtleSA9PT0gXCJDdW11bGF0aXZlIFN0YWtlIEFcIiA/IGQudmFsdWUgOiBOYU47XG5cbnN0cmluZ1MgPSBcIlRvdGFsIFN0YWtlID0gXCIgKyBpbnB1dFMudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4pO1xuc3RyaW5nSSA9IFwiSW5mbGF0aW9uID0gXCIgKyBwYXJhbUkudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4pO1xuc3RyaW5nRCA9IGBEID0gJHtwYXJhbUQudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuKX0geWVhcnNgO1xuc3RyaW5nQyA9IGDiiJpDID0gJHtNYXRoLnNxcnQocGFyYW1DKS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4pfSB5ZWFyc2A7XG5cbnlpZWxkUGFyYW1zID0gW1xuICB7IGtleTogc3RyaW5nRCwgdGltZTogcGFyYW1EIH0sXG4gIHsga2V5OiBzdHJpbmdDLCB0aW1lOiBNYXRoLnNxcnQocGFyYW1DKSB9LFxuXTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogZDMuc2NoZW1lQ2F0ZWdvcnkxMCxcbiAgICBkb21haW46IFtcbiAgICAgIFwiU3Rha2UgQVwiLFxuICAgICAgXCJUaW1lLXdlaWdodGVkIEluY2VudGl2ZSBDdXJ2ZVwiLFxuICAgICAgXCJJbmZsYXRpb24tYWRqdXN0ZWQgSW5jZW50aXZlc1wiLFxuICAgICAgc3RyaW5nRCxcbiAgICAgIHN0cmluZ0MsXG4gICAgXSxcbiAgfSxcbiAgeDoge1xuICAgIHRpY2tzOiBkMy5yYW5nZSgxLCAxMSksXG4gICAgZG9tYWluOiBbMC4yNSwgMTAuNDVdLFxuICAgIGxhYmVsOiBcIkR1cmF0aW9uIEUgKFllYXJzKVwiLFxuICB9LFxuICB5OiB7XG4gICAgZG9tYWluOiBbXG4gICAgICAwLFxuICAgICAgTWF0aC5tYXgoZDMubWF4KHlpZWxkRGF0YSwgZ2V0U3Rha2UpLCBkMy5tYXgoeWllbGREYXRhLCBnZXRZaWVsZFRlcm0pKSxcbiAgICBdLFxuICAgIGdyaWQ6IHRydWUsXG4gIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcImxlZnRcIiwgbGFiZWw6IFwiU3Rha2UgQSAoJSlcIiB9KSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIkluY2VudGl2ZSBSYXRlcyAoJSlcIiB9KSxcbiAgICBQbG90LnJlY3RZKHlpZWxkRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC50aW1lIC0gMC40NSxcbiAgICAgIHgyOiBkID0+IGQudGltZSArIDAuNDUsXG4gICAgICB5OiBnZXRTdGFrZSxcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgfSksXG4gICAgUGxvdC5ydWxlWCh5aWVsZFBhcmFtcywge1xuICAgICAgeDogXCJ0aW1lXCIsXG4gICAgICBzdHJva2U6IFwia2V5XCIsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXG4gICAgfSksXG4gICAgUGxvdC5saW5lWSh5aWVsZERhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldFlpZWxkVGVybSwgc3Ryb2tlOiBcImtleVwiIH0pLFxuICAgIFBsb3QuZG90WSh5aWVsZERhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldFlpZWxkVGVybSwgZmlsbDogXCJrZXlcIiB9KSxcbiAgICBQbG90LmxpbmVZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0UmVhbFlpZWxkLCBzdHJva2U6IFwia2V5XCIgfSksXG4gICAgUGxvdC5kb3RZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0UmVhbFlpZWxkLCBmaWxsOiBcImtleVwiIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgcmFuZ2U6IFs4LCA1LCAzLCA0XS5tYXAoaSA9PiBkMy5zY2hlbWVDYXRlZ29yeTEwW2ldKSxcbiAgICBkb21haW46IFtcIkN1bXVsYXRpdmUgU3Rha2UgQVwiLCBcIkRpc2NvdW50IEN1cnZlXCIsIHN0cmluZ0QsIHN0cmluZ0NdLFxuICB9LFxuICB4OiB7XG4gICAgdGlja3M6IGQzLnJhbmdlKDEsIDExKSxcbiAgICBkb21haW46IFswLjI1LCAxMC40NV0sXG4gICAgbGFiZWw6IFwiRHVyYXRpb24gRSAoWWVhcnMpXCJcbiAgfSxcbiAgeTogeyBkb21haW46IFswLCAxMDBdLCBncmlkOiB0cnVlIH0sXG4gIGNsaXA6IHRydWUsXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcImxlZnRcIiwgbGFiZWw6IFwiQ3VtdWxhdGl2ZSBTdGFrZSAoJSlcIiB9KSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIkRpc2NvdW50ICglKVwiIH0pLFxuICAgIFBsb3QucmVjdFkoeWllbGREYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLnRpbWUgLSAwLjQ1LFxuICAgICAgeDI6IGQgPT4gZC50aW1lICsgMC40NSxcbiAgICAgIHk6IGdldEN1bVN0YWtlLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgICBQbG90LnJ1bGVYKHlpZWxkUGFyYW1zLCB7XG4gICAgICB4OiBcInRpbWVcIixcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSxcbiAgICBQbG90LmxpbmVZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0RGlzY291bnQsIHN0cm9rZTogXCJrZXlcIiB9KSxcbiAgICBQbG90LmRvdFkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXREaXNjb3VudCwgZmlsbDogXCJrZXlcIiB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbnRyYXN0aW5nVGV4dENvbG9yKGJhY2tncm91bmRDb2xvcikge1xuICBpZiAoZDMuaHNsKGJhY2tncm91bmRDb2xvcikubCA8IDAuNSkge1xuICAgIHJldHVybiBcIndoaXRlXCI7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFwiYmxhY2tcIjtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVBcHByb3hEZWx0YUEocGFyYW1TLCBwYXJhbUUpIHtcbiAgcmV0dXJuIHBhcmFtUyAqICgxIC0gcGFyYW1TKSAvIHBhcmFtRTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbmZsYXRpb25EYXRhID0ge1xuICBjb25zdCBpbmZsYXRpb25EYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtUyA9IDA7IHBhcmFtUyA8IDEuMDE7IHBhcmFtUyArPSAwLjEpIHtcbiAgICBmb3IgKGxldCBwYXJhbUUgPSAxOyBwYXJhbUUgPD0gMTA7IHBhcmFtRSsrKSB7XG4gICAgICBpbmZsYXRpb25EYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwizpRBXCIsXG4gICAgICAgIGU6IHBhcmFtRSxcbiAgICAgICAgczogcGFyYW1TLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZUFwcHJveERlbHRhQShwYXJhbVMsIHBhcmFtRSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGluZmxhdGlvbkRhdGE7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgc2NoZW1lOiBcIlNwZWN0cmFsXCIsIHR5cGU6IFwic2VxdWVudGlhbFwiLCBsYWJlbDogXCLOlFNcIiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgxLCAxMC4xLCAxKSwgZG9tYWluOiBbMTAuNSwgMC41XSwgbGFiZWw6IFwiRHVyYXRpb24gRSAoWWVhcnMpXCIgfSxcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJTdGFraW5nIFNcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QoaW5mbGF0aW9uRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5lIC0gMC41LFxuICAgICAgeDI6IGQgPT4gZC5lICsgMC41LFxuICAgICAgeTE6IGQgPT4gZC5zIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQucyArIDAuMDUsXG4gICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KGluZmxhdGlvbkRhdGEsIHtcbiAgICAgIHg6IFwiZVwiLFxuICAgICAgeTogXCJzXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXG4gICAgICAgICAgWzAsIGNvbXB1dGVBcHByb3hEZWx0YUEoMC41LCAxKV0sXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCxcbiAgICAgICAgKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXRDaTAgPSBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1BvcnRmb2xpbyB9IENfe2kwfWAsXG4gIHN0ZXA6IDFlLTMsXG59KTtcbnZpZXdvZiBpbnB1dExpcVNoYXBlID0gSW5wdXRzLnJhbmdlKFstMSwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7U2NoZWR1bGUgc2hhcGV9YCxcbiAgc3RlcDogMWUtMyxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZlY0NpID0gY29uc3RBcmVhTGluZWFyKHZlY0UsIDEgLSBpbnB1dENpMCwgaW5wdXRMaXFTaGFwZSwgMC4wMSk7XG5cbnBhcmFtQmFyQ2kgPSBpbnB1dENpMCArIGRvdFByb2R1Y3QodmVjQiwgdmVjQ2kpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNhcmJvbkhlbGREYXRhID0ge1xuICBjb25zdCBjYXJib25IZWxkRGF0YSA9IFtdO1xuICBjYXJib25IZWxkRGF0YS5wdXNoKHtcbiAgICBrZXk6IFwiTGlxdWlkaXR5IFNjaGVkdWxlXCIsXG4gICAgdmFsdWU6IDEwMCAqIGlucHV0Q2kwLFxuICAgIHRpbWU6IDAsXG4gIH0pO1xuICBmb3IgKGxldCB0ID0gMzsgdCA8IHZlY0UubGVuZ3RoOyB0ICs9IDQpIHtcbiAgICBjYXJib25IZWxkRGF0YS5wdXNoKHtcbiAgICAgIGtleTogXCJMaXF1aWRpdHkgU2NoZWR1bGVcIixcbiAgICAgIHZhbHVlOiAxMDAgKiBkMy5zdW0odmVjQ2kuc2xpY2UodCAtIDMsIHQgKyAxKSksXG4gICAgICB0aW1lOiB2ZWNFW3RdLFxuICAgIH0pO1xuICAgIGNhcmJvbkhlbGREYXRhLnB1c2goe1xuICAgICAga2V5OiBcIkRpc2NvdW50IEN1cnZlXCIsXG4gICAgICB2YWx1ZTogMTAwICogdmVjQlt0XSxcbiAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGNhcmJvbkhlbGREYXRhO1xufTtcbmdldExpcVNjaGVkdWxlID0gZCA9PiBkLmtleSA9PT0gXCJMaXF1aWRpdHkgU2NoZWR1bGVcIiA/IGQudmFsdWUgOiBOYU47XG5cbnN0cmluZ0JhckNpID0gYFByZXNlbnQtVmFsdWUgQ2FyYm9uIEPMhOG1oiA9ICR7cGFyYW1CYXJDaS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwIH0sXG4pfWA7XG5cbmhlbGRDYXJib25QYXJhbSA9IFt7IGtleTogc3RyaW5nQmFyQ2ksIHZhbHVlOiAxMDAgKiBwYXJhbUJhckNpIH1dO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHJhbmdlOiBbMiwgNSwgNl0ubWFwKGkgPT4gZDMuc2NoZW1lQ2F0ZWdvcnkxMFtpXSksXG4gICAgZG9tYWluOiBbXCJMaXF1aWRpdHkgU2NoZWR1bGVcIiwgXCJEaXNjb3VudCBDdXJ2ZVwiLCBzdHJpbmdCYXJDaV0sXG4gIH0sXG4gIHg6IHtcbiAgICBsYWJlbDogXCJUaW1lIHRvIEV4cGlyeSAoWWVhcnMpXCIsXG4gICAgbGFiZWxBbmNob3I6IFwicmlnaHRcIixcbiAgICBsYWJlbEFycm93OiB0cnVlLFxuICB9LFxuICB5OiB7IGRvbWFpbjogWzAsIDEwMF0sIGdyaWQ6IHRydWUgfSxcbiAgaW5zZXRUb3A6IDE2LFxuICBpbnNldExlZnQ6IDgsXG4gIGluc2V0UmlnaHQ6IDgsXG4gIGNsaXA6IHRydWUsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwibGVmdFwiLCBsYWJlbDogXCJRdWFudGl0eSBvZiBDYXJib24gKCUpXCIgfSksXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJyaWdodFwiLCBsYWJlbDogXCJEaXNjb3VudCAoJSlcIiB9KSxcbiAgICBQbG90LnJlY3RZKGNhcmJvbkhlbGREYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLnRpbWUgLSAwLjQ1LFxuICAgICAgeDI6IGQgPT4gZC50aW1lICsgMC40NSxcbiAgICAgIHk6IGdldExpcVNjaGVkdWxlLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgICBQbG90LnJ1bGVZKGhlbGRDYXJib25QYXJhbSwge1xuICAgICAgeTogXCJ2YWx1ZVwiLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxuICAgIH0pLFxuICAgIFBsb3QubGluZVkoY2FyYm9uSGVsZERhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldERpc2NvdW50LCBzdHJva2U6IFwia2V5XCIgfSksXG4gICAgUGxvdC5kb3RZKGNhcmJvbkhlbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXREaXNjb3VudCwgZmlsbDogXCJrZXlcIiB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQ2kgPSBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1B1cmNoYXNlZCB9IFxcRGVsdGEgQ19pYCxcbiAgc3RlcDogMWUtMyxcbiAgdmFsdWU6IDEsXG59KTtcbnZpZXdvZiBpbnB1dEV0ID0gSW5wdXRzLnJhbmdlKFswLCAxMF0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7RXhwaXJ5IH0gRV90IFxcdGV4dHsgKHllYXJzKX1gLFxuICBzdGVwOiAxLFxuICB2YWx1ZTogNixcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVEZWx0YUNpMChkZWx0YUNpLCB0KSB7XG4gIHJldHVybiB0ID09PSAwID8gZGVsdGFDaSA6IDA7XG59XG5cbmZ1bmN0aW9uIGNvbXB1dGVWZWNEZWx0YUNpKGRlbHRhQ2ksIHQpIHtcbiAgY29uc3QgdmVjRGVsdGFDaSA9IEFycmF5KDQwKS5maWxsKDApO1xuICBpZiAodCAhPT0gMCkge1xuICAgIHZlY0RlbHRhQ2lbdCAtIDFdID0gZGVsdGFDaTtcbiAgfVxuICByZXR1cm4gdmVjRGVsdGFDaTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwYXJhbU1hdHVyaXR5SWR4ID0gNCAqIGlucHV0RXQ7XG5cbnBhcmFtRGVsdGFDaTAgPSBjb21wdXRlRGVsdGFDaTAoaW5wdXREZWx0YUNpLCBwYXJhbU1hdHVyaXR5SWR4KTtcblxudmVjRGVsdGFDaSA9IGNvbXB1dGVWZWNEZWx0YUNpKGlucHV0RGVsdGFDaSwgcGFyYW1NYXR1cml0eUlkeCk7XG5cbnBhcmFtRGVsdGFCYXJDaSA9IHBhcmFtRGVsdGFDaTAgKyBkb3RQcm9kdWN0KHZlY0IsIHZlY0RlbHRhQ2kpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNhcmJvbkJ1eURhdGEgPSB7XG4gIGNvbnN0IGNhcmJvbkJ1eURhdGEgPSBbXTtcbiAgY2FyYm9uQnV5RGF0YS5wdXNoKHtcbiAgICBrZXk6IFwiQ2FyYm9uIEJvdWdodCBieSBBQU1cIixcbiAgICB2YWx1ZTogMTAwICogcGFyYW1EZWx0YUNpMCxcbiAgICB0aW1lOiAwLFxuICB9KTtcbiAgZm9yIChsZXQgdCA9IDM7IHQgPCB2ZWNFLmxlbmd0aDsgdCArPSA0KSB7XG4gICAgY2FyYm9uQnV5RGF0YS5wdXNoKHtcbiAgICAgIGtleTogXCJDYXJib24gQm91Z2h0IGJ5IEFBTVwiLFxuICAgICAgdmFsdWU6IDEwMCAqIGQzLnN1bSh2ZWNEZWx0YUNpLnNsaWNlKHQgLSAzLCB0ICsgMSkpLFxuICAgICAgdGltZTogdmVjRVt0XSxcbiAgICB9KTtcbiAgICBjYXJib25CdXlEYXRhLnB1c2goe1xuICAgICAga2V5OiBcIkRpc2NvdW50IEN1cnZlXCIsXG4gICAgICB2YWx1ZTogMTAwICogdmVjQlt0XSxcbiAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGNhcmJvbkJ1eURhdGE7XG59O1xuZ2V0Q2FyYm9uQm91Z2h0ID0gZCA9PiBkLmtleSA9PT0gXCJDYXJib24gQm91Z2h0IGJ5IEFBTVwiID8gZC52YWx1ZSA6IE5hTjtcblxuc3RyaW5nRGVsdGFCYXJDaSA9IFwiUHJlc2VudC1WYWx1ZSBDYXJib24gQm91Z2h0IGJ5IEFBTSDOlEPMhOG1oiA9IFwiICtcbiAgICAgICAgcGFyYW1EZWx0YUJhckNpLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdHlsZTogXCJwZXJjZW50XCIsXG4gICAgICAgICAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDEsXG4gICAgICAgICAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDEsXG4gICAgICAgICAgfSxcbiAgICAgICAgKTtcbmJvdWdodENhcmJvblBhcmFtID0gW3sga2V5OiBzdHJpbmdEZWx0YUJhckNpLCB2YWx1ZTogMTAwICogcGFyYW1EZWx0YUJhckNpIH1dO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHJhbmdlOiBbMywgNSwgN10ubWFwKGkgPT4gZDMuc2NoZW1lQ2F0ZWdvcnkxMFtpXSksXG4gICAgZG9tYWluOiBbXCJDYXJib24gQm91Z2h0IGJ5IEFBTVwiLCBcIkRpc2NvdW50IEN1cnZlXCIsIHN0cmluZ0RlbHRhQmFyQ2ldLFxuICB9LFxuICB4OiB7XG4gICAgbGFiZWw6IFwiVGltZSB0byBFeHBpcnkgKFllYXJzKVwiLFxuICAgIGxhYmVsQW5jaG9yOiBcInJpZ2h0XCIsXG4gICAgbGFiZWxBcnJvdzogdHJ1ZSxcbiAgfSxcbiAgeTogeyBkb21haW46IFswLCAxMDBdLCBncmlkOiB0cnVlIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcImxlZnRcIiwgbGFiZWw6IFwiUXVhbnRpdHkgb2YgQ2FyYm9uICglKVwiIH0pLFxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwicmlnaHRcIiwgbGFiZWw6IFwiRGlzY291bnQgKCUpXCIgfSksXG4gICAgUGxvdC5yZWN0WShjYXJib25CdXlEYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLnRpbWUgLSAwLjQ1LFxuICAgICAgeDI6IGQgPT4gZC50aW1lICsgMC40NSxcbiAgICAgIHk6IGdldENhcmJvbkJvdWdodCxcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgfSksXG4gICAgUGxvdC5ydWxlWShib3VnaHRDYXJib25QYXJhbSwge1xuICAgICAgeTogXCJ2YWx1ZVwiLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxuICAgIH0pLFxuICAgIFBsb3QubGluZVkoY2FyYm9uQnV5RGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0RGlzY291bnQsIHN0cm9rZTogXCJrZXlcIiB9KSxcbiAgICBQbG90LmRvdFkoY2FyYm9uQnV5RGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0RGlzY291bnQsIGZpbGw6IFwia2V5XCIgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXREZWx0YUJhckNpID0gSW5wdXRzLnJhbmdlKFswLjAxLCAxXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtQdXJjaGFzZWQgfSBcXERlbHRhIFxcYmFyIENfaWAsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiAxLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZURlbHRhQShBaSwgR2ksIGRlbHRhQ2kpIHtcbiAgcmV0dXJuIE1hdGguZXhwbTEoKEFpIC0gKEFpKioyICogKDEgLSBHaSkqKjIgLyAyKSkgKiBNYXRoLmxvZzFwKGRlbHRhQ2kpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwcmljaW5nRGF0YSA9IHtcbiAgY29uc3QgcHJpY2luZ0RhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xuICAgIHByaWNpbmdEYXRhLnB1c2goe1xuICAgICAga2V5OiBcIs6UQVwiLFxuICAgICAgYWk6IDAsXG4gICAgICBnaTogcGFyYW1HaSxcbiAgICAgIHZhbHVlOiBOYU4sXG4gICAgfSk7XG4gICAgcHJpY2luZ0RhdGEucHVzaCh7XG4gICAgICBrZXk6IFwiTm9ybWFsaXNlZCDOlEFcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xuICAgICAgcHJpY2luZ0RhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCLOlEFcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZURlbHRhQShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQmFyQ2kpLFxuICAgICAgfSk7XG4gICAgICBwcmljaW5nRGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIk5vcm1hbGlzZWQgzpRBXCIsXG4gICAgICAgIGFpOiBwYXJhbUFpLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVEZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUJhckNpKSAvXG4gICAgICAgICAgICAgICAgKGlucHV0RGVsdGFCYXJDaSAqIHBhcmFtQWkpLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBwcmljaW5nRGF0YTtcbn07XG5nZXREZWx0YUEgPSBkID0+IGQua2V5ID09PSBcIs6UQVwiID8gZC52YWx1ZSA6IE5hTjtcbmdldE5vcm1EZWx0YUEgPSBkID0+IGQua2V5ID09PSBcIk5vcm1hbGlzZWQgzpRBXCIgPyBkLnZhbHVlIDogTmFOO1xuXG5zdHJpbmdJbnB1dERlbHRhQmFyQ2kgPSBpbnB1dERlbHRhQmFyQ2kudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMCB9LFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogYM6UQSwgd2hlcmUgzpRDzIThtaIgPSAke3N0cmluZ0lucHV0RGVsdGFCYXJDaX1gLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KHByaWNpbmdEYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IGdldERlbHRhQSxcbiAgICB9KSxcbiAgICBQbG90LnRleHQocHJpY2luZ0RhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldERlbHRhQShkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIGNvbXB1dGVEZWx0YUEoMC4xLCAxLCBpbnB1dERlbHRhQmFyQ2kpLFxuICAgICAgICAgICAgY29tcHV0ZURlbHRhQSgxLCAxLCBpbnB1dERlbHRhQmFyQ2kpLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCxcbiAgICAgICAgKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogYE5vcm1hbGlzZWQgzpRBLCB3aGVyZSDOlEPMhOG1oiA9ICR7c3RyaW5nSW5wdXREZWx0YUJhckNpfWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QocHJpY2luZ0RhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0Tm9ybURlbHRhQSxcbiAgICB9KSxcbiAgICBQbG90LnRleHQocHJpY2luZ0RhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldE5vcm1EZWx0YUEoZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcbiAgICAgICAgICBbXG4gICAgICAgICAgICBjb21wdXRlRGVsdGFBKDEsIDAsIGlucHV0RGVsdGFCYXJDaSkgLyBpbnB1dERlbHRhQmFyQ2ksXG4gICAgICAgICAgICBjb21wdXRlRGVsdGFBKDEsIDEsIGlucHV0RGVsdGFCYXJDaSkgLyBpbnB1dERlbHRhQmFyQ2ksXG4gICAgICAgICAgXSxcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxuICAgICAgICApKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQmFyQ251bGwgPSBJbnB1dHMucmFuZ2UoWzFlLTEsIDFlNV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UHVyY2hhc2VkIH0gXFxEZWx0YSBcXGJhciBDX1xcZW1wdHlzZXRgLFxuICBzdGVwOiAxZS0xLFxuICB2YWx1ZTogMWUyLFxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVplcm9DYXJib25EZWx0YUEoQWksIEdpLCBkZWx0YUNudWxsKSB7XG4gIHJldHVybiAoZGVsdGFDbnVsbCAvICgxICsgZGVsdGFDbnVsbCkpICogKEFpIC0gKEFpKioyICogKDEgLSBHaSkqKjIgLyAyKSkqKjI7XG59XG5cbmZ1bmN0aW9uIGNvbXB1dGVUcnVlRGVsdGFBKEFpLCBHaSwgYmFyQ2lUb25uZXMsIGRlbHRhQmFyQ2lUb25uZXMpIHtcbiAgaWYgKGJhckNpVG9ubmVzID09PSAwKSB7XG4gICAgcmV0dXJuIGNvbXB1dGVaZXJvQ2FyYm9uRGVsdGFBKEFpLCBHaSwgZGVsdGFCYXJDaVRvbm5lcyk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgZGVsdGFCYXJDaSA9IGRlbHRhQmFyQ2lUb25uZXMgLyBiYXJDaVRvbm5lcztcbiAgICByZXR1cm4gY29tcHV0ZURlbHRhQShBaSwgR2ksIGRlbHRhQmFyQ2kpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG51bWJlck9mRGlnaXRzKHgpIHtcbiAgcmV0dXJuIHggPT09IDAgPyAxIDogKDEgKyBNYXRoLmZsb29yKE1hdGgubG9nMTAoeCkpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ6ZXJvQ2FyYm9uRGF0YSA9IHtcbiAgY29uc3QgemVyb0NhcmJvbkRhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xuICAgIHplcm9DYXJib25EYXRhLnB1c2goe1xuICAgICAga2V5OiBcIs6UQVwiLFxuICAgICAgYWk6IDAsXG4gICAgICBnaTogcGFyYW1HaSxcbiAgICAgIHZhbHVlOiBOYU4sXG4gICAgfSk7XG4gICAgemVyb0NhcmJvbkRhdGEucHVzaCh7XG4gICAgICBrZXk6IFwiTm9ybWFsaXNlZCDOlEFcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xuICAgICAgemVyb0NhcmJvbkRhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCLOlEFcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZVplcm9DYXJib25EZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUJhckNudWxsKSxcbiAgICAgIH0pO1xuICAgICAgemVyb0NhcmJvbkRhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJOb3JtYWxpc2VkIM6UQVwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQmFyQ251bGwpIC9cbiAgICAgICAgICAgICAgICAoKGlucHV0RGVsdGFCYXJDbnVsbCAvICgxICsgaW5wdXREZWx0YUJhckNudWxsKSkgKiBwYXJhbUFpKioyKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gemVyb0NhcmJvbkRhdGE7XG59O1xuXG5zdHJpbmdEZWx0YUJhckNudWxsID0gaW5wdXREZWx0YUJhckNudWxsLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDEsIG51bWJlck9mRGlnaXRzKGlucHV0RGVsdGFCYXJDbnVsbCkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMSwgbnVtYmVyT2ZEaWdpdHMoaW5wdXREZWx0YUJhckNudWxsKSksXG4gIH0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBgzpRBLCB3aGVyZSDOlEPMhOKIhSA9ICR7c3RyaW5nRGVsdGFCYXJDbnVsbH0gdENPMmVxYCxcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdCh6ZXJvQ2FyYm9uRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXG4gICAgICB4MjogZCA9PiBkLmFpICsgMC4wNSxcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXG4gICAgICBmaWxsOiBnZXREZWx0YUEsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KHplcm9DYXJib25EYXRhLCB7XG4gICAgICB4OiBcImFpXCIsXG4gICAgICB5OiBcImdpXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXREZWx0YUEoZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDQsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogNCB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcbiAgICAgICAgICBbXG4gICAgICAgICAgICBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQSgwLjEsIDEsIGlucHV0RGVsdGFCYXJDbnVsbCksXG4gICAgICAgICAgICBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQSgxLCAxLCBpbnB1dERlbHRhQmFyQ251bGwpLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCxcbiAgICAgICAgKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogYE5vcm1hbGlzZWQgzpRBLCB3aGVyZSDOlEPMhOKIhSA9ICR7c3RyaW5nRGVsdGFCYXJDbnVsbH0gdENPMmVxYCxcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdCh6ZXJvQ2FyYm9uRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXG4gICAgICB4MjogZCA9PiBkLmFpICsgMC4wNSxcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXG4gICAgICBmaWxsOiBnZXROb3JtRGVsdGFBLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dCh6ZXJvQ2FyYm9uRGF0YSwge1xuICAgICAgeDogXCJhaVwiLFxuICAgICAgeTogXCJnaVwiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0Tm9ybURlbHRhQShkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIGNvbXB1dGVaZXJvQ2FyYm9uRGVsdGFBKDEsIDAsIGlucHV0RGVsdGFCYXJDbnVsbCkgL1xuICAgICAgICAgICAgICAgICAgICAoaW5wdXREZWx0YUJhckNudWxsIC8gKDEgKyBpbnB1dERlbHRhQmFyQ251bGwpKSxcbiAgICAgICAgICAgIGNvbXB1dGVaZXJvQ2FyYm9uRGVsdGFBKDEsIDEsIGlucHV0RGVsdGFCYXJDbnVsbCkgL1xuICAgICAgICAgICAgICAgICAgICAoaW5wdXREZWx0YUJhckNudWxsIC8gKDEgKyBpbnB1dERlbHRhQmFyQ251bGwpKSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0RGVsdGFBID0gSW5wdXRzLnJhbmdlKFswLjAwMSwgMC45OTldLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0J1cm50IH0gXFxEZWx0YSBBYCxcbiAgc3RlcDogMC4wMDEsXG4gIHZhbHVlOiAwLjEsXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlRGVsdGFDaShBaSwgR2ksIGRlbHRhQSkge1xuICByZXR1cm4gTWF0aC5leHBtMSgtTWF0aC5sb2cxcChkZWx0YUEpIC8gKEFpICsgKEFpKioyICogKDEgLSBHaSkqKjIgLyAyKSkpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJldGlyZW1lbnREYXRhID0ge1xuICBjb25zdCByZXRpcmVtZW50RGF0YSA9IFtdO1xuICBmb3IgKGxldCBwYXJhbUdpID0gMDsgcGFyYW1HaSA8IDEuMDE7IHBhcmFtR2kgKz0gMC4xKSB7XG4gICAgcmV0aXJlbWVudERhdGEucHVzaCh7XG4gICAgICBrZXk6IFwiLc6UQ+G1olwiLFxuICAgICAgYWk6IDAsXG4gICAgICBnaTogcGFyYW1HaSxcbiAgICAgIHZhbHVlOiBOYU4sXG4gICAgfSk7XG4gICAgZm9yIChsZXQgcGFyYW1BaSA9IDAuMTsgcGFyYW1BaSA8IDEuMDE7IHBhcmFtQWkgKz0gMC4xKSB7XG4gICAgICByZXRpcmVtZW50RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIi3OlEPhtaJcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogLWNvbXB1dGVEZWx0YUNpKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFBKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmV0aXJlbWVudERhdGE7XG59O1xuXG5zdHJpbmdJbnB1dERlbHRhQSA9IGlucHV0RGVsdGFBLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDEsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMSB9LFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogYC3OlEPhtaIsIHdoZXJlIM6UQSA9ICR7c3RyaW5nSW5wdXREZWx0YUF9YCxcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdChyZXRpcmVtZW50RGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5haSAtIDAuMDUsXG4gICAgICB4MjogZCA9PiBkLmFpICsgMC4wNSxcbiAgICAgIHkxOiBkID0+IGQuZ2kgLSAwLjA1LFxuICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXG4gICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KHJldGlyZW1lbnREYXRhLCB7XG4gICAgICB4OiBcImFpXCIsXG4gICAgICB5OiBcImdpXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXG4gICAgICAgICAgW1xuICAgICAgICAgICAgLWNvbXB1dGVEZWx0YUNpKDEsIDAsIGlucHV0RGVsdGFBKSxcbiAgICAgICAgICAgIC1jb21wdXRlRGVsdGFDaSgwLjEsIDEsIGlucHV0RGVsdGFBKSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0RGVsdGFDaW5pdGlhbCA9IElucHV0cy5yYW5nZShbMC4wMDEsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0luaXRpYWwgfVxcRGVsdGEgQ2AsXG4gIHN0ZXA6IDAuMDAxLFxuICB2YWx1ZTogMC4xLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVNwcmVhZChBaSwgR2ksIGRlbHRhQ2luaXRpYWwpIHtcbiAgY29uc3QgZGVsdGFBID0gY29tcHV0ZURlbHRhQShBaSwgR2ksIGRlbHRhQ2luaXRpYWwpO1xuICBjb25zdCBkZWx0YUNmaW5hbCA9IC1jb21wdXRlRGVsdGFDaShBaSwgR2ksIGRlbHRhQSk7XG4gIHJldHVybiAoZGVsdGFDaW5pdGlhbCAtIGRlbHRhQ2ZpbmFsKSAvIGRlbHRhQ2luaXRpYWw7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibGlxdWlkYXRpb25EYXRhID0ge1xuICBjb25zdCBsaXF1aWRhdGlvbkRhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xuICAgIGxpcXVpZGF0aW9uRGF0YS5wdXNoKHsga2V5OiBcImRlbHRhYVwiLCBhaTogMCwgZ2k6IHBhcmFtR2ksIHZhbHVlOiBOYU4gfSk7XG4gICAgbGlxdWlkYXRpb25EYXRhLnB1c2goeyBrZXk6IFwiZGVsdGFjXCIsIGFpOiAwLCBnaTogcGFyYW1HaSwgdmFsdWU6IE5hTiB9KTtcbiAgICBsaXF1aWRhdGlvbkRhdGEucHVzaCh7IGtleTogXCJzcHJlYWRcIiwgYWk6IDAsIGdpOiBwYXJhbUdpLCB2YWx1ZTogTmFOIH0pO1xuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xuICAgICAgY29uc3QgZGVsdGFBID0gY29tcHV0ZURlbHRhQShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQ2luaXRpYWwpXG4gICAgICBsaXF1aWRhdGlvbkRhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJkZWx0YWFcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZURlbHRhQShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQ2luaXRpYWwpIC9cbiAgICAgICAgICAgICAgICBpbnB1dERlbHRhQ2luaXRpYWwsXG4gICAgICB9KTtcbiAgICAgIGxpcXVpZGF0aW9uRGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcImRlbHRhY1wiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlRGVsdGFDaShwYXJhbUFpLCBwYXJhbUdpLCBkZWx0YUEpIC8gaW5wdXREZWx0YUNpbml0aWFsLFxuICAgICAgfSk7XG4gICAgICBsaXF1aWRhdGlvbkRhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJzcHJlYWRcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZVNwcmVhZChwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQ2luaXRpYWwpLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBsaXF1aWRhdGlvbkRhdGE7XG59O1xuZ2V0TGlxRGVsdGFBID0gZCA9PiBkLmtleSA9PT0gXCJkZWx0YWFcIiA/IGQudmFsdWUgOiBOYU47XG5nZXRMaXFEZWx0YUNpID0gZCA9PiBkLmtleSA9PT0gXCJkZWx0YWNcIiA/IGQudmFsdWUgOiBOYU47XG5nZXRMaXFTcHJlYWQgPSBkID0+IGQua2V5ID09PSBcInNwcmVhZFwiID8gZC52YWx1ZSA6IE5hTjtcblxuc3RyaW5nSW5wdXREZWx0YUNpbml0aWFsID0gaW5wdXREZWx0YUNpbml0aWFsLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDEsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMSB9LFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICBkb21haW46IFswLCBjb21wdXRlU3ByZWFkKDEsIDAsIDEpXSxcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogYENhcmJvbiBTcHJlYWQgzrUsIHdoZXJlIGluaXRpYWwgzpRDID0gJHtzdHJpbmdJbnB1dERlbHRhQ2luaXRpYWx9YCxcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0TGlxU3ByZWFkLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldExpcVNwcmVhZChkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFswLCBjb21wdXRlU3ByZWFkKDEsIDAsIGlucHV0RGVsdGFDaW5pdGlhbCldLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiSW5wdXRzLmJpbmQoXG4gIElucHV0cy5yYW5nZShbMC4wMDEsIDFdLCB7XG4gICAgbGFiZWw6IHRleGBcXHRleHR7SW5pdGlhbCB9XFxEZWx0YSBDYCxcbiAgICBzdGVwOiAwLjAwMSxcbiAgICB2YWx1ZTogMC4xLFxuICB9KSxcbiAgdmlld29mIGlucHV0RGVsdGFDaW5pdGlhbCxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgZG9tYWluOiBbMCwgMV0sXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGBDb21wb25lbnQgzpRBLCB3aGVyZSBpbml0aWFsIM6UQyA9ICR7XG4gICAgICBzdHJpbmdJbnB1dERlbHRhQ2luaXRpYWxcbiAgICB9YCxcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0TGlxRGVsdGFBLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldExpcURlbHRhQShkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKGQudmFsdWUpKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJHcmV5c1wiLFxuICAgIGRvbWFpbjogW1xuICAgICAgLTEsXG4gICAgICBjb21wdXRlRGVsdGFDaShcbiAgICAgICAgMSxcbiAgICAgICAgMCxcbiAgICAgICAgY29tcHV0ZURlbHRhQSgxLCAwLCBpbnB1dERlbHRhQ2luaXRpYWwpIC8gaW5wdXREZWx0YUNpbml0aWFsLFxuICAgICAgKSxcbiAgICBdLFxuICAgIGxhYmVsOiBgQ29tcG9uZW50IM6UQywgd2hlcmUgaW5pdGlhbCDOlEMgPSAke1xuICAgICAgc3RyaW5nSW5wdXREZWx0YUNpbml0aWFsXG4gICAgfWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QobGlxdWlkYXRpb25EYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IGdldExpcURlbHRhQ2ksXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KGxpcXVpZGF0aW9uRGF0YSwge1xuICAgICAgeDogXCJhaVwiLFxuICAgICAgeTogXCJnaVwiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0TGlxRGVsdGFDaShkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIC0xLFxuICAgICAgICAgICAgY29tcHV0ZURlbHRhQ2koXG4gICAgICAgICAgICAgIDEsXG4gICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgIGNvbXB1dGVEZWx0YUEoMSwgMCwgaW5wdXREZWx0YUNpbml0aWFsKSAvIGlucHV0RGVsdGFDaW5pdGlhbCxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgXSxcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZUdyZXlzLFxuICAgICAgICApKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVCZXRhKHZlY0FpLCB2ZWNHaSkge1xuICBjb25zdCBiZXRhMiA9IHZlY0FpLnJlZHVjZShcbiAgICAoYWNjLCBBaSwgaSkgPT4gYWNjICsgQWkgLSBBaSAqICgxIC0gdmVjR2lbaV0pKioyLFxuICAgIDAsXG4gICk7XG4gIHJldHVybiBNYXRoLnNxcnQoYmV0YTIpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVCZXRhaShBaSwgR2kpIHtcbiAgcmV0dXJuIE1hdGguc3FydChBaSAtIEFpICogKDEgLSBHaSkqKjIpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJldGFEYXRhID0ge1xuICBjb25zdCBiZXRhRGF0YSA9IFtdO1xuICBmb3IgKGxldCBwYXJhbUdpID0gMDsgcGFyYW1HaSA8IDEuMDE7IHBhcmFtR2kgKz0gMC4xKSB7XG4gICAgYmV0YURhdGEucHVzaCh7XG4gICAgICBrZXk6IFwizrLhtaJcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xuICAgICAgYmV0YURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCLOsuG1olwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlQmV0YWkocGFyYW1BaSwgcGFyYW1HaSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGJldGFEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogXCLOsuG1olwiLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KGJldGFEYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICB9KSxcbiAgICBQbG90LnRleHQoYmV0YURhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoZDMuaW50ZXJwb2xhdGVTcGVjdHJhbChkLnZhbHVlKSksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJhcnJheUFpID0gWzAuNSwgMC4yLCAwLjEsIDAuMDVdO1xuYXJyYXlJbml0aWFsR2kgPSBbMC4zLCAwLjEsIDAuMDUsIDAuMDFdO1xuYXJyYXlOZXdHaSA9IGFycmF5SW5pdGlhbEdpLnRvUmV2ZXJzZWQoKTtcbmJldGFDb250cmliRGF0YSA9IHtcbiAgY29uc3QgYmV0YUNvbnRyaWJEYXRhID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXlBaS5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IEFpID0gYXJyYXlBaVtpXTtcbiAgICBjb25zdCBpbml0aWFsR2kgPSBhcnJheUluaXRpYWxHaVtpXTtcbiAgICBjb25zdCBpbml0aWFsQmV0YTIgPSBjb21wdXRlQmV0YWkoQWksIGluaXRpYWxHaSkqKjI7XG4gICAgY29uc3QgbmV3R2kgPSBhcnJheU5ld0dpW2ldO1xuICAgIGNvbnN0IG5ld0JldGEyID0gY29tcHV0ZUJldGFpKEFpLCBuZXdHaSkqKjI7XG4gICAgYmV0YUNvbnRyaWJEYXRhLnB1c2goeyBrZXk6IFwiSW5pdGlhbCBH4bWiXCIsIGNsYXNzOiBpLCB2YWx1ZTogaW5pdGlhbEdpIH0pO1xuICAgIGJldGFDb250cmliRGF0YS5wdXNoKHsga2V5OiBcIkluaXRpYWwgzrLhtaLCslwiLCBjbGFzczogaSwgdmFsdWU6IGluaXRpYWxCZXRhMiB9KTtcbiAgICBiZXRhQ29udHJpYkRhdGEucHVzaCh7IGtleTogXCJOZXcgR+G1olwiLCBjbGFzczogaSwgdmFsdWU6IG5ld0dpIH0pO1xuICAgIGJldGFDb250cmliRGF0YS5wdXNoKHsga2V5OiBcIk5ldyDOsuG1osKyXCIsIGNsYXNzOiBpLCB2YWx1ZTogbmV3QmV0YTIgfSk7XG4gIH1cbiAgcmV0dXJuIGJldGFDb250cmliRGF0YTtcbn07XG5nZXRJbml0aWFsRyA9IGQgPT4gZC5rZXkgPT09IFwiSW5pdGlhbCBH4bWiXCIgPyBkLnZhbHVlIDogTmFOO1xuZ2V0SW5pdGlhbEJldGEyID0gZCA9PiBkLmtleSA9PT0gXCJJbml0aWFsIM6y4bWiwrJcIiA/IGQudmFsdWUgOiBOYU47XG5nZXROZXdHID0gZCA9PiBkLmtleSA9PT0gXCJOZXcgR+G1olwiID8gZC52YWx1ZSA6IE5hTjtcbmdldE5ld0JldGEyID0gZCA9PiBkLmtleSA9PT0gXCJOZXcgzrLhtaLCslwiID8gZC52YWx1ZSA6IE5hTjtcblxuZG9tYWluRyA9IFswLCBNYXRoLm1heChkMy5tYXgoYXJyYXlJbml0aWFsR2kpLCBkMy5tYXgoYXJyYXlOZXdHaSkpXTtcbnJhbmdlQmV0YTIgPSBbXG4gIDAsXG4gIE1hdGgubWF4KFxuICAgIGQzLm1heChiZXRhQ29udHJpYkRhdGEsIGdldEluaXRpYWxCZXRhMiksXG4gICAgZDMubWF4KGJldGFDb250cmliRGF0YSwgZ2V0TmV3QmV0YTIpLFxuICApLFxuXTtcbnNjYWxlRyA9IGQzLnNjYWxlTGluZWFyKGRvbWFpbkcsIHJhbmdlQmV0YTIpO1xubWFwU2NhbGVHID0geCA9PiB4Lm1hcChzY2FsZUcpO1xuXG5wYXJhbUluaXRpYWxCZXRhID0gY29tcHV0ZUJldGEoYXJyYXlBaSwgYXJyYXlJbml0aWFsR2kpO1xucGFyYW1OZXdCZXRhID0gY29tcHV0ZUJldGEoYXJyYXlBaSwgYXJyYXlOZXdHaSk7XG5cbnN0cmluZ0luaXRpYWxCZXRhID0gXCJJbml0aWFsIM6yID0gXCIgKyBwYXJhbUluaXRpYWxCZXRhLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiA0LCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDQgfSxcbik7XG5zdHJpbmdOZXdCZXRhID0gXCJOZXcgzrIgPSBcIiArIHBhcmFtTmV3QmV0YS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogNCwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiA0IH0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHJhbmdlOiBbXCJncmF5XCIsIFwiYmxhY2tcIiwgXCJibHVlXCIsIFwicmVkXCJdLFxuICAgIGRvbWFpbjogW1wiSW5pdGlhbCDOsuG1osKyXCIsIFwiTmV3IM6y4bWiwrJcIiwgXCJJbml0aWFsIEfhtaJcIiwgXCJOZXcgR+G1olwiXSxcbiAgfSxcbiAgeDoge1xuICAgIHRpY2tzOiBkMy5yYW5nZSg0KSxcbiAgICBsYWJlbDogXCJB4bWiIE92ZXIgNCBDbGFzc2VzXCIsXG4gICAgdGlja0Zvcm1hdDogZCA9PiBhcnJheUFpW2RdLFxuICB9LFxuICB5OiB7IGRvbWFpbjogcmFuZ2VCZXRhMiB9LFxuICBpbnNldFRvcDogMTYsXG4gIGluc2V0TGVmdDogOCxcbiAgaW5zZXRSaWdodDogOCxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJsZWZ0XCIsIGxhYmVsOiBcIs6y4bWiwrJcIiB9KSxcbiAgICBQbG90LmF4aXNZKHNjYWxlRy50aWNrcygpLCB7IGFuY2hvcjogXCJyaWdodFwiLCBsYWJlbDogXCJH4bWiXCIsIHk6IHNjYWxlRyB9KSxcbiAgICBQbG90LnJlY3RZKGJldGFDb250cmliRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5jbGFzcyAtIDAuNDUsXG4gICAgICB4MjogZCA9PiBkLmNsYXNzLFxuICAgICAgeTogZ2V0SW5pdGlhbEJldGEyLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgICBQbG90LnJlY3RZKGJldGFDb250cmliRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5jbGFzcyxcbiAgICAgIHgyOiBkID0+IGQuY2xhc3MgKyAwLjQ1LFxuICAgICAgeTogZ2V0TmV3QmV0YTIsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgIH0pLFxuICAgIFBsb3QubGluZVkoYmV0YUNvbnRyaWJEYXRhLCBQbG90Lm1hcFkobWFwU2NhbGVHLCB7XG4gICAgICB4OiBcImNsYXNzXCIsXG4gICAgICB5OiBnZXRJbml0aWFsRyxcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSksXG4gICAgUGxvdC5kb3RZKGJldGFDb250cmliRGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlRywge1xuICAgICAgeDogXCJjbGFzc1wiLFxuICAgICAgeTogZ2V0SW5pdGlhbEcsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgIH0pKSxcbiAgICBQbG90LmxpbmVZKGJldGFDb250cmliRGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlRywge1xuICAgICAgeDogXCJjbGFzc1wiLFxuICAgICAgeTogZ2V0TmV3RyxcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSksXG4gICAgUGxvdC5kb3RZKGJldGFDb250cmliRGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlRywge1xuICAgICAgeDogXCJjbGFzc1wiLFxuICAgICAgeTogZ2V0TmV3RyxcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgfSkpLFxuICAgIFBsb3QudGV4dChbc3RyaW5nSW5pdGlhbEJldGFdLCB7IHg6IDAuNSwgeTogMC4yMywgZmlsbDogZCA9PiBcImJsdWVcIiB9KSxcbiAgICBQbG90LnRleHQoW3N0cmluZ05ld0JldGFdLCB7IHg6IDIuNSwgeTogMC4yMywgZmlsbDogZCA9PiBcInJlZFwiIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUxhbWJkYUdHKEFRLCBHaSwgR0cpIHtcbiAgcmV0dXJuICgxIC0gQVEpIC8gKDEgKyAoR2kgLyBHRykqKjIpO1xufVxuXG5mdW5jdGlvbiBjaGFuZ2VUcmFuc2xhdGlvbihkeCwgZHkpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBzdmdUcmFuc2Zvcm1MaXN0ID0gdGhpcy50cmFuc2Zvcm0uYmFzZVZhbDtcbiAgICBpZiAoc3ZnVHJhbnNmb3JtTGlzdC5sZW5ndGggPiAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTVkdUcmFuc2Zvcm1MaXN0IG11c3Qgb25seSBjb250YWluIG9uZSB0cmFuc2xhdGlvblwiKTtcbiAgICB9XG4gICAgY29uc3Qge2UsIGZ9ID0gc3ZnVHJhbnNmb3JtTGlzdC5jb25zb2xpZGF0ZSgpLm1hdHJpeDtcbiAgICByZXR1cm4gYHRyYW5zbGF0ZSgke2UgKyBkeH0sJHtmICsgZHl9KWA7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJsYW1iZGFHR0RhdGEgPSB7XG4gIGNvbnN0IGxhbWJkYUdHRGF0YSA9IFtdO1xuICBmb3IgKGxldCBwYXJhbUdpID0gMDsgcGFyYW1HaSA8IDEuMDE7IHBhcmFtR2kgKz0gMC4xKSB7XG4gICAgZm9yIChsZXQgcGFyYW1BUSA9IDA7IHBhcmFtQVEgPCAxLjAxOyBwYXJhbUFRICs9IDAuMSkge1xuICAgICAgbGFtYmRhR0dEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwizrtcIixcbiAgICAgICAgYXE6IHBhcmFtQVEsXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZUxhbWJkYUdHKHBhcmFtQVEsIHBhcmFtR2ksIDEgLSBwYXJhbUdpKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbGFtYmRhR0dEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwbG90TGFtYmRhR0cgPSB7XG4gIGNvbnN0IHBsb3RMYW1iZGFHRyA9IFBsb3QucGxvdCh7XG4gICAgY29sb3I6IHtcbiAgICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgICAgZG9tYWluOiBbMCwgMV0sXG4gICAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICAgIGxhYmVsOiBcIs67XCIsXG4gICAgfSxcbiAgICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJBICBcIiB9LFxuICAgIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QuZnJhbWUoKSxcbiAgICAgIFBsb3QucmVjdChsYW1iZGFHR0RhdGEsIHtcbiAgICAgICAgeDE6IGQgPT4gZC5hcSAtIDAuMDUsXG4gICAgICAgIHgyOiBkID0+IGQuYXEgKyAwLjA1LFxuICAgICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXG4gICAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICAgIH0pLFxuICAgICAgUGxvdC50ZXh0KGxhbWJkYUdHRGF0YSwge1xuICAgICAgICB4OiBcImFxXCIsXG4gICAgICAgIHk6IFwiZ2lcIixcbiAgICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgICApLFxuICAgICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxuICAgICAgICApLFxuICAgICAgfSksXG4gICAgXSxcbiAgfSk7XG5cbiAgZDMuc2VsZWN0KHBsb3RMYW1iZGFHRylcbiAgICAuc2VsZWN0KFwiZ1thcmlhLWxhYmVsPSd4LWF4aXMgbGFiZWwnXVwiKVxuICAgIC5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAuY2xvbmUoZmFsc2UpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigtMTIsIDEuNSkpXG4gICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjAuNmVtXCIpXG4gICAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiNjAwXCIpXG4gICAgICAudGV4dChcIlFcIik7XG5cbiAgcmV0dXJuIHBsb3RMYW1iZGFHRztcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUxhbWJkYUcoQVEsIEFHKSB7XG4gIHJldHVybiAyICogQUcgLyAoMiAqIEFHICsgQVEgKiBNYXRoLnNxcnQoMikpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVMYW1iZGFRKEFRLCBBRykge1xuICByZXR1cm4gMSAtIGNvbXB1dGVMYW1iZGFHKEFRLCBBRyk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibGFtYmRhR1FEYXRhID0ge1xuICBjb25zdCBsYW1iZGFHUURhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1BRyA9IDA7IHBhcmFtQUcgPCAxLjAxOyBwYXJhbUFHICs9IDAuMSkge1xuICAgIGZvciAobGV0IHBhcmFtQVEgPSAwOyBwYXJhbUFRIDwgMS4wMTsgcGFyYW1BUSArPSAwLjEpIHtcbiAgICAgIGlmIChwYXJhbUFHICsgcGFyYW1BUSA8IDEuMDEpIHtcbiAgICAgICAgbGFtYmRhR1FEYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCJSZWxhdGl2ZSDwnZeU8J2XmiBMaXF1aWRpdHkgUG9vbCBTaGFyZVwiLFxuICAgICAgICAgIGFxOiBwYXJhbUFRLFxuICAgICAgICAgIGFnOiBwYXJhbUFHLFxuICAgICAgICAgIHZhbHVlOiBjb21wdXRlTGFtYmRhRyhwYXJhbUFRLCBwYXJhbUFHKSxcbiAgICAgICAgfSk7XG4gICAgICAgIGxhbWJkYUdRRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwiUmVsYXRpdmUg8J2XlPCdl6QgTGlxdWlkaXR5IFBvb2wgU2hhcmVcIixcbiAgICAgICAgICBhcTogcGFyYW1BUSxcbiAgICAgICAgICBhZzogcGFyYW1BRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUxhbWJkYVEocGFyYW1BUSwgcGFyYW1BRyksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gbGFtYmRhR1FEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwbG90TGFtYmRhR1EgPSB7XG4gIGNvbnN0IHBsb3RMYW1iZGFHUSA9IFBsb3QucGxvdCh7XG4gICAgYXNwZWN0UmF0aW86IDEsXG4gICAgY29sb3I6IHtcbiAgICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgICAgZG9tYWluOiBbMCwgMV0sXG4gICAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICAgIGxhYmVsOiBcIs67XCIsXG4gICAgfSxcbiAgICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJBICBcIiB9LFxuICAgIHk6IHtcbiAgICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxuICAgICAgZG9tYWluOiBbMS4wNSwgLTAuMDVdLFxuICAgICAgbGFiZWw6IFwiQVwiLFxuICAgIH0sXG4gICAgZng6IHsgbGFiZWw6IG51bGwgfSxcbiAgICBjbGFzc05hbWU6IFwiTGFtYmRhR1FcIixcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5mcmFtZSgpLFxuICAgICAgUGxvdC5yZWN0KGxhbWJkYUdRRGF0YSwge1xuICAgICAgICB4MTogZCA9PiBkLmFxIC0gMC4wNSxcbiAgICAgICAgeDI6IGQgPT4gZC5hcSArIDAuMDUsXG4gICAgICAgIHkxOiBkID0+IGQuYWcgLSAwLjA1LFxuICAgICAgICB5MjogZCA9PiBkLmFnICsgMC4wNSxcbiAgICAgICAgZng6IFwia2V5XCIsXG4gICAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICAgIH0pLFxuICAgICAgUGxvdC50ZXh0KGxhbWJkYUdRRGF0YSwge1xuICAgICAgICB4OiBcImFxXCIsXG4gICAgICAgIHk6IFwiYWdcIixcbiAgICAgICAgZng6IFwia2V5XCIsXG4gICAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICAgKSxcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICAgKSxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIGQzLnNlbGVjdChwbG90TGFtYmRhR1EpXG4gICAgLnNlbGVjdChcImdbYXJpYS1sYWJlbD0neC1heGlzIGxhYmVsJ11cIilcbiAgICAuc2VsZWN0KFwidGV4dFwiKVxuICAgIC5jbG9uZShmYWxzZSlcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGNoYW5nZVRyYW5zbGF0aW9uKC0xMiwgMS41KSlcbiAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMC42ZW1cIilcbiAgICAgIC5hdHRyKFwiZm9udC13ZWlnaHRcIiwgXCI2MDBcIilcbiAgICAgIC50ZXh0KFwiUVwiKTtcblxuICBkMy5zZWxlY3QocGxvdExhbWJkYUdRKVxuICAgIC5zZWxlY3QoXCJnW2FyaWEtbGFiZWw9J3ktYXhpcyBsYWJlbCddXCIpXG4gICAgLnNlbGVjdChcInRleHRcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGNoYW5nZVRyYW5zbGF0aW9uKDAsIDEwKSlcbiAgICAuY2xvbmUoZmFsc2UpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigxNCwgNC4xKSlcbiAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMC42ZW1cIilcbiAgICAgIC5hdHRyKFwiZm9udC13ZWlnaHRcIiwgXCI2MDBcIilcbiAgICAgIC50ZXh0KFwiR1wiKTtcblxuICByZXR1cm4gcGxvdExhbWJkYUdRO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBwaWVjZXdpc2VMb2dUcmFuc2Zvcm0oeFRyYW4gPSAxKSB7XG4gIHJldHVybiB4ID0+IHggPiB4VHJhbiA/IE1hdGgubG9nKHgpIDogeCAtIHhUcmFuICsgTWF0aC5sb2coeFRyYW4pO1xufVxuXG5mdW5jdGlvbiBwaWVjZXdpc2VMb2dJbnZlcnQoeFRyYW4gPSAxKSB7XG4gIHJldHVybiB5ID0+IHkgPiBNYXRoLmxvZyh4VHJhbikgPyBNYXRoLmV4cCh5KSA6IHkgLSBNYXRoLmxvZzEwKHhUcmFuKSArIHhUcmFuO1xufVxuXG5mdW5jdGlvbiBzZXRJbnB1dChpbnB1dCwgdmFsdWUpIHtcbiAgaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xufVxuXG5mdW5jdGlvbiBudW1EaWdpdHMoeCkge1xuICByZXR1cm4geCA9PT0gMCA/IDEgOiAoMSArIE1hdGguZmxvb3IoTWF0aC5sb2cxMCh4KSkpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRlZmF1bHRBVmFsdWUgPSAyZTY7XG5kZWZhdWx0QVN1cHBseSA9IDJlNztcbmRlZmF1bHRQcmVzZW50VG9ubmVzID0gMWU3O1xuZGVmYXVsdERlbHRhVG9ubmVzID0gMWUyO1xuZGVmYXVsdEFpID0gMC41O1xuZGVmYXVsdEdpID0gMC41O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IklucHV0cy5idXR0b24oXG4gIFtbXCJSZXNldFwiLCAoKSA9PiB7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QVZhbHVlLCBkZWZhdWx0QVZhbHVlKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBU3VwcGx5LCBkZWZhdWx0QVN1cHBseSk7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0UHJlc2VudFRvbm5lcywgZGVmYXVsdFByZXNlbnRUb25uZXMpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dERlbHRhVG9ubmVzLCBkZWZhdWx0RGVsdGFUb25uZXMpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dEFpLCBkZWZhdWx0QWkpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dEdpLCBkZWZhdWx0R2kpO1xuICB9XV0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dEFWYWx1ZSA9IElucHV0cy5yYW5nZShbMWU1LCAxZTldLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e01hcmtldCBjYXAuIG9mIFxcdGV4dGJme0F9fWAsXG4gIHN0ZXA6IDEsXG4gIHZhbHVlOiBkZWZhdWx0QVZhbHVlLFxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxufSk7XG52aWV3b2YgaW5wdXRBU3VwcGx5ID0gSW5wdXRzLnJhbmdlKFsxZTYsIDFlMTBdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1N1cHBseSBvZiBcXHRleHRiZntBfX1gLFxuICBzdGVwOiAxLFxuICB2YWx1ZTogZGVmYXVsdEFTdXBwbHksXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbnZpZXdvZiBpbnB1dFByZXNlbnRUb25uZXMgPSBJbnB1dHMucmFuZ2UoWzAsIDFlOV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UG9ydGZvbGlvIH0gXFxiYXIgQ19pYCxcbiAgc3RlcDogMWUtMyxcbiAgdmFsdWU6IGRlZmF1bHRQcmVzZW50VG9ubmVzLFxuICB0cmFuc2Zvcm06IHBpZWNld2lzZUxvZ1RyYW5zZm9ybSgxZS0zKSxcbiAgaW52ZXJ0OiBwaWVjZXdpc2VMb2dJbnZlcnQoMWUtMyksXG59KTtcbnZpZXdvZiBpbnB1dERlbHRhVG9ubmVzID0gSW5wdXRzLnJhbmdlKFsxZS0zLCAxZTddLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1B1cmNoYXNlZCB0b25uZXN9YCxcbiAgc3RlcDogMWUtMyxcbiAgdmFsdWU6IGRlZmF1bHREZWx0YVRvbm5lcyxcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcbn0pO1xudmlld29mIGlucHV0QWkgPSBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0FsbG9jYXRpb24gfSBBX2lgLFxuICBzdGVwOiAxZS02LFxuICB2YWx1ZTogZGVmYXVsdEFpLFxuICB0cmFuc2Zvcm06IHBpZWNld2lzZUxvZ1RyYW5zZm9ybSgxZS02KSxcbiAgaW52ZXJ0OiBwaWVjZXdpc2VMb2dJbnZlcnQoMWUtNiksXG59KTtcbnZpZXdvZiBpbnB1dEdpID0gSW5wdXRzLnJhbmdlKFswLCAxXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtBbGxvY2F0aW9uIH0gR19pYCxcbiAgc3RlcDogMWUtNixcbiAgdmFsdWU6IGRlZmF1bHRHaSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBhcmFtRGVsdGFBID0gY29tcHV0ZVRydWVEZWx0YUEoXG4gIGlucHV0QWksXG4gIGlucHV0R2ksXG4gIGlucHV0UHJlc2VudFRvbm5lcyxcbiAgaW5wdXREZWx0YVRvbm5lcyxcbik7XG5wYXJhbURlbHRhVG9ubmVzID0gcGFyYW1EZWx0YUEgPT09IDAgPyAwIDogaW5wdXREZWx0YVRvbm5lcztcbnBhcmFtQUVtaXR0ZWQgPSBwYXJhbURlbHRhQSAqIGlucHV0QVN1cHBseTtcbnBhcmFtQVByaWNlID0gaW5wdXRBVmFsdWUgLyBpbnB1dEFTdXBwbHk7XG5wYXJhbUJhckNpUHJpY2UgPSBpbnB1dEFWYWx1ZSAqIHBhcmFtRGVsdGFBIC8gaW5wdXREZWx0YVRvbm5lcztcblxuc3RyaW5nQVN1cHBseSA9IGlucHV0QVN1cHBseS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAyIC0gbnVtRGlnaXRzKHBhcmFtQUVtaXR0ZWQpKSxcbiAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1BRW1pdHRlZCkpLFxuICB9LFxuKSArIFwiIGtWQ01cIjtcbnN0cmluZ1ByZXNlbnRUb25uZXMgPSBpbnB1dFByZXNlbnRUb25uZXMudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMyAtIG51bURpZ2l0cyhwYXJhbURlbHRhVG9ubmVzKSksXG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAzIC0gbnVtRGlnaXRzKHBhcmFtRGVsdGFUb25uZXMpKSxcbiAgfSxcbikgKyBcIiB0Q08yZXFcIjtcbnN0cmluZ0FFbWl0dGVkID0gXCIrXCIgKyBwYXJhbUFFbWl0dGVkLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbUFFbWl0dGVkKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCBudW1EaWdpdHMocGFyYW1BRW1pdHRlZCkpLFxuICB9LFxuKSArIFwiIGtWQ01cIjtcbnN0cmluZ0RlbHRhVG9ubmVzID0gXCIrXCIgKyBwYXJhbURlbHRhVG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDMsIG51bURpZ2l0cyhwYXJhbURlbHRhVG9ubmVzKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgzLCBudW1EaWdpdHMocGFyYW1EZWx0YVRvbm5lcykpLFxuICB9LFxuKSArIFwiIHRDTzJlcVwiO1xuc3RyaW5nQVByaWNlID0gXCIkXCIgKyBwYXJhbUFQcmljZS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQVByaWNlKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQVByaWNlKSksXG4gIH0sXG4pO1xuc3RyaW5nQmFyQ2lQcmljZSA9IFwiJFwiICsgcGFyYW1CYXJDaVByaWNlLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1CYXJDaVByaWNlKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQmFyQ2lQcmljZSkpLFxuICB9LFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkZWZhdWx0TGlxdWlkVG9ubmVzID0gMWU3O1xuZGVmYXVsdEFCdXJudCA9IDFlMjtcbmRlZmF1bHRHbnVsbCA9IDAuNTtcbmRlZmF1bHRBID0gMC41O1xuZGVmYXVsdFMgPSAwLjU7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiSW5wdXRzLmJ1dHRvbihcbiAgW1tcIlJlc2V0XCIsICgpID0+IHtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBVmFsdWVfLCBkZWZhdWx0QVZhbHVlKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBU3VwcGx5XywgZGVmYXVsdEFTdXBwbHkpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dExpcXVpZFRvbm5lcywgZGVmYXVsdExpcXVpZFRvbm5lcyk7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QUJ1cm50LCBkZWZhdWx0QUJ1cm50KTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBaSwgZGVmYXVsdEFpKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRHaSwgZGVmYXVsdEdpKTtcbiAgfV1dLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXRBVmFsdWVfID0gSW5wdXRzLnJhbmdlKFsxZTUsIDFlOV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7TWFya2V0IGNhcC4gb2YgXFx0ZXh0YmZ7QX19YCxcbiAgc3RlcDogMSxcbiAgdmFsdWU6IGRlZmF1bHRBVmFsdWUsXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbnZpZXdvZiBpbnB1dEFTdXBwbHlfID0gSW5wdXRzLnJhbmdlKFsxZTYsIDFlMTBdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1N1cHBseSBvZiBcXHRleHRiZntBfX1gLFxuICBzdGVwOiAxLFxuICB2YWx1ZTogZGVmYXVsdEFTdXBwbHksXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbnZpZXdvZiBpbnB1dExpcXVpZFRvbm5lcyA9IElucHV0cy5yYW5nZShbMWUtMywgMWU5XSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtQb3J0Zm9saW8gfSBDX3tpMH1gLFxuICBzdGVwOiAxZS0zLFxuICB2YWx1ZTogZGVmYXVsdExpcXVpZFRvbm5lcyxcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcbn0pO1xudmlld29mIGlucHV0QUJ1cm50ID0gSW5wdXRzLnJhbmdlKFsxZS0xLCAxZTZdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1xcdGV4dGJme0F9IHRva2VucyBidXJudH1gLFxuICBzdGVwOiAxZS0xLFxuICB2YWx1ZTogZGVmYXVsdEFCdXJudCxcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcbn0pO1xuSW5wdXRzLmJpbmQoXG4gIElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgICBsYWJlbDogdGV4YFxcdGV4dHtBbGxvY2F0aW9uIH0gQV9pYCxcbiAgICBzdGVwOiAxZS02LFxuICAgIHZhbHVlOiBkZWZhdWx0QWksXG4gICAgdHJhbnNmb3JtOiBwaWVjZXdpc2VMb2dUcmFuc2Zvcm0oMWUtNiksXG4gICAgaW52ZXJ0OiBwaWVjZXdpc2VMb2dJbnZlcnQoMWUtNiksXG4gIH0pLFxuICB2aWV3b2YgaW5wdXRBaSxcbik7XG5JbnB1dHMuYmluZChcbiAgSW5wdXRzLnJhbmdlKFswLCAxXSwge1xuICAgIGxhYmVsOiB0ZXhgXFx0ZXh0e0FsbG9jYXRpb24gfSBHX2lgLFxuICAgIHN0ZXA6IDFlLTYsXG4gICAgdmFsdWU6IGRlZmF1bHRHaSxcbiAgfSksXG4gIHZpZXdvZiBpbnB1dEdpLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwYXJhbUFCdXJudCA9IGlucHV0QWkgPT09IDAgPyAwIDogaW5wdXRBQnVybnRcbnBhcmFtRGVsdGFBXyA9IHBhcmFtQUJ1cm50IC8gaW5wdXRBU3VwcGx5XztcbnBhcmFtRGVsdGFDaSA9IGlucHV0QWkgPT09IDAgPyAtMCA6IGNvbXB1dGVEZWx0YUNpKFxuICBpbnB1dEFpLFxuICBpbnB1dEdpLFxuICBwYXJhbURlbHRhQV8sXG4pO1xucGFyYW1EZWx0YUNpVG9ubmVzID0gLXBhcmFtRGVsdGFDaSAqIGlucHV0TGlxdWlkVG9ubmVzO1xucGFyYW1BUHJpY2VfID0gaW5wdXRBVmFsdWVfIC8gaW5wdXRBU3VwcGx5XztcbnBhcmFtQ2lQcmljZSA9IGlucHV0QWkgPT09IDAgPyAwIDogaW5wdXRBVmFsdWVfICogcGFyYW1EZWx0YUFfIC8gcGFyYW1EZWx0YUNpVG9ubmVzO1xuXG5zdHJpbmdBU3VwcGx5XyA9IGlucHV0QVN1cHBseV8udG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMiAtIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMiAtIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxuICB9LFxuKSArIFwiIGtWQ01cIjtcbnN0cmluZ0xpcXVpZFRvbm5lcyA9IGlucHV0TGlxdWlkVG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1EZWx0YUNpVG9ubmVzKSksXG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAyIC0gbnVtRGlnaXRzKHBhcmFtRGVsdGFDaVRvbm5lcykpLFxuICB9LFxuKSArIFwiIHRDTzJlcVwiO1xuc3RyaW5nQUJ1cm50ID0gXCLiiJJcIiArIHBhcmFtQUJ1cm50LnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtQUJ1cm50KSksXG4gIH0sXG4pICsgXCIga1ZDTVwiO1xuc3RyaW5nRGVsdGFDaVRvbm5lcyA9IFwi4oiSXCIgKyBwYXJhbURlbHRhQ2lUb25uZXMudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtRGVsdGFDaVRvbm5lcykpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtRGVsdGFDaVRvbm5lcykpLFxuICB9LFxuKSArIFwiIHRDTzJlcVwiO1xuc3RyaW5nQVByaWNlXyA9IFwiJFwiICsgcGFyYW1BUHJpY2VfLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1BUHJpY2VfKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQVByaWNlXykpLFxuICB9LFxuKTtcbnN0cmluZ0NpUHJpY2UgPSBcIiRcIiArIHBhcmFtQ2lQcmljZS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQ2lQcmljZSkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgMiArIG51bURpZ2l0cyhwYXJhbUNpUHJpY2UpKSxcbiAgfSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYWxsb2NJbml0R0RhdGEgPSB7XG4gIGNvbnN0IGFsbG9jSW5pdEdEYXRhID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwLjAxOyBpICs9IDAuMjUpIHtcbiAgICBpZiAoaSA8IDIuNTEpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiMDFYXCIsIHZhbHVlOiBpIH0pO1xuICAgIH1cbiAgICBpZiAoMi40OSA8IGkgJiYgaSA8IDUuNTEpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwicEtsaW1hIEhvbGRlcnNcIiwgdmFsdWU6IGkgfSk7XG4gICAgfVxuICAgIGlmICg1LjQ5IDwgaSAmJiBpIDwgMTAuMDEpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiREFPL1RyZWFzdXJ5XCIsIHZhbHVlOiBpIH0pO1xuICAgIH1cbiAgICBpZiAoOS45OSA8IGkgJiYgaSA8IDE1LjAxKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIkVjb3N5c3RlbSBHcmFudFwiLCB2YWx1ZTogaSB9KTtcbiAgICB9XG4gICAgaWYgKDE0Ljk5IDwgaSAmJiBpIDwgMjAuMDEpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiUHJvZHVjdCBEZXNpZ25cIiwgdmFsdWU6IGkgfSk7XG4gICAgfVxuICAgIGlmICgxOS45OSA8IGkgJiYgaSA8IDYwLjAxKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIktsaW1hIEhvbGRlcnNcIiwgdmFsdWU6IGkgfSk7XG4gICAgfVxuICAgIGlmICg1OS45OSA8IGkpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiSW5jZW50aXZlc1wiLCB2YWx1ZTogaSB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFsbG9jSW5pdEdEYXRhO1xufTtcbmxvbmdpdHVkZVNjYWxlID0gZDMuc2NhbGVMaW5lYXIoWzE4MCwgLTE4MF0pO1xuZ2V0Q2VudGVyID0gZCA9PlxuICAgICAgICBbMS4yNSwgNCwgNy43NSwgMTIuNSwgMTcuNSwgNDAsIDgwXS5pbmNsdWRlcyhkLnZhbHVlKSA/IGQudmFsdWUgOiBOYU47XG5cbmNvaG9ydHNEb21haW4gPSBbXG4gIFwiSW5jZW50aXZlc1wiLFxuICBcIktsaW1hIEhvbGRlcnNcIixcbiAgXCJQcm9kdWN0IERlc2lnblwiLFxuICBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICBcIkRBTy9UcmVhc3VyeVwiLFxuICBcInBLbGltYSBIb2xkZXJzXCIsXG4gIFwiMDFYXCIsXG5dO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIHByb2plY3Rpb246IHsgdHlwZTogXCJhemltdXRoYWwtZXF1aWRpc3RhbnRcIiwgcm90YXRlOiBbMCwgLTkwXSwgc2NhbGU6IDIgfSxcbiAgY29sb3I6IHsgbGVnZW5kOiB0cnVlLCByYW5nZTogZDMuc2NoZW1lQ2F0ZWdvcnkxMCwgZG9tYWluOiBjb2hvcnRzRG9tYWluIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5hcmVhKGFsbG9jSW5pdEdEYXRhLCB7XG4gICAgICB4MTogKHsgdmFsdWUgfSkgPT4gbG9uZ2l0dWRlU2NhbGUodmFsdWUgLyAxMDApLFxuICAgICAgeTE6IC0yMCxcbiAgICAgIHgyOiAoeyB2YWx1ZSB9KSA9PiBsb25naXR1ZGVTY2FsZSh2YWx1ZSAvIDEwMCksXG4gICAgICB5MjogLTcwLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgXVxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0UDAgPSBJbnB1dHMucmFuZ2UoWzAuMDEsIDAuNV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7SW5pdGlhbCBpc3N1YW5jZSB9IFBfMGAsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiAwLjA3LFxufSk7XG52aWV3b2YgaW5wdXRUID0gSW5wdXRzLnJhbmdlKFsyLCA2MF0sIHtcbiAgbGFiZWw6IHRleGBUIFxcdGV4dHsgKG1vbnRocyl9YCxcbiAgc3RlcDogMSxcbiAgdmFsdWU6IDI0LFxufSk7XG5cbnN0cmluZ0lucHV0UDAgPSBpbnB1dFAwLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSxcbik7XG5zdHJpbmdJbnB1dFQgPSBpbnB1dFQudG9Mb2NhbGVTdHJpbmcoXCJlbi1HQlwiLCB7IG1heGltdW1GcmFjdGlvbkRpZ2l0czogMCB9KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlUCh0LCBQMCwgVCkge1xuICBjb25zdCB4MCA9IE1hdGgubG9nKFAwIC8gKDEgLSBQMCkpO1xuICBjb25zdCB4dCA9IHgwICogKDEgLSB0IC8gVCk7XG4gIGNvbnN0IGV4cCA9IE1hdGguZXhwKHh0KTtcbiAgcmV0dXJuIGV4cCAvIChleHAgKyAxKTtcbn1cblxuZnVuY3Rpb24gY29tcHV0ZURlcml2UCh0LCBQMCwgVCkge1xuICBjb25zdCB4MCA9IE1hdGgubG9nKFAwIC8gKDEgLSBQMCkpO1xuICBjb25zdCB4dCA9IHgwICogKDEgLSB0IC8gVCk7XG4gIGNvbnN0IGV4cCA9IE1hdGguZXhwKHh0KTtcbiAgY29uc3QgUCA9IGV4cCAvICgxICsgZXhwKTtcbiAgcmV0dXJuIC0oeDAgLyBUKSAqIFAgKiAoMSAtIFApO1xufVxuXG5mdW5jdGlvbiBnZXRWZXN0aW5nKHZlY1Zlc3RpbmcsIHQsIHRTdGFydCwgdEVuZCkge1xuICBpZiAodCA8IHRTdGFydClcbiAgICByZXR1cm4gMDtcbiAgZWxzZSBpZiAodCA8IHRFbmQpIHtcbiAgICByZXR1cm4gdmVjVmVzdGluZ1t0IC0gdFN0YXJ0XTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdmVjVmVzdGluZ1t0RW5kIC0gdFN0YXJ0IC0gMV07XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ0VmVzdFN0YXJ0ID0gMztcbnRWZXN0RW5kID0gMiAqIGlucHV0VDtcbnRWZXN0aW5nID0gZDMucmFuZ2UodFZlc3RTdGFydCwgdFZlc3RFbmQpO1xudmVjVmVzdGluZ0Rlcml2ID0gbm9ybWFsaXplKHRWZXN0aW5nLm1hcCh0ID0+XG4gIGNvbXB1dGVEZXJpdlAodCwgaW5wdXRQMCwgaW5wdXRUKVxuKSk7XG52ZWNWZXN0aW5nID0gZDMuY3Vtc3VtKHZlY1Zlc3RpbmdEZXJpdik7XG5cbnN1cHBseURhdGFBbGwgPSB7XG4gIGxldCBwYXJhbVZlc3RpbmdQcmV2aW91cyA9IDA7XG4gIGNvbnN0IHZlY1N1cHBseUluY2VudGl2ZXMgPSBbXTtcbiAgY29uc3QgdmVjU3VwcGx5Q2lyY3VsYXRpbmcgPSBbXTtcbiAgY29uc3Qgc3VwcGx5RGF0YSA9IFtdO1xuICBmb3IgKGxldCB0ID0gMDsgdCA8PSA3MjsgdCsrKSB7XG4gICAgY29uc3QgcGFyYW1QID0gY29tcHV0ZVAodCwgaW5wdXRQMCwgaW5wdXRUKTtcbiAgICBjb25zdCBwYXJhbURlcml2UCA9IGNvbXB1dGVEZXJpdlAodCwgaW5wdXRQMCwgaW5wdXRUKTtcbiAgICBjb25zdCBwYXJhbVZlc3RpbmcgPSBnZXRWZXN0aW5nKHZlY1Zlc3RpbmcsIHQsIHRWZXN0U3RhcnQsIHRWZXN0RW5kKTtcbiAgICBjb25zdCBwYXJhbVZlc3RpbmdEaWZmID0gcGFyYW1WZXN0aW5nIC0gcGFyYW1WZXN0aW5nUHJldmlvdXM7XG4gICAgcGFyYW1WZXN0aW5nUHJldmlvdXMgPSBwYXJhbVZlc3Rpbmc7XG5cbiAgICBjb25zdCBzdXBwbHkwMVggPSAyLjU7XG4gICAgY29uc3Qgc3VwcGx5UEtsaW1hID0gMyAqIHBhcmFtVmVzdGluZztcbiAgICBjb25zdCBzdXBwbHlUcmVhc3VyeSA9IDQuNTtcbiAgICBjb25zdCBzdXBwbHlHcmFudCA9IDUgKiBwYXJhbVZlc3Rpbmc7XG4gICAgY29uc3Qgc3VwcGx5UHJvZHVjdCA9IDUgKiBwYXJhbVZlc3Rpbmc7XG4gICAgY29uc3Qgc3VwcGx5S2xpbWEgPSA0MCAqIHBhcmFtVmVzdGluZztcbiAgICBjb25zdCBzdXBwbHlJbmNlbnRpdmVzID0gNDAgKiBwYXJhbVA7XG4gICAgdmVjU3VwcGx5SW5jZW50aXZlcy5wdXNoKHN1cHBseUluY2VudGl2ZXMpO1xuXG4gICAgY29uc3Qgc3VwcGx5MDFYU3RhY2tlZCA9IHN1cHBseTAxWDtcbiAgICBjb25zdCBzdXBwbHlQS2xpbWFTdGFja2VkID0gc3VwcGx5UEtsaW1hICsgc3VwcGx5MDFYU3RhY2tlZDtcbiAgICBjb25zdCBzdXBwbHlUcmVhc3VyeVN0YWNrZWQgPSBzdXBwbHlUcmVhc3VyeSArIHN1cHBseVBLbGltYVN0YWNrZWQ7XG4gICAgY29uc3Qgc3VwcGx5R3JhbnRTdGFja2VkID0gc3VwcGx5R3JhbnQgKyBzdXBwbHlUcmVhc3VyeVN0YWNrZWQ7XG4gICAgY29uc3Qgc3VwcGx5UHJvZHVjdFN0YWNrZWQgPSBzdXBwbHlQcm9kdWN0ICsgc3VwcGx5R3JhbnRTdGFja2VkO1xuICAgIGNvbnN0IHN1cHBseUtsaW1hU3RhY2tlZCA9IHN1cHBseUtsaW1hICsgc3VwcGx5UHJvZHVjdFN0YWNrZWQ7XG4gICAgY29uc3Qgc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQgPSBzdXBwbHlJbmNlbnRpdmVzICsgc3VwcGx5S2xpbWFTdGFja2VkO1xuICAgIGNvbnN0IHN1cHBseUNpcmN1bGF0aW5nID0gc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQgLyAxMDA7XG4gICAgdmVjU3VwcGx5Q2lyY3VsYXRpbmcucHVzaChzdXBwbHlJbmNlbnRpdmVzU3RhY2tlZCk7XG5cbiAgICBpZiAodCA8PSA2MCkge1xuICAgICAgY29uc3QgZGlmZkluY2VudGl2ZXMgPSA0MCAqICh0ID09PSAwID8gaW5wdXRQMCA6IHBhcmFtRGVyaXZQKTtcbiAgICAgIGNvbnN0IGRpZmZLbGltYSA9IDQwICogcGFyYW1WZXN0aW5nRGlmZjtcbiAgICAgIGNvbnN0IGRpZmZQcm9kdWN0ID0gNSAqIHBhcmFtVmVzdGluZ0RpZmY7XG4gICAgICBjb25zdCBkaWZmR3JhbnQgPSA1ICogcGFyYW1WZXN0aW5nRGlmZjtcbiAgICAgIGNvbnN0IGRpZmZQS2xpbWEgPSAzICogcGFyYW1WZXN0aW5nRGlmZjtcbiAgICAgIGNvbnN0IGRpZmZUcmVhc3VyeSA9IHQgPT09IDAgPyA0LjU6IDA7XG4gICAgICBjb25zdCBkaWZmMDFYID0gdCA9PT0gMCA/IDIuNSA6IDA7XG5cbiAgICAgIGNvbnN0IGRpZmZJbmNlbnRpdmVzU3RhY2tlZCA9IGRpZmZJbmNlbnRpdmVzO1xuICAgICAgY29uc3QgZGlmZktsaW1hU3RhY2tlZCA9IGRpZmZLbGltYSArIGRpZmZJbmNlbnRpdmVzU3RhY2tlZDtcbiAgICAgIGNvbnN0IGRpZmZQcm9kdWN0U3RhY2tlZCA9IGRpZmZQcm9kdWN0ICsgZGlmZktsaW1hU3RhY2tlZDtcbiAgICAgIGNvbnN0IGRpZmZHcmFudFN0YWNrZWQgPSBkaWZmR3JhbnQgKyBkaWZmUHJvZHVjdFN0YWNrZWQ7XG4gICAgICBjb25zdCBkaWZmUEtsaW1hU3RhY2tlZCA9IGRpZmZQS2xpbWEgKyBkaWZmR3JhbnRTdGFja2VkO1xuICAgICAgY29uc3QgZGlmZlRyZWFzdXJ5U3RhY2tlZCA9IGRpZmZUcmVhc3VyeSArIGRpZmZQS2xpbWFTdGFja2VkO1xuICAgICAgY29uc3QgZGlmZjAxWFN0YWNrZWQgPSBkaWZmMDFYICsgZGlmZlRyZWFzdXJ5U3RhY2tlZDtcblxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlByb3BvcnRpb24gb2YgU3VwcGx5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IDEwMCAqIHBhcmFtUCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlJhdGUgb2YgQ2hhbmdlXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IDEwMCAqIHBhcmFtRGVyaXZQLFxuICAgICAgfSk7XG5cbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCIwMVhcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5MDFYU3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwicEtsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hU3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVRyZWFzdXJ5U3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiRWNvc3lzdGVtIEdyYW50XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUdyYW50U3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdFN0YWNrZWQgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5S2xpbWFTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJJbmNlbnRpdmVzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUluY2VudGl2ZXNTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcblxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiMDFYXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseTAxWCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJwS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlQS2xpbWEgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVRyZWFzdXJ5IC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlHcmFudCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJQcm9kdWN0IERlc2lnblwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlQcm9kdWN0IC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5S2xpbWEgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlJbmNlbnRpdmVzIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcblxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIjAxWFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHkwMVhTdGFja2VkLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwicEtsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hU3RhY2tlZCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkRBTy9UcmVhc3VyeVwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlUcmVhc3VyeVN0YWNrZWQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJFY29zeXN0ZW0gR3JhbnRcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5R3JhbnRTdGFja2VkLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdFN0YWNrZWQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJLbGltYSBIb2xkZXJzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUtsaW1hU3RhY2tlZCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkluY2VudGl2ZXNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQsXG4gICAgICB9KTtcblxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiMDFYXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseTAxWCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwicEtsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJEQU8vVHJlYXN1cnlcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5VHJlYXN1cnksXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlHcmFudCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlLbGltYSxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlJbmNlbnRpdmVzLFxuICAgICAgfSk7XG5cbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJJbmNlbnRpdmVzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IGRpZmZJbmNlbnRpdmVzLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmS2xpbWEsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJQcm9kdWN0IERlc2lnblwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmUHJvZHVjdCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmR3JhbnQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJwS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmUEtsaW1hLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IGRpZmZUcmVhc3VyeSxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIjAxWFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmMDFYLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgdmVjTmV4dFllYXJJbmNlbnRpdmVzID0gdmVjU3VwcGx5SW5jZW50aXZlcy5tYXAoKHZhbCwgdCkgPT5cbiAgICB2ZWNTdXBwbHlJbmNlbnRpdmVzW3QgKyAxMl0gLSB2YWwpO1xuICBjb25zdCB2ZWNBUFkgPSB2ZWNTdXBwbHlDaXJjdWxhdGluZy5tYXAoKHZhbCwgdCkgPT5cbiAgICAxMDAgKiAodmVjU3VwcGx5Q2lyY3VsYXRpbmdbdCArIDEyXSAtIHZhbCkgLyB2YWwpO1xuICBjb25zdCB2ZWNBUFIgPSB2ZWNTdXBwbHlDaXJjdWxhdGluZy5tYXAoKHZhbCwgdCkgPT5cbiAgICAxMDAgKiAodmVjU3VwcGx5Q2lyY3VsYXRpbmdbdCArIDEyXSAtIHZlY05leHRZZWFySW5jZW50aXZlc1t0XSAtIHZhbCkgLyB2YWwpO1xuXG4gIGZvciAobGV0IHQgPSAwOyB0IDw9IDYwOyB0KyspIHtcbiAgICBzdXBwbHlEYXRhLnB1c2goeyBrZXk6IFwiQVBZXCIsIHg6IHQsIHk6IHZlY0FQWVt0XSB9KTtcbiAgICBzdXBwbHlEYXRhLnB1c2goeyBrZXk6IFwiQVBSXCIsIHg6IHQsIHk6IHZlY0FQUlt0XSB9KTtcbiAgfVxuICByZXR1cm4gW1xuICAgIHZlY1N1cHBseUluY2VudGl2ZXMsXG4gICAgdmVjU3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgc3VwcGx5RGF0YSxcbiAgICB2ZWNBUFksXG4gICAgdmVjQVBSLFxuICBdO1xufVxudmVjU3VwcGx5SW5jZW50aXZlcyA9IHN1cHBseURhdGFBbGxbMF07XG52ZWNTdXBwbHlDaXJjdWxhdGluZyA9IHN1cHBseURhdGFBbGxbMV07XG5zdXBwbHlEYXRhID0gc3VwcGx5RGF0YUFsbFsyXTtcbnZlY0FQWSA9IHN1cHBseURhdGFBbGxbM107XG52ZWNBUFIgPSBzdXBwbHlEYXRhQWxsWzRdO1xuXG5nZXRMb2dpc3RpY0N1cnZlID0gZCA9PiBkLmtleSA9PT0gXCJQcm9wb3J0aW9uIG9mIFN1cHBseVwiID8gZC55IDogTmFOO1xuZ2V0UmF0ZU9mQ2hhbmdlID0gZCA9PiBkLmtleSA9PT0gXCJSYXRlIG9mIENoYW5nZVwiID8gZC55IDogTmFOO1xuZ2V0Q2lyY3VsYXRpbmdTdGFja2VkID0gZCA9PlxuICAgICAgICBkLmtleSA9PT0gXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XG5nZXRDaXJjdWxhdGluZ1Vuc3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XG5nZXRUb3RhbFN0YWNrZWQgPSBkID0+IGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIiA/IGQueSA6IE5hTjtcbmdldFRvdGFsVW5zdGFja2VkID0gZCA9PiBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIiA/IGQueSA6IE5hTjtcbmdldERpZmZVbnN0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIiA/IGQueSA6IE5hTjtcbmdldENvaG9ydENpcmN1bGF0aW5nU3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiID8gZC5jb2hvcnQgOiBOYU47XG5nZXRDb2hvcnRDaXJjdWxhdGluZ1Vuc3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIgPyBkLmNvaG9ydCA6IE5hTjtcbmdldENvaG9ydFRvdGFsU3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiID8gZC5jb2hvcnQgOiBOYU47XG5nZXRDb2hvcnRUb3RhbFVuc3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIgPyBkLmNvaG9ydCA6IE5hTjtcbmdldENvaG9ydERpZmZVbnN0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIiA/IGQuY29ob3J0IDogTmFOO1xuZ2V0QVBZID0gZCA9PiBkLmtleSA9PT0gXCJBUFlcIiA/IGQueSA6IE5hTjtcbmdldEFQUiA9IGQgPT4gZC5rZXkgPT09IFwiQVBSXCIgPyBkLnkgOiBOYU47XG5cbmRvbWFpblJhdGVPZkNoYW5nZSA9IFswLCBkMy5tYXgoc3VwcGx5RGF0YSwgZ2V0UmF0ZU9mQ2hhbmdlKV07XG5zY2FsZVJhdGVPZkNoYW5nZSA9IGQzLnNjYWxlTGluZWFyKGRvbWFpblJhdGVPZkNoYW5nZSwgWzAsIDEwMF0pO1xubWFwU2NhbGVSYXRlT2ZDaGFuZ2UgPSB4ID0+IHgubWFwKHNjYWxlUmF0ZU9mQ2hhbmdlKTtcblxuc3RyaW5nUDAgPSBcIkluaXRpYWwgSXNzdWFuY2UgUOKCgCA9IFwiICsgaW5wdXRQMC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwIH0sXG4pO1xuc3RyaW5nVCA9IFwiSW5mbGVjdGlvbiBQb2ludCBUaW1lIFQgPSBcIiArIGlucHV0VC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IG1heGltdW1GcmFjdGlvbkRpZ2l0czogMCB9LFxuKSArIFwiIG1vbnRoc1wiO1xuXG5zdXBwbHlQYXJhbXMgPSBbXG4gIHsga2V5OiBzdHJpbmdQMCwgeDogMC41LCB5OiAxMDAgKiBpbnB1dFAwIH0sXG4gIHsga2V5OiBzdHJpbmdULCB4OiBpbnB1dFQsIHk6IDUwIH0sXG5dO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHJhbmdlOiBbNSwgNywgMCwgMl0ubWFwKGkgPT4gZDMuc2NoZW1lQ2F0ZWdvcnkxMFtpXSksXG4gICAgZG9tYWluOiBbXCJQcm9wb3J0aW9uIG9mIFN1cHBseVwiLCBcIlJhdGUgb2YgQ2hhbmdlXCIsIHN0cmluZ1AwLCBzdHJpbmdUXSxcbiAgfSxcbiAgeDoge1xuICAgIHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksXG4gICAgbGFiZWw6IFwi4oCYTGlmZeKAmSBTcGFuIChNb250aHMpXCIsXG4gICAgZ3JpZDogdHJ1ZSxcbiAgfSxcbiAgeTogeyBkb21haW46IFswLCAxMDBdIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgY2xpcDogdHJ1ZSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJsZWZ0XCIsIGxhYmVsOiBcIlByb3BvcnRpb24gb2YgU3VwcGx5ICglKVwiIH0pLFxuICAgIFBsb3QuYXhpc1koc2NhbGVSYXRlT2ZDaGFuZ2UudGlja3MoKSwge1xuICAgICAgYW5jaG9yOiBcInJpZ2h0XCIsXG4gICAgICB0aWNrRm9ybWF0OiBzY2FsZVJhdGVPZkNoYW5nZS50aWNrRm9ybWF0KCksXG4gICAgICBsYWJlbDogXCJSYXRlIG9mIENoYW5nZSAoJS9Nb250aClcIixcbiAgICAgIHk6IHNjYWxlUmF0ZU9mQ2hhbmdlXG4gICAgfSksXG4gICAgUGxvdC5saW5lWShzdXBwbHlEYXRhLCBQbG90Lm1hcFkobWFwU2NhbGVSYXRlT2ZDaGFuZ2UsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0UmF0ZU9mQ2hhbmdlLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxuICAgIH0pKSxcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0TG9naXN0aWNDdXJ2ZSxcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICB9KSxcbiAgICBQbG90LmFyZWFZKHN1cHBseURhdGEsIFBsb3QubWFwWShtYXBTY2FsZVJhdGVPZkNoYW5nZSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRSYXRlT2ZDaGFuZ2UsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuMyxcbiAgICB9KSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IGdldExvZ2lzdGljQ3VydmUsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuMyxcbiAgICB9KSxcbiAgICBQbG90LnJ1bGVYKHN1cHBseVBhcmFtcywge1xuICAgICAgeDogZCA9PiBkLmtleSA9PT0gc3RyaW5nVCA/IGQueCA6IE5hTixcbiAgICAgIHk6IFwieVwiLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxuICAgIH0pLFxuICAgIFBsb3QuZG90WShzdXBwbHlQYXJhbXMsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogXCJ5XCIsXG4gICAgICByOiA1LFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgXVxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTg0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHsgbGVnZW5kOiB0cnVlLCByYW5nZTogZDMuc2NoZW1lQ2F0ZWdvcnkxMCwgZG9tYWluOiBjb2hvcnRzRG9tYWluIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDYwLjEsIDEyKSwgbGFiZWw6IFwiVGltZSAoTW9udGhzKVwiLCBncmlkOiB0cnVlIH0sXG4gIHk6IHsgZG9tYWluOiBbMCwgMTAwXSwgbGFiZWw6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5ICglKVwiLCBncmlkOiB0cnVlIH0sXG4gIGNsaXA6IHRydWUsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRDaXJjdWxhdGluZ1N0YWNrZWQsXG4gICAgICBzdHJva2U6IGdldENvaG9ydENpcmN1bGF0aW5nU3RhY2tlZCxcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICB9KSxcbiAgICBQbG90LmFyZWFZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0Q2lyY3VsYXRpbmdVbnN0YWNrZWQsXG4gICAgICBmaWxsOiBnZXRDb2hvcnRDaXJjdWxhdGluZ1Vuc3RhY2tlZCxcbiAgICAgIGZpbGxPcGFjaXR5OiAwLjUsXG4gICAgfSksXG4gIF1cbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxuICB5OiB7IGRvbWFpbjogWzAsIDEwMF0sIGxhYmVsOiBcIlRvdGFsIFN1cHBseSAoJSlcIiwgZ3JpZDogdHJ1ZSB9LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0VG90YWxTdGFja2VkLFxuICAgICAgc3Ryb2tlOiBnZXRDb2hvcnRUb3RhbFN0YWNrZWQsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgfSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IGdldFRvdGFsVW5zdGFja2VkLFxuICAgICAgZmlsbDogZ2V0Q29ob3J0VG90YWxVbnN0YWNrZWQsXG4gICAgICBmaWxsT3BhY2l0eTogMC41LFxuICAgIH0pLFxuICBdXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxuICB5OiB7IGxhYmVsOiBcIlRvdGFsIFN1cHBseSAoJSlcIiwgZ3JpZDogdHJ1ZSB9LFxuICBpbnNldFRvcDogMTYsXG4gIGNsaXA6IHRydWUsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRUb3RhbFVuc3RhY2tlZCxcbiAgICAgIHN0cm9rZTogZ2V0Q29ob3J0VG90YWxVbnN0YWNrZWQsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgfSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHkxOiAwLFxuICAgICAgeTI6IGdldFRvdGFsVW5zdGFja2VkLFxuICAgICAgZmlsbDogZ2V0Q29ob3J0VG90YWxVbnN0YWNrZWQsXG4gICAgICBmaWxsT3BhY2l0eTogMC4yLFxuICAgIH0pLFxuICBdXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxuICB5OiB7IGxhYmVsOiBcIlJhdGUgb2YgR3Jvd3RoICglL01vbnRoKVwiLCBncmlkOiB0cnVlIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3RZKHN1cHBseURhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQueCAtIDAuNDUsXG4gICAgICB4MjogZCA9PiBkLnggKyAwLjQ1LFxuICAgICAgeTogZ2V0RGlmZlVuc3RhY2tlZCxcbiAgICAgIGZpbGw6IGdldENvaG9ydERpZmZVbnN0YWNrZWQsXG4gICAgfSksXG4gIF1cbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHJhbmdlOiBbOSwgOF0ubWFwKGkgPT4gZDMuc2NoZW1lQ2F0ZWdvcnkxMFtpXSksXG4gICAgZG9tYWluOiBbXCJBUFlcIiwgXCJBUFJcIl0sXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDYwLjEsIDEyKSwgbGFiZWw6IFwiVGltZSAoTW9udGhzKVwiLCBncmlkOiB0cnVlIH0sXG4gIHk6IHtcbiAgICBkb21haW46IFswLCBNYXRoLm1heChkMy5tYXgodmVjQVBSKSwgZDMubWF4KHZlY0FQWSkpXSxcbiAgICBsYWJlbDogXCJBbm51YWwgUGVyY2VudGFnZSAoJSlcIixcbiAgICBncmlkOiB0cnVlLFxuICB9LFxuICBpbnNldFRvcDogMTYsXG4gIGNsaXA6IHRydWUsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRBUFksXG4gICAgICBzdHJva2U6IFwia2V5XCIsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgfSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHkxOiAwLFxuICAgICAgeTI6IGdldEFQWSxcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgICBmaWxsT3BhY2l0eTogMC4yLFxuICAgIH0pLFxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRBUFIsXG4gICAgICBzdHJva2U6IFwia2V5XCIsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgICBzdHJva2VEYXNoYXJyYXk6IDQsXG4gICAgfSksXG4gIF1cbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVVcHNpbG9uKEcsIEwpIHtcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAoMiAqIEcgKiBMIC8gKEcqKjIgKyBMKioyKSkqKjI7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ1cHNpbG9uRGF0YSA9IHtcbiAgY29uc3QgdXBzaWxvbkRhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMDUpIHtcbiAgICBmb3IgKGxldCBwYXJhbUwgPSAwOyBwYXJhbUwgPCAxLjAxOyBwYXJhbUwgKz0gMC4wNSkge1xuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcbiAgICAgICAgdXBzaWxvbkRhdGEucHVzaCh7XG4gICAgICAgICAga2V5OiBcIs+FXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZVVwc2lsb24ocGFyYW1HLCBwYXJhbUwpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVwc2lsb25EYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBhc3BlY3RSYXRpbzogMSxcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgZG9tYWluOiBbMCwgMV0sXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IFwiUmVsYXRpdmUgVXRpbGlzYXRpb24gz4VcIixcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxuICB5OiB7XG4gICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXG4gICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxuICB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QodXBzaWxvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQubCAtIDAuMDI1LFxuICAgICAgeDI6IGQgPT4gZC5sICsgMC4wMjUsXG4gICAgICB5MTogZCA9PiBkLmcgLSAwLjAyNSxcbiAgICAgIHkyOiBkID0+IGQuZyArIDAuMDI1LFxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dCh1cHNpbG9uRGF0YSwge1xuICAgICAgeDogXCJsXCIsXG4gICAgICB5OiBcImdcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVFdGEoRywgTCkge1xuICBpZiAoRyA9PT0gMCAmJiBMID09PSAwKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIDIgKiBHICogTCAvIChHICogKDEgLSBHKSArIEwgKiAoMSAtIEwpKTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImV0YURhdGEgPSB7XG4gIGNvbnN0IGV0YURhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMDUpIHtcbiAgICBmb3IgKGxldCBwYXJhbUwgPSAwOyBwYXJhbUwgPCAxLjAxOyBwYXJhbUwgKz0gMC4wNSkge1xuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcbiAgICAgICAgZXRhRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwizrdcIixcbiAgICAgICAgICBsOiBwYXJhbUwsXG4gICAgICAgICAgZzogcGFyYW1HLFxuICAgICAgICAgIHZhbHVlOiBjb21wdXRlRXRhKHBhcmFtRywgcGFyYW1MKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBldGFEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBhc3BlY3RSYXRpbzogMSxcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgZG9tYWluOiBbMCwgMV0sXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IFwiQWJzb2x1dGUgVXRpbGlzYXRpb24gzrdcIixcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxuICB5OiB7XG4gICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXG4gICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxuICB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QoZXRhRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5sIC0gMC4wMjUsXG4gICAgICB4MjogZCA9PiBkLmwgKyAwLjAyNSxcbiAgICAgIHkxOiBkID0+IGQuZyAtIDAuMDI1LFxuICAgICAgeTI6IGQgPT4gZC5nICsgMC4wMjUsXG4gICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KGV0YURhdGEsIHtcbiAgICAgIHg6IFwibFwiLFxuICAgICAgeTogXCJnXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXRTXyA9IElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7VGltZS1Mb2NrZWQgfSBTYCxcbiAgc3RlcDogMC4wMSxcbiAgdmFsdWU6IDAuNSxcbn0pO1xuXG52aWV3b2YgaW5wdXRXZWlnaHRBRyA9IElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7TFAgc3BsaXR9YCxcbiAgc3RlcDogMC4wMSxcbiAgdmFsdWU6IDAuNSxcbn0pO1xuXG5wYXJhbVdlaWdodEFRID0gMSAtIGlucHV0V2VpZ2h0QUc7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTk2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVRyZWFzdXJ5KEcsIEwpIHtcbiAgcmV0dXJuIE1hdGgubWF4KDAsIDEgLSBjb21wdXRlVXBzaWxvbihHLCBMKSAqIGNvbXB1dGVFdGEoRywgTCkpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVJQm9uZHMoRywgTCwgUykge1xuICBpZiAoRyA9PT0gMCAmJiBMID09PSAwKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFMgKiBMKioyIC8gKEcqKjIgKyBMKioyKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb21wdXRlSVN0YWtpbmcoRywgTCwgUykge1xuICBpZiAoRyA9PT0gMCAmJiBMID09PSAwKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuICgxIC0gUykgKiBMKioyIC8gKEcqKjIgKyBMKioyKTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVJUG9vbChHLCBMLCB3ZWlnaHQpIHtcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB3ZWlnaHQgKiBHKioyIC8gKEcqKjIgKyBMKioyKTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFsbG9jYXRpb25TUURhdGEgPSB7XG4gIGNvbnN0IGFsbG9jYXRpb25TUURhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMSkge1xuICAgIGZvciAobGV0IHBhcmFtTCA9IDA7IHBhcmFtTCA8IDEuMDE7IHBhcmFtTCArPSAwLjEpIHtcbiAgICAgIGlmIChwYXJhbUcgKyBwYXJhbUwgPCAxLjAxKSB7XG4gICAgICAgIGFsbG9jYXRpb25TUURhdGEucHVzaCh7XG4gICAgICAgICAga2V5OiBcIvCdl5QgVGltZS1sb2NrcyBBbGxvY2F0aW9uXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlCb25kcyhwYXJhbUcsIHBhcmFtTCwgaW5wdXRTXyksXG4gICAgICAgIH0pO1xuICAgICAgICBhbGxvY2F0aW9uU1FEYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCLwnZeaIFVzZXItbG9ja3MgQWxsb2NhdGlvblwiLFxuICAgICAgICAgIGw6IHBhcmFtTCxcbiAgICAgICAgICBnOiBwYXJhbUcsXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVJU3Rha2luZyhwYXJhbUcsIHBhcmFtTCwgaW5wdXRTXyksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gYWxsb2NhdGlvblNRRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBsb3RBbGxvY2F0aW9uU1EgPSB7XG4gIGNvbnN0IHBsb3RBbGxvY2F0aW9uU1EgPSBQbG90LnBsb3Qoe1xuICAgIGFzcGVjdFJhdGlvOiAxLFxuICAgIGNvbG9yOiB7XG4gICAgICBsZWdlbmQ6IHRydWUsXG4gICAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICAgIGRvbWFpbjogWzAsIDFdLFxuICAgICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgICBsYWJlbDogXCJBbGxvY2F0aW9uIElcIixcbiAgICB9LFxuICAgIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkxpcXVpZGl0eSBMXCIgfSxcbiAgICB5OiB7XG4gICAgICB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSxcbiAgICAgIGRvbWFpbjogWzEuMDUsIC0wLjA1XSxcbiAgICAgIGxhYmVsOiBcIlN0YWtlIEdcIixcbiAgICB9LFxuICAgIGZ4OiB7IGxhYmVsOiBudWxsIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QuZnJhbWUoKSxcbiAgICAgIFBsb3QucmVjdChhbGxvY2F0aW9uU1FEYXRhLCB7XG4gICAgICAgIHgxOiBkID0+IGQubCAtIDAuMDUsXG4gICAgICAgIHgyOiBkID0+IGQubCArIDAuMDUsXG4gICAgICAgIHkxOiBkID0+IGQuZyAtIDAuMDUsXG4gICAgICAgIHkyOiBkID0+IGQuZyArIDAuMDUsXG4gICAgICAgIGZ4OiBcImtleVwiLFxuICAgICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgICB9KSxcbiAgICAgIFBsb3QudGV4dChhbGxvY2F0aW9uU1FEYXRhLCB7XG4gICAgICAgIHg6IFwibFwiLFxuICAgICAgICB5OiBcImdcIixcbiAgICAgICAgZng6IFwia2V5XCIsXG4gICAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICAgKSxcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICAgKSxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIGQzLnNlbGVjdChwbG90QWxsb2NhdGlvblNRKVxuICAgIC5zZWxlY3QoXCJnW2FyaWEtbGFiZWw9J3ktYXhpcyBsYWJlbCddXCIpXG4gICAgLnNlbGVjdChcInRleHRcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGNoYW5nZVRyYW5zbGF0aW9uKDAsIDEwKSk7XG5cbiAgcmV0dXJuIHBsb3RBbGxvY2F0aW9uU1E7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJhbGxvY2F0aW9uUG9vbERhdGEgPSB7XG4gIGNvbnN0IGFsbG9jYXRpb25Qb29sRGF0YSA9IFtdO1xuICBmb3IgKGxldCBwYXJhbUcgPSAwOyBwYXJhbUcgPCAxLjAxOyBwYXJhbUcgKz0gMC4xKSB7XG4gICAgZm9yIChsZXQgcGFyYW1MID0gMDsgcGFyYW1MIDwgMS4wMTsgcGFyYW1MICs9IDAuMSkge1xuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcbiAgICAgICAgYWxsb2NhdGlvblBvb2xEYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCLwnZeU8J2XmiBQb29sIEFsbG9jYXRpb25cIixcbiAgICAgICAgICBsOiBwYXJhbUwsXG4gICAgICAgICAgZzogcGFyYW1HLFxuICAgICAgICAgIHZhbHVlOiBjb21wdXRlSVBvb2wocGFyYW1HLCBwYXJhbUwsIGlucHV0V2VpZ2h0QUcpLFxuICAgICAgICB9KTtcbiAgICAgICAgYWxsb2NhdGlvblBvb2xEYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCLwnZeU8J2XpCBQb29sIEFsbG9jYXRpb25cIixcbiAgICAgICAgICBsOiBwYXJhbUwsXG4gICAgICAgICAgZzogcGFyYW1HLFxuICAgICAgICAgIHZhbHVlOiBjb21wdXRlSVBvb2wocGFyYW1HLCBwYXJhbUwsIHBhcmFtV2VpZ2h0QVEpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFsbG9jYXRpb25Qb29sRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBsb3RBbGxvY2F0aW9uUG9vbCA9IHtcbiAgY29uc3QgcGxvdEFsbG9jYXRpb25Qb29sID0gUGxvdC5wbG90KHtcbiAgICBhc3BlY3RSYXRpbzogMSxcbiAgICBjb2xvcjoge1xuICAgICAgbGVnZW5kOiB0cnVlLFxuICAgICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgICBkb21haW46IFswLCAxXSxcbiAgICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgICAgbGFiZWw6IFwiQWxsb2NhdGlvbiBJXCIsXG4gICAgfSxcbiAgICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJMaXF1aWRpdHkgTFwiIH0sXG4gICAgeToge1xuICAgICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgICBkb21haW46IFsxLjA1LCAtMC4wNV0sXG4gICAgICBsYWJlbDogXCJTdGFrZSBHXCIsXG4gICAgfSxcbiAgICBmeDogeyBsYWJlbDogbnVsbCB9LFxuICAgIG1hcmtzOiBbXG4gICAgICBQbG90LmZyYW1lKCksXG4gICAgICBQbG90LnJlY3QoYWxsb2NhdGlvblBvb2xEYXRhLCB7XG4gICAgICAgIHgxOiBkID0+IGQubCAtIDAuMDUsXG4gICAgICAgIHgyOiBkID0+IGQubCArIDAuMDUsXG4gICAgICAgIHkxOiBkID0+IGQuZyAtIDAuMDUsXG4gICAgICAgIHkyOiBkID0+IGQuZyArIDAuMDUsXG4gICAgICAgIGZ4OiBcImtleVwiLFxuICAgICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgICB9KSxcbiAgICAgIFBsb3QudGV4dChhbGxvY2F0aW9uUG9vbERhdGEsIHtcbiAgICAgICAgeDogXCJsXCIsXG4gICAgICAgIHk6IFwiZ1wiLFxuICAgICAgICBmeDogXCJrZXlcIixcbiAgICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgICApLFxuICAgICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxuICAgICAgICApLFxuICAgICAgfSksXG4gICAgXSxcbiAgfSk7XG5cbiAgZDMuc2VsZWN0KHBsb3RBbGxvY2F0aW9uUG9vbClcbiAgICAuc2VsZWN0KFwiZ1thcmlhLWxhYmVsPSd5LWF4aXMgbGFiZWwnXVwiKVxuICAgIC5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigwLCAxMCkpO1xuXG4gIHJldHVybiBwbG90QWxsb2NhdGlvblBvb2w7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ0cmVhc3VyeURhdGEgPSB7XG4gIGNvbnN0IHRyZWFzdXJ5RGF0YSA9IFtdO1xuICBmb3IgKGxldCBwYXJhbUcgPSAwOyBwYXJhbUcgPCAxLjAxOyBwYXJhbUcgKz0gMC4wNSkge1xuICAgIGZvciAobGV0IHBhcmFtTCA9IDA7IHBhcmFtTCA8IDEuMDE7IHBhcmFtTCArPSAwLjA1KSB7XG4gICAgICBpZiAocGFyYW1HICsgcGFyYW1MIDwgMS4wMSkge1xuICAgICAgICB0cmVhc3VyeURhdGEucHVzaCh7XG4gICAgICAgICAga2V5OiBcIklfVFwiLFxuICAgICAgICAgIGw6IHBhcmFtTCxcbiAgICAgICAgICBnOiBwYXJhbUcsXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVUcmVhc3VyeShwYXJhbUcsIHBhcmFtTCksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gdHJlYXN1cnlEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTA0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgYXNwZWN0UmF0aW86IDEsXG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIGRvbWFpbjogWzAsIDFdLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBcIkFsbG9jYXRpb24gSVwiLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJMaXF1aWRpdHkgTFwiIH0sXG4gIHk6IHtcbiAgICB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSxcbiAgICBkb21haW46IFsxLjAyNSwgLTAuMDI1XSxcbiAgICBsYWJlbDogXCJTdGFrZSBHXCIsXG4gIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdCh0cmVhc3VyeURhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQubCAtIDAuMDI1LFxuICAgICAgeDI6IGQgPT4gZC5sICsgMC4wMjUsXG4gICAgICB5MTogZCA9PiBkLmcgLSAwLjAyNSxcbiAgICAgIHkyOiBkID0+IGQuZyArIDAuMDI1LFxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dCh0cmVhc3VyeURhdGEsIHtcbiAgICAgIHg6IFwibFwiLFxuICAgICAgeTogXCJnXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0Q2kwJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0TGlxU2hhcGUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREZWx0YUNpJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RXQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREZWx0YUJhckNpJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RGVsdGFCYXJDbnVsbCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dERlbHRhQScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dERlbHRhQ2luaXRpYWwnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBVmFsdWUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBU3VwcGx5JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0UHJlc2VudFRvbm5lcycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dERlbHRhVG9ubmVzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0QWknKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRHaScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEFWYWx1ZV8nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBU3VwcGx5XycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dExpcXVpZFRvbm5lcycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEFCdXJudCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFAwJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0VCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dFNfJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0V2VpZ2h0QUcnKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/whitepaper\.klima\.leodesouza\.net");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>