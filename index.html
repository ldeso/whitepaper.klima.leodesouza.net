<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="The Dark Sole Enterprise Ltd ds@darksole.vip with contributions from the Klima and Carbonmark teams">

<title>Klima 2.0</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./brand/favicon.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-60e100c6da31042f5888afdb26ee89da.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link rel="icon" type="image/png" sizes="96x96" href="./brand/favicon-96x96.png">
<link rel="shortcut icon" href="./brand/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="./brand/apple-touch-icon.png">

  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Klima 2.0">
<meta property="og:description" content="This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.
The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.
The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.
This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.">
<meta property="og:image" content="https://whitepaper.klima.leodesouza.net/brand/klimaprotocol.svg">
<meta property="og:image:alt" content="Klima Protocol Logo.">
<meta name="twitter:title" content="Klima 2.0">
<meta name="twitter:description" content="This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.
The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.
The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.
This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.">
<meta name="twitter:image" content="https://whitepaper.klima.leodesouza.net/brand/klimaprotocol.svg">
<meta name="twitter:image:alt" content="Klima Protocol Logo.">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-prologue" id="toc-sec-prologue" class="nav-link active" data-scroll-target="#sec-prologue"><span class="header-section-number">1</span> Prologue</a></li>
  <li><a href="#sec-klima-2.0" id="toc-sec-klima-2.0" class="nav-link" data-scroll-target="#sec-klima-2.0"><span class="header-section-number">2</span> Klima&nbsp;2.0</a>
  <ul class="collapse">
  <li><a href="#sec-high-level-architecture" id="toc-sec-high-level-architecture" class="nav-link" data-scroll-target="#sec-high-level-architecture"><span class="header-section-number">2.1</span> High-Level Architecture</a></li>
  <li><a href="#sec-carbon-inventory" id="toc-sec-carbon-inventory" class="nav-link" data-scroll-target="#sec-carbon-inventory"><span class="header-section-number">2.2</span> Carbon Inventory</a></li>
  <li><a href="#sec-tokens" id="toc-sec-tokens" class="nav-link" data-scroll-target="#sec-tokens"><span class="header-section-number">2.3</span> Tokens</a></li>
  <li><a href="#sec-participants" id="toc-sec-participants" class="nav-link" data-scroll-target="#sec-participants"><span class="header-section-number">2.4</span> Participants</a></li>
  <li><a href="#sec-protocol-design-principles" id="toc-sec-protocol-design-principles" class="nav-link" data-scroll-target="#sec-protocol-design-principles"><span class="header-section-number">2.5</span> Protocol Design Principles</a></li>
  </ul></li>
  <li><a href="#sec-core-protocol-mechanics" id="toc-sec-core-protocol-mechanics" class="nav-link" data-scroll-target="#sec-core-protocol-mechanics"><span class="header-section-number">3</span> Core Protocol Mechanics</a>
  <ul class="collapse">
  <li><a href="#sec-time-locking-mechanics" id="toc-sec-time-locking-mechanics" class="nav-link" data-scroll-target="#sec-time-locking-mechanics"><span class="header-section-number">3.1</span> Time-locking Mechanics</a></li>
  <li><a href="#sec-carbon-inventory-mechanics" id="toc-sec-carbon-inventory-mechanics" class="nav-link" data-scroll-target="#sec-carbon-inventory-mechanics"><span class="header-section-number">3.2</span> Carbon Inventory Mechanics</a></li>
  <li><a href="#sec-liquidity-mechanics" id="toc-sec-liquidity-mechanics" class="nav-link" data-scroll-target="#sec-liquidity-mechanics"><span class="header-section-number">3.3</span> Liquidity Mechanics</a></li>
  <li><a href="#sec-interactive-model" id="toc-sec-interactive-model" class="nav-link" data-scroll-target="#sec-interactive-model"><span class="header-section-number">3.4</span> Interactive Model</a></li>
  </ul></li>
  <li><a href="#sec-klima-2.0-token-distribution" id="toc-sec-klima-2.0-token-distribution" class="nav-link" data-scroll-target="#sec-klima-2.0-token-distribution"><span class="header-section-number">4</span> Klima&nbsp;2.0 Token Distribution</a>
  <ul class="collapse">
  <li><a href="#sec-planned-allocations" id="toc-sec-planned-allocations" class="nav-link" data-scroll-target="#sec-planned-allocations"><span class="header-section-number">4.1</span> Planned Allocations</a></li>
  <li><a href="#sec-programmatic-incentive-curve" id="toc-sec-programmatic-incentive-curve" class="nav-link" data-scroll-target="#sec-programmatic-incentive-curve"><span class="header-section-number">4.2</span> Programmatic Incentive Curve</a></li>
  <li><a href="#sec-share-of-k2-incentives" id="toc-sec-share-of-k2-incentives" class="nav-link" data-scroll-target="#sec-share-of-k2-incentives"><span class="header-section-number">4.3</span> Share of K2 Incentives</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="index.md"><i class="bi bi-file-text"></i>Markdown (for LLMs)</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Klima 2.0</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p></p><p>The Dark Sole Enterprise Ltd <a href="mailto:ds@darksole.vip" class="email">ds@darksole.vip</a><br>
with contributions from the Klima and Carbonmark teams</p> <p></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">29 Jan 2026 (Version 1.49)</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Notice to Readers</div>
    <p>This document describes a proposed technical and economic model developed by 01X as part of exploratory research conducted in connection with the Klima ecosystem. It reflects conceptual design work informed by prior learnings from KlimaDAO and related on-chain carbon market initiatives.<br>
    The model presented herein is illustrative only and is intended to explore one possible approach to scaling carbon market infrastructure using blockchain-based systems. It does not represent a commitment to implement any specific architecture, mechanism, parameter, or economic outcome.<br>
    The Klima Protocol is expected to deploy a production system for on-chain carbon market infrastructure in or around February 2026. At that time, a separate implementation whitepaper will be released describing the deployed system, and the corresponding smart contract code will be made publicly available as open-source software.<br>
    This document should not be relied upon as a description of the final protocol, its operation, or its economics. It does not constitute an offer, solicitation, investment advice, or a representation regarding the legal, regulatory, or economic characteristics of any future deployment.</p>
  </div>
</div>


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="brand/klimaprotocol.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%" alt="Klima Protocol Logo."></p>
</figure>
</div>
<p><strong>Copyright Notice</strong></p>
<p>This document represents original work by dark_sole <a href="mailto:ds@darksole.vip" class="email">ds@darksole.vip</a>. While contributions from others are gratefully acknowledged, all intellectual property rights remain with the author. The models, algorithms, processes, products, methodologies, and concepts described herein are licenced exclusively for commercial use by the Klima Protocol. No other party may implement, copy, modify, or derive works from these materials without explicit written permission from the author.</p>
<p>© 2025 dark_sole. All rights reserved.</p>
<section id="sec-prologue" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="sec-prologue"><span class="header-section-number">1</span> Prologue</h2>
<p>Klima&nbsp;2.0 is an autonomous, rules-based coordination protocol designed to support the retirement of carbon credits through continuous and transparent execution terms.</p>
<p>It is not a financial product, investment vehicle, or asset management system, but a piece of market infrastructure that enables carbon supply and retirement demand to interact under predefined conditions.</p>
<p>The protocol operates through a dual-token architecture that facilitates coordination without discretionary control: <strong>kVCM</strong> functions as the internal unit of account and pricing reference for protocol-facilitated carbon retirement, while <strong>K2</strong> provides signalling inputs related to capacity. Together, these tokens inform protocol parameters through deterministic smart-contract logic. This architecture enables the protocol to:</p>
<ul>
<li><p>define execution rates and intake eligibility for carbon credits against transparent, predefined rules;</p></li>
<li><p>make acquired credits available exclusively for irreversible retirement;</p></li>
<li><p>coordinate liquidity provision and participation incentives required for continuous operation.</p></li>
</ul>
<p>Participant actions such as locking tokens, signalling preferences, or providing liquidity serve inputs into a coordination mechanism that adjusts protocol parameters within predefined bounds. These inputs do not confer ownership rights, redemption rights, or claims on protocol-held carbon, nor do they constitute discretionary management of assets.</p>
<p>The protocol consists of three interdependent functional layers:</p>
<ul>
<li><p>a carbon inventory layer that holds credits solely for the purpose of facilitating retirement;</p></li>
<li><p>a liquidity layer that supports access and withdrawal from the system through external markets; and</p></li>
<li><p>a coordination layer that aggregates participant signals to inform protocol parameters.</p></li>
</ul>
<p>These layers are designed to operate together as a self-contained system, adjusting to observable supply and retirement demand without reliance on external oracles, manual intervention, or fee-extractive intermediaries.</p>
<p>Klima&nbsp;2.0 abstracts complex carbon market interactions into a transparent and auditable execution framework, enabling participants to interact with carbon retirement infrastructure directly, programmatically, and on equal terms.</p>
<p>Any economic effects arising from protocol activity result from predefined rules and market interaction, rather than from asset ownership, portfolio management, or profit extraction.</p>
</section>
<section id="sec-klima-2.0" class="level2 page-columns page-full" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="sec-klima-2.0"><span class="header-section-number">2</span> Klima&nbsp;2.0</h2>
<p>KlimaDAO launched in 2021 on the Polygon blockchain as an early experiment in applying tokenisation and onchain liquidity to voluntary carbon markets. The initial design centred on the KLIMA token and a treasury-based mechanism intended to bootstrap liquidity and participation in a nascent onchain carbon ecosystem.</p>
<p>That first iteration played a meaningful role in demonstrating that carbon credits could be represented, transferred, and retired using blockchain infrastructure. It also catalysed the development of a broader ecosystem of tools and services, including integrations with multiple carbon registries, marketplaces and point-of-sale interfaces, APIs for third-party applications, and direct onchain issuance by project developers.</p>
<p>Over time, it became clear that the original architecture was not well suited to serving large-scale, enterprise carbon buyers or to supporting continuous, rules-based market operation without manual intervention. In particular, treasury-centric designs introduced complexity, opacity, and governance challenges that limited scalability and operational clarity.</p>
<p>Klima&nbsp;2.0 is a ground-up redesign informed by these lessons. Rather than relying on treasury management or discretionary allocation, the new protocol is structured as neutral, non-extractive market infrastructure focused exclusively on facilitating carbon retirement through transparent pricing, programmatic settlement, and open participation.</p>
<p>The Klima&nbsp;2.0 protocol replaces treasury-backed mechanisms with a rules-based coordination model that uses protocol-native tokens to parameterise execution rates, intake capacity, and participation incentives. Carbon credits handled by the protocol are acquired solely to fulfil retirement demand and are not held, traded, or managed for financial gain.</p>
<p>This shift reflects a deliberate move away from capital-centric designs toward infrastructure that prioritises auditability, predictability, and long-term operational resilience. Klima&nbsp;2.0 is intended to function as a shared execution layer for carbon markets, enabling suppliers, buyers, and integrators to interact under predefined conditions without reliance on discretionary intermediaries.</p>
<section id="sec-high-level-architecture" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="sec-high-level-architecture"><span class="header-section-number">2.1</span> High-Level Architecture</h3>
<p>Klima&nbsp;2.0 operates using two protocol-native tokens, <strong>kVCM</strong> and <strong>K2</strong>, which together enable rules-based coordination and participation within the system. These tokens do not confer ownership rights, redemption rights, or claims on protocol-handled carbon, and do not represent investment interests.</p>
<p>The <strong>kVCM</strong> and <strong>K2</strong> tokens are used in three interdependent functional layers that together support continuous, non-discretionary operation:</p>
<ol type="1">
<li><p><strong>Carbon Inventory Layer</strong>:</p>
<ul>
<li><p>Accumulates carbon credits by minting <strong>kVCM</strong>.</p></li>
<li><p>Sells carbon retirement certificates by burning <strong>kVCM</strong>.</p></li>
<li><p>Sets carbon execution rates based on predefined rules.</p></li>
</ul>
<p>Carbon credits handled by the protocol cannot be withdrawn, transferred, or resold. They may only be retired.</p></li>
<li><p><strong>Liquidity Layer</strong>:</p>
<ul>
<li><p><strong>kVCM</strong> and <strong>K2</strong> token holders are able to pair their tokens together (or, in the case of <strong>kVCM</strong>, with USDC) in a standard liquidity pool to provide liquidity and generate fees on trades executed through the pool.</p></li>
<li><p>Liquidity providers may stake their liquidity provider tokens for a fixed time period of their choice, making them eligible to receive a share of the <strong>kVCM</strong> and <strong>K2</strong> incentives.</p></li>
</ul></li>
<li><p><strong>Coordination Layer</strong>:</p>
<ul>
<li><p><strong>kVCM</strong> holders may <strong>time-lock</strong> their <strong>kVCM</strong> for a fixed time period of their choice, making them eligible to receive <strong>kVCM</strong> base accrual, <strong>K2</strong> incentives, and to allocate their <strong>kVCM</strong> to carbon classes – which increases the weight of these carbon classes in the inventory.</p></li>
<li><p><strong>K2</strong> holders may <strong>user-lock</strong> their <strong>K2</strong> for at least 48 hours, making them eligible to receive <strong>kVCM</strong> and <strong>K2</strong> incentives, and to allocate their <strong>K2</strong> to carbon classes – which reduces the difference between the execution terms on carbon intake and retirements for these carbon classes.</p></li>
<li><p>Time-locked <strong>kVCM</strong> holders participate in protocol coordination alongside liquidity providers with liquidity staked in the <strong>kVCM</strong>/<strong>K2</strong> liquidity pool.</p></li>
</ul></li>
</ol>
<p>These layers operate together as a self-contained system that responds only to its own observable state, without reliance on external oracles or centralised intervention.</p>
</section>
<section id="sec-carbon-inventory" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="sec-carbon-inventory"><span class="header-section-number">2.2</span> Carbon Inventory</h3>
<p>The protocol’s carbon inventory accumulates and retires carbon. It is driven by parameters determined by its rules-based smart contracts, and user activities.</p>
<div id="fig-carbon-inventory" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 Carbon Inventory.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-inventory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/carbon-inventory.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-inventory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Klima&nbsp;2.0 Carbon Inventory.
</figcaption>
</figure>
</div>
<p>Carbon credits are acquired from suppliers, and consumed by retirement buyers. Carbon credits are grouped by predefined classifications called <strong>carbon classes</strong>.</p>
<p>Aggregate token holder allocations collectively set the parameters for the execution rates of <strong>each class</strong>, for both suppliers and retirees, by defining:</p>
<ul>
<li><p>Inventory weighting.</p></li>
<li><p>Capacity.</p></li>
</ul>
<p>Thus the Protocol is driven in response to its own native token allocations, acting as rules-based carbon market infrastructure to connect available supply with retirement demand. It is able to do so without using oracles or external inputs, and without discretionary allocation, resale, or optimisation of inventory.</p>
</section>
<section id="sec-tokens" class="level3 page-columns page-full" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="sec-tokens"><span class="header-section-number">2.3</span> Tokens</h3>
<p>Locking or staking the protocol’s tokens allows participants to signal preferences within the system, and may make them eligible to receive protocol incentives.</p>
<p>Holding or locking protocol tokens does not represent ownership of protocol carbon assets, profit participation, or direct exposure to carbon price movements.</p>
<p>Together, <strong>kVCM</strong> and <strong>K2</strong> enable the protocol to operate as neutral, non-extractive infrastructure, coordinating participation and execution without discretionary management.</p>
<section id="sec-kvcm" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="sec-kvcm"><span class="header-section-number">2.3.1</span> kVCM</h4>
<p><strong>kVCM</strong> is the protocol’s primary utility token. Its supply is <u>not capped</u>: it grows when new carbon is supplied to the protocol, and contracts when it is retired.</p>
<ul>
<li><p>When <strong>time-locked</strong>:</p>
<ul>
<li><p>It may be allocated to carbon classes for inventory weighting.</p></li>
<li><p>It receives <strong>kVCM</strong> base accrual and <strong>K2</strong> incentives.</p></li>
<li><p>In aggregate, time-locks determine the rate of incentive issuance.</p></li>
</ul></li>
<li><p><strong>Transactional</strong> usage:</p>
<ul>
<li><p><strong>Mint</strong>: when suppliers deliver carbon to the protocol.</p></li>
<li><p><strong>Burn</strong>: when credits are retired from the protocol.</p></li>
</ul></li>
<li><p>When <strong>staked</strong> in liquidity pools it is also eligible for <strong>kVCM</strong> and <strong>K2</strong> incentives, based on the duration of the stake and the position’s relative share of the pool.</p></li>
</ul>
<div id="fig-token-utility" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token utility.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-utility.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Token utility.
</figcaption>
</figure>
</div>
</section>
<section id="sec-k2" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="sec-k2"><span class="header-section-number">2.3.2</span> K2</h4>
<p><strong>K2</strong> is a <u>fixed-supply</u> token distributed programmatically over time.</p>
<ul>
<li><p>When <strong>user-locked</strong>:</p>
<ul>
<li><p>It may be allocated to carbon classes to reduce the difference between execution terms on carbon intake and retirements.</p></li>
<li><p>It receives <strong>kVCM</strong> and <strong>K2</strong> incentives.</p></li>
<li><p>In aggregate, user-locks influence the rates of incentive issuance.</p></li>
</ul></li>
<li><p>When <strong>staked</strong> in the <strong>kVCM</strong>/<strong>K2</strong> liquidity pool it is also eligible for <strong>kVCM</strong> and <strong>K2</strong> incentives, based on the duration of the stake and the position’s relative share of the pool.</p></li>
</ul>
</section>
<section id="sec-utility-functions" class="level4" data-number="2.3.3">
<h4 data-number="2.3.3" class="anchored" data-anchor-id="sec-utility-functions"><span class="header-section-number">2.3.3</span> Utility Functions</h4>
<p>The <strong>kVCM</strong> token has <u>two</u> utility functions which are not independent:</p>
<div id="fig-kvcm-utility" class="quarto-float quarto-figure quarto-figure-center anchored" alt="kVCM utility functions.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kvcm-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/kvcm-utility.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kvcm-utility-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: <strong>kVCM</strong> utility functions.
</figcaption>
</figure>
</div>
<ol type="1">
<li><p><strong>Time lock</strong>: The <strong>kVCM</strong> token is locked for a specific period of time which determines a <strong>kVCM</strong> ‘base accrual’ rate. This cannot be amended.</p></li>
<li><p><strong>Execution rate allocation</strong>: Collective signalling of carbon classes via <strong>kVCM</strong> allocations determines determines the protocol’s execution rate for carbon intake and retirement, expressed in <strong>kVCM</strong> units. These parameters govern how the protocol issues or burns <strong>kVCM</strong> when carbon is supplied or retired. Allocations may be updated over time.</p></li>
</ol>
<p>The <strong>K2</strong> token also has <u>two</u> utility functions:</p>
<ol type="1">
<li><p><strong>User lock</strong>: The <strong>K2</strong> token remains locked for at least 24 hours.</p></li>
<li><p><strong>Capacity allocation</strong>: Collective selection of carbon classes via <strong>K2</strong> allocations determines the protocol’s execution capacity for carbon intake and retirement operations for a given class. Higher capacity allocations increase the system’s ability to process additional carbon activity without materially altering the execution rate, as defined by <strong>kVCM</strong> allocations.</p></li>
</ol>
<p>Both tokens support the operation of the infrastructure, with <strong>kVCM</strong> informing execution rateios, and the <strong>K2</strong> token modulating capacity.</p>
</section>
<section id="sec-base-accrual-incentives" class="level4" data-number="2.3.4">
<h4 data-number="2.3.4" class="anchored" data-anchor-id="sec-base-accrual-incentives"><span class="header-section-number">2.3.4</span> Base Accrual and Incentives</h4>
<p>The protocol issues tokens to participants who provide services necessary for system operation.</p>
<ol type="1">
<li><p><strong>kVCM Base Accrual</strong></p>
<p>A base accrual of <strong>kVCM</strong> tokens is continously emitted to:</p>
<ul>
<li>Time-locked <strong>kVCM</strong>.</li>
</ul></li>
<li><p><strong>kVCM Incentives</strong></p>
<p><strong>kVCM</strong> incentives are continuously emitted to:</p>
<ul>
<li><p>User-locked <strong>K2</strong>.</p></li>
<li><p>Both <strong>kVCM</strong> and <strong>K2</strong> liquidity providers.</p></li>
</ul>
<p>The number of <strong>kVCM</strong> tokens emitted as <strong>kVCM</strong> incentives is proportional to (but never higher than) the number of <strong>kVCM</strong> tokens emitted as base accrual.</p></li>
<li><p><strong>K2 Incentives</strong></p>
<p>Depending on overall system balances, the supply of <strong>K2</strong> tokens is programatically allocated at various rates to:</p>
<ul>
<li><p>Time-locked <strong>kVCM</strong>.</p></li>
<li><p>User-locked <strong>K2</strong>.</p></li>
<li><p>Both <strong>kVCM</strong> and <strong>K2</strong> liquidity providers.</p></li>
</ul></li>
</ol>
</section>
<section id="sec-token-initialisation" class="level4 page-columns page-full" data-number="2.3.5">
<h4 data-number="2.3.5" class="anchored" data-anchor-id="sec-token-initialisation"><span class="header-section-number">2.3.5</span> Token Initialisation</h4>
<p>There is an initial issuance of tokens at the genesis of Klima&nbsp;2.0. All future emissions are distributed autonomously via carbon swaps and incentives.</p>
<div id="tbl-token-summary" class="column-body-outset quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[10,15,75]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-token-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Token</th>
<th style="text-align: left;">Supply</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>kVCM</strong></td>
<td style="text-align: left;">20 million</td>
<td style="text-align: left;"><ul>
<li>Supply expands and contracts programmatically in response to carbon intake and retirement activity.</li>
<li>New tokens are emitted continuously as base accrual and incentives.</li>
<li>A portion of the initial supply is allocated to existing KLIMA holders.</li>
</ul></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>K2</strong></td>
<td style="text-align: left;">100 million</td>
<td style="text-align: left;"><ul>
<li>Fixed supply.</li>
<li>Distributed programatically over time, with a portion allocated to existing KLIMA holders.</li>
</ul></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-token-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Token Summary
</figcaption>
</figure>
</div>
</section>
</section>
<section id="sec-participants" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="sec-participants"><span class="header-section-number">2.4</span> Participants</h3>
<ol type="1">
<li><p><strong>Carbon Suppliers &amp; Retirees</strong></p>
<p>Participants may supply or retire eligible, tokenised carbon credits to the protocol at quoted execution rates. Supplied credits are handled solely for retirement and cannot be withdrawn, transferred, resold or otherwise arbitraged.</p>
<p><strong>Carbon inventory</strong>: Indicative excution rates for suppliers and retirees are continuously updated based on protocol state.</p></li>
<li><p><strong>Liquidity Providers</strong></p>
<p>Participants may provide liquidity in supported token pairs to facilitate entry and exit from the system. Liquidity provision supports continuous execution and is incentivised according to predefined protocol rules.</p>
<p><strong>Staked liquidity</strong>: Protocol incentives may be issued for participants providing liquidity to support system operation.</p></li>
<li><p><strong>Coordinators</strong></p>
<p>Participants may influence execution conditions by allocating <strong>kVCM</strong> and <strong>K2</strong> tokens within predefined protocol parameters.</p>
<p><strong>Time locks &amp; user locks</strong>: Protocol incentives may be issued for those contributing activities that coordinate the protocol and signal long-term participation.</p></li>
</ol>
</section>
<section id="sec-protocol-design-principles" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="sec-protocol-design-principles"><span class="header-section-number">2.5</span> Protocol Design Principles</h3>
<ol type="1">
<li><p><strong>Infrastructure, Not Extraction</strong>:</p>
<p>Klima&nbsp;2.0 is designed as shared market infrastructure rather than an extractive financial product. The protocol does not charge fees, take hidden spreads, or operate profit-taking mechanisms for any sponsor, foundation, or investor. All protocol behaviour is rules-based and applies uniformly to all participants, with no privileged economic positions or revenue capture layers.</p>
<p><strong>Design intent</strong>: Reduce opaque intermediation and hidden margins common in carbon markets, not replace them with a new rent-seeking intermediary.</p></li>
<li><p><strong>Consumption-only Carbon Access</strong>:</p>
<p>Carbon credits handled by the protocol are not exposed for resale, speculation, or secondary trading. Once accepted by the protocol, credits may only be accessed for irreversible retirement through protocol-defined processes.</p>
<p><strong>Design intent</strong>: Align the system with carbon’s end use (retirement), rather than treating credits as financial instruments.</p></li>
<li><p><strong>Coordination Through Signalling</strong>:</p>
<p>Protocol tokens do not represent ownership of carbon, claims on protocol-held assets, or entitlement to surplus value. Instead, tokens function as signalling and coordination inputs that influence protocol parameters&nbsp;(such as execution conditions and capacity) within predefined bounds.</p>
<p><strong>Design intent</strong>: Enable decentralised coordination in a complex and competitive environment.</p></li>
<li><p><strong>Autonomous, Rules-based Operation</strong></p>
<p>All protocol behaviour is governed by deterministic smart contracts. Once deployed, the system operates autonomously and does not rely on discretionary decisions by any individual, committee, or organisation.</p>
<p><strong>Design intent</strong>: Build a trustless, auditable system, that is not based on subjective, opaque intervention.</p></li>
<li><p><strong>Equal Access and Uniform Treatment</strong></p>
<p>All participants interact with the protocol on identical terms. There are no side agreements, preferential execution paths, differentiated rights, or bespoke economic arrangements. Protocol rules apply uniformly to all users, including the protocol’s creators and affiliated entities.</p>
<p><strong>Design intent</strong>: Ensure credibility, neutrality, and resistance to capture.</p></li>
<li><p><strong>Market-driven Outcomes, Not Managed returns</strong></p>
<p>Any economic effects associated with protocol participation arise solely from predefined rules and participant interaction with the system. The protocol does not manage assets on behalf of users, target returns, or seek to optimise outcomes for any class of participant.</p>
<p><strong>Design intent</strong>: Enable transparent market coordination without positioning the protocol as an asset manager or investment vehicle</p></li>
</ol>
</section>
</section>
<section id="sec-core-protocol-mechanics" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="sec-core-protocol-mechanics"><span class="header-section-number">3</span> Core Protocol Mechanics</h2>
<p>From this section we refer to <strong>kVCM</strong> tokens as <strong>A</strong>, <strong>K2</strong> tokens as <strong>G</strong>, USDC tokens as <strong>Q</strong>, carbon credits as <strong>C</strong>, and carbon retirement certificates as <strong>C*</strong>.</p>
<p>Three types of mechanics enable the Klima Protocol to find equilibrium through continuous, rule-based feedback mechanisms representing system state&nbsp;(supply, demand, coordinator allocations). There is no centralised management entity with discretionary powers, or fees that can be turned on.</p>
<ol type="1">
<li><p><strong>Time-locking mechanics</strong>: <strong>A</strong> token holders can time-lock their tokens until a set date to have the ability to select carbon classes for inventory weighting.</p>
<ul>
<li>The collective time locks define the base accrual curve.</li>
</ul></li>
<li><p><strong>Carbon inventory mechanics</strong>: the protocol swaps <strong>A</strong> for carbon credits <strong>C</strong>&nbsp;(in) or carbon retirement certificates <strong>C*</strong>&nbsp;(out).</p>
<ul>
<li>Both allocations of time-locked <strong>A</strong> tokens and user-locked <strong>G</strong> tokens are used in the protocol: allocations of <strong>A</strong> determine the execution rates of carbon, and allocations of <strong>G</strong> determine capacity.</li>
</ul></li>
<li><p><strong>Liquidity mechanics</strong>: External liquidity pools enable conversion between <strong>kVCM</strong> and supported settlement assets. Liquidity provision supports system availability and may make participants eligible for protocol incentives.</p>
<ul>
<li><p><span class="overline"><strong>AG</strong></span> liquidity pool: Native token swap <strong>A</strong> and <strong>G</strong>.</p></li>
<li><p><span class="overline"><strong>AQ</strong></span> liquidity pool: The asset token <strong>A</strong> with USDC <strong>Q</strong>.</p></li>
</ul></li>
</ol>
<p>The Klima system enables each participant to contribute to various aspects of the model, according to their own interests and preferences. This, in conjunction with the autonomous model, enables the protocol to fulfill continuous carbon retirement activity within the carbon markets.</p>
<section id="sec-time-locking-mechanics" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="sec-time-locking-mechanics"><span class="header-section-number">3.1</span> Time-locking Mechanics</h3>
<p>Time-locking <strong>A</strong> tokens represents a commitment to protocol participation for a fixed duration. Lock durations are standardised at 90 days increments and expire on a rolling schedule. There are always 40 durations, extending out to approximately 10 years.</p>
<ul>
<li><p><strong>Discount curve</strong>: Aggregate time-locking determines the shape of the discount curve of the <strong>A</strong> token.</p></li>
<li><p><strong>Incentives</strong>: Time-locked <strong>A</strong> tokens receive base accrual. Base accrual is calculated daily based on time-locked positions.</p></li>
<li><p><strong>Locks</strong>: Time-locked tokens and any associated base accrual are released only upon time-lock expiration. Early exit is not possible.</p></li>
</ul>
<p><strong>G</strong> tokens are <u>not</u> involved in the time-locking mechanics. The discount curve is agnostic to carbon class although only time-locked <strong>A</strong> token holders can allocate their token to carbon classes for inventory weighting.</p>
<section id="sec-base-accrual" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="sec-base-accrual"><span class="header-section-number">3.1.1</span> Base Accrual</h4>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">S</span>: Total time-locked <strong>A</strong> tokens expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
<li><p><span class="math inline">S_t</span>: Total <strong>A</strong> tokens time-locked in bucket <span class="math inline">t</span>, expressed as a proportion of the outstanding supply of <strong>A</strong>, where <span class="math inline">{\sum S_t = S}</span>, and <span class="math inline">t</span> is the index of standard durations <span class="math inline">t \in \{1, 2, 3, \dots, 40\}</span>.</p></li>
<li><p><span class="math inline">E_t</span>: Duration expressed in years.</p></li>
</ul>
<p>Calculating curve parameters <span class="math inline">D</span> and <span class="math inline">C</span>:</p>
<p><span id="eq-curve-parameter-d"><span class="math display">
D = \frac{1}{S} \sum_{t=1}^{40} S_t \, E_t
\tag{1}</span></span></p>
<p><span id="eq-curve-parameter-c"><span class="math display">
C = \frac{1}{S} \sum_{t=1}^{40} S_t \, E_t^2
\tag{2}</span></span></p>
<p>The shape of the base accrual curve is produced:</p>
<p><span id="eq-base-accrual-shape"><span class="math display">
\gamma_t = \max \left( \frac{E_t}{D} - \frac{E_t^2}{2 \, C}, \, 0 \right)
\tag{3}</span></span></p>
<p>Normalising <span class="math inline">\gamma_t</span> to <span class="math inline">\hat \gamma_t</span>:</p>
<p><span id="eq-base-accrual-normalised"><span class="math display">
\hat \gamma_t = \frac{\gamma_t}{\sum_{t=1}^{40} \gamma_t}
\tag{4}</span></span></p>
<p>With the cumulative sum of the normalised values expressed as <span class="math inline">\Gamma_t</span>:</p>
<p><span id="eq-base-accrual-normalized-sum"><span class="math display">
\Gamma_t = \sum_{i=1}^t \hat \gamma_i \quad \text{for } t = 1, \dots, 40
\tag{5}</span></span></p>
<p>The base accrual curve <span class="math inline">Z_t</span> is solved:</p>
<p><span id="eq-base-accrual"><span class="math display">
Z_t = (1 - S) \, \frac{\Gamma_t}{E_t}
\tag{6}</span></span></p>
<p>Whereupon, the discount rate <span class="math inline">B_t</span> that forms the discount curve is derived:</p>
<p><span id="eq-discount-rate"><span class="math display">
B_t = \exp(-Z_t \, E_t)
\tag{7}</span></span></p>
<p>The accrual of time-locked <strong>A</strong> tokens is calculated daily and added to the locked balance, hence the daily accrual for each duration is calculated:</p>
<p><span id="eq-daily-accrual"><span class="math display">
Y_t = \exp \left( \frac{Z_t}{365} \right) - 1
\tag{8}</span></span></p>
<p>Hence, any time-locked <strong>A</strong> stake <span class="math inline">S_t</span> will increase daily by <span class="math inline">\Delta S_t</span>:</p>
<p><span id="eq-daily-increase"><span class="math display">
\Delta S_t = S_t \, Y_t
\tag{9}</span></span></p>
<p>With the total <strong>A</strong> tokens created on a daily basis, or ‘growth’, as</p>
<p><span id="eq-daily-growth"><span class="math display">
R = \sum_{t=1}^{40} \Delta S_t
\tag{10}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="626" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 625;"><span id="cb1-626"><a href="#cb1-626" aria-hidden="true" tabindex="-1"></a>viewof inputS <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-4</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb1-627"><a href="#cb1-627" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Time-Locked } S`</span><span class="op">,</span></span>
<span id="cb1-628"><a href="#cb1-628" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-4</span><span class="op">,</span></span>
<span id="cb1-629"><a href="#cb1-629" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.55</span><span class="op">,</span></span>
<span id="cb1-630"><a href="#cb1-630" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a>viewof inputD <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.25</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span> {</span>
<span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Parameter } D`</span><span class="op">,</span></span>
<span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">4.69</span><span class="op">,</span></span>
<span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-base-accrual-example" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-base-accrual-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="646" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 645;"><span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">constAreaLinear</span>(range<span class="op">,</span> area<span class="op">,</span> inputSlope<span class="op">,</span> slopeFactor <span class="op">=</span> <span class="fl">0.007</span>) {</span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (range<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [area]<span class="op">;</span></span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y2 <span class="op">=</span> range<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> slope <span class="op">=</span> slopeFactor <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atanh</span>(inputSlope)<span class="op">;</span></span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> intercept <span class="op">=</span> area <span class="op">/</span> range<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(slope) <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">*</span> intercept <span class="op">/</span> (y2 <span class="op">-</span> y1 <span class="op">-</span> <span class="dv">1</span>)) {</span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yExactShift <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="dv">2</span> <span class="op">*</span> area <span class="op">/</span> slope))<span class="op">;</span></span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yRoundShift <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(yExactShift))<span class="op">;</span></span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (slope <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a>      y1 <span class="op">=</span> y2 <span class="op">-</span> yRoundShift<span class="op">;</span></span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>      y2 <span class="op">=</span> y1 <span class="op">+</span> yRoundShift<span class="op">;</span></span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a>    slope <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(slope) <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> area <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>((y2 <span class="op">-</span> y1)<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a>    intercept <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(slope) <span class="op">*</span> (y2 <span class="op">-</span> y1 <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yConstArea <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> range<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> i <span class="op">-</span> (y1 <span class="op">+</span> y2) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>    yConstArea<span class="op">.</span><span class="fu">push</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> slope <span class="op">*</span> y <span class="op">+</span> intercept))<span class="op">;</span></span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> yConstArea<span class="op">;</span></span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="680" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 679;"><span id="cb3-680"><a href="#cb3-680" aria-hidden="true" tabindex="-1"></a>vecE <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.1</span><span class="op">,</span> <span class="fl">0.25</span>)<span class="op">;</span></span>
<span id="cb3-681"><a href="#cb3-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-682"><a href="#cb3-682" aria-hidden="true" tabindex="-1"></a>scaleE <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(d3<span class="op">.</span><span class="fu">extent</span>(vecE)<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb3-683"><a href="#cb3-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-684"><a href="#cb3-684" aria-hidden="true" tabindex="-1"></a>vecS <span class="op">=</span> <span class="fu">constAreaLinear</span>(vecE<span class="op">,</span> <span class="fl">0.55</span><span class="op">,</span> <span class="fu">scaleE</span>(inputD))<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb3-685"><a href="#cb3-685" aria-hidden="true" tabindex="-1"></a>  x <span class="kw">=&gt;</span> x <span class="op">*</span> inputS <span class="op">/</span> <span class="fl">0.55</span><span class="op">,</span></span>
<span id="cb3-686"><a href="#cb3-686" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb3-687"><a href="#cb3-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-688"><a href="#cb3-688" aria-hidden="true" tabindex="-1"></a>vecReverseCumsumS <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecS<span class="op">.</span><span class="fu">slice</span>()<span class="op">.</span><span class="fu">reverse</span>())<span class="op">.</span><span class="fu">reverse</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="692" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 691;"><span id="cb4-692"><a href="#cb4-692" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dotProduct</span>(v<span class="op">,</span> w) {</span>
<span id="cb4-693"><a href="#cb4-693" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (v<span class="op">.</span><span class="at">length</span> <span class="op">!==</span> w<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb4-694"><a href="#cb4-694" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"Vectors must have the same length"</span>)<span class="op">;</span></span>
<span id="cb4-695"><a href="#cb4-695" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-696"><a href="#cb4-696" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> val<span class="op">,</span> i) <span class="kw">=&gt;</span> acc <span class="op">+</span> val <span class="op">*</span> w[i]<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb4-697"><a href="#cb4-697" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-698"><a href="#cb4-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-699"><a href="#cb4-699" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">weightedArithmeticMean</span>(v<span class="op">,</span> weights) {</span>
<span id="cb4-700"><a href="#cb4-700" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">dotProduct</span>(v<span class="op">,</span> weights) <span class="op">/</span> d3<span class="op">.</span><span class="fu">sum</span>(weights)<span class="op">;</span></span>
<span id="cb4-701"><a href="#cb4-701" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="704" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 703;"><span id="cb5-704"><a href="#cb5-704" aria-hidden="true" tabindex="-1"></a>paramD <span class="op">=</span> <span class="fu">weightedArithmeticMean</span>(vecE<span class="op">,</span> vecS)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="708" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 707;"><span id="cb6-708"><a href="#cb6-708" aria-hidden="true" tabindex="-1"></a>paramC <span class="op">=</span> <span class="fu">weightedArithmeticMean</span>(vecE<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> e <span class="op">*</span> e)<span class="op">,</span> vecS)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="712" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 711;"><span id="cb7-712"><a href="#cb7-712" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeGamma</span>(vecE<span class="op">,</span> paramD<span class="op">,</span> paramC) {</span>
<span id="cb7-713"><a href="#cb7-713" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> twoC <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> paramC<span class="op">;</span></span>
<span id="cb7-714"><a href="#cb7-714" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecE<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> e<span class="op">/</span>paramD <span class="op">-</span> e<span class="op">*</span>e<span class="op">/</span>twoC))<span class="op">;</span></span>
<span id="cb7-715"><a href="#cb7-715" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="719" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 718;"><span id="cb8-719"><a href="#cb8-719" aria-hidden="true" tabindex="-1"></a>vecGamma <span class="op">=</span> <span class="fu">computeGamma</span>(vecE<span class="op">,</span> paramD<span class="op">,</span> paramC)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="723" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 722;"><span id="cb9-723"><a href="#cb9-723" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">normalize</span>(v) {</span>
<span id="cb9-724"><a href="#cb9-724" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sum <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(v)<span class="op">;</span></span>
<span id="cb9-725"><a href="#cb9-725" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> v<span class="op">.</span><span class="fu">map</span>(val <span class="kw">=&gt;</span> val <span class="op">/</span> sum)<span class="op">;</span></span>
<span id="cb9-726"><a href="#cb9-726" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="730" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 729;"><span id="cb10-730"><a href="#cb10-730" aria-hidden="true" tabindex="-1"></a>vecNormGamma <span class="op">=</span> <span class="fu">normalize</span>(vecGamma)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="734" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 733;"><span id="cb11-734"><a href="#cb11-734" aria-hidden="true" tabindex="-1"></a>vecCumSumGamma <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecNormGamma)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="738" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 737;"><span id="cb12-738"><a href="#cb12-738" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeZ</span>(paramS<span class="op">,</span> vecCumSumGamma<span class="op">,</span> vecE) {</span>
<span id="cb12-739"><a href="#cb12-739" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecCumSumGamma<span class="op">.</span><span class="fu">map</span>((g<span class="op">,</span> t) <span class="kw">=&gt;</span> (<span class="dv">1</span> <span class="op">-</span> paramS) <span class="op">*</span> g <span class="op">/</span> vecE[t])<span class="op">;</span></span>
<span id="cb12-740"><a href="#cb12-740" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="744" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 743;"><span id="cb13-744"><a href="#cb13-744" aria-hidden="true" tabindex="-1"></a>vecZ <span class="op">=</span> <span class="fu">computeZ</span>(inputS<span class="op">,</span> vecCumSumGamma<span class="op">,</span> vecE)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="748" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 747;"><span id="cb14-748"><a href="#cb14-748" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeB</span>(vecZ<span class="op">,</span> vecE) {</span>
<span id="cb14-749"><a href="#cb14-749" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecZ<span class="op">.</span><span class="fu">map</span>((z<span class="op">,</span> t) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>z <span class="op">*</span> vecE[t]))<span class="op">;</span></span>
<span id="cb14-750"><a href="#cb14-750" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="754" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 753;"><span id="cb15-754"><a href="#cb15-754" aria-hidden="true" tabindex="-1"></a>vecB <span class="op">=</span> <span class="fu">computeB</span>(vecZ<span class="op">,</span> vecE)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="758" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 757;"><span id="cb16-758"><a href="#cb16-758" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeY</span>(vecZ) {</span>
<span id="cb16-759"><a href="#cb16-759" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> vecZ<span class="op">.</span><span class="fu">map</span>(z <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>(z))<span class="op">;</span></span>
<span id="cb16-760"><a href="#cb16-760" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="764" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 763;"><span id="cb17-764"><a href="#cb17-764" aria-hidden="true" tabindex="-1"></a>vecY <span class="op">=</span> <span class="fu">computeY</span>(vecZ)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="768" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 767;"><span id="cb18-768"><a href="#cb18-768" aria-hidden="true" tabindex="-1"></a>paramI <span class="op">=</span> <span class="fu">dotProduct</span>(vecS<span class="op">,</span> vecY)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="773" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 772;"><span id="cb19-773"><a href="#cb19-773" aria-hidden="true" tabindex="-1"></a>yieldData <span class="op">=</span> {</span>
<span id="cb19-774"><a href="#cb19-774" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> yieldData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb19-775"><a href="#cb19-775" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> t <span class="op">&lt;</span> vecE<span class="op">.</span><span class="at">length</span><span class="op">;</span> t <span class="op">+=</span> <span class="dv">4</span>) {</span>
<span id="cb19-776"><a href="#cb19-776" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-777"><a href="#cb19-777" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Stake A"</span><span class="op">,</span></span>
<span id="cb19-778"><a href="#cb19-778" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">sum</span>(vecS<span class="op">.</span><span class="fu">slice</span>(t <span class="op">-</span> <span class="dv">3</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span>))<span class="op">,</span></span>
<span id="cb19-779"><a href="#cb19-779" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-780"><a href="#cb19-780" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-781"><a href="#cb19-781" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-782"><a href="#cb19-782" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Base Accrual"</span><span class="op">,</span></span>
<span id="cb19-783"><a href="#cb19-783" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecZ[t]<span class="op">,</span></span>
<span id="cb19-784"><a href="#cb19-784" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-785"><a href="#cb19-785" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-786"><a href="#cb19-786" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-787"><a href="#cb19-787" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Growth-adjusted Base Accrual"</span><span class="op">,</span></span>
<span id="cb19-788"><a href="#cb19-788" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> (vecZ[t] <span class="op">-</span> paramI)<span class="op">,</span></span>
<span id="cb19-789"><a href="#cb19-789" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-790"><a href="#cb19-790" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-791"><a href="#cb19-791" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-792"><a href="#cb19-792" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Discount Curve"</span><span class="op">,</span></span>
<span id="cb19-793"><a href="#cb19-793" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecB[t]<span class="op">,</span></span>
<span id="cb19-794"><a href="#cb19-794" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-795"><a href="#cb19-795" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-796"><a href="#cb19-796" aria-hidden="true" tabindex="-1"></a>      yieldData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb19-797"><a href="#cb19-797" aria-hidden="true" tabindex="-1"></a>         <span class="dt">key</span><span class="op">:</span> <span class="st">"Cumulative Stake A"</span><span class="op">,</span></span>
<span id="cb19-798"><a href="#cb19-798" aria-hidden="true" tabindex="-1"></a>         <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> vecReverseCumsumS[t <span class="op">-</span> <span class="dv">3</span>]<span class="op">,</span></span>
<span id="cb19-799"><a href="#cb19-799" aria-hidden="true" tabindex="-1"></a>         <span class="dt">time</span><span class="op">:</span> vecE[t]<span class="op">,</span></span>
<span id="cb19-800"><a href="#cb19-800" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb19-801"><a href="#cb19-801" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb19-802"><a href="#cb19-802" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> yieldData<span class="op">;</span></span>
<span id="cb19-803"><a href="#cb19-803" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb19-804"><a href="#cb19-804" aria-hidden="true" tabindex="-1"></a>getStake <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Stake A"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-805"><a href="#cb19-805" aria-hidden="true" tabindex="-1"></a>getYieldTerm <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Base Accrual"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-806"><a href="#cb19-806" aria-hidden="true" tabindex="-1"></a>getRealYield <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Growth-adjusted Base Accrual"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-807"><a href="#cb19-807" aria-hidden="true" tabindex="-1"></a>getDiscount <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Discount Curve"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-808"><a href="#cb19-808" aria-hidden="true" tabindex="-1"></a>getCumStake <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Cumulative Stake A"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb19-809"><a href="#cb19-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-810"><a href="#cb19-810" aria-hidden="true" tabindex="-1"></a>stringS <span class="op">=</span> <span class="st">"Total Stake = "</span> <span class="op">+</span> inputS<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-811"><a href="#cb19-811" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-812"><a href="#cb19-812" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-813"><a href="#cb19-813" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb19-814"><a href="#cb19-814" aria-hidden="true" tabindex="-1"></a>stringI <span class="op">=</span> <span class="st">"Growth = "</span> <span class="op">+</span> paramI<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-815"><a href="#cb19-815" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-816"><a href="#cb19-816" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-817"><a href="#cb19-817" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">"/Year"</span><span class="op">;</span></span>
<span id="cb19-818"><a href="#cb19-818" aria-hidden="true" tabindex="-1"></a>stringD <span class="op">=</span> <span class="vs">`D = </span><span class="sc">${</span>paramD<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-819"><a href="#cb19-819" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-820"><a href="#cb19-820" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-821"><a href="#cb19-821" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> years`</span><span class="op">;</span></span>
<span id="cb19-822"><a href="#cb19-822" aria-hidden="true" tabindex="-1"></a>stringC <span class="op">=</span> <span class="vs">`√C = </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(paramC)<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb19-823"><a href="#cb19-823" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb19-824"><a href="#cb19-824" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb19-825"><a href="#cb19-825" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> years`</span><span class="op">;</span></span>
<span id="cb19-826"><a href="#cb19-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-827"><a href="#cb19-827" aria-hidden="true" tabindex="-1"></a>yieldParams <span class="op">=</span> [</span>
<span id="cb19-828"><a href="#cb19-828" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringD<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> paramD }<span class="op">,</span></span>
<span id="cb19-829"><a href="#cb19-829" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringC<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(paramC) }<span class="op">,</span></span>
<span id="cb19-830"><a href="#cb19-830" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="834" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 833;"><span id="cb20-834"><a href="#cb20-834" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb20-835"><a href="#cb20-835" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb20-836"><a href="#cb20-836" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-837"><a href="#cb20-837" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span></span>
<span id="cb20-838"><a href="#cb20-838" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb20-839"><a href="#cb20-839" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Stake A"</span><span class="op">,</span></span>
<span id="cb20-840"><a href="#cb20-840" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Base Accrual"</span><span class="op">,</span></span>
<span id="cb20-841"><a href="#cb20-841" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Growth-adjusted Base Accrual"</span><span class="op">,</span></span>
<span id="cb20-842"><a href="#cb20-842" aria-hidden="true" tabindex="-1"></a>      stringD<span class="op">,</span></span>
<span id="cb20-843"><a href="#cb20-843" aria-hidden="true" tabindex="-1"></a>      stringC<span class="op">,</span></span>
<span id="cb20-844"><a href="#cb20-844" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb20-845"><a href="#cb20-845" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-846"><a href="#cb20-846" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb20-847"><a href="#cb20-847" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">,</span></span>
<span id="cb20-848"><a href="#cb20-848" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.45</span>]<span class="op">,</span></span>
<span id="cb20-849"><a href="#cb20-849" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Duration E (Years)"</span><span class="op">,</span></span>
<span id="cb20-850"><a href="#cb20-850" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-851"><a href="#cb20-851" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb20-852"><a href="#cb20-852" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb20-853"><a href="#cb20-853" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span></span>
<span id="cb20-854"><a href="#cb20-854" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(yieldData<span class="op">,</span> getStake)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(yieldData<span class="op">,</span> getYieldTerm))<span class="op">,</span></span>
<span id="cb20-855"><a href="#cb20-855" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb20-856"><a href="#cb20-856" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-857"><a href="#cb20-857" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-858"><a href="#cb20-858" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb20-859"><a href="#cb20-859" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb20-860"><a href="#cb20-860" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb20-861"><a href="#cb20-861" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-862"><a href="#cb20-862" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb20-863"><a href="#cb20-863" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb20-864"><a href="#cb20-864" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake A (%)"</span> })<span class="op">,</span></span>
<span id="cb20-865"><a href="#cb20-865" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Accrual Rate (%/Year)"</span> })<span class="op">,</span></span>
<span id="cb20-866"><a href="#cb20-866" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(yieldData<span class="op">,</span> {</span>
<span id="cb20-867"><a href="#cb20-867" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb20-868"><a href="#cb20-868" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb20-869"><a href="#cb20-869" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getStake<span class="op">,</span></span>
<span id="cb20-870"><a href="#cb20-870" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb20-871"><a href="#cb20-871" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-872"><a href="#cb20-872" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(yieldParams<span class="op">,</span> {</span>
<span id="cb20-873"><a href="#cb20-873" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span></span>
<span id="cb20-874"><a href="#cb20-874" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb20-875"><a href="#cb20-875" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb20-876"><a href="#cb20-876" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb20-877"><a href="#cb20-877" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-878"><a href="#cb20-878" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getYieldTerm<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-879"><a href="#cb20-879" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getYieldTerm<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-880"><a href="#cb20-880" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getRealYield<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-881"><a href="#cb20-881" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getRealYield<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb20-882"><a href="#cb20-882" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb20-883"><a href="#cb20-883" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-20" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-20" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Base accrual <span>(<span id="ojs-element-id-1"></span>,</span> <span><span id="ojs-element-id-2"></span>).</span>
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="888" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 887;"><span id="cb21-888"><a href="#cb21-888" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb21-889"><a href="#cb21-889" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb21-890"><a href="#cb21-890" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-891"><a href="#cb21-891" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">8</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb21-892"><a href="#cb21-892" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Cumulative Stake A"</span><span class="op">,</span> <span class="st">"Discount Curve"</span><span class="op">,</span> stringD<span class="op">,</span> stringC]<span class="op">,</span></span>
<span id="cb21-893"><a href="#cb21-893" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-894"><a href="#cb21-894" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb21-895"><a href="#cb21-895" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">,</span></span>
<span id="cb21-896"><a href="#cb21-896" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">0.25</span><span class="op">,</span> <span class="fl">10.45</span>]<span class="op">,</span></span>
<span id="cb21-897"><a href="#cb21-897" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Duration E (Years)"</span></span>
<span id="cb21-898"><a href="#cb21-898" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-899"><a href="#cb21-899" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb21-900"><a href="#cb21-900" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-901"><a href="#cb21-901" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb21-902"><a href="#cb21-902" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb21-903"><a href="#cb21-903" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb21-904"><a href="#cb21-904" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb21-905"><a href="#cb21-905" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb21-906"><a href="#cb21-906" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Cumulative Stake (%)"</span> })<span class="op">,</span></span>
<span id="cb21-907"><a href="#cb21-907" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Discount (%)"</span> })<span class="op">,</span></span>
<span id="cb21-908"><a href="#cb21-908" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(yieldData<span class="op">,</span> {</span>
<span id="cb21-909"><a href="#cb21-909" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb21-910"><a href="#cb21-910" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb21-911"><a href="#cb21-911" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCumStake<span class="op">,</span></span>
<span id="cb21-912"><a href="#cb21-912" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb21-913"><a href="#cb21-913" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb21-914"><a href="#cb21-914" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(yieldParams<span class="op">,</span> {</span>
<span id="cb21-915"><a href="#cb21-915" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span></span>
<span id="cb21-916"><a href="#cb21-916" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb21-917"><a href="#cb21-917" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb21-918"><a href="#cb21-918" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb21-919"><a href="#cb21-919" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb21-920"><a href="#cb21-920" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb21-921"><a href="#cb21-921" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(yieldData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> getDiscount<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span> })<span class="op">,</span></span>
<span id="cb21-922"><a href="#cb21-922" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb21-923"><a href="#cb21-923" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-21" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-21" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Discount rates.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-base-accrual-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Example of base accrual.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>For visualising the sensitivity of overall <strong>A</strong> base accrual with respect to staking and duration, <a href="#fig-growth-rate" class="quarto-xref">Figure&nbsp;5</a> assumes a single duration over the staking range to provide an approximation of growth <span class="math inline">\Delta S \approx Z \, S</span>.</p>
<div id="fig-growth-rate" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A annual growth rate Delta S from base accrual.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-growth-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="951" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 950;"><span id="cb22-951"><a href="#cb22-951" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">contrastingTextColor</span>(backgroundColor) {</span>
<span id="cb22-952"><a href="#cb22-952" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d3<span class="op">.</span><span class="fu">hsl</span>(backgroundColor)<span class="op">.</span><span class="at">l</span> <span class="op">&lt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb22-953"><a href="#cb22-953" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"white"</span><span class="op">;</span></span>
<span id="cb22-954"><a href="#cb22-954" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-955"><a href="#cb22-955" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb22-956"><a href="#cb22-956" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-957"><a href="#cb22-957" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="961" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 960;"><span id="cb23-961"><a href="#cb23-961" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeApproxDeltaA</span>(paramS<span class="op">,</span> paramE) {</span>
<span id="cb23-962"><a href="#cb23-962" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> paramS <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> paramS) <span class="op">/</span> paramE<span class="op">;</span></span>
<span id="cb23-963"><a href="#cb23-963" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="967" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 966;"><span id="cb24-967"><a href="#cb24-967" aria-hidden="true" tabindex="-1"></a>growthData <span class="op">=</span> {</span>
<span id="cb24-968"><a href="#cb24-968" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> growthData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb24-969"><a href="#cb24-969" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramS <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramS <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramS <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb24-970"><a href="#cb24-970" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramE <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> paramE <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">;</span> paramE<span class="op">++</span>) {</span>
<span id="cb24-971"><a href="#cb24-971" aria-hidden="true" tabindex="-1"></a>      growthData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb24-972"><a href="#cb24-972" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb24-973"><a href="#cb24-973" aria-hidden="true" tabindex="-1"></a>        <span class="dt">e</span><span class="op">:</span> paramE<span class="op">,</span></span>
<span id="cb24-974"><a href="#cb24-974" aria-hidden="true" tabindex="-1"></a>        <span class="dt">s</span><span class="op">:</span> paramS<span class="op">,</span></span>
<span id="cb24-975"><a href="#cb24-975" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeApproxDeltaA</span>(paramS<span class="op">,</span> paramE)<span class="op">,</span></span>
<span id="cb24-976"><a href="#cb24-976" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb24-977"><a href="#cb24-977" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-978"><a href="#cb24-978" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-979"><a href="#cb24-979" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> growthData<span class="op">;</span></span>
<span id="cb24-980"><a href="#cb24-980" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="984" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 983;"><span id="cb25-984"><a href="#cb25-984" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb25-985"><a href="#cb25-985" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Annual Growth ΔS"</span> }<span class="op">,</span></span>
<span id="cb25-986"><a href="#cb25-986" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> <span class="fl">10.1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">10.5</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Duration E (Years)"</span> }<span class="op">,</span></span>
<span id="cb25-987"><a href="#cb25-987" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Staking S"</span> }<span class="op">,</span></span>
<span id="cb25-988"><a href="#cb25-988" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb25-989"><a href="#cb25-989" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb25-990"><a href="#cb25-990" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(growthData<span class="op">,</span> {</span>
<span id="cb25-991"><a href="#cb25-991" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">e</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-992"><a href="#cb25-992" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">e</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-993"><a href="#cb25-993" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb25-994"><a href="#cb25-994" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb25-995"><a href="#cb25-995" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb25-996"><a href="#cb25-996" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-997"><a href="#cb25-997" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(growthData<span class="op">,</span> {</span>
<span id="cb25-998"><a href="#cb25-998" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"e"</span><span class="op">,</span></span>
<span id="cb25-999"><a href="#cb25-999" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"s"</span><span class="op">,</span></span>
<span id="cb25-1000"><a href="#cb25-1000" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb25-1001"><a href="#cb25-1001" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb25-1002"><a href="#cb25-1002" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb25-1003"><a href="#cb25-1003" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb25-1004"><a href="#cb25-1004" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb25-1005"><a href="#cb25-1005" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb25-1006"><a href="#cb25-1006" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeApproxDeltaA</span>(<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span></span>
<span id="cb25-1007"><a href="#cb25-1007" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb25-1008"><a href="#cb25-1008" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb25-1009"><a href="#cb25-1009" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb25-1010"><a href="#cb25-1010" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-1011"><a href="#cb25-1011" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb25-1012"><a href="#cb25-1012" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-25" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-growth-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: <strong>A</strong> annual growth rate <span class="math inline">\Delta S</span> from base accrual.
</figcaption>
</figure>
</div>
</section>
<section id="sec-protocol-coordination-voting-power" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="sec-protocol-coordination-voting-power"><span class="header-section-number">3.1.2</span> Protocol Coordination Voting Power</h4>
<p>Protocol coordination voting power can be derived from two participation cohorts:</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong> tokens: <span class="math inline">S_t</span></p></li>
<li><p>Staked liquidity in the <strong>A</strong>-<strong>G</strong> pair <span class="overline"><strong>AG</strong></span>&nbsp;(see <a href="#sec-liquidity-mechanics" class="quarto-xref">Section&nbsp;3.3</a>), defined here as <span class="math inline">A_{Gt}</span>, representing the quantity of <strong>A</strong> tokens held in the liquidity pool expressed as a proportion of circulating supply.</p></li>
</ol>
<p>Voting power is allocated by lock or stake duration, and applied to the respective balance of <strong>A</strong> tokens:</p>
<ol type="1">
<li><p>Voting weights for time-locked <strong>A</strong> tokens <span class="math inline">v_t</span>:</p>
<p><span id="eq-voting-weights-time-locks"><span class="math display">
v_t = Z_t \, S_t
  \tag{11}</span></span></p></li>
<li><p>Voting weights for staked liquidity <span class="math inline">w_t</span>:</p>
<p><span id="eq-voting-weights-lps"><span class="math display">
w_t = Z_t \, A_{Gt}
  \tag{12}</span></span></p></li>
<li><p>Voting power for time-locked <strong>A</strong> tokens <span class="math inline">V_t</span>:</p>
<p><span id="eq-voting-power-time-locks"><span class="math display">
V_t = \frac{v_t}{\sum_{j=1}^{40} (v_j + 2 w_j)}
  \tag{13}</span></span></p></li>
<li><p>Voting power for staked liquidity <span class="math inline">W_t</span>:</p>
<p><span id="eq-voting-power-lps"><span class="math display">
W_t = \frac{w_t}{\sum_{j=1}^{40} \left( \frac 1 2 v_j + w_j \right)}
  \tag{14}</span></span></p></li>
</ol>
</section>
</section>
<section id="sec-carbon-inventory-mechanics" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="sec-carbon-inventory-mechanics"><span class="header-section-number">3.2</span> Carbon Inventory Mechanics</h3>
<p>The carbon inventory layer ultimately swaps carbon through a set of smart contracts, driven by carbon supply, demand, and user inputs. The combined allocations of <strong>A</strong> and <strong>G</strong> tokens creates a dynamic real-time execution rate curve for each carbon class.</p>
<div id="fig-carbon-inventory-mechanics" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Klima 2.0 carbon inventory mechanics.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-inventory-mechanics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/carbon-inventory-mechanics.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-inventory-mechanics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Klima&nbsp;2.0 carbon inventory mechanics.
</figcaption>
</figure>
</div>
<section id="sec-carbon-supply" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="sec-carbon-supply"><span class="header-section-number">3.2.1</span> Carbon Supply</h4>
<p><em>User swaps carbon credits for <strong>A</strong> tokens.</em></p>
<section id="sec-existing-carbon-in-the-inventory" class="level5" data-number="3.2.1.1">
<h5 data-number="3.2.1.1" class="anchored" data-anchor-id="sec-existing-carbon-in-the-inventory"><span class="header-section-number">3.2.1.1</span> Existing Carbon in the Inventory</h5>
<p>For execution terms, both <strong>A</strong> tokens and <strong>G</strong> tokens may be allocated to specific carbon classes <span class="math inline">{i \in \{1, 2, 3, \dots, n\}}</span> and these are independent allocations between the two tokens.</p>
<div id="fig-token-staking-class-structure" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token staking class structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-staking-class-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-staking-class-structure.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-staking-class-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Token staking class structure.
</figcaption>
</figure>
</div>
<p>For a carbon class quantity to be supplied to the protocol, it must have a strictly positive quantity of <strong>A</strong> tokens allocated to that carbon class, otherwise there is no defined rate, and the carbon cannot be swapped.</p>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">C_i</span>: Total tonnes of carbon class <span class="math inline">i</span> currently held in the inventory.</p></li>
<li><p><span class="math inline">A_i</span>: <strong>A</strong> tokens allocated to carbon class <span class="math inline">i</span> expressed as a proportion of the outstanding supply of <strong>A</strong> tokens, where <span class="math inline">{\sum A_i = A}</span>.</p></li>
<li><p><span class="math inline">G_i</span>: <strong>G</strong> tokens allocated to carbon class <span class="math inline">i</span> expressed as a proportion of the outstanding supply of <strong>G</strong> Tokens.</p></li>
</ul>
<p>Where <span class="math inline">\Delta C_i</span> is expressed as the relative increment to its respective pool balance, the amount of <strong>A</strong> tokens issued for carbon, <span class="math inline">\Delta A</span>, expressed as a proportion of current supply, is determined as:</p>
<p><span id="eq-a-change-intermediary-step"><span class="math display">
\ln(1 + \Delta A) =
  \left( A_i - \frac{A_i^2 \, (1 - G_i)^2}{2} \right) \ln(1 + \Delta C_i)
\tag{15}</span></span></p>
<p>Denoting the expression on the right hand side of <a href="#eq-a-change-intermediary-step" class="quarto-xref">Equation&nbsp;15</a> as <span class="math inline">\mathsf{RHS}</span>:</p>
<p><span id="eq-a-change"><span class="math display">
\Delta A = \exp(\mathsf{RHS}) - 1
\tag{16}</span></span></p>
<p>Finally, <span class="math inline">\Delta A</span> is applied to the outstanding supply of <strong>A</strong> to solve for token quantities.</p>
<p><a href="#fig-a-price-curves" class="quarto-xref">Figure&nbsp;8</a> illustrates the <strong>G</strong> token’s capacity to maintain the initial execution terms of the <strong>A</strong> token. The data has been normalised in <a href="#fig-a-price-curves-normalised" class="quarto-xref">Figure&nbsp;9</a> to <span class="math inline">\Delta C_i \, A_i</span>.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="1147" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1146;"><span id="cb26-1147"><a href="#cb26-1147" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaBarCi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb26-1148"><a href="#cb26-1148" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta C_i`</span><span class="op">,</span></span>
<span id="cb26-1149"><a href="#cb26-1149" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb26-1150"><a href="#cb26-1150" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb26-1151"><a href="#cb26-1151" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-26" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-a-price-curves" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A price curves.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="1163" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1162;"><span id="cb27-1163"><a href="#cb27-1163" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCi) {</span>
<span id="cb27-1164"><a href="#cb27-1164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>((Ai <span class="op">-</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>)) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log1p</span>(deltaCi))<span class="op">;</span></span>
<span id="cb27-1165"><a href="#cb27-1165" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="1170" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1169;"><span id="cb28-1170"><a href="#cb28-1170" aria-hidden="true" tabindex="-1"></a>pricingData <span class="op">=</span> {</span>
<span id="cb28-1171"><a href="#cb28-1171" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pricingData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb28-1172"><a href="#cb28-1172" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb28-1173"><a href="#cb28-1173" aria-hidden="true" tabindex="-1"></a>    pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1174"><a href="#cb28-1174" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb28-1175"><a href="#cb28-1175" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb28-1176"><a href="#cb28-1176" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb28-1177"><a href="#cb28-1177" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb28-1178"><a href="#cb28-1178" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-1179"><a href="#cb28-1179" aria-hidden="true" tabindex="-1"></a>    pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1180"><a href="#cb28-1180" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb28-1181"><a href="#cb28-1181" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb28-1182"><a href="#cb28-1182" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb28-1183"><a href="#cb28-1183" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb28-1184"><a href="#cb28-1184" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-1185"><a href="#cb28-1185" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb28-1186"><a href="#cb28-1186" aria-hidden="true" tabindex="-1"></a>      pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1187"><a href="#cb28-1187" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb28-1188"><a href="#cb28-1188" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb28-1189"><a href="#cb28-1189" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb28-1190"><a href="#cb28-1190" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb28-1191"><a href="#cb28-1191" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb28-1192"><a href="#cb28-1192" aria-hidden="true" tabindex="-1"></a>      pricingData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb28-1193"><a href="#cb28-1193" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb28-1194"><a href="#cb28-1194" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb28-1195"><a href="#cb28-1195" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb28-1196"><a href="#cb28-1196" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCi) <span class="op">/</span></span>
<span id="cb28-1197"><a href="#cb28-1197" aria-hidden="true" tabindex="-1"></a>                (inputDeltaBarCi <span class="op">*</span> paramAi)<span class="op">,</span></span>
<span id="cb28-1198"><a href="#cb28-1198" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb28-1199"><a href="#cb28-1199" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-1200"><a href="#cb28-1200" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-1201"><a href="#cb28-1201" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pricingData<span class="op">;</span></span>
<span id="cb28-1202"><a href="#cb28-1202" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb28-1203"><a href="#cb28-1203" aria-hidden="true" tabindex="-1"></a>getDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"ΔA"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb28-1204"><a href="#cb28-1204" aria-hidden="true" tabindex="-1"></a>getNormDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Normalised ΔA"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb28-1205"><a href="#cb28-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1206"><a href="#cb28-1206" aria-hidden="true" tabindex="-1"></a>stringInputDeltaBarCi <span class="op">=</span> inputDeltaBarCi<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb28-1207"><a href="#cb28-1207" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb28-1208"><a href="#cb28-1208" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb28-1209"><a href="#cb28-1209" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-28-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="1212" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1211;"><span id="cb29-1212"><a href="#cb29-1212" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb29-1213"><a href="#cb29-1213" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb29-1214"><a href="#cb29-1214" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb29-1215"><a href="#cb29-1215" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb29-1216"><a href="#cb29-1216" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb29-1217"><a href="#cb29-1217" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`ΔA, where ΔCᵢ = </span><span class="sc">${</span>stringInputDeltaBarCi<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb29-1218"><a href="#cb29-1218" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb29-1219"><a href="#cb29-1219" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb29-1220"><a href="#cb29-1220" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb29-1221"><a href="#cb29-1221" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb29-1222"><a href="#cb29-1222" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb29-1223"><a href="#cb29-1223" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(pricingData<span class="op">,</span> {</span>
<span id="cb29-1224"><a href="#cb29-1224" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb29-1225"><a href="#cb29-1225" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb29-1226"><a href="#cb29-1226" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb29-1227"><a href="#cb29-1227" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb29-1228"><a href="#cb29-1228" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getDeltaA<span class="op">,</span></span>
<span id="cb29-1229"><a href="#cb29-1229" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-1230"><a href="#cb29-1230" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(pricingData<span class="op">,</span> {</span>
<span id="cb29-1231"><a href="#cb29-1231" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb29-1232"><a href="#cb29-1232" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb29-1233"><a href="#cb29-1233" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb29-1234"><a href="#cb29-1234" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb29-1235"><a href="#cb29-1235" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb29-1236"><a href="#cb29-1236" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb29-1237"><a href="#cb29-1237" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb29-1238"><a href="#cb29-1238" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb29-1239"><a href="#cb29-1239" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb29-1240"><a href="#cb29-1240" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb29-1241"><a href="#cb29-1241" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi)<span class="op">,</span></span>
<span id="cb29-1242"><a href="#cb29-1242" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb29-1243"><a href="#cb29-1243" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb29-1244"><a href="#cb29-1244" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb29-1245"><a href="#cb29-1245" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb29-1246"><a href="#cb29-1246" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-1247"><a href="#cb29-1247" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb29-1248"><a href="#cb29-1248" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-29" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: <strong>A</strong> price curves (<span class="math inline">\Delta A</span>).
</figcaption>
</figure>
</div>
<div id="fig-a-price-curves-normalised" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Normalised A price curves.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="1262" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1261;"><span id="cb30-1262"><a href="#cb30-1262" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb30-1263"><a href="#cb30-1263" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb30-1264"><a href="#cb30-1264" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb30-1265"><a href="#cb30-1265" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb30-1266"><a href="#cb30-1266" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb30-1267"><a href="#cb30-1267" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Normalised ΔA, where ΔCᵢ = </span><span class="sc">${</span>stringInputDeltaBarCi<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb30-1268"><a href="#cb30-1268" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb30-1269"><a href="#cb30-1269" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb30-1270"><a href="#cb30-1270" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb30-1271"><a href="#cb30-1271" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb30-1272"><a href="#cb30-1272" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb30-1273"><a href="#cb30-1273" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(pricingData<span class="op">,</span> {</span>
<span id="cb30-1274"><a href="#cb30-1274" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb30-1275"><a href="#cb30-1275" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb30-1276"><a href="#cb30-1276" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb30-1277"><a href="#cb30-1277" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb30-1278"><a href="#cb30-1278" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getNormDeltaA<span class="op">,</span></span>
<span id="cb30-1279"><a href="#cb30-1279" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb30-1280"><a href="#cb30-1280" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(pricingData<span class="op">,</span> {</span>
<span id="cb30-1281"><a href="#cb30-1281" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb30-1282"><a href="#cb30-1282" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb30-1283"><a href="#cb30-1283" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getNormDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb30-1284"><a href="#cb30-1284" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb30-1285"><a href="#cb30-1285" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb30-1286"><a href="#cb30-1286" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb30-1287"><a href="#cb30-1287" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb30-1288"><a href="#cb30-1288" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb30-1289"><a href="#cb30-1289" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb30-1290"><a href="#cb30-1290" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaBarCi) <span class="op">/</span> inputDeltaBarCi<span class="op">,</span></span>
<span id="cb30-1291"><a href="#cb30-1291" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCi) <span class="op">/</span> inputDeltaBarCi<span class="op">,</span></span>
<span id="cb30-1292"><a href="#cb30-1292" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb30-1293"><a href="#cb30-1293" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb30-1294"><a href="#cb30-1294" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb30-1295"><a href="#cb30-1295" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb30-1296"><a href="#cb30-1296" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb30-1297"><a href="#cb30-1297" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb30-1298"><a href="#cb30-1298" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-30" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Normalised <strong>A</strong> price curves.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Noting that the sensitivity to <span class="math inline">G_i</span> increases as <span class="math inline">A_i</span> increases and the effects become more pronounced as <span class="math inline">\Delta C_i</span> increases.</p>
</section>
<section id="sec-zero-carbon-scenario" class="level5" data-number="3.2.1.2">
<h5 data-number="3.2.1.2" class="anchored" data-anchor-id="sec-zero-carbon-scenario"><span class="header-section-number">3.2.1.2</span> Zero Carbon Scenario</h5>
<p>There are circumstances when there is zero carbon held in the inventory for a particular class, i.e.&nbsp;<span class="math inline">{C_i = 0}</span>, which invalidates the calculation of <span class="math inline">\Delta C_i</span> and a different approach is required.</p>
<p>Taking <span class="math inline">\Delta C_\emptyset</span> as the tonnes of carbon tokens (implying an existing balance of 1 tonne) to be supplied for any carbon class that has a strictly positive <strong>A</strong> allocation <span class="math inline">A_\emptyset</span>, together with <strong>G</strong> allocation <span class="math inline">G_\emptyset</span>:</p>
<p><span id="eq-a-change-zero-carbon"><span class="math display">
\Delta A =
  \frac{\Delta C_\emptyset}{1 + \Delta C_\emptyset} \,
  \left( A_\emptyset - \frac{A_\emptyset^2 (1 - G_\emptyset)^2}{2} \right)^2
\tag{17}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="1334" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1333;"><span id="cb31-1334"><a href="#cb31-1334" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaBarCnull <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-1</span><span class="op">,</span> <span class="fl">1e5</span>]<span class="op">,</span> {</span>
<span id="cb31-1335"><a href="#cb31-1335" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased } </span><span class="sc">\D</span><span class="vs">elta C_</span><span class="sc">\e</span><span class="vs">mptyset`</span><span class="op">,</span></span>
<span id="cb31-1336"><a href="#cb31-1336" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-1</span><span class="op">,</span></span>
<span id="cb31-1337"><a href="#cb31-1337" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">1e2</span><span class="op">,</span></span>
<span id="cb31-1338"><a href="#cb31-1338" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb31-1339"><a href="#cb31-1339" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-31" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-a-price-curves-zero-carbon" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A price curves in the zero carbon scenario.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-zero-carbon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="1352" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1351;"><span id="cb32-1352"><a href="#cb32-1352" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeZeroCarbonDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCnull) {</span>
<span id="cb32-1353"><a href="#cb32-1353" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (deltaCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> deltaCnull)) <span class="op">*</span> (Ai <span class="op">-</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>))<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb32-1354"><a href="#cb32-1354" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-1355"><a href="#cb32-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1356"><a href="#cb32-1356" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeTrueDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> barCiTonnes<span class="op">,</span> deltaBarCiTonnes) {</span>
<span id="cb32-1357"><a href="#cb32-1357" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (barCiTonnes <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb32-1358"><a href="#cb32-1358" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">computeZeroCarbonDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaBarCiTonnes)<span class="op">;</span></span>
<span id="cb32-1359"><a href="#cb32-1359" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb32-1360"><a href="#cb32-1360" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> deltaBarCi <span class="op">=</span> deltaBarCiTonnes <span class="op">/</span> barCiTonnes<span class="op">;</span></span>
<span id="cb32-1361"><a href="#cb32-1361" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaBarCi)<span class="op">;</span></span>
<span id="cb32-1362"><a href="#cb32-1362" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-1363"><a href="#cb32-1363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-1364"><a href="#cb32-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1365"><a href="#cb32-1365" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">numberOfDigits</span>(x) {</span>
<span id="cb32-1366"><a href="#cb32-1366" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> (<span class="dv">1</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(x)))<span class="op">;</span></span>
<span id="cb32-1367"><a href="#cb32-1367" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-32-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="1371" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1370;"><span id="cb33-1371"><a href="#cb33-1371" aria-hidden="true" tabindex="-1"></a>zeroCarbonData <span class="op">=</span> {</span>
<span id="cb33-1372"><a href="#cb33-1372" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> zeroCarbonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb33-1373"><a href="#cb33-1373" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb33-1374"><a href="#cb33-1374" aria-hidden="true" tabindex="-1"></a>    zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1375"><a href="#cb33-1375" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb33-1376"><a href="#cb33-1376" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb33-1377"><a href="#cb33-1377" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb33-1378"><a href="#cb33-1378" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb33-1379"><a href="#cb33-1379" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb33-1380"><a href="#cb33-1380" aria-hidden="true" tabindex="-1"></a>    zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1381"><a href="#cb33-1381" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb33-1382"><a href="#cb33-1382" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb33-1383"><a href="#cb33-1383" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb33-1384"><a href="#cb33-1384" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb33-1385"><a href="#cb33-1385" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb33-1386"><a href="#cb33-1386" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb33-1387"><a href="#cb33-1387" aria-hidden="true" tabindex="-1"></a>      zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1388"><a href="#cb33-1388" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"ΔA"</span><span class="op">,</span></span>
<span id="cb33-1389"><a href="#cb33-1389" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb33-1390"><a href="#cb33-1390" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb33-1391"><a href="#cb33-1391" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeZeroCarbonDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb33-1392"><a href="#cb33-1392" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb33-1393"><a href="#cb33-1393" aria-hidden="true" tabindex="-1"></a>      zeroCarbonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb33-1394"><a href="#cb33-1394" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Normalised ΔA"</span><span class="op">,</span></span>
<span id="cb33-1395"><a href="#cb33-1395" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb33-1396"><a href="#cb33-1396" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb33-1397"><a href="#cb33-1397" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeZeroCarbonDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb33-1398"><a href="#cb33-1398" aria-hidden="true" tabindex="-1"></a>                ((inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull)) <span class="op">*</span> paramAi<span class="op">**</span><span class="dv">2</span>)<span class="op">,</span></span>
<span id="cb33-1399"><a href="#cb33-1399" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb33-1400"><a href="#cb33-1400" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-1401"><a href="#cb33-1401" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-1402"><a href="#cb33-1402" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> zeroCarbonData<span class="op">;</span></span>
<span id="cb33-1403"><a href="#cb33-1403" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb33-1404"><a href="#cb33-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1405"><a href="#cb33-1405" aria-hidden="true" tabindex="-1"></a>stringDeltaBarCnull <span class="op">=</span> inputDeltaBarCnull<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb33-1406"><a href="#cb33-1406" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb33-1407"><a href="#cb33-1407" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb33-1408"><a href="#cb33-1408" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="fu">numberOfDigits</span>(inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb33-1409"><a href="#cb33-1409" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="fu">numberOfDigits</span>(inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb33-1410"><a href="#cb33-1410" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb33-1411"><a href="#cb33-1411" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-33-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="1414" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1413;"><span id="cb34-1414"><a href="#cb34-1414" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb34-1415"><a href="#cb34-1415" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb34-1416"><a href="#cb34-1416" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb34-1417"><a href="#cb34-1417" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb34-1418"><a href="#cb34-1418" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb34-1419"><a href="#cb34-1419" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`ΔA, where ΔC∅ = </span><span class="sc">${</span>stringDeltaBarCnull<span class="sc">}</span><span class="vs"> tCO2eq`</span><span class="op">,</span></span>
<span id="cb34-1420"><a href="#cb34-1420" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb34-1421"><a href="#cb34-1421" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb34-1422"><a href="#cb34-1422" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb34-1423"><a href="#cb34-1423" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb34-1424"><a href="#cb34-1424" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb34-1425"><a href="#cb34-1425" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb34-1426"><a href="#cb34-1426" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb34-1427"><a href="#cb34-1427" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb34-1428"><a href="#cb34-1428" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb34-1429"><a href="#cb34-1429" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb34-1430"><a href="#cb34-1430" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getDeltaA<span class="op">,</span></span>
<span id="cb34-1431"><a href="#cb34-1431" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-1432"><a href="#cb34-1432" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb34-1433"><a href="#cb34-1433" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb34-1434"><a href="#cb34-1434" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb34-1435"><a href="#cb34-1435" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb34-1436"><a href="#cb34-1436" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb34-1437"><a href="#cb34-1437" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb34-1438"><a href="#cb34-1438" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb34-1439"><a href="#cb34-1439" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb34-1440"><a href="#cb34-1440" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb34-1441"><a href="#cb34-1441" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb34-1442"><a href="#cb34-1442" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb34-1443"><a href="#cb34-1443" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull)<span class="op">,</span></span>
<span id="cb34-1444"><a href="#cb34-1444" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb34-1445"><a href="#cb34-1445" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb34-1446"><a href="#cb34-1446" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb34-1447"><a href="#cb34-1447" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb34-1448"><a href="#cb34-1448" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb34-1449"><a href="#cb34-1449" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb34-1450"><a href="#cb34-1450" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-34" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-zero-carbon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: <strong>A</strong> price curves (<span class="math inline">\Delta A</span>) in the zero carbon scenario.
</figcaption>
</figure>
</div>
<div id="fig-a-price-curves-zero-carbon-normalised" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Normalised A price curves in the zero carbon scenario.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-price-curves-zero-carbon-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="1465" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1464;"><span id="cb35-1465"><a href="#cb35-1465" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb35-1466"><a href="#cb35-1466" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb35-1467"><a href="#cb35-1467" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb35-1468"><a href="#cb35-1468" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb35-1469"><a href="#cb35-1469" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb35-1470"><a href="#cb35-1470" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Normalised ΔA, where ΔC∅ = </span><span class="sc">${</span>stringDeltaBarCnull<span class="sc">}</span><span class="vs"> tCO2eq`</span><span class="op">,</span></span>
<span id="cb35-1471"><a href="#cb35-1471" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb35-1472"><a href="#cb35-1472" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb35-1473"><a href="#cb35-1473" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb35-1474"><a href="#cb35-1474" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb35-1475"><a href="#cb35-1475" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb35-1476"><a href="#cb35-1476" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb35-1477"><a href="#cb35-1477" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb35-1478"><a href="#cb35-1478" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb35-1479"><a href="#cb35-1479" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb35-1480"><a href="#cb35-1480" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb35-1481"><a href="#cb35-1481" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getNormDeltaA<span class="op">,</span></span>
<span id="cb35-1482"><a href="#cb35-1482" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb35-1483"><a href="#cb35-1483" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(zeroCarbonData<span class="op">,</span> {</span>
<span id="cb35-1484"><a href="#cb35-1484" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb35-1485"><a href="#cb35-1485" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb35-1486"><a href="#cb35-1486" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getNormDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb35-1487"><a href="#cb35-1487" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb35-1488"><a href="#cb35-1488" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb35-1489"><a href="#cb35-1489" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb35-1490"><a href="#cb35-1490" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb35-1491"><a href="#cb35-1491" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb35-1492"><a href="#cb35-1492" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb35-1493"><a href="#cb35-1493" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb35-1494"><a href="#cb35-1494" aria-hidden="true" tabindex="-1"></a>                    (inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb35-1495"><a href="#cb35-1495" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeZeroCarbonDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaBarCnull) <span class="op">/</span></span>
<span id="cb35-1496"><a href="#cb35-1496" aria-hidden="true" tabindex="-1"></a>                    (inputDeltaBarCnull <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> inputDeltaBarCnull))<span class="op">,</span></span>
<span id="cb35-1497"><a href="#cb35-1497" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb35-1498"><a href="#cb35-1498" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb35-1499"><a href="#cb35-1499" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb35-1500"><a href="#cb35-1500" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb35-1501"><a href="#cb35-1501" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb35-1502"><a href="#cb35-1502" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb35-1503"><a href="#cb35-1503" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-35" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-price-curves-zero-carbon-normalised-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Normalised <strong>A</strong> price curves in the zero carbon scenario.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-sell-offset-certificates" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="sec-sell-offset-certificates"><span class="header-section-number">3.2.2</span> Carbon Credit Retirements</h4>
<p><em>User swaps <strong>A</strong> tokens for carbon retirement certificates.</em></p>
<section id="sec-weighted-carbon-class" class="level5" data-number="3.2.2.1">
<h5 data-number="3.2.2.1" class="anchored" data-anchor-id="sec-weighted-carbon-class"><span class="header-section-number">3.2.2.1</span> Weighted Carbon Class</h5>
<p>For retiring carbon that is <em>weighted</em>, that is for which there is a strictly positive <strong>A</strong> token allocation, an <strong>A</strong> token holder can extract the carbon class retirement certificate of their choice <span class="math inline">C_i</span>:</p>
<p><span id="eq-carbon-change-intermediary-step"><span class="math display">
\ln(1 + \Delta C_i) =
  \frac{-\ln(1 + \Delta A)}{A_i + \frac 1 2 A_i^2 \, (1 - G_i)^2}
\tag{18}</span></span></p>
<p>As before, denoting the expression on the right hand side of <a href="#eq-carbon-change-intermediary-step" class="quarto-xref">Equation&nbsp;18</a> as <span class="math inline">\mathsf{RHS}</span>:</p>
<p><span id="eq-carbon-change"><span class="math display">
\Delta C_i = \exp(\mathsf{RHS}) - 1
\tag{19}</span></span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="1541" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1540;"><span id="cb36-1541"><a href="#cb36-1541" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaA <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="fl">0.999</span>]<span class="op">,</span> {</span>
<span id="cb36-1542"><a href="#cb36-1542" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Burnt } </span><span class="sc">\D</span><span class="vs">elta A`</span><span class="op">,</span></span>
<span id="cb36-1543"><a href="#cb36-1543" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb36-1544"><a href="#cb36-1544" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb36-1545"><a href="#cb36-1545" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-36" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-proportion-of-carbon-retired" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Proportion of carbon retired.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-proportion-of-carbon-retired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="1557" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1556;"><span id="cb37-1557"><a href="#cb37-1557" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDeltaCi</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaA) {</span>
<span id="cb37-1558"><a href="#cb37-1558" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">expm1</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log1p</span>(deltaA) <span class="op">/</span> (Ai <span class="op">+</span> (Ai<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>)))<span class="op">;</span></span>
<span id="cb37-1559"><a href="#cb37-1559" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-37" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="1564" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1563;"><span id="cb38-1564"><a href="#cb38-1564" aria-hidden="true" tabindex="-1"></a>retirementData <span class="op">=</span> {</span>
<span id="cb38-1565"><a href="#cb38-1565" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> retirementData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb38-1566"><a href="#cb38-1566" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb38-1567"><a href="#cb38-1567" aria-hidden="true" tabindex="-1"></a>    retirementData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb38-1568"><a href="#cb38-1568" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"-ΔCᵢ"</span><span class="op">,</span></span>
<span id="cb38-1569"><a href="#cb38-1569" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb38-1570"><a href="#cb38-1570" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb38-1571"><a href="#cb38-1571" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb38-1572"><a href="#cb38-1572" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb38-1573"><a href="#cb38-1573" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb38-1574"><a href="#cb38-1574" aria-hidden="true" tabindex="-1"></a>      retirementData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb38-1575"><a href="#cb38-1575" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"-ΔCᵢ"</span><span class="op">,</span></span>
<span id="cb38-1576"><a href="#cb38-1576" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb38-1577"><a href="#cb38-1577" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb38-1578"><a href="#cb38-1578" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="op">-</span><span class="fu">computeDeltaCi</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb38-1579"><a href="#cb38-1579" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb38-1580"><a href="#cb38-1580" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-1581"><a href="#cb38-1581" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-1582"><a href="#cb38-1582" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> retirementData<span class="op">;</span></span>
<span id="cb38-1583"><a href="#cb38-1583" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb38-1584"><a href="#cb38-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1585"><a href="#cb38-1585" aria-hidden="true" tabindex="-1"></a>stringInputDeltaA <span class="op">=</span> inputDeltaA<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb38-1586"><a href="#cb38-1586" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb38-1587"><a href="#cb38-1587" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb38-1588"><a href="#cb38-1588" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-38-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-38-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1591" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1590;"><span id="cb39-1591"><a href="#cb39-1591" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb39-1592"><a href="#cb39-1592" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb39-1593"><a href="#cb39-1593" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb39-1594"><a href="#cb39-1594" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb39-1595"><a href="#cb39-1595" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb39-1596"><a href="#cb39-1596" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`-ΔCᵢ, where ΔA = </span><span class="sc">${</span>stringInputDeltaA<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb39-1597"><a href="#cb39-1597" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb39-1598"><a href="#cb39-1598" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb39-1599"><a href="#cb39-1599" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb39-1600"><a href="#cb39-1600" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb39-1601"><a href="#cb39-1601" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb39-1602"><a href="#cb39-1602" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(retirementData<span class="op">,</span> {</span>
<span id="cb39-1603"><a href="#cb39-1603" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1604"><a href="#cb39-1604" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1605"><a href="#cb39-1605" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1606"><a href="#cb39-1606" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb39-1607"><a href="#cb39-1607" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb39-1608"><a href="#cb39-1608" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb39-1609"><a href="#cb39-1609" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(retirementData<span class="op">,</span> {</span>
<span id="cb39-1610"><a href="#cb39-1610" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb39-1611"><a href="#cb39-1611" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb39-1612"><a href="#cb39-1612" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb39-1613"><a href="#cb39-1613" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb39-1614"><a href="#cb39-1614" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb39-1615"><a href="#cb39-1615" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb39-1616"><a href="#cb39-1616" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb39-1617"><a href="#cb39-1617" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb39-1618"><a href="#cb39-1618" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb39-1619"><a href="#cb39-1619" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fu">computeDeltaCi</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb39-1620"><a href="#cb39-1620" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fu">computeDeltaCi</span>(<span class="fl">0.1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> inputDeltaA)<span class="op">,</span></span>
<span id="cb39-1621"><a href="#cb39-1621" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb39-1622"><a href="#cb39-1622" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb39-1623"><a href="#cb39-1623" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb39-1624"><a href="#cb39-1624" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb39-1625"><a href="#cb39-1625" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb39-1626"><a href="#cb39-1626" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb39-1627"><a href="#cb39-1627" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-39" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-proportion-of-carbon-retired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Proportion of carbon retired.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-proportion-of-carbon-retired" class="quarto-xref">Figure&nbsp;12</a> shows the cost of carbon increasing with <span class="math inline">A_i</span> and decreasing on <span class="math inline">G_i</span>.</p>
</section>
<section id="sec-unweighted-carbon-class" class="level5" data-number="3.2.2.2">
<h5 data-number="3.2.2.2" class="anchored" data-anchor-id="sec-unweighted-carbon-class"><span class="header-section-number">3.2.2.2</span> Unweighted Carbon Class</h5>
<p>A retirement certificate for a carbon class with a zero <strong>A</strong> allocation cannot be extracted from the inventory by swapping in <strong>A</strong> tokens.</p>
</section>
<section id="sec-round-trip-difference" class="level5" data-number="3.2.2.3">
<h5 data-number="3.2.2.3" class="anchored" data-anchor-id="sec-round-trip-difference"><span class="header-section-number">3.2.2.3</span> Round Trip Difference</h5>
<p>Any difference between the <strong>A</strong> tokens issued in connection with carbon intake and the <strong>A</strong> tokens burned in connection with retirement is reflected solely as a change in the circulating supply of <strong>A</strong> tokens, according to the above protocol rules. No margin, profit, or financial surplus is retained or extracted by any entity.</p>
<p><a href="#fig-carbon-difference" class="quarto-xref">Figure&nbsp;13</a> below shows the difference captured on a ‘round trip’ by the system where <span class="math inline">\varepsilon</span> is the proportion retained:</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1662" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1661;"><span id="cb40-1662"><a href="#cb40-1662" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaCinitial <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb40-1663"><a href="#cb40-1663" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial }</span><span class="sc">\D</span><span class="vs">elta C`</span><span class="op">,</span></span>
<span id="cb40-1664"><a href="#cb40-1664" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb40-1665"><a href="#cb40-1665" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb40-1666"><a href="#cb40-1666" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-40" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-difference" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Carbon difference.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-difference-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1678" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1677;"><span id="cb41-1678"><a href="#cb41-1678" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeSpread</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCinitial) {</span>
<span id="cb41-1679"><a href="#cb41-1679" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaA <span class="op">=</span> <span class="fu">computeDeltaA</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaCinitial)<span class="op">;</span></span>
<span id="cb41-1680"><a href="#cb41-1680" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> deltaCfinal <span class="op">=</span> <span class="op">-</span><span class="fu">computeDeltaCi</span>(Ai<span class="op">,</span> Gi<span class="op">,</span> deltaA)<span class="op">;</span></span>
<span id="cb41-1681"><a href="#cb41-1681" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (deltaCinitial <span class="op">-</span> deltaCfinal) <span class="op">/</span> deltaCinitial<span class="op">;</span></span>
<span id="cb41-1682"><a href="#cb41-1682" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-41" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1687" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1686;"><span id="cb42-1687"><a href="#cb42-1687" aria-hidden="true" tabindex="-1"></a>liquidationData <span class="op">=</span> {</span>
<span id="cb42-1688"><a href="#cb42-1688" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> liquidationData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb42-1689"><a href="#cb42-1689" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb42-1690"><a href="#cb42-1690" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"deltaa"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb42-1691"><a href="#cb42-1691" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"deltac"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb42-1692"><a href="#cb42-1692" aria-hidden="true" tabindex="-1"></a>    liquidationData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"spread"</span><span class="op">,</span> <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span> })<span class="op">;</span></span>
<span id="cb42-1693"><a href="#cb42-1693" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb42-1694"><a href="#cb42-1694" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> deltaA <span class="op">=</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial)</span>
<span id="cb42-1695"><a href="#cb42-1695" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1696"><a href="#cb42-1696" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"deltaa"</span><span class="op">,</span></span>
<span id="cb42-1697"><a href="#cb42-1697" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1698"><a href="#cb42-1698" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1699"><a href="#cb42-1699" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaA</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial) <span class="op">/</span></span>
<span id="cb42-1700"><a href="#cb42-1700" aria-hidden="true" tabindex="-1"></a>                inputDeltaCinitial<span class="op">,</span></span>
<span id="cb42-1701"><a href="#cb42-1701" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1702"><a href="#cb42-1702" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1703"><a href="#cb42-1703" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"deltac"</span><span class="op">,</span></span>
<span id="cb42-1704"><a href="#cb42-1704" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1705"><a href="#cb42-1705" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1706"><a href="#cb42-1706" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeDeltaCi</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> deltaA) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb42-1707"><a href="#cb42-1707" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1708"><a href="#cb42-1708" aria-hidden="true" tabindex="-1"></a>      liquidationData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb42-1709"><a href="#cb42-1709" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"spread"</span><span class="op">,</span></span>
<span id="cb42-1710"><a href="#cb42-1710" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb42-1711"><a href="#cb42-1711" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb42-1712"><a href="#cb42-1712" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeSpread</span>(paramAi<span class="op">,</span> paramGi<span class="op">,</span> inputDeltaCinitial)<span class="op">,</span></span>
<span id="cb42-1713"><a href="#cb42-1713" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb42-1714"><a href="#cb42-1714" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-1715"><a href="#cb42-1715" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-1716"><a href="#cb42-1716" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> liquidationData<span class="op">;</span></span>
<span id="cb42-1717"><a href="#cb42-1717" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb42-1718"><a href="#cb42-1718" aria-hidden="true" tabindex="-1"></a>getLiqDeltaA <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"deltaa"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb42-1719"><a href="#cb42-1719" aria-hidden="true" tabindex="-1"></a>getLiqDeltaCi <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"deltac"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb42-1720"><a href="#cb42-1720" aria-hidden="true" tabindex="-1"></a>getLiqSpread <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"spread"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb42-1721"><a href="#cb42-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1722"><a href="#cb42-1722" aria-hidden="true" tabindex="-1"></a>stringInputDeltaCinitial <span class="op">=</span> inputDeltaCinitial<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb42-1723"><a href="#cb42-1723" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb42-1724"><a href="#cb42-1724" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb42-1725"><a href="#cb42-1725" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-42-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1728" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1727;"><span id="cb43-1728"><a href="#cb43-1728" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb43-1729"><a href="#cb43-1729" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb43-1730"><a href="#cb43-1730" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-1731"><a href="#cb43-1731" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb43-1732"><a href="#cb43-1732" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeSpread</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span></span>
<span id="cb43-1733"><a href="#cb43-1733" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb43-1734"><a href="#cb43-1734" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Carbon Difference ε, where initial ΔC = </span><span class="sc">${</span>stringInputDeltaCinitial<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb43-1735"><a href="#cb43-1735" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb43-1736"><a href="#cb43-1736" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb43-1737"><a href="#cb43-1737" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb43-1738"><a href="#cb43-1738" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb43-1739"><a href="#cb43-1739" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb43-1740"><a href="#cb43-1740" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb43-1741"><a href="#cb43-1741" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1742"><a href="#cb43-1742" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1743"><a href="#cb43-1743" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1744"><a href="#cb43-1744" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb43-1745"><a href="#cb43-1745" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqSpread<span class="op">,</span></span>
<span id="cb43-1746"><a href="#cb43-1746" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb43-1747"><a href="#cb43-1747" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb43-1748"><a href="#cb43-1748" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb43-1749"><a href="#cb43-1749" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb43-1750"><a href="#cb43-1750" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqSpread</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb43-1751"><a href="#cb43-1751" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb43-1752"><a href="#cb43-1752" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb43-1753"><a href="#cb43-1753" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1754"><a href="#cb43-1754" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb43-1755"><a href="#cb43-1755" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb43-1756"><a href="#cb43-1756" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span><span class="op">,</span> <span class="fu">computeSpread</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial)]<span class="op">,</span></span>
<span id="cb43-1757"><a href="#cb43-1757" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateSpectral</span><span class="op">,</span></span>
<span id="cb43-1758"><a href="#cb43-1758" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb43-1759"><a href="#cb43-1759" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb43-1760"><a href="#cb43-1760" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb43-1761"><a href="#cb43-1761" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb43-1762"><a href="#cb43-1762" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-43" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-difference-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Carbon ‘difference’.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-carbon-difference-components" class="quarto-xref">Figure&nbsp;14</a> shows the component difference contributions on a carbon supply and purchase round trip of a carbon retirement certificate.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1781" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1780;"><span id="cb44-1781"><a href="#cb44-1781" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb44-1782"><a href="#cb44-1782" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.001</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb44-1783"><a href="#cb44-1783" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial }</span><span class="sc">\D</span><span class="vs">elta C`</span><span class="op">,</span></span>
<span id="cb44-1784"><a href="#cb44-1784" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">0.001</span><span class="op">,</span></span>
<span id="cb44-1785"><a href="#cb44-1785" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb44-1786"><a href="#cb44-1786" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb44-1787"><a href="#cb44-1787" aria-hidden="true" tabindex="-1"></a>  viewof inputDeltaCinitial<span class="op">,</span></span>
<span id="cb44-1788"><a href="#cb44-1788" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-44" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-carbon-difference-components" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-carbon-difference-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1801" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1800;"><span id="cb45-1801"><a href="#cb45-1801" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb45-1802"><a href="#cb45-1802" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb45-1803"><a href="#cb45-1803" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb45-1804"><a href="#cb45-1804" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb45-1805"><a href="#cb45-1805" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb45-1806"><a href="#cb45-1806" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb45-1807"><a href="#cb45-1807" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Component ΔA, where initial ΔC = </span><span class="sc">${</span></span>
<span id="cb45-1808"><a href="#cb45-1808" aria-hidden="true" tabindex="-1"></a>      stringInputDeltaCinitial</span>
<span id="cb45-1809"><a href="#cb45-1809" aria-hidden="true" tabindex="-1"></a>    <span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb45-1810"><a href="#cb45-1810" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb45-1811"><a href="#cb45-1811" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb45-1812"><a href="#cb45-1812" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb45-1813"><a href="#cb45-1813" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb45-1814"><a href="#cb45-1814" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb45-1815"><a href="#cb45-1815" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb45-1816"><a href="#cb45-1816" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb45-1817"><a href="#cb45-1817" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb45-1818"><a href="#cb45-1818" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb45-1819"><a href="#cb45-1819" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb45-1820"><a href="#cb45-1820" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqDeltaA<span class="op">,</span></span>
<span id="cb45-1821"><a href="#cb45-1821" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb45-1822"><a href="#cb45-1822" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb45-1823"><a href="#cb45-1823" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb45-1824"><a href="#cb45-1824" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb45-1825"><a href="#cb45-1825" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqDeltaA</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb45-1826"><a href="#cb45-1826" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb45-1827"><a href="#cb45-1827" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb45-1828"><a href="#cb45-1828" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb45-1829"><a href="#cb45-1829" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(d3<span class="op">.</span><span class="fu">interpolateSpectral</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">,</span></span>
<span id="cb45-1830"><a href="#cb45-1830" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb45-1831"><a href="#cb45-1831" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb45-1832"><a href="#cb45-1832" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-45" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-45-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-45" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-45-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Carbon ‘difference’ component ΔA.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1837" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1836;"><span id="cb46-1837"><a href="#cb46-1837" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb46-1838"><a href="#cb46-1838" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb46-1839"><a href="#cb46-1839" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb46-1840"><a href="#cb46-1840" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Greys"</span><span class="op">,</span></span>
<span id="cb46-1841"><a href="#cb46-1841" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb46-1842"><a href="#cb46-1842" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb46-1843"><a href="#cb46-1843" aria-hidden="true" tabindex="-1"></a>      <span class="fu">computeDeltaCi</span>(</span>
<span id="cb46-1844"><a href="#cb46-1844" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span></span>
<span id="cb46-1845"><a href="#cb46-1845" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span></span>
<span id="cb46-1846"><a href="#cb46-1846" aria-hidden="true" tabindex="-1"></a>        <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb46-1847"><a href="#cb46-1847" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb46-1848"><a href="#cb46-1848" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb46-1849"><a href="#cb46-1849" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="vs">`Component ΔC, where initial ΔC = </span><span class="sc">${</span></span>
<span id="cb46-1850"><a href="#cb46-1850" aria-hidden="true" tabindex="-1"></a>      stringInputDeltaCinitial</span>
<span id="cb46-1851"><a href="#cb46-1851" aria-hidden="true" tabindex="-1"></a>    <span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb46-1852"><a href="#cb46-1852" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb46-1853"><a href="#cb46-1853" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb46-1854"><a href="#cb46-1854" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb46-1855"><a href="#cb46-1855" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb46-1856"><a href="#cb46-1856" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb46-1857"><a href="#cb46-1857" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb46-1858"><a href="#cb46-1858" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb46-1859"><a href="#cb46-1859" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb46-1860"><a href="#cb46-1860" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb46-1861"><a href="#cb46-1861" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb46-1862"><a href="#cb46-1862" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getLiqDeltaCi<span class="op">,</span></span>
<span id="cb46-1863"><a href="#cb46-1863" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb46-1864"><a href="#cb46-1864" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(liquidationData<span class="op">,</span> {</span>
<span id="cb46-1865"><a href="#cb46-1865" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb46-1866"><a href="#cb46-1866" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb46-1867"><a href="#cb46-1867" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(<span class="fu">getLiqDeltaCi</span>(d)) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb46-1868"><a href="#cb46-1868" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb46-1869"><a href="#cb46-1869" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb46-1870"><a href="#cb46-1870" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb46-1871"><a href="#cb46-1871" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb46-1872"><a href="#cb46-1872" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>(</span>
<span id="cb46-1873"><a href="#cb46-1873" aria-hidden="true" tabindex="-1"></a>          [</span>
<span id="cb46-1874"><a href="#cb46-1874" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb46-1875"><a href="#cb46-1875" aria-hidden="true" tabindex="-1"></a>            <span class="fu">computeDeltaCi</span>(</span>
<span id="cb46-1876"><a href="#cb46-1876" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span><span class="op">,</span></span>
<span id="cb46-1877"><a href="#cb46-1877" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span><span class="op">,</span></span>
<span id="cb46-1878"><a href="#cb46-1878" aria-hidden="true" tabindex="-1"></a>              <span class="fu">computeDeltaA</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputDeltaCinitial) <span class="op">/</span> inputDeltaCinitial<span class="op">,</span></span>
<span id="cb46-1879"><a href="#cb46-1879" aria-hidden="true" tabindex="-1"></a>            )<span class="op">,</span></span>
<span id="cb46-1880"><a href="#cb46-1880" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">,</span></span>
<span id="cb46-1881"><a href="#cb46-1881" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="at">interpolateGreys</span><span class="op">,</span></span>
<span id="cb46-1882"><a href="#cb46-1882" aria-hidden="true" tabindex="-1"></a>        )(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb46-1883"><a href="#cb46-1883" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb46-1884"><a href="#cb46-1884" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb46-1885"><a href="#cb46-1885" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb46-1886"><a href="#cb46-1886" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-46" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-46-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-46" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-46-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Carbon ‘difference’ component ΔC.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-carbon-difference-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Carbon ‘difference’ components.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-liquidity-mechanics" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="sec-liquidity-mechanics"><span class="header-section-number">3.3</span> Liquidity Mechanics</h3>
<p>Both <strong>A</strong> and <strong>G</strong> tokens can be used for providing liquidity.</p>
<div id="fig-token-liquidity" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Token liquidity and execution structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-token-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/token-liquidity.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-token-liquidity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Token liquidity and execution structure.
</figcaption>
</figure>
</div>
<p>There are two core liquidity pools:</p>
<ol type="1">
<li><p>An AMM 50:50 pairing of <strong>A</strong> and <strong>G</strong>&nbsp;tokens: pool <span class="overline"><strong>AG</strong></span>.</p></li>
<li><p>A hard currency USDC denoted as <strong>Q</strong> paired with <strong>A</strong>: pool <span class="overline"><strong>AQ</strong></span>.</p></li>
</ol>
<section id="sec-liquidity-fees" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="sec-liquidity-fees"><span class="header-section-number">3.3.1</span> Liquidity Fees</h4>
<p>The <span class="overline"><strong>AQ</strong></span> pool will have its own set of fees in the standard way.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The <span class="overline"><strong>AG</strong></span> pool has different economics as the assets are highly correlated since they represent the same economy. For this reason, the fees are extremely low.</p>
<p>By staking liquidity&nbsp;(liquidity provider tokens) to the <strong>standard durations</strong>, both pools may receive a distribution of <strong>A</strong> tokens determined from <a href="#sec-kvcm-incentives" class="quarto-xref">Section&nbsp;3.3.2</a> below. This is an <u>additional</u> primary issuance to the Base Accrual already discussed.</p>
</section>
<section id="sec-kvcm-incentives" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="sec-kvcm-incentives"><span class="header-section-number">3.3.2</span> kVCM Incentives</h4>
<p>In addition to the base accrual mechanism, <strong>kVCM</strong> incentives are distributed to user-locked <strong>G</strong> token holders and staked liquidity providers of <strong>A</strong> and <strong>G</strong> tokens.</p>
<p>As we have seen, a higher <strong>G</strong> token allocation <span class="math inline">G_i</span> for a carbon class increases the protocol’s capacity to process additional carbon activity without materially altering the execution rate. As a consequence, the relationship between the carbon class selected under <span class="math inline">G_i</span> and the <strong>A</strong> strengthens. If we consider <span class="math inline">G_i</span> as an estimate of residual or idiosyncratic sensitivity in the carbon class, we can calculate an inventory beta <span class="math inline">\beta</span> from the implied betas of each carbon class <span class="math inline">i</span>.</p>
<p><span id="eq-beta"><span class="math display">
\beta = \sqrt{\sum_{i=1}^n A_i - A_i \, (1 - G_i)^2}
\tag{20}</span></span></p>
<p>The inventory <span class="math inline">\beta</span> determines a sensitivity factor for the liquidity pools of <strong>A</strong>.</p>
<p>For intuition, the map in <a href="#fig-range-of-beta-i" class="quarto-xref">Figure&nbsp;16</a> shows the various outputs of the function per carbon class.</p>
<div id="fig-range-of-beta-i" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Range of Beta i.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-range-of-beta-i-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1991" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1990;"><span id="cb47-1991"><a href="#cb47-1991" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeBeta</span>(vecAi<span class="op">,</span> vecGi) {</span>
<span id="cb47-1992"><a href="#cb47-1992" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> beta2 <span class="op">=</span> vecAi<span class="op">.</span><span class="fu">reduce</span>(</span>
<span id="cb47-1993"><a href="#cb47-1993" aria-hidden="true" tabindex="-1"></a>    (acc<span class="op">,</span> Ai<span class="op">,</span> i) <span class="kw">=&gt;</span> acc <span class="op">+</span> Ai <span class="op">-</span> Ai <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> vecGi[i])<span class="op">**</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb47-1994"><a href="#cb47-1994" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span><span class="op">,</span></span>
<span id="cb47-1995"><a href="#cb47-1995" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb47-1996"><a href="#cb47-1996" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(beta2)<span class="op">;</span></span>
<span id="cb47-1997"><a href="#cb47-1997" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-47" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="2001" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2000;"><span id="cb48-2001"><a href="#cb48-2001" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> Gi) {</span>
<span id="cb48-2002"><a href="#cb48-2002" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(Ai <span class="op">-</span> Ai <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> Gi)<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb48-2003"><a href="#cb48-2003" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-48" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="2007" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2006;"><span id="cb49-2007"><a href="#cb49-2007" aria-hidden="true" tabindex="-1"></a>betaData <span class="op">=</span> {</span>
<span id="cb49-2008"><a href="#cb49-2008" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> betaData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb49-2009"><a href="#cb49-2009" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb49-2010"><a href="#cb49-2010" aria-hidden="true" tabindex="-1"></a>    betaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb49-2011"><a href="#cb49-2011" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb49-2012"><a href="#cb49-2012" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ai</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb49-2013"><a href="#cb49-2013" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb49-2014"><a href="#cb49-2014" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb49-2015"><a href="#cb49-2015" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb49-2016"><a href="#cb49-2016" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAi <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> paramAi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb49-2017"><a href="#cb49-2017" aria-hidden="true" tabindex="-1"></a>      betaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb49-2018"><a href="#cb49-2018" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb49-2019"><a href="#cb49-2019" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ai</span><span class="op">:</span> paramAi<span class="op">,</span></span>
<span id="cb49-2020"><a href="#cb49-2020" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb49-2021"><a href="#cb49-2021" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeBetai</span>(paramAi<span class="op">,</span> paramGi)<span class="op">,</span></span>
<span id="cb49-2022"><a href="#cb49-2022" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb49-2023"><a href="#cb49-2023" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb49-2024"><a href="#cb49-2024" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-2025"><a href="#cb49-2025" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> betaData<span class="op">;</span></span>
<span id="cb49-2026"><a href="#cb49-2026" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-49" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="2030" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2029;"><span id="cb50-2030"><a href="#cb50-2030" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb50-2031"><a href="#cb50-2031" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb50-2032"><a href="#cb50-2032" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb50-2033"><a href="#cb50-2033" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb50-2034"><a href="#cb50-2034" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb50-2035"><a href="#cb50-2035" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"βᵢ"</span><span class="op">,</span></span>
<span id="cb50-2036"><a href="#cb50-2036" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb50-2037"><a href="#cb50-2037" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ"</span> }<span class="op">,</span></span>
<span id="cb50-2038"><a href="#cb50-2038" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb50-2039"><a href="#cb50-2039" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb50-2040"><a href="#cb50-2040" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb50-2041"><a href="#cb50-2041" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(betaData<span class="op">,</span> {</span>
<span id="cb50-2042"><a href="#cb50-2042" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb50-2043"><a href="#cb50-2043" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ai</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb50-2044"><a href="#cb50-2044" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb50-2045"><a href="#cb50-2045" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb50-2046"><a href="#cb50-2046" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb50-2047"><a href="#cb50-2047" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb50-2048"><a href="#cb50-2048" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(betaData<span class="op">,</span> {</span>
<span id="cb50-2049"><a href="#cb50-2049" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"ai"</span><span class="op">,</span></span>
<span id="cb50-2050"><a href="#cb50-2050" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb50-2051"><a href="#cb50-2051" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb50-2052"><a href="#cb50-2052" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb50-2053"><a href="#cb50-2053" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb50-2054"><a href="#cb50-2054" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb50-2055"><a href="#cb50-2055" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(d3<span class="op">.</span><span class="fu">interpolateSpectral</span>(d<span class="op">.</span><span class="at">value</span>))<span class="op">,</span></span>
<span id="cb50-2056"><a href="#cb50-2056" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb50-2057"><a href="#cb50-2057" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb50-2058"><a href="#cb50-2058" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-50" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-range-of-beta-i-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Range of <span class="math inline">\beta_i</span>.
</figcaption>
</figure>
</div>
<p>The table and figure below show an example of the effects on <span class="math inline">\beta</span> of allocating large <span class="math inline">G_i</span> values to small <span class="math inline">A_i</span> values where the shift in <span class="math inline">G_i</span> results in a lower <span class="math inline">\beta</span>&nbsp;(0.27 from 0.55) with no change to total <strong>G</strong> and <strong>A</strong> allocations.</p>
<div id="tbl-effect-on-beta-from-outsized-g-staking" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[15,10,10,10,10,10]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-effect-on-beta-from-outsized-g-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Class</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
<th style="text-align: left;">3</th>
<th style="text-align: left;">4</th>
<th style="text-align: left;"><span class="math inline">\beta</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">A_i</span></td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">0.20</td>
<td style="text-align: left;">0.10</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Initial <span class="math inline">G_i</span></td>
<td style="text-align: left;"><span class="blue">0.30</span></td>
<td style="text-align: left;"><span class="blue">0.10</span></td>
<td style="text-align: left;"><span class="blue">0.05</span></td>
<td style="text-align: left;"><span class="blue">0.01</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Initial <span class="math inline">\beta_i^2</span></td>
<td style="text-align: left;">0.2550</td>
<td style="text-align: left;">0.0380</td>
<td style="text-align: left;">0.0098</td>
<td style="text-align: left;">0.0010</td>
<td style="text-align: left;"><span class="blue">0.5511</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">New <span class="math inline">G_i</span></td>
<td style="text-align: left;"><span class="red">0.01</span></td>
<td style="text-align: left;"><span class="red">0.05</span></td>
<td style="text-align: left;"><span class="red">0.10</span></td>
<td style="text-align: left;"><span class="red">0.30</span></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">New <span class="math inline">\beta_i^2</span></td>
<td style="text-align: left;">0.0100</td>
<td style="text-align: left;">0.0195</td>
<td style="text-align: left;">0.0190</td>
<td style="text-align: left;">0.0255</td>
<td style="text-align: left;"><span class="red">0.2719</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\Delta G_i</span></td>
<td style="text-align: left;">(0.29)</td>
<td style="text-align: left;">(0.05)</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;">0.29</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\Delta \beta_i^2</span></td>
<td style="text-align: left;">(0.2451)</td>
<td style="text-align: left;">(0.0185)</td>
<td style="text-align: left;">0.0092</td>
<td style="text-align: left;">0.0245</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-effect-on-beta-from-outsized-g-staking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Effect on <span class="math inline">\beta</span> from outsized <strong>G</strong> allocation.
</figcaption>
</figure>
</div>
<div id="fig-example-of-g-stake-on-beta" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Example of G allocation on Beta.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-example-of-g-stake-on-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="2106" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2105;"><span id="cb51-2106"><a href="#cb51-2106" aria-hidden="true" tabindex="-1"></a>arrayAi <span class="op">=</span> [<span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.2</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.05</span>]<span class="op">;</span></span>
<span id="cb51-2107"><a href="#cb51-2107" aria-hidden="true" tabindex="-1"></a>arrayInitialGi <span class="op">=</span> [<span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.01</span>]<span class="op">;</span></span>
<span id="cb51-2108"><a href="#cb51-2108" aria-hidden="true" tabindex="-1"></a>arrayNewGi <span class="op">=</span> arrayInitialGi<span class="op">.</span><span class="fu">toReversed</span>()<span class="op">;</span></span>
<span id="cb51-2109"><a href="#cb51-2109" aria-hidden="true" tabindex="-1"></a>betaContribData <span class="op">=</span> {</span>
<span id="cb51-2110"><a href="#cb51-2110" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> betaContribData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb51-2111"><a href="#cb51-2111" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> arrayAi<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb51-2112"><a href="#cb51-2112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> Ai <span class="op">=</span> arrayAi[i]<span class="op">;</span></span>
<span id="cb51-2113"><a href="#cb51-2113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialGi <span class="op">=</span> arrayInitialGi[i]<span class="op">;</span></span>
<span id="cb51-2114"><a href="#cb51-2114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialBeta2 <span class="op">=</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> initialGi)<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb51-2115"><a href="#cb51-2115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newGi <span class="op">=</span> arrayNewGi[i]<span class="op">;</span></span>
<span id="cb51-2116"><a href="#cb51-2116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newBeta2 <span class="op">=</span> <span class="fu">computeBetai</span>(Ai<span class="op">,</span> newGi)<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb51-2117"><a href="#cb51-2117" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Initial Gᵢ"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> initialGi })<span class="op">;</span></span>
<span id="cb51-2118"><a href="#cb51-2118" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Initial βᵢ²"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> initialBeta2 })<span class="op">;</span></span>
<span id="cb51-2119"><a href="#cb51-2119" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"New Gᵢ"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> newGi })<span class="op">;</span></span>
<span id="cb51-2120"><a href="#cb51-2120" aria-hidden="true" tabindex="-1"></a>    betaContribData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"New βᵢ²"</span><span class="op">,</span> <span class="dt">class</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> newBeta2 })<span class="op">;</span></span>
<span id="cb51-2121"><a href="#cb51-2121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-2122"><a href="#cb51-2122" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> betaContribData<span class="op">;</span></span>
<span id="cb51-2123"><a href="#cb51-2123" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb51-2124"><a href="#cb51-2124" aria-hidden="true" tabindex="-1"></a>getInitialG <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Initial Gᵢ"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-2125"><a href="#cb51-2125" aria-hidden="true" tabindex="-1"></a>getInitialBeta2 <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Initial βᵢ²"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-2126"><a href="#cb51-2126" aria-hidden="true" tabindex="-1"></a>getNewG <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"New Gᵢ"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-2127"><a href="#cb51-2127" aria-hidden="true" tabindex="-1"></a>getNewBeta2 <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"New βᵢ²"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb51-2128"><a href="#cb51-2128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2129"><a href="#cb51-2129" aria-hidden="true" tabindex="-1"></a>domainG <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d3<span class="op">.</span><span class="fu">max</span>(arrayInitialGi)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(arrayNewGi))]<span class="op">;</span></span>
<span id="cb51-2130"><a href="#cb51-2130" aria-hidden="true" tabindex="-1"></a>rangeBeta2 <span class="op">=</span> [</span>
<span id="cb51-2131"><a href="#cb51-2131" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb51-2132"><a href="#cb51-2132" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(</span>
<span id="cb51-2133"><a href="#cb51-2133" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">max</span>(betaContribData<span class="op">,</span> getInitialBeta2)<span class="op">,</span></span>
<span id="cb51-2134"><a href="#cb51-2134" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">max</span>(betaContribData<span class="op">,</span> getNewBeta2)<span class="op">,</span></span>
<span id="cb51-2135"><a href="#cb51-2135" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb51-2136"><a href="#cb51-2136" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb51-2137"><a href="#cb51-2137" aria-hidden="true" tabindex="-1"></a>scaleG <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(domainG<span class="op">,</span> rangeBeta2)<span class="op">;</span></span>
<span id="cb51-2138"><a href="#cb51-2138" aria-hidden="true" tabindex="-1"></a>mapScaleG <span class="op">=</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>(scaleG)<span class="op">;</span></span>
<span id="cb51-2139"><a href="#cb51-2139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2140"><a href="#cb51-2140" aria-hidden="true" tabindex="-1"></a>paramInitialBeta <span class="op">=</span> <span class="fu">computeBeta</span>(arrayAi<span class="op">,</span> arrayInitialGi)<span class="op">;</span></span>
<span id="cb51-2141"><a href="#cb51-2141" aria-hidden="true" tabindex="-1"></a>paramNewBeta <span class="op">=</span> <span class="fu">computeBeta</span>(arrayAi<span class="op">,</span> arrayNewGi)<span class="op">;</span></span>
<span id="cb51-2142"><a href="#cb51-2142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2143"><a href="#cb51-2143" aria-hidden="true" tabindex="-1"></a>stringInitialBeta <span class="op">=</span> <span class="st">"Initial β = "</span> <span class="op">+</span> paramInitialBeta<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb51-2144"><a href="#cb51-2144" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb51-2145"><a href="#cb51-2145" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb51-2146"><a href="#cb51-2146" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb51-2147"><a href="#cb51-2147" aria-hidden="true" tabindex="-1"></a>stringNewBeta <span class="op">=</span> <span class="st">"New β = "</span> <span class="op">+</span> paramNewBeta<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb51-2148"><a href="#cb51-2148" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb51-2149"><a href="#cb51-2149" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">4</span> }<span class="op">,</span></span>
<span id="cb51-2150"><a href="#cb51-2150" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-51-16" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="2153" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2152;"><span id="cb52-2153"><a href="#cb52-2153" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb52-2154"><a href="#cb52-2154" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb52-2155"><a href="#cb52-2155" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb52-2156"><a href="#cb52-2156" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="st">"gray"</span><span class="op">,</span> <span class="st">"black"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"red"</span>]<span class="op">,</span></span>
<span id="cb52-2157"><a href="#cb52-2157" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Initial βᵢ²"</span><span class="op">,</span> <span class="st">"New βᵢ²"</span><span class="op">,</span> <span class="st">"Initial Gᵢ"</span><span class="op">,</span> <span class="st">"New Gᵢ"</span>]<span class="op">,</span></span>
<span id="cb52-2158"><a href="#cb52-2158" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb52-2159"><a href="#cb52-2159" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb52-2160"><a href="#cb52-2160" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">4</span>)<span class="op">,</span></span>
<span id="cb52-2161"><a href="#cb52-2161" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Aᵢ Over 4 Classes"</span><span class="op">,</span></span>
<span id="cb52-2162"><a href="#cb52-2162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> arrayAi[d]<span class="op">,</span></span>
<span id="cb52-2163"><a href="#cb52-2163" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb52-2164"><a href="#cb52-2164" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> rangeBeta2 }<span class="op">,</span></span>
<span id="cb52-2165"><a href="#cb52-2165" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb52-2166"><a href="#cb52-2166" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb52-2167"><a href="#cb52-2167" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb52-2168"><a href="#cb52-2168" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb52-2169"><a href="#cb52-2169" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb52-2170"><a href="#cb52-2170" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"βᵢ²"</span> })<span class="op">,</span></span>
<span id="cb52-2171"><a href="#cb52-2171" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>(scaleG<span class="op">.</span><span class="fu">ticks</span>()<span class="op">,</span> { <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> scaleG })<span class="op">,</span></span>
<span id="cb52-2172"><a href="#cb52-2172" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(betaContribData<span class="op">,</span> {</span>
<span id="cb52-2173"><a href="#cb52-2173" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb52-2174"><a href="#cb52-2174" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span><span class="op">,</span></span>
<span id="cb52-2175"><a href="#cb52-2175" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialBeta2<span class="op">,</span></span>
<span id="cb52-2176"><a href="#cb52-2176" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb52-2177"><a href="#cb52-2177" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb52-2178"><a href="#cb52-2178" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(betaContribData<span class="op">,</span> {</span>
<span id="cb52-2179"><a href="#cb52-2179" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span><span class="op">,</span></span>
<span id="cb52-2180"><a href="#cb52-2180" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">class</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb52-2181"><a href="#cb52-2181" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewBeta2<span class="op">,</span></span>
<span id="cb52-2182"><a href="#cb52-2182" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb52-2183"><a href="#cb52-2183" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb52-2184"><a href="#cb52-2184" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb52-2185"><a href="#cb52-2185" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb52-2186"><a href="#cb52-2186" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialG<span class="op">,</span></span>
<span id="cb52-2187"><a href="#cb52-2187" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb52-2188"><a href="#cb52-2188" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb52-2189"><a href="#cb52-2189" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb52-2190"><a href="#cb52-2190" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb52-2191"><a href="#cb52-2191" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb52-2192"><a href="#cb52-2192" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getInitialG<span class="op">,</span></span>
<span id="cb52-2193"><a href="#cb52-2193" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb52-2194"><a href="#cb52-2194" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb52-2195"><a href="#cb52-2195" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb52-2196"><a href="#cb52-2196" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb52-2197"><a href="#cb52-2197" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewG<span class="op">,</span></span>
<span id="cb52-2198"><a href="#cb52-2198" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb52-2199"><a href="#cb52-2199" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb52-2200"><a href="#cb52-2200" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb52-2201"><a href="#cb52-2201" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(betaContribData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleG<span class="op">,</span> {</span>
<span id="cb52-2202"><a href="#cb52-2202" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"class"</span><span class="op">,</span></span>
<span id="cb52-2203"><a href="#cb52-2203" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getNewG<span class="op">,</span></span>
<span id="cb52-2204"><a href="#cb52-2204" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb52-2205"><a href="#cb52-2205" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb52-2206"><a href="#cb52-2206" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([stringInitialBeta]<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fl">0.23</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="st">"blue"</span> })<span class="op">,</span></span>
<span id="cb52-2207"><a href="#cb52-2207" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([stringNewBeta]<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fl">0.23</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="st">"red"</span> })<span class="op">,</span></span>
<span id="cb52-2208"><a href="#cb52-2208" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb52-2209"><a href="#cb52-2209" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-52" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-example-of-g-stake-on-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Example of <strong>G</strong> allocation on <span class="math inline">\beta</span>.
</figcaption>
</figure>
</div>
<p><a href="#fig-example-of-g-stake-on-beta" class="quarto-xref">Figure&nbsp;17</a> shows the effect of <strong>G</strong> allocation on <span class="math inline">\beta</span> as a function of <strong>A</strong> allocation; that is to say that a large <span class="math inline">G_i</span> stake on a small <span class="math inline">A_i</span> stake has limited effects&nbsp;(notwithstanding other consequential factors).</p>
</section>
<section id="sec-allocation-of-kvcm-incentives" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="sec-allocation-of-kvcm-incentives"><span class="header-section-number">3.3.3</span> Allocation of kVCM incentives</h4>
<p>The full issuance of <strong>A</strong> tokens is depicted below, including now the <strong>A</strong> incentives for the liquidity pools.</p>
<div id="fig-a-token-flow-structure" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A token flow structure.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-token-flow-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/a-token-flow-structure.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-token-flow-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: <strong>A</strong> token flow structure.
</figcaption>
</figure>
</div>
</section>
<section id="sec-share-of-kvcm-incentives" class="level4" data-number="3.3.4">
<h4 data-number="3.3.4" class="anchored" data-anchor-id="sec-share-of-kvcm-incentives"><span class="header-section-number">3.3.4</span> Share of kVCM incentives</h4>
<p>The <strong>kVCM</strong> incentives are shared between user-locked <strong>G</strong> tokens, <span class="overline"><strong>AG</strong></span>. and <span class="overline"><strong>AQ</strong></span> pools, with shares <span class="math inline">\lambda_{GG}</span>, <span class="math inline">\lambda_G</span>, and <span class="math inline">\lambda_Q</span> respectively.</p>
<p>Defining:</p>
<ul>
<li><p><span class="math inline">G_G</span>: Total <strong>G</strong> tokens in the <span class="overline"><strong>AG</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>G</strong>.</p></li>
<li><p><span class="math inline">A_G</span>: Total <strong>A</strong>&nbsp;tokens in the <span class="overline"><strong>AG</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
<li><p><span class="math inline">A_Q</span>: Total <strong>A</strong>&nbsp;tokens in the <span class="overline"><strong>AQ</strong></span> pool, expressed as a proportion of the outstanding supply of <strong>A</strong>.</p></li>
</ul>
<p>The allocation to user-locked <strong>G</strong> tokens, <span class="math inline">\lambda_{GG}</span>:</p>
<p><span id="eq-lambda-gg"><span class="math display">
\lambda_{GG} = \frac{1 - A_Q}{1 + \left( \frac{\sum_{i=1}^{n}{G_i}}{G_G} \right)^2}
\tag{21}</span></span></p>
<div id="fig-g-stake-allocation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="G stake allocation.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-g-stake-allocation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="2294" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2293;"><span id="cb53-2294"><a href="#cb53-2294" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaGG</span>(AQ<span class="op">,</span> Gi<span class="op">,</span> GG) {</span>
<span id="cb53-2295"><a href="#cb53-2295" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> AQ) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> (Gi <span class="op">/</span> GG)<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb53-2296"><a href="#cb53-2296" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-2297"><a href="#cb53-2297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-2298"><a href="#cb53-2298" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">changeTranslation</span>(dx<span class="op">,</span> dy) {</span>
<span id="cb53-2299"><a href="#cb53-2299" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">function</span> () {</span>
<span id="cb53-2300"><a href="#cb53-2300" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svgTransformList <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">transform</span><span class="op">.</span><span class="at">baseVal</span><span class="op">;</span></span>
<span id="cb53-2301"><a href="#cb53-2301" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (svgTransformList<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb53-2302"><a href="#cb53-2302" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"SVGTransformList must only contain one translation"</span>)<span class="op">;</span></span>
<span id="cb53-2303"><a href="#cb53-2303" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-2304"><a href="#cb53-2304" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {e<span class="op">,</span> f} <span class="op">=</span> svgTransformList<span class="op">.</span><span class="fu">consolidate</span>()<span class="op">.</span><span class="at">matrix</span><span class="op">;</span></span>
<span id="cb53-2305"><a href="#cb53-2305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`translate(</span><span class="sc">${</span>e <span class="op">+</span> dx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>f <span class="op">+</span> dy<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb53-2306"><a href="#cb53-2306" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-2307"><a href="#cb53-2307" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-53-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-53-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="2310" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2309;"><span id="cb54-2310"><a href="#cb54-2310" aria-hidden="true" tabindex="-1"></a>lambdaGGData <span class="op">=</span> {</span>
<span id="cb54-2311"><a href="#cb54-2311" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambdaGGData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb54-2312"><a href="#cb54-2312" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramGi <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramGi <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramGi <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb54-2313"><a href="#cb54-2313" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAQ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAQ <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb54-2314"><a href="#cb54-2314" aria-hidden="true" tabindex="-1"></a>      lambdaGGData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb54-2315"><a href="#cb54-2315" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb54-2316"><a href="#cb54-2316" aria-hidden="true" tabindex="-1"></a>        <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb54-2317"><a href="#cb54-2317" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gi</span><span class="op">:</span> paramGi<span class="op">,</span></span>
<span id="cb54-2318"><a href="#cb54-2318" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaGG</span>(paramAQ<span class="op">,</span> paramGi<span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> paramGi)<span class="op">,</span></span>
<span id="cb54-2319"><a href="#cb54-2319" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb54-2320"><a href="#cb54-2320" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-2321"><a href="#cb54-2321" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-2322"><a href="#cb54-2322" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> lambdaGGData<span class="op">;</span></span>
<span id="cb54-2323"><a href="#cb54-2323" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-54" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="2327" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2326;"><span id="cb55-2327"><a href="#cb55-2327" aria-hidden="true" tabindex="-1"></a>plotLambdaGG <span class="op">=</span> {</span>
<span id="cb55-2328"><a href="#cb55-2328" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotLambdaGG <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb55-2329"><a href="#cb55-2329" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb55-2330"><a href="#cb55-2330" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb55-2331"><a href="#cb55-2331" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb55-2332"><a href="#cb55-2332" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb55-2333"><a href="#cb55-2333" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb55-2334"><a href="#cb55-2334" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb55-2335"><a href="#cb55-2335" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb55-2336"><a href="#cb55-2336" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"A  "</span> }<span class="op">,</span></span>
<span id="cb55-2337"><a href="#cb55-2337" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Gᵢ"</span> }<span class="op">,</span></span>
<span id="cb55-2338"><a href="#cb55-2338" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb55-2339"><a href="#cb55-2339" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb55-2340"><a href="#cb55-2340" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(lambdaGGData<span class="op">,</span> {</span>
<span id="cb55-2341"><a href="#cb55-2341" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2342"><a href="#cb55-2342" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2343"><a href="#cb55-2343" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2344"><a href="#cb55-2344" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gi</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb55-2345"><a href="#cb55-2345" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb55-2346"><a href="#cb55-2346" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb55-2347"><a href="#cb55-2347" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(lambdaGGData<span class="op">,</span> {</span>
<span id="cb55-2348"><a href="#cb55-2348" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"aq"</span><span class="op">,</span></span>
<span id="cb55-2349"><a href="#cb55-2349" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"gi"</span><span class="op">,</span></span>
<span id="cb55-2350"><a href="#cb55-2350" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb55-2351"><a href="#cb55-2351" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb55-2352"><a href="#cb55-2352" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb55-2353"><a href="#cb55-2353" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb55-2354"><a href="#cb55-2354" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb55-2355"><a href="#cb55-2355" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb55-2356"><a href="#cb55-2356" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb55-2357"><a href="#cb55-2357" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb55-2358"><a href="#cb55-2358" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb55-2359"><a href="#cb55-2359" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb55-2360"><a href="#cb55-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-2361"><a href="#cb55-2361" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGG)</span>
<span id="cb55-2362"><a href="#cb55-2362" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='x-axis label']"</span>)</span>
<span id="cb55-2363"><a href="#cb55-2363" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb55-2364"><a href="#cb55-2364" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb55-2365"><a href="#cb55-2365" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="fl">1.5</span>))</span>
<span id="cb55-2366"><a href="#cb55-2366" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb55-2367"><a href="#cb55-2367" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb55-2368"><a href="#cb55-2368" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb55-2369"><a href="#cb55-2369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-2370"><a href="#cb55-2370" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotLambdaGG<span class="op">;</span></span>
<span id="cb55-2371"><a href="#cb55-2371" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-55" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-g-stake-allocation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: <strong>G</strong> stake allocation&nbsp;(assuming <span class="math inline">G_G = 1 - G_i</span>).
</figcaption>
</figure>
</div>
<p>Noting the relationship between <span class="math inline">G</span> and <span class="math inline">\beta</span>, and particularly if <span class="math inline">G = 0</span>, <span class="math inline">\beta = 0</span>.</p>
<p>The residual share, <span class="math inline">1 - \lambda_{GG}</span>, is split between the liquidity pools:</p>
<p><span id="eq-lambda-g"><span class="math display">
\lambda_G = (1 - \lambda_{GG}) \frac{2 A_G}{2 A_G + A_Q \sqrt 2}
\tag{22}</span></span></p>
<p>For completeness:</p>
<p><span id="eq-lambda-q"><span class="math display">
\lambda_Q = 1 - \lambda_{GG} - \lambda_G
\tag{23}</span></span></p>
<div id="fig-liquidity-pool-split" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Liquidity pool split.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-liquidity-pool-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="2400" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2399;"><span id="cb56-2400"><a href="#cb56-2400" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaG</span>(AQ<span class="op">,</span> AG) {</span>
<span id="cb56-2401"><a href="#cb56-2401" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> AG <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> AG <span class="op">+</span> AQ <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb56-2402"><a href="#cb56-2402" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-56" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb57" data-startfrom="2406" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2405;"><span id="cb57-2406"><a href="#cb57-2406" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeLambdaQ</span>(AQ<span class="op">,</span> AG) {</span>
<span id="cb57-2407"><a href="#cb57-2407" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> <span class="fu">computeLambdaG</span>(AQ<span class="op">,</span> AG)<span class="op">;</span></span>
<span id="cb57-2408"><a href="#cb57-2408" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-57" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb58" data-startfrom="2412" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2411;"><span id="cb58-2412"><a href="#cb58-2412" aria-hidden="true" tabindex="-1"></a>lambdaGQData <span class="op">=</span> {</span>
<span id="cb58-2413"><a href="#cb58-2413" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambdaGQData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb58-2414"><a href="#cb58-2414" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramAG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb58-2415"><a href="#cb58-2415" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramAQ <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramAQ <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb58-2416"><a href="#cb58-2416" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramAG <span class="op">+</span> paramAQ <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb58-2417"><a href="#cb58-2417" aria-hidden="true" tabindex="-1"></a>        lambdaGQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb58-2418"><a href="#cb58-2418" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"Relative 𝗔𝗚 Liquidity Pool Share"</span><span class="op">,</span></span>
<span id="cb58-2419"><a href="#cb58-2419" aria-hidden="true" tabindex="-1"></a>          <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb58-2420"><a href="#cb58-2420" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ag</span><span class="op">:</span> paramAG<span class="op">,</span></span>
<span id="cb58-2421"><a href="#cb58-2421" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaG</span>(paramAQ<span class="op">,</span> paramAG)<span class="op">,</span></span>
<span id="cb58-2422"><a href="#cb58-2422" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb58-2423"><a href="#cb58-2423" aria-hidden="true" tabindex="-1"></a>        lambdaGQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb58-2424"><a href="#cb58-2424" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"Relative 𝗔𝗤 Liquidity Pool Share"</span><span class="op">,</span></span>
<span id="cb58-2425"><a href="#cb58-2425" aria-hidden="true" tabindex="-1"></a>          <span class="dt">aq</span><span class="op">:</span> paramAQ<span class="op">,</span></span>
<span id="cb58-2426"><a href="#cb58-2426" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ag</span><span class="op">:</span> paramAG<span class="op">,</span></span>
<span id="cb58-2427"><a href="#cb58-2427" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeLambdaQ</span>(paramAQ<span class="op">,</span> paramAG)<span class="op">,</span></span>
<span id="cb58-2428"><a href="#cb58-2428" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb58-2429"><a href="#cb58-2429" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb58-2430"><a href="#cb58-2430" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-2431"><a href="#cb58-2431" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-2432"><a href="#cb58-2432" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> lambdaGQData<span class="op">;</span></span>
<span id="cb58-2433"><a href="#cb58-2433" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-58" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb59" data-startfrom="2437" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2436;"><span id="cb59-2437"><a href="#cb59-2437" aria-hidden="true" tabindex="-1"></a>plotLambdaGQ <span class="op">=</span> {</span>
<span id="cb59-2438"><a href="#cb59-2438" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotLambdaGQ <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb59-2439"><a href="#cb59-2439" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb59-2440"><a href="#cb59-2440" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb59-2441"><a href="#cb59-2441" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb59-2442"><a href="#cb59-2442" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb59-2443"><a href="#cb59-2443" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb59-2444"><a href="#cb59-2444" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb59-2445"><a href="#cb59-2445" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"λ"</span><span class="op">,</span></span>
<span id="cb59-2446"><a href="#cb59-2446" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb59-2447"><a href="#cb59-2447" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"A  "</span> }<span class="op">,</span></span>
<span id="cb59-2448"><a href="#cb59-2448" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb59-2449"><a href="#cb59-2449" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb59-2450"><a href="#cb59-2450" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb59-2451"><a href="#cb59-2451" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"A"</span><span class="op">,</span></span>
<span id="cb59-2452"><a href="#cb59-2452" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb59-2453"><a href="#cb59-2453" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb59-2454"><a href="#cb59-2454" aria-hidden="true" tabindex="-1"></a>    <span class="dt">className</span><span class="op">:</span> <span class="st">"LambdaGQ"</span><span class="op">,</span></span>
<span id="cb59-2455"><a href="#cb59-2455" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb59-2456"><a href="#cb59-2456" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb59-2457"><a href="#cb59-2457" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(lambdaGQData<span class="op">,</span> {</span>
<span id="cb59-2458"><a href="#cb59-2458" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2459"><a href="#cb59-2459" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">aq</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2460"><a href="#cb59-2460" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ag</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2461"><a href="#cb59-2461" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ag</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb59-2462"><a href="#cb59-2462" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb59-2463"><a href="#cb59-2463" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb59-2464"><a href="#cb59-2464" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb59-2465"><a href="#cb59-2465" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(lambdaGQData<span class="op">,</span> {</span>
<span id="cb59-2466"><a href="#cb59-2466" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"aq"</span><span class="op">,</span></span>
<span id="cb59-2467"><a href="#cb59-2467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"ag"</span><span class="op">,</span></span>
<span id="cb59-2468"><a href="#cb59-2468" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb59-2469"><a href="#cb59-2469" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb59-2470"><a href="#cb59-2470" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb59-2471"><a href="#cb59-2471" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb59-2472"><a href="#cb59-2472" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb59-2473"><a href="#cb59-2473" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb59-2474"><a href="#cb59-2474" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb59-2475"><a href="#cb59-2475" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb59-2476"><a href="#cb59-2476" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb59-2477"><a href="#cb59-2477" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb59-2478"><a href="#cb59-2478" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb59-2479"><a href="#cb59-2479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-2480"><a href="#cb59-2480" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGQ)</span>
<span id="cb59-2481"><a href="#cb59-2481" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='x-axis label']"</span>)</span>
<span id="cb59-2482"><a href="#cb59-2482" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb59-2483"><a href="#cb59-2483" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb59-2484"><a href="#cb59-2484" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="fl">1.5</span>))</span>
<span id="cb59-2485"><a href="#cb59-2485" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb59-2486"><a href="#cb59-2486" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb59-2487"><a href="#cb59-2487" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Q"</span>)<span class="op">;</span></span>
<span id="cb59-2488"><a href="#cb59-2488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-2489"><a href="#cb59-2489" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotLambdaGQ)</span>
<span id="cb59-2490"><a href="#cb59-2490" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb59-2491"><a href="#cb59-2491" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb59-2492"><a href="#cb59-2492" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb59-2493"><a href="#cb59-2493" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>(<span class="kw">false</span>)</span>
<span id="cb59-2494"><a href="#cb59-2494" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">14</span><span class="op">,</span> <span class="fl">4.1</span>))</span>
<span id="cb59-2495"><a href="#cb59-2495" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"0.6em"</span>)</span>
<span id="cb59-2496"><a href="#cb59-2496" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb59-2497"><a href="#cb59-2497" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"G"</span>)<span class="op">;</span></span>
<span id="cb59-2498"><a href="#cb59-2498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-2499"><a href="#cb59-2499" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotLambdaGQ<span class="op">;</span></span>
<span id="cb59-2500"><a href="#cb59-2500" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-59" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-liquidity-pool-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Liquidity pool split <span class="math inline">\lambda_G, \lambda_Q</span>.
</figcaption>
</figure>
</div>
</section>
<section id="sec-kvcm-incentives-distribution" class="level4" data-number="3.3.5">
<h4 data-number="3.3.5" class="anchored" data-anchor-id="sec-kvcm-incentives-distribution"><span class="header-section-number">3.3.5</span> kVCM Incentives Distribution</h4>
<p>For <span class="math inline">\lambda_{GG}</span>, <span class="math inline">\lambda_G</span>, <span class="math inline">\lambda_Q</span> we apply <span class="math inline">\beta</span>:</p>
<p><span id="eq-capital-lambda"><span class="math display">
\Lambda_X = \lambda_X \, \beta, \quad \text{for } X \in \{GG, G, Q\}
\tag{24}</span></span></p>
<p>Taking <span class="math inline">b</span> as a discount parameter:</p>
<p><span id="eq-discount-parameter"><span class="math display">
b = \frac{\sum_1^{40} Z_t \, S_t \, B_t}{\sum_1^{40} Z_t \, S_t }
\tag{25}</span></span></p>
<p>The total <strong>kVCM</strong> incentive tokens <span class="math inline">R_\lambda</span>:</p>
<p><span id="eq-kvcm-incentives"><span class="math display">
R_\lambda = b \, R \, (\Lambda_{GG} + \Lambda_G + \Lambda_Q)
\tag{26}</span></span></p>
<p>The allocations of <span class="math inline">R_\lambda</span> are pro-rata to <span class="math inline">\Lambda_{GG}</span>, <span class="math inline">\Lambda_G</span>, <span class="math inline">\Lambda_Q</span>, and thereafter:</p>
<ol type="1">
<li><p>Locked <strong>G</strong>: <span class="math inline">\Lambda_{GG}</span> in proportion to <strong>G</strong>.</p></li>
<li><p>Locked <span class="overline"><strong>AG</strong></span>, <span class="overline"><strong>AQ</strong></span> tokens are allocated a weighting <span class="math inline">G_t</span>, <span class="math inline">Q_t</span> depending on their time bucket <span class="math inline">t</span>:</p>
<p><span id="eq-kvcm-incentives-weighting-ag-pool"><span class="math display">
G_t = \frac{Z_t \, L_{Gt} \, B_t}{\sum Z_t \, L_{Gt} \, B_t}
  \tag{27}</span></span></p>
<p><span id="eq-kvcm-incentives-weighting-aq-pool"><span class="math display">
Q_t = \frac{Z_t \, L_{Qt} \, B_t}{\sum Z_t \, L_{Qt} \, B_t}
  \tag{28}</span></span></p>
<p>Where <span class="math inline">L_{Gt}</span>, <span class="math inline">L_{Qt}</span> are the proportion of all liquidity locked in each time bucket for <span class="overline"><strong>AG</strong></span> and <span class="overline"><strong>AQ</strong></span> respectively.</p></li>
</ol>
<p>Thereafter each time bucket allocation is proportionate to staked liquidity provider token holdings.</p>
</section>
</section>
<section id="sec-interactive-model" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="sec-interactive-model"><span class="header-section-number">3.4</span> Interactive Model</h3>
<p>This additional section is only in the interactive version of the whitepaper. It presents an interactive model where parameters of interest can be adjusted by the reader.</p>
<p>In <a href="#sec-kvcm-tokens-minted-when-the-protocol-acquires-carbon" class="quarto-xref">Section&nbsp;3.4.1</a>, a carbon supplier swaps carbon to the protocol in exchange for <strong>A</strong> tokens; from the point of view of the protocol, this represents a carbon acquisition. In <a href="#sec-carbon-retired-by-the-protocol-when-it-burns-kvcm-tokens" class="quarto-xref">Section&nbsp;3.4.2</a>, a holder of <strong>A</strong> tokens burns them to retire carbon from the protocol; from the point of view of the protocol, this represents a carbon retirement.</p>
<section id="sec-kvcm-tokens-minted-when-the-protocol-acquires-carbon" class="level4" data-number="3.4.1">
<h4 data-number="3.4.1" class="anchored" data-anchor-id="sec-kvcm-tokens-minted-when-the-protocol-acquires-carbon"><span class="header-section-number">3.4.1</span> kVCM Tokens Minted When the Protocol Acquires Carbon</h4>
<p>In this section, the reader controls how many tonnes of carbon class <span class="math inline">i</span> are acquired by the protocol. The number of <strong>A</strong> tokens emitted in exchange is calculated in real time. The price of carbon class <span class="math inline">i</span> is calculated by dividing the number of <strong>A</strong> tokens emitted by the protocol by the number of tonnes purchased by the protocol.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb60" data-startfrom="2598" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2597;"><span id="cb60-2598"><a href="#cb60-2598" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">piecewiseLogTransform</span>(xTran <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb60-2599"><a href="#cb60-2599" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="kw">=&gt;</span> x <span class="op">&gt;</span> xTran <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x) <span class="op">:</span> x <span class="op">-</span> xTran <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(xTran)<span class="op">;</span></span>
<span id="cb60-2600"><a href="#cb60-2600" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-2601"><a href="#cb60-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2602"><a href="#cb60-2602" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">piecewiseLogInvert</span>(xTran <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb60-2603"><a href="#cb60-2603" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> y <span class="kw">=&gt;</span> y <span class="op">&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(xTran) <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(y) <span class="op">:</span> y <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(xTran) <span class="op">+</span> xTran<span class="op">;</span></span>
<span id="cb60-2604"><a href="#cb60-2604" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-2605"><a href="#cb60-2605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2606"><a href="#cb60-2606" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setInput</span>(input<span class="op">,</span> value) {</span>
<span id="cb60-2607"><a href="#cb60-2607" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb60-2608"><a href="#cb60-2608" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb60-2609"><a href="#cb60-2609" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-2610"><a href="#cb60-2610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2611"><a href="#cb60-2611" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">numDigits</span>(x) {</span>
<span id="cb60-2612"><a href="#cb60-2612" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> (<span class="dv">1</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">log10</span>(x)))<span class="op">;</span></span>
<span id="cb60-2613"><a href="#cb60-2613" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-60-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb61" data-startfrom="2617" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2616;"><span id="cb61-2617"><a href="#cb61-2617" aria-hidden="true" tabindex="-1"></a>defaultAValue <span class="op">=</span> <span class="fl">2e6</span><span class="op">;</span></span>
<span id="cb61-2618"><a href="#cb61-2618" aria-hidden="true" tabindex="-1"></a>defaultASupply <span class="op">=</span> <span class="fl">2e7</span><span class="op">;</span></span>
<span id="cb61-2619"><a href="#cb61-2619" aria-hidden="true" tabindex="-1"></a>defaultPresentTonnes <span class="op">=</span> <span class="fl">1e7</span><span class="op">;</span></span>
<span id="cb61-2620"><a href="#cb61-2620" aria-hidden="true" tabindex="-1"></a>defaultDeltaTonnes <span class="op">=</span> <span class="fl">1e2</span><span class="op">;</span></span>
<span id="cb61-2621"><a href="#cb61-2621" aria-hidden="true" tabindex="-1"></a>defaultAi <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb61-2622"><a href="#cb61-2622" aria-hidden="true" tabindex="-1"></a>defaultGi <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-61-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-61-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-61-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-61-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-61-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-61-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb62" data-startfrom="2625" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2624;"><span id="cb62-2625"><a href="#cb62-2625" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>(</span>
<span id="cb62-2626"><a href="#cb62-2626" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">"Reset"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb62-2627"><a href="#cb62-2627" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAValue<span class="op">,</span> defaultAValue)<span class="op">;</span></span>
<span id="cb62-2628"><a href="#cb62-2628" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputASupply<span class="op">,</span> defaultASupply)<span class="op">;</span></span>
<span id="cb62-2629"><a href="#cb62-2629" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputPresentTonnes<span class="op">,</span> defaultPresentTonnes)<span class="op">;</span></span>
<span id="cb62-2630"><a href="#cb62-2630" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputDeltaTonnes<span class="op">,</span> defaultDeltaTonnes)<span class="op">;</span></span>
<span id="cb62-2631"><a href="#cb62-2631" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAi<span class="op">,</span> defaultAi)<span class="op">;</span></span>
<span id="cb62-2632"><a href="#cb62-2632" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputGi<span class="op">,</span> defaultGi)<span class="op">;</span></span>
<span id="cb62-2633"><a href="#cb62-2633" aria-hidden="true" tabindex="-1"></a>  }]]<span class="op">,</span></span>
<span id="cb62-2634"><a href="#cb62-2634" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-62" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb63" data-startfrom="2639" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2638;"><span id="cb63-2639"><a href="#cb63-2639" aria-hidden="true" tabindex="-1"></a>viewof inputAValue <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e5</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb63-2640"><a href="#cb63-2640" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Market cap. of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb63-2641"><a href="#cb63-2641" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb63-2642"><a href="#cb63-2642" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAValue<span class="op">,</span></span>
<span id="cb63-2643"><a href="#cb63-2643" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb63-2644"><a href="#cb63-2644" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb63-2645"><a href="#cb63-2645" aria-hidden="true" tabindex="-1"></a>viewof inputASupply <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e6</span><span class="op">,</span> <span class="fl">1e10</span>]<span class="op">,</span> {</span>
<span id="cb63-2646"><a href="#cb63-2646" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Supply of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb63-2647"><a href="#cb63-2647" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb63-2648"><a href="#cb63-2648" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultASupply<span class="op">,</span></span>
<span id="cb63-2649"><a href="#cb63-2649" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb63-2650"><a href="#cb63-2650" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb63-2651"><a href="#cb63-2651" aria-hidden="true" tabindex="-1"></a>viewof inputPresentTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb63-2652"><a href="#cb63-2652" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Inventory } C_i`</span><span class="op">,</span></span>
<span id="cb63-2653"><a href="#cb63-2653" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb63-2654"><a href="#cb63-2654" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultPresentTonnes<span class="op">,</span></span>
<span id="cb63-2655"><a href="#cb63-2655" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-3</span>)<span class="op">,</span></span>
<span id="cb63-2656"><a href="#cb63-2656" aria-hidden="true" tabindex="-1"></a>  <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-3</span>)<span class="op">,</span></span>
<span id="cb63-2657"><a href="#cb63-2657" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb63-2658"><a href="#cb63-2658" aria-hidden="true" tabindex="-1"></a>viewof inputDeltaTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-3</span><span class="op">,</span> <span class="fl">1e7</span>]<span class="op">,</span> {</span>
<span id="cb63-2659"><a href="#cb63-2659" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Purchased tonnes}`</span><span class="op">,</span></span>
<span id="cb63-2660"><a href="#cb63-2660" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb63-2661"><a href="#cb63-2661" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultDeltaTonnes<span class="op">,</span></span>
<span id="cb63-2662"><a href="#cb63-2662" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb63-2663"><a href="#cb63-2663" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb63-2664"><a href="#cb63-2664" aria-hidden="true" tabindex="-1"></a>viewof inputAi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb63-2665"><a href="#cb63-2665" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } A_i`</span><span class="op">,</span></span>
<span id="cb63-2666"><a href="#cb63-2666" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb63-2667"><a href="#cb63-2667" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAi<span class="op">,</span></span>
<span id="cb63-2668"><a href="#cb63-2668" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb63-2669"><a href="#cb63-2669" aria-hidden="true" tabindex="-1"></a>  <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb63-2670"><a href="#cb63-2670" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb63-2671"><a href="#cb63-2671" aria-hidden="true" tabindex="-1"></a>viewof inputGi <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb63-2672"><a href="#cb63-2672" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } G_i`</span><span class="op">,</span></span>
<span id="cb63-2673"><a href="#cb63-2673" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb63-2674"><a href="#cb63-2674" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultGi<span class="op">,</span></span>
<span id="cb63-2675"><a href="#cb63-2675" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-63-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-63-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-63-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-63-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-63-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-63-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb64" data-startfrom="2679" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2678;"><span id="cb64-2679"><a href="#cb64-2679" aria-hidden="true" tabindex="-1"></a>paramDeltaA <span class="op">=</span> <span class="fu">computeTrueDeltaA</span>(</span>
<span id="cb64-2680"><a href="#cb64-2680" aria-hidden="true" tabindex="-1"></a>  inputAi<span class="op">,</span></span>
<span id="cb64-2681"><a href="#cb64-2681" aria-hidden="true" tabindex="-1"></a>  inputGi<span class="op">,</span></span>
<span id="cb64-2682"><a href="#cb64-2682" aria-hidden="true" tabindex="-1"></a>  inputPresentTonnes<span class="op">,</span></span>
<span id="cb64-2683"><a href="#cb64-2683" aria-hidden="true" tabindex="-1"></a>  inputDeltaTonnes<span class="op">,</span></span>
<span id="cb64-2684"><a href="#cb64-2684" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb64-2685"><a href="#cb64-2685" aria-hidden="true" tabindex="-1"></a>paramDeltaTonnes <span class="op">=</span> paramDeltaA <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputDeltaTonnes<span class="op">;</span></span>
<span id="cb64-2686"><a href="#cb64-2686" aria-hidden="true" tabindex="-1"></a>paramAEmitted <span class="op">=</span> paramDeltaA <span class="op">*</span> inputASupply<span class="op">;</span></span>
<span id="cb64-2687"><a href="#cb64-2687" aria-hidden="true" tabindex="-1"></a>paramAPrice <span class="op">=</span> inputAValue <span class="op">/</span> inputASupply<span class="op">;</span></span>
<span id="cb64-2688"><a href="#cb64-2688" aria-hidden="true" tabindex="-1"></a>paramBarCiPrice <span class="op">=</span> inputAValue <span class="op">*</span> paramDeltaA <span class="op">/</span> inputDeltaTonnes<span class="op">;</span></span>
<span id="cb64-2689"><a href="#cb64-2689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2690"><a href="#cb64-2690" aria-hidden="true" tabindex="-1"></a>stringASupply <span class="op">=</span> inputASupply<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2691"><a href="#cb64-2691" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2692"><a href="#cb64-2692" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb64-2693"><a href="#cb64-2693" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb64-2694"><a href="#cb64-2694" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb64-2695"><a href="#cb64-2695" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb64-2696"><a href="#cb64-2696" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb64-2697"><a href="#cb64-2697" aria-hidden="true" tabindex="-1"></a>stringPresentTonnes <span class="op">=</span> inputPresentTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2698"><a href="#cb64-2698" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2699"><a href="#cb64-2699" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb64-2700"><a href="#cb64-2700" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb64-2701"><a href="#cb64-2701" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb64-2702"><a href="#cb64-2702" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb64-2703"><a href="#cb64-2703" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb64-2704"><a href="#cb64-2704" aria-hidden="true" tabindex="-1"></a>stringAEmitted <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> paramAEmitted<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2705"><a href="#cb64-2705" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2706"><a href="#cb64-2706" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb64-2707"><a href="#cb64-2707" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb64-2708"><a href="#cb64-2708" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramAEmitted))<span class="op">,</span></span>
<span id="cb64-2709"><a href="#cb64-2709" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb64-2710"><a href="#cb64-2710" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb64-2711"><a href="#cb64-2711" aria-hidden="true" tabindex="-1"></a>stringDeltaTonnes <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> paramDeltaTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2712"><a href="#cb64-2712" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2713"><a href="#cb64-2713" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb64-2714"><a href="#cb64-2714" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">3</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb64-2715"><a href="#cb64-2715" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">3</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaTonnes))<span class="op">,</span></span>
<span id="cb64-2716"><a href="#cb64-2716" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb64-2717"><a href="#cb64-2717" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb64-2718"><a href="#cb64-2718" aria-hidden="true" tabindex="-1"></a>stringAPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramAPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2719"><a href="#cb64-2719" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2720"><a href="#cb64-2720" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb64-2721"><a href="#cb64-2721" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice))<span class="op">,</span></span>
<span id="cb64-2722"><a href="#cb64-2722" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice))<span class="op">,</span></span>
<span id="cb64-2723"><a href="#cb64-2723" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb64-2724"><a href="#cb64-2724" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb64-2725"><a href="#cb64-2725" aria-hidden="true" tabindex="-1"></a>stringBarCiPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramBarCiPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb64-2726"><a href="#cb64-2726" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb64-2727"><a href="#cb64-2727" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb64-2728"><a href="#cb64-2728" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramBarCiPrice))<span class="op">,</span></span>
<span id="cb64-2729"><a href="#cb64-2729" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramBarCiPrice))<span class="op">,</span></span>
<span id="cb64-2730"><a href="#cb64-2730" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb64-2731"><a href="#cb64-2731" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-64-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Supply of <strong>A</strong> Tokens</th>
<th style="text-align: right;">Inventory Carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-3"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-4"></span></span></td>
</tr>
<tr class="even">
<td><strong>Variation</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-5"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-6"></span></span></td>
</tr>
<tr class="odd">
<td><strong>Unit Price</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-7"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-8"></span></span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sec-carbon-retired-by-the-protocol-when-it-burns-kvcm-tokens" class="level4" data-number="3.4.2">
<h4 data-number="3.4.2" class="anchored" data-anchor-id="sec-carbon-retired-by-the-protocol-when-it-burns-kvcm-tokens"><span class="header-section-number">3.4.2</span> Carbon Retired by the Protocol When it Burns kVCM Tokens</h4>
<p>In this section, the reader controls how many <strong>A</strong> tokens are burnt by the protocol. The number of liquid tonnes retired by the protocol AAM in exchange is calculated in real time. The price of carbon is calculated by dividing the number of <strong>A</strong> tokens burnt by the protocol by the number of tonnes of carbon retired.</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb65" data-startfrom="2757" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2756;"><span id="cb65-2757"><a href="#cb65-2757" aria-hidden="true" tabindex="-1"></a>defaultLiquidTonnes <span class="op">=</span> <span class="fl">1e7</span><span class="op">;</span></span>
<span id="cb65-2758"><a href="#cb65-2758" aria-hidden="true" tabindex="-1"></a>defaultABurnt <span class="op">=</span> <span class="fl">1e2</span><span class="op">;</span></span>
<span id="cb65-2759"><a href="#cb65-2759" aria-hidden="true" tabindex="-1"></a>defaultGnull <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb65-2760"><a href="#cb65-2760" aria-hidden="true" tabindex="-1"></a>defaultA <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb65-2761"><a href="#cb65-2761" aria-hidden="true" tabindex="-1"></a>defaultS <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-65-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-65-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-65-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-65-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-65-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb66" data-startfrom="2764" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2763;"><span id="cb66-2764"><a href="#cb66-2764" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>(</span>
<span id="cb66-2765"><a href="#cb66-2765" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">"Reset"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb66-2766"><a href="#cb66-2766" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAValue_<span class="op">,</span> defaultAValue)<span class="op">;</span></span>
<span id="cb66-2767"><a href="#cb66-2767" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputASupply_<span class="op">,</span> defaultASupply)<span class="op">;</span></span>
<span id="cb66-2768"><a href="#cb66-2768" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputLiquidTonnes<span class="op">,</span> defaultLiquidTonnes)<span class="op">;</span></span>
<span id="cb66-2769"><a href="#cb66-2769" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputABurnt<span class="op">,</span> defaultABurnt)<span class="op">;</span></span>
<span id="cb66-2770"><a href="#cb66-2770" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputAi<span class="op">,</span> defaultAi)<span class="op">;</span></span>
<span id="cb66-2771"><a href="#cb66-2771" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setInput</span>(viewof inputGi<span class="op">,</span> defaultGi)<span class="op">;</span></span>
<span id="cb66-2772"><a href="#cb66-2772" aria-hidden="true" tabindex="-1"></a>  }]]<span class="op">,</span></span>
<span id="cb66-2773"><a href="#cb66-2773" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-66" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb67" data-startfrom="2778" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2777;"><span id="cb67-2778"><a href="#cb67-2778" aria-hidden="true" tabindex="-1"></a>viewof inputAValue_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e5</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb67-2779"><a href="#cb67-2779" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Market cap. of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb67-2780"><a href="#cb67-2780" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb67-2781"><a href="#cb67-2781" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultAValue<span class="op">,</span></span>
<span id="cb67-2782"><a href="#cb67-2782" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb67-2783"><a href="#cb67-2783" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb67-2784"><a href="#cb67-2784" aria-hidden="true" tabindex="-1"></a>viewof inputASupply_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e6</span><span class="op">,</span> <span class="fl">1e10</span>]<span class="op">,</span> {</span>
<span id="cb67-2785"><a href="#cb67-2785" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Supply of </span><span class="sc">\t</span><span class="vs">extbf{A}}`</span><span class="op">,</span></span>
<span id="cb67-2786"><a href="#cb67-2786" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb67-2787"><a href="#cb67-2787" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultASupply<span class="op">,</span></span>
<span id="cb67-2788"><a href="#cb67-2788" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb67-2789"><a href="#cb67-2789" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb67-2790"><a href="#cb67-2790" aria-hidden="true" tabindex="-1"></a>viewof inputLiquidTonnes <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-3</span><span class="op">,</span> <span class="fl">1e9</span>]<span class="op">,</span> {</span>
<span id="cb67-2791"><a href="#cb67-2791" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Inventory } C_i`</span><span class="op">,</span></span>
<span id="cb67-2792"><a href="#cb67-2792" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-3</span><span class="op">,</span></span>
<span id="cb67-2793"><a href="#cb67-2793" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultLiquidTonnes<span class="op">,</span></span>
<span id="cb67-2794"><a href="#cb67-2794" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb67-2795"><a href="#cb67-2795" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb67-2796"><a href="#cb67-2796" aria-hidden="true" tabindex="-1"></a>viewof inputABurnt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">1e-1</span><span class="op">,</span> <span class="fl">1e6</span>]<span class="op">,</span> {</span>
<span id="cb67-2797"><a href="#cb67-2797" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{</span><span class="sc">\t</span><span class="vs">extbf{A} tokens burnt}`</span><span class="op">,</span></span>
<span id="cb67-2798"><a href="#cb67-2798" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-1</span><span class="op">,</span></span>
<span id="cb67-2799"><a href="#cb67-2799" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> defaultABurnt<span class="op">,</span></span>
<span id="cb67-2800"><a href="#cb67-2800" aria-hidden="true" tabindex="-1"></a>  <span class="dt">transform</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span><span class="op">,</span></span>
<span id="cb67-2801"><a href="#cb67-2801" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb67-2802"><a href="#cb67-2802" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb67-2803"><a href="#cb67-2803" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb67-2804"><a href="#cb67-2804" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } A_i`</span><span class="op">,</span></span>
<span id="cb67-2805"><a href="#cb67-2805" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb67-2806"><a href="#cb67-2806" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> defaultAi<span class="op">,</span></span>
<span id="cb67-2807"><a href="#cb67-2807" aria-hidden="true" tabindex="-1"></a>    <span class="dt">transform</span><span class="op">:</span> <span class="fu">piecewiseLogTransform</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb67-2808"><a href="#cb67-2808" aria-hidden="true" tabindex="-1"></a>    <span class="dt">invert</span><span class="op">:</span> <span class="fu">piecewiseLogInvert</span>(<span class="fl">1e-6</span>)<span class="op">,</span></span>
<span id="cb67-2809"><a href="#cb67-2809" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb67-2810"><a href="#cb67-2810" aria-hidden="true" tabindex="-1"></a>  viewof inputAi<span class="op">,</span></span>
<span id="cb67-2811"><a href="#cb67-2811" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-67-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-67-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-67-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-67-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-67-5" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb68" data-startfrom="2812" data-source-offset="-864"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2811;"><span id="cb68-2812"><a href="#cb68-2812" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb68-2813"><a href="#cb68-2813" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb68-2814"><a href="#cb68-2814" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Allocation } G_i`</span><span class="op">,</span></span>
<span id="cb68-2815"><a href="#cb68-2815" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb68-2816"><a href="#cb68-2816" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> defaultGi<span class="op">,</span></span>
<span id="cb68-2817"><a href="#cb68-2817" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb68-2818"><a href="#cb68-2818" aria-hidden="true" tabindex="-1"></a>  viewof inputGi<span class="op">,</span></span>
<span id="cb68-2819"><a href="#cb68-2819" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-67-6" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb69" data-startfrom="2823" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2822;"><span id="cb69-2823"><a href="#cb69-2823" aria-hidden="true" tabindex="-1"></a>paramABurnt <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputABurnt</span>
<span id="cb69-2824"><a href="#cb69-2824" aria-hidden="true" tabindex="-1"></a>paramDeltaA_ <span class="op">=</span> paramABurnt <span class="op">/</span> inputASupply_<span class="op">;</span></span>
<span id="cb69-2825"><a href="#cb69-2825" aria-hidden="true" tabindex="-1"></a>paramDeltaCi <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="op">-</span><span class="dv">0</span> <span class="op">:</span> <span class="fu">computeDeltaCi</span>(</span>
<span id="cb69-2826"><a href="#cb69-2826" aria-hidden="true" tabindex="-1"></a>  inputAi<span class="op">,</span></span>
<span id="cb69-2827"><a href="#cb69-2827" aria-hidden="true" tabindex="-1"></a>  inputGi<span class="op">,</span></span>
<span id="cb69-2828"><a href="#cb69-2828" aria-hidden="true" tabindex="-1"></a>  paramDeltaA_<span class="op">,</span></span>
<span id="cb69-2829"><a href="#cb69-2829" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb69-2830"><a href="#cb69-2830" aria-hidden="true" tabindex="-1"></a>paramDeltaCiTonnes <span class="op">=</span> <span class="op">-</span>paramDeltaCi <span class="op">*</span> inputLiquidTonnes<span class="op">;</span></span>
<span id="cb69-2831"><a href="#cb69-2831" aria-hidden="true" tabindex="-1"></a>paramAPrice_ <span class="op">=</span> inputAValue_ <span class="op">/</span> inputASupply_<span class="op">;</span></span>
<span id="cb69-2832"><a href="#cb69-2832" aria-hidden="true" tabindex="-1"></a>paramCiPrice <span class="op">=</span> inputAi <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> inputAValue_ <span class="op">*</span> paramDeltaA_ <span class="op">/</span> paramDeltaCiTonnes<span class="op">;</span></span>
<span id="cb69-2833"><a href="#cb69-2833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2834"><a href="#cb69-2834" aria-hidden="true" tabindex="-1"></a>stringASupply_ <span class="op">=</span> inputASupply_<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb69-2835"><a href="#cb69-2835" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb69-2836"><a href="#cb69-2836" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-2837"><a href="#cb69-2837" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb69-2838"><a href="#cb69-2838" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb69-2839"><a href="#cb69-2839" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb69-2840"><a href="#cb69-2840" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb69-2841"><a href="#cb69-2841" aria-hidden="true" tabindex="-1"></a>stringLiquidTonnes <span class="op">=</span> inputLiquidTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb69-2842"><a href="#cb69-2842" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb69-2843"><a href="#cb69-2843" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-2844"><a href="#cb69-2844" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb69-2845"><a href="#cb69-2845" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">-</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb69-2846"><a href="#cb69-2846" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb69-2847"><a href="#cb69-2847" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb69-2848"><a href="#cb69-2848" aria-hidden="true" tabindex="-1"></a>stringABurnt <span class="op">=</span> <span class="st">"−"</span> <span class="op">+</span> paramABurnt<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb69-2849"><a href="#cb69-2849" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb69-2850"><a href="#cb69-2850" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-2851"><a href="#cb69-2851" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb69-2852"><a href="#cb69-2852" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramABurnt))<span class="op">,</span></span>
<span id="cb69-2853"><a href="#cb69-2853" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb69-2854"><a href="#cb69-2854" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" kVCM"</span><span class="op">;</span></span>
<span id="cb69-2855"><a href="#cb69-2855" aria-hidden="true" tabindex="-1"></a>stringDeltaCiTonnes <span class="op">=</span> <span class="st">"−"</span> <span class="op">+</span> paramDeltaCiTonnes<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb69-2856"><a href="#cb69-2856" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb69-2857"><a href="#cb69-2857" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-2858"><a href="#cb69-2858" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb69-2859"><a href="#cb69-2859" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="fu">numDigits</span>(paramDeltaCiTonnes))<span class="op">,</span></span>
<span id="cb69-2860"><a href="#cb69-2860" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb69-2861"><a href="#cb69-2861" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" tCO2eq"</span><span class="op">;</span></span>
<span id="cb69-2862"><a href="#cb69-2862" aria-hidden="true" tabindex="-1"></a>stringAPrice_ <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramAPrice_<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb69-2863"><a href="#cb69-2863" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb69-2864"><a href="#cb69-2864" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-2865"><a href="#cb69-2865" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice_))<span class="op">,</span></span>
<span id="cb69-2866"><a href="#cb69-2866" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramAPrice_))<span class="op">,</span></span>
<span id="cb69-2867"><a href="#cb69-2867" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb69-2868"><a href="#cb69-2868" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb69-2869"><a href="#cb69-2869" aria-hidden="true" tabindex="-1"></a>stringCiPrice <span class="op">=</span> <span class="st">"$"</span> <span class="op">+</span> paramCiPrice<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb69-2870"><a href="#cb69-2870" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb69-2871"><a href="#cb69-2871" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-2872"><a href="#cb69-2872" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minimumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramCiPrice))<span class="op">,</span></span>
<span id="cb69-2873"><a href="#cb69-2873" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span> <span class="op">+</span> <span class="fu">numDigits</span>(paramCiPrice))<span class="op">,</span></span>
<span id="cb69-2874"><a href="#cb69-2874" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb69-2875"><a href="#cb69-2875" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-68-12" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Supply of <strong>A</strong> Tokens</th>
<th style="text-align: right;">Inventory Carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-9"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-10"></span></span></td>
</tr>
<tr class="even">
<td><strong>Variation</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-11"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-12"></span></span></td>
</tr>
<tr class="odd">
<td><strong>Unit Price</strong></td>
<td style="text-align: right;"><span><span id="ojs-element-id-13"></span></span></td>
<td style="text-align: right;"><span><span id="ojs-element-id-14"></span></span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-klima-2.0-token-distribution" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="sec-klima-2.0-token-distribution"><span class="header-section-number">4</span> Klima&nbsp;2.0 Token Distribution</h2>
<section id="sec-planned-allocations" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="sec-planned-allocations"><span class="header-section-number">4.1</span> Planned Allocations</h3>
<div id="tbl-kvcm-token" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-kvcm-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Cohort</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Quantity (m)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klima Holders</td>
<td style="text-align: right;">87.5%</td>
<td style="text-align: right;">17.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">DAO/Treasury</td>
<td style="text-align: right;">10.0%</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">01X</td>
<td style="text-align: right;">2.5%</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: right;"><strong>100.0%</strong></td>
<td style="text-align: right;"><strong>20.0</strong></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-kvcm-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: <strong>kVCM</strong> token.
</figcaption>
</figure>
</div>
<div id="tbl-k2-token" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[40,10,15,30]">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-k2-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 40%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Cohort</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Quantity (m)</th>
<th style="text-align: left;">Liquidity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klima Holders</td>
<td style="text-align: right;">40.0%</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ecosystem Grant</td>
<td style="text-align: right;">5.0%</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Programmatic Incentives</td>
<td style="text-align: right;">40.0%</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: left;">Incentive Curve</td>
</tr>
<tr class="even">
<td style="text-align: left;">pKlima Holders</td>
<td style="text-align: right;">3.0%</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DAO/Treasury</td>
<td style="text-align: right;">4.5%</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: left;">24 month locked LP of <span class="overline"><strong>AG</strong></span></td>
</tr>
<tr class="even">
<td style="text-align: left;">01X</td>
<td style="text-align: right;">2.5%</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: left;">24 month locked LP of <span class="overline"><strong>AG</strong></span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Product Design and Development</td>
<td style="text-align: right;">5.0%</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">Logistic Vesting 48 months</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: right;"><strong>100.0%</strong></td>
<td style="text-align: right;"><strong>100.0</strong></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-k2-token-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: <strong>K2</strong> token.
</figcaption>
</figure>
</div>
<div id="fig-k2-token-allocations" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token allocations.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-allocations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb70" data-startfrom="2923" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2922;"><span id="cb70-2923"><a href="#cb70-2923" aria-hidden="true" tabindex="-1"></a>allocInitGData <span class="op">=</span> {</span>
<span id="cb70-2924"><a href="#cb70-2924" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocInitGData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb70-2925"><a href="#cb70-2925" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="fl">100.01</span><span class="op">;</span> i <span class="op">+=</span> <span class="fl">0.25</span>) {</span>
<span id="cb70-2926"><a href="#cb70-2926" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="op">&lt;</span> <span class="fl">2.51</span>) {</span>
<span id="cb70-2927"><a href="#cb70-2927" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb70-2928"><a href="#cb70-2928" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-2929"><a href="#cb70-2929" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">2.49</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">5.51</span>) {</span>
<span id="cb70-2930"><a href="#cb70-2930" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb70-2931"><a href="#cb70-2931" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-2932"><a href="#cb70-2932" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">5.49</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">10.01</span>) {</span>
<span id="cb70-2933"><a href="#cb70-2933" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb70-2934"><a href="#cb70-2934" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-2935"><a href="#cb70-2935" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">9.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">15.01</span>) {</span>
<span id="cb70-2936"><a href="#cb70-2936" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb70-2937"><a href="#cb70-2937" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-2938"><a href="#cb70-2938" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">14.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">20.01</span>) {</span>
<span id="cb70-2939"><a href="#cb70-2939" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb70-2940"><a href="#cb70-2940" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-2941"><a href="#cb70-2941" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">19.99</span> <span class="op">&lt;</span> i <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> <span class="fl">60.01</span>) {</span>
<span id="cb70-2942"><a href="#cb70-2942" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb70-2943"><a href="#cb70-2943" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-2944"><a href="#cb70-2944" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fl">59.99</span> <span class="op">&lt;</span> i) {</span>
<span id="cb70-2945"><a href="#cb70-2945" aria-hidden="true" tabindex="-1"></a>      allocInitGData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i })<span class="op">;</span></span>
<span id="cb70-2946"><a href="#cb70-2946" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-2947"><a href="#cb70-2947" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-2948"><a href="#cb70-2948" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocInitGData<span class="op">;</span></span>
<span id="cb70-2949"><a href="#cb70-2949" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb70-2950"><a href="#cb70-2950" aria-hidden="true" tabindex="-1"></a>longitudeScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>([<span class="dv">180</span><span class="op">,</span> <span class="op">-</span><span class="dv">180</span>])<span class="op">;</span></span>
<span id="cb70-2951"><a href="#cb70-2951" aria-hidden="true" tabindex="-1"></a>getCenter <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb70-2952"><a href="#cb70-2952" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">1.25</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="fl">7.75</span><span class="op">,</span> <span class="fl">12.5</span><span class="op">,</span> <span class="fl">17.5</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">80</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> d<span class="op">.</span><span class="at">value</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb70-2953"><a href="#cb70-2953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-2954"><a href="#cb70-2954" aria-hidden="true" tabindex="-1"></a>cohortsDomain <span class="op">=</span> [</span>
<span id="cb70-2955"><a href="#cb70-2955" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb70-2956"><a href="#cb70-2956" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb70-2957"><a href="#cb70-2957" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb70-2958"><a href="#cb70-2958" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb70-2959"><a href="#cb70-2959" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb70-2960"><a href="#cb70-2960" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb70-2961"><a href="#cb70-2961" aria-hidden="true" tabindex="-1"></a>  <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb70-2962"><a href="#cb70-2962" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-69-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb71" data-startfrom="2965" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2964;"><span id="cb71-2965"><a href="#cb71-2965" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb71-2966"><a href="#cb71-2966" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"azimuthal-equidistant"</span><span class="op">,</span> <span class="dt">rotate</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb71-2967"><a href="#cb71-2967" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb71-2968"><a href="#cb71-2968" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb71-2969"><a href="#cb71-2969" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">area</span>(allocInitGData<span class="op">,</span> {</span>
<span id="cb71-2970"><a href="#cb71-2970" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> ({ value }) <span class="kw">=&gt;</span> <span class="fu">longitudeScale</span>(value <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb71-2971"><a href="#cb71-2971" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="op">-</span><span class="dv">20</span><span class="op">,</span></span>
<span id="cb71-2972"><a href="#cb71-2972" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> ({ value }) <span class="kw">=&gt;</span> <span class="fu">longitudeScale</span>(value <span class="op">/</span> <span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb71-2973"><a href="#cb71-2973" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> <span class="op">-</span><span class="dv">70</span><span class="op">,</span></span>
<span id="cb71-2974"><a href="#cb71-2974" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb71-2975"><a href="#cb71-2975" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb71-2976"><a href="#cb71-2976" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb71-2977"><a href="#cb71-2977" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-70" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-allocations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: <strong>K2</strong> token allocations.
</figcaption>
</figure>
</div>
</section>
<section id="sec-programmatic-incentive-curve" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="sec-programmatic-incentive-curve"><span class="header-section-number">4.2</span> Programmatic Incentive Curve</h3>
<p>The incentive issuance is built on a logistic function, <span class="math inline">\operatorname{P}</span>, to generate total proportion of supply in issue. It is calibrated from the initial issuance at TGE <span class="math inline">P_0</span> and the inflection point time <span class="math inline">T</span> where 50% of <strong>G</strong> token incentives have been released.</p>
<p>Setting <span class="math inline">x_0</span> from the initial supply parameter:</p>
<p><span id="eq-incentives-issuance-x-0"><span class="math display">
x_0 = \ln\left( \frac{P_0}{1 - P_0} \right)
\tag{29}</span></span></p>
<p>With <span class="math inline">x_t</span> at time point <span class="math inline">t \in (0, \infty)</span>:</p>
<p><span id="eq-incentives-issuance-x-t"><span class="math display">
x_t = x_0 \, \left( 1 - \frac t T \right)
\tag{30}</span></span></p>
<p>Giving supply function <span class="math inline">\operatorname{P}(t)</span> as:</p>
<p><span id="eq-incentives-issuance-curve"><span class="math display">
\operatorname{P}(t) = \frac{\exp(x_t)}{\exp(x_t) + 1}
\tag{31}</span></span></p>
<p><span class="math inline">P_0</span> set at <span><span id="ojs-element-id-15"></span></span> and <span class="math inline">T</span> at <span><span id="ojs-element-id-16"></span></span> months:</p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb72" data-startfrom="3025" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3024;"><span id="cb72-3025"><a href="#cb72-3025" aria-hidden="true" tabindex="-1"></a>viewof inputP0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> {</span>
<span id="cb72-3026"><a href="#cb72-3026" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Initial issuance } P_0`</span><span class="op">,</span></span>
<span id="cb72-3027"><a href="#cb72-3027" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb72-3028"><a href="#cb72-3028" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.07</span><span class="op">,</span></span>
<span id="cb72-3029"><a href="#cb72-3029" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-3030"><a href="#cb72-3030" aria-hidden="true" tabindex="-1"></a>viewof inputT <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">2</span><span class="op">,</span> <span class="dv">60</span>]<span class="op">,</span> {</span>
<span id="cb72-3031"><a href="#cb72-3031" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`T </span><span class="sc">\t</span><span class="vs">ext{ (months)}`</span><span class="op">,</span></span>
<span id="cb72-3032"><a href="#cb72-3032" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb72-3033"><a href="#cb72-3033" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span></span>
<span id="cb72-3034"><a href="#cb72-3034" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb72-3035"><a href="#cb72-3035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3036"><a href="#cb72-3036" aria-hidden="true" tabindex="-1"></a>stringInputP0 <span class="op">=</span> inputP0<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb72-3037"><a href="#cb72-3037" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb72-3038"><a href="#cb72-3038" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb72-3039"><a href="#cb72-3039" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb72-3040"><a href="#cb72-3040" aria-hidden="true" tabindex="-1"></a>stringInputT <span class="op">=</span> inputT<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"en-GB"</span><span class="op">,</span> { <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-71-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-71-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-71-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-71-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-incentive-issuance" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Incentive Issuance.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentive-issuance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb73" data-startfrom="3052" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3051;"><span id="cb73-3052"><a href="#cb73-3052" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeP</span>(t<span class="op">,</span> P0<span class="op">,</span> T) {</span>
<span id="cb73-3053"><a href="#cb73-3053" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(P0 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> P0))<span class="op">;</span></span>
<span id="cb73-3054"><a href="#cb73-3054" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xt <span class="op">=</span> x0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> t <span class="op">/</span> T)<span class="op">;</span></span>
<span id="cb73-3055"><a href="#cb73-3055" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> exp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(xt)<span class="op">;</span></span>
<span id="cb73-3056"><a href="#cb73-3056" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> exp <span class="op">/</span> (exp <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb73-3057"><a href="#cb73-3057" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-3058"><a href="#cb73-3058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3059"><a href="#cb73-3059" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeDerivP</span>(t<span class="op">,</span> P0<span class="op">,</span> T) {</span>
<span id="cb73-3060"><a href="#cb73-3060" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(P0 <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> P0))<span class="op">;</span></span>
<span id="cb73-3061"><a href="#cb73-3061" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xt <span class="op">=</span> x0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> t <span class="op">/</span> T)<span class="op">;</span></span>
<span id="cb73-3062"><a href="#cb73-3062" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> exp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(xt)<span class="op">;</span></span>
<span id="cb73-3063"><a href="#cb73-3063" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> P <span class="op">=</span> exp <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp)<span class="op">;</span></span>
<span id="cb73-3064"><a href="#cb73-3064" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">-</span>(x0 <span class="op">/</span> T) <span class="op">*</span> P <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> P)<span class="op">;</span></span>
<span id="cb73-3065"><a href="#cb73-3065" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-3066"><a href="#cb73-3066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3067"><a href="#cb73-3067" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getVesting</span>(vecVesting<span class="op">,</span> t<span class="op">,</span> tStart<span class="op">,</span> tEnd) {</span>
<span id="cb73-3068"><a href="#cb73-3068" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="op">&lt;</span> tStart)</span>
<span id="cb73-3069"><a href="#cb73-3069" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb73-3070"><a href="#cb73-3070" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (t <span class="op">&lt;</span> tEnd) {</span>
<span id="cb73-3071"><a href="#cb73-3071" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vecVesting[t <span class="op">-</span> tStart]<span class="op">;</span></span>
<span id="cb73-3072"><a href="#cb73-3072" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb73-3073"><a href="#cb73-3073" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vecVesting[tEnd <span class="op">-</span> tStart <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb73-3074"><a href="#cb73-3074" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-3075"><a href="#cb73-3075" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-72-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb74" data-startfrom="3079" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3078;"><span id="cb74-3079"><a href="#cb74-3079" aria-hidden="true" tabindex="-1"></a>tVestStart <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb74-3080"><a href="#cb74-3080" aria-hidden="true" tabindex="-1"></a>tVestEnd <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> inputT<span class="op">;</span></span>
<span id="cb74-3081"><a href="#cb74-3081" aria-hidden="true" tabindex="-1"></a>tVesting <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(tVestStart<span class="op">,</span> tVestEnd)<span class="op">;</span></span>
<span id="cb74-3082"><a href="#cb74-3082" aria-hidden="true" tabindex="-1"></a>vecVestingDeriv <span class="op">=</span> <span class="fu">normalize</span>(tVesting<span class="op">.</span><span class="fu">map</span>(t <span class="kw">=&gt;</span></span>
<span id="cb74-3083"><a href="#cb74-3083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">computeDerivP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)</span>
<span id="cb74-3084"><a href="#cb74-3084" aria-hidden="true" tabindex="-1"></a>))<span class="op">;</span></span>
<span id="cb74-3085"><a href="#cb74-3085" aria-hidden="true" tabindex="-1"></a>vecVesting <span class="op">=</span> d3<span class="op">.</span><span class="fu">cumsum</span>(vecVestingDeriv)<span class="op">;</span></span>
<span id="cb74-3086"><a href="#cb74-3086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3087"><a href="#cb74-3087" aria-hidden="true" tabindex="-1"></a>supplyDataAll <span class="op">=</span> {</span>
<span id="cb74-3088"><a href="#cb74-3088" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> paramVestingPrevious <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb74-3089"><a href="#cb74-3089" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecSupplyIncentives <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb74-3090"><a href="#cb74-3090" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecSupplyCirculating <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb74-3091"><a href="#cb74-3091" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> supplyData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb74-3092"><a href="#cb74-3092" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">&lt;=</span> <span class="dv">72</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb74-3093"><a href="#cb74-3093" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramP <span class="op">=</span> <span class="fu">computeP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)<span class="op">;</span></span>
<span id="cb74-3094"><a href="#cb74-3094" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramDerivP <span class="op">=</span> <span class="fu">computeDerivP</span>(t<span class="op">,</span> inputP0<span class="op">,</span> inputT)<span class="op">;</span></span>
<span id="cb74-3095"><a href="#cb74-3095" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramVesting <span class="op">=</span> <span class="fu">getVesting</span>(vecVesting<span class="op">,</span> t<span class="op">,</span> tVestStart<span class="op">,</span> tVestEnd)<span class="op">;</span></span>
<span id="cb74-3096"><a href="#cb74-3096" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paramVestingDiff <span class="op">=</span> paramVesting <span class="op">-</span> paramVestingPrevious<span class="op">;</span></span>
<span id="cb74-3097"><a href="#cb74-3097" aria-hidden="true" tabindex="-1"></a>    paramVestingPrevious <span class="op">=</span> paramVesting<span class="op">;</span></span>
<span id="cb74-3098"><a href="#cb74-3098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3099"><a href="#cb74-3099" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supply01X <span class="op">=</span> <span class="fl">2.5</span><span class="op">;</span></span>
<span id="cb74-3100"><a href="#cb74-3100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyPKlima <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb74-3101"><a href="#cb74-3101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyTreasury <span class="op">=</span> <span class="fl">4.5</span><span class="op">;</span></span>
<span id="cb74-3102"><a href="#cb74-3102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyGrant <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb74-3103"><a href="#cb74-3103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyProduct <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb74-3104"><a href="#cb74-3104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyKlima <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramVesting<span class="op">;</span></span>
<span id="cb74-3105"><a href="#cb74-3105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyIncentives <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramP<span class="op">;</span></span>
<span id="cb74-3106"><a href="#cb74-3106" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives<span class="op">.</span><span class="fu">push</span>(supplyIncentives)<span class="op">;</span></span>
<span id="cb74-3107"><a href="#cb74-3107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3108"><a href="#cb74-3108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supply01XStacked <span class="op">=</span> supply01X<span class="op">;</span></span>
<span id="cb74-3109"><a href="#cb74-3109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyPKlimaStacked <span class="op">=</span> supplyPKlima <span class="op">+</span> supply01XStacked<span class="op">;</span></span>
<span id="cb74-3110"><a href="#cb74-3110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyTreasuryStacked <span class="op">=</span> supplyTreasury <span class="op">+</span> supplyPKlimaStacked<span class="op">;</span></span>
<span id="cb74-3111"><a href="#cb74-3111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyGrantStacked <span class="op">=</span> supplyGrant <span class="op">+</span> supplyTreasuryStacked<span class="op">;</span></span>
<span id="cb74-3112"><a href="#cb74-3112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyProductStacked <span class="op">=</span> supplyProduct <span class="op">+</span> supplyGrantStacked<span class="op">;</span></span>
<span id="cb74-3113"><a href="#cb74-3113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyKlimaStacked <span class="op">=</span> supplyKlima <span class="op">+</span> supplyProductStacked<span class="op">;</span></span>
<span id="cb74-3114"><a href="#cb74-3114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyIncentivesStacked <span class="op">=</span> supplyIncentives <span class="op">+</span> supplyKlimaStacked<span class="op">;</span></span>
<span id="cb74-3115"><a href="#cb74-3115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supplyCirculating <span class="op">=</span> supplyIncentivesStacked <span class="op">/</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb74-3116"><a href="#cb74-3116" aria-hidden="true" tabindex="-1"></a>    vecSupplyCirculating<span class="op">.</span><span class="fu">push</span>(supplyIncentivesStacked)<span class="op">;</span></span>
<span id="cb74-3117"><a href="#cb74-3117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3118"><a href="#cb74-3118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (t <span class="op">&lt;=</span> <span class="dv">60</span>) {</span>
<span id="cb74-3119"><a href="#cb74-3119" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffIncentives <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> (t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> inputP0 <span class="op">:</span> paramDerivP)<span class="op">;</span></span>
<span id="cb74-3120"><a href="#cb74-3120" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffKlima <span class="op">=</span> <span class="dv">40</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb74-3121"><a href="#cb74-3121" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffProduct <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb74-3122"><a href="#cb74-3122" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffGrant <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb74-3123"><a href="#cb74-3123" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffPKlima <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> paramVestingDiff<span class="op">;</span></span>
<span id="cb74-3124"><a href="#cb74-3124" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffTreasury <span class="op">=</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">4.5</span><span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb74-3125"><a href="#cb74-3125" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diff01X <span class="op">=</span> t <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">2.5</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb74-3126"><a href="#cb74-3126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3127"><a href="#cb74-3127" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffIncentivesStacked <span class="op">=</span> diffIncentives<span class="op">;</span></span>
<span id="cb74-3128"><a href="#cb74-3128" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffKlimaStacked <span class="op">=</span> diffKlima <span class="op">+</span> diffIncentivesStacked<span class="op">;</span></span>
<span id="cb74-3129"><a href="#cb74-3129" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffProductStacked <span class="op">=</span> diffProduct <span class="op">+</span> diffKlimaStacked<span class="op">;</span></span>
<span id="cb74-3130"><a href="#cb74-3130" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffGrantStacked <span class="op">=</span> diffGrant <span class="op">+</span> diffProductStacked<span class="op">;</span></span>
<span id="cb74-3131"><a href="#cb74-3131" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffPKlimaStacked <span class="op">=</span> diffPKlima <span class="op">+</span> diffGrantStacked<span class="op">;</span></span>
<span id="cb74-3132"><a href="#cb74-3132" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diffTreasuryStacked <span class="op">=</span> diffTreasury <span class="op">+</span> diffPKlimaStacked<span class="op">;</span></span>
<span id="cb74-3133"><a href="#cb74-3133" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> diff01XStacked <span class="op">=</span> diff01X <span class="op">+</span> diffTreasuryStacked<span class="op">;</span></span>
<span id="cb74-3134"><a href="#cb74-3134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3135"><a href="#cb74-3135" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3136"><a href="#cb74-3136" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Proportion of Supply"</span><span class="op">,</span></span>
<span id="cb74-3137"><a href="#cb74-3137" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3138"><a href="#cb74-3138" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramP<span class="op">,</span></span>
<span id="cb74-3139"><a href="#cb74-3139" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3140"><a href="#cb74-3140" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3141"><a href="#cb74-3141" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Rate of Change"</span><span class="op">,</span></span>
<span id="cb74-3142"><a href="#cb74-3142" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3143"><a href="#cb74-3143" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> paramDerivP<span class="op">,</span></span>
<span id="cb74-3144"><a href="#cb74-3144" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3145"><a href="#cb74-3145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3146"><a href="#cb74-3146" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3147"><a href="#cb74-3147" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3148"><a href="#cb74-3148" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb74-3149"><a href="#cb74-3149" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3150"><a href="#cb74-3150" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01XStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3151"><a href="#cb74-3151" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3152"><a href="#cb74-3152" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3153"><a href="#cb74-3153" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3154"><a href="#cb74-3154" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb74-3155"><a href="#cb74-3155" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3156"><a href="#cb74-3156" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlimaStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3157"><a href="#cb74-3157" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3158"><a href="#cb74-3158" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3159"><a href="#cb74-3159" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3160"><a href="#cb74-3160" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb74-3161"><a href="#cb74-3161" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3162"><a href="#cb74-3162" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasuryStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3163"><a href="#cb74-3163" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3164"><a href="#cb74-3164" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3165"><a href="#cb74-3165" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3166"><a href="#cb74-3166" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb74-3167"><a href="#cb74-3167" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3168"><a href="#cb74-3168" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrantStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3169"><a href="#cb74-3169" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3170"><a href="#cb74-3170" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3171"><a href="#cb74-3171" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3172"><a href="#cb74-3172" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb74-3173"><a href="#cb74-3173" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3174"><a href="#cb74-3174" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProductStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3175"><a href="#cb74-3175" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3176"><a href="#cb74-3176" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3177"><a href="#cb74-3177" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3178"><a href="#cb74-3178" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb74-3179"><a href="#cb74-3179" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3180"><a href="#cb74-3180" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlimaStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3181"><a href="#cb74-3181" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3182"><a href="#cb74-3182" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3183"><a href="#cb74-3183" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3184"><a href="#cb74-3184" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb74-3185"><a href="#cb74-3185" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3186"><a href="#cb74-3186" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentivesStacked <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3187"><a href="#cb74-3187" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3188"><a href="#cb74-3188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3189"><a href="#cb74-3189" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3190"><a href="#cb74-3190" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3191"><a href="#cb74-3191" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb74-3192"><a href="#cb74-3192" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3193"><a href="#cb74-3193" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01X <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3194"><a href="#cb74-3194" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3195"><a href="#cb74-3195" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3196"><a href="#cb74-3196" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3197"><a href="#cb74-3197" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb74-3198"><a href="#cb74-3198" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3199"><a href="#cb74-3199" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlima <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3200"><a href="#cb74-3200" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3201"><a href="#cb74-3201" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3202"><a href="#cb74-3202" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3203"><a href="#cb74-3203" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb74-3204"><a href="#cb74-3204" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3205"><a href="#cb74-3205" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasury <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3206"><a href="#cb74-3206" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3207"><a href="#cb74-3207" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3208"><a href="#cb74-3208" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3209"><a href="#cb74-3209" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb74-3210"><a href="#cb74-3210" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3211"><a href="#cb74-3211" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrant <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3212"><a href="#cb74-3212" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3213"><a href="#cb74-3213" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3214"><a href="#cb74-3214" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3215"><a href="#cb74-3215" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb74-3216"><a href="#cb74-3216" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3217"><a href="#cb74-3217" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProduct <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3218"><a href="#cb74-3218" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3219"><a href="#cb74-3219" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3220"><a href="#cb74-3220" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3221"><a href="#cb74-3221" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb74-3222"><a href="#cb74-3222" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3223"><a href="#cb74-3223" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlima <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3224"><a href="#cb74-3224" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3225"><a href="#cb74-3225" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3226"><a href="#cb74-3226" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Circulating Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3227"><a href="#cb74-3227" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb74-3228"><a href="#cb74-3228" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3229"><a href="#cb74-3229" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentives <span class="op">/</span> supplyCirculating<span class="op">,</span></span>
<span id="cb74-3230"><a href="#cb74-3230" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3231"><a href="#cb74-3231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3232"><a href="#cb74-3232" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3233"><a href="#cb74-3233" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3234"><a href="#cb74-3234" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb74-3235"><a href="#cb74-3235" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3236"><a href="#cb74-3236" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01XStacked<span class="op">,</span></span>
<span id="cb74-3237"><a href="#cb74-3237" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3238"><a href="#cb74-3238" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3239"><a href="#cb74-3239" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3240"><a href="#cb74-3240" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb74-3241"><a href="#cb74-3241" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3242"><a href="#cb74-3242" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlimaStacked<span class="op">,</span></span>
<span id="cb74-3243"><a href="#cb74-3243" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3244"><a href="#cb74-3244" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3245"><a href="#cb74-3245" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3246"><a href="#cb74-3246" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb74-3247"><a href="#cb74-3247" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3248"><a href="#cb74-3248" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasuryStacked<span class="op">,</span></span>
<span id="cb74-3249"><a href="#cb74-3249" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3250"><a href="#cb74-3250" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3251"><a href="#cb74-3251" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3252"><a href="#cb74-3252" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb74-3253"><a href="#cb74-3253" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3254"><a href="#cb74-3254" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrantStacked<span class="op">,</span></span>
<span id="cb74-3255"><a href="#cb74-3255" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3256"><a href="#cb74-3256" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3257"><a href="#cb74-3257" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3258"><a href="#cb74-3258" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb74-3259"><a href="#cb74-3259" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3260"><a href="#cb74-3260" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProductStacked<span class="op">,</span></span>
<span id="cb74-3261"><a href="#cb74-3261" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3262"><a href="#cb74-3262" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3263"><a href="#cb74-3263" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3264"><a href="#cb74-3264" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb74-3265"><a href="#cb74-3265" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3266"><a href="#cb74-3266" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlimaStacked<span class="op">,</span></span>
<span id="cb74-3267"><a href="#cb74-3267" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3268"><a href="#cb74-3268" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3269"><a href="#cb74-3269" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Stacked)"</span><span class="op">,</span></span>
<span id="cb74-3270"><a href="#cb74-3270" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb74-3271"><a href="#cb74-3271" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3272"><a href="#cb74-3272" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentivesStacked<span class="op">,</span></span>
<span id="cb74-3273"><a href="#cb74-3273" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3274"><a href="#cb74-3274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3275"><a href="#cb74-3275" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3276"><a href="#cb74-3276" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3277"><a href="#cb74-3277" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb74-3278"><a href="#cb74-3278" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3279"><a href="#cb74-3279" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supply01X<span class="op">,</span></span>
<span id="cb74-3280"><a href="#cb74-3280" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3281"><a href="#cb74-3281" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3282"><a href="#cb74-3282" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3283"><a href="#cb74-3283" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb74-3284"><a href="#cb74-3284" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3285"><a href="#cb74-3285" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyPKlima<span class="op">,</span></span>
<span id="cb74-3286"><a href="#cb74-3286" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3287"><a href="#cb74-3287" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3288"><a href="#cb74-3288" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3289"><a href="#cb74-3289" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb74-3290"><a href="#cb74-3290" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3291"><a href="#cb74-3291" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyTreasury<span class="op">,</span></span>
<span id="cb74-3292"><a href="#cb74-3292" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3293"><a href="#cb74-3293" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3294"><a href="#cb74-3294" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3295"><a href="#cb74-3295" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb74-3296"><a href="#cb74-3296" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3297"><a href="#cb74-3297" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyGrant<span class="op">,</span></span>
<span id="cb74-3298"><a href="#cb74-3298" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3299"><a href="#cb74-3299" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3300"><a href="#cb74-3300" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3301"><a href="#cb74-3301" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb74-3302"><a href="#cb74-3302" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3303"><a href="#cb74-3303" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyProduct<span class="op">,</span></span>
<span id="cb74-3304"><a href="#cb74-3304" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3305"><a href="#cb74-3305" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3306"><a href="#cb74-3306" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3307"><a href="#cb74-3307" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb74-3308"><a href="#cb74-3308" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3309"><a href="#cb74-3309" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyKlima<span class="op">,</span></span>
<span id="cb74-3310"><a href="#cb74-3310" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3311"><a href="#cb74-3311" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3312"><a href="#cb74-3312" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3313"><a href="#cb74-3313" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb74-3314"><a href="#cb74-3314" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3315"><a href="#cb74-3315" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> supplyIncentives<span class="op">,</span></span>
<span id="cb74-3316"><a href="#cb74-3316" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3317"><a href="#cb74-3317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3318"><a href="#cb74-3318" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3319"><a href="#cb74-3319" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3320"><a href="#cb74-3320" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Incentives"</span><span class="op">,</span></span>
<span id="cb74-3321"><a href="#cb74-3321" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3322"><a href="#cb74-3322" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffIncentives<span class="op">,</span></span>
<span id="cb74-3323"><a href="#cb74-3323" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3324"><a href="#cb74-3324" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3325"><a href="#cb74-3325" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3326"><a href="#cb74-3326" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Klima Holders"</span><span class="op">,</span></span>
<span id="cb74-3327"><a href="#cb74-3327" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3328"><a href="#cb74-3328" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffKlima<span class="op">,</span></span>
<span id="cb74-3329"><a href="#cb74-3329" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3330"><a href="#cb74-3330" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3331"><a href="#cb74-3331" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3332"><a href="#cb74-3332" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Product Design"</span><span class="op">,</span></span>
<span id="cb74-3333"><a href="#cb74-3333" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3334"><a href="#cb74-3334" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffProduct<span class="op">,</span></span>
<span id="cb74-3335"><a href="#cb74-3335" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3336"><a href="#cb74-3336" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3337"><a href="#cb74-3337" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3338"><a href="#cb74-3338" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"Ecosystem Grant"</span><span class="op">,</span></span>
<span id="cb74-3339"><a href="#cb74-3339" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3340"><a href="#cb74-3340" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffGrant<span class="op">,</span></span>
<span id="cb74-3341"><a href="#cb74-3341" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3342"><a href="#cb74-3342" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3343"><a href="#cb74-3343" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3344"><a href="#cb74-3344" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"pKlima Holders"</span><span class="op">,</span></span>
<span id="cb74-3345"><a href="#cb74-3345" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3346"><a href="#cb74-3346" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffPKlima<span class="op">,</span></span>
<span id="cb74-3347"><a href="#cb74-3347" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3348"><a href="#cb74-3348" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3349"><a href="#cb74-3349" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3350"><a href="#cb74-3350" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"DAO/Treasury"</span><span class="op">,</span></span>
<span id="cb74-3351"><a href="#cb74-3351" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3352"><a href="#cb74-3352" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diffTreasury<span class="op">,</span></span>
<span id="cb74-3353"><a href="#cb74-3353" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3354"><a href="#cb74-3354" aria-hidden="true" tabindex="-1"></a>      supplyData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb74-3355"><a href="#cb74-3355" aria-hidden="true" tabindex="-1"></a>        <span class="dt">key</span><span class="op">:</span> <span class="st">"Total Supply Differential (Unstacked)"</span><span class="op">,</span></span>
<span id="cb74-3356"><a href="#cb74-3356" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cohort</span><span class="op">:</span> <span class="st">"01X"</span><span class="op">,</span></span>
<span id="cb74-3357"><a href="#cb74-3357" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb74-3358"><a href="#cb74-3358" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> diff01X<span class="op">,</span></span>
<span id="cb74-3359"><a href="#cb74-3359" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb74-3360"><a href="#cb74-3360" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb74-3361"><a href="#cb74-3361" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-3362"><a href="#cb74-3362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3363"><a href="#cb74-3363" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecNextYearIncentives <span class="op">=</span> vecSupplyIncentives<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb74-3364"><a href="#cb74-3364" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> val)<span class="op">;</span></span>
<span id="cb74-3365"><a href="#cb74-3365" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecAPY <span class="op">=</span> vecSupplyCirculating<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb74-3366"><a href="#cb74-3366" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">*</span> (vecSupplyCirculating[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> val) <span class="op">/</span> val)<span class="op">;</span></span>
<span id="cb74-3367"><a href="#cb74-3367" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vecAPR <span class="op">=</span> vecSupplyCirculating<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> t) <span class="kw">=&gt;</span></span>
<span id="cb74-3368"><a href="#cb74-3368" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">*</span> (vecSupplyCirculating[t <span class="op">+</span> <span class="dv">12</span>] <span class="op">-</span> vecNextYearIncentives[t] <span class="op">-</span> val) <span class="op">/</span> val)<span class="op">;</span></span>
<span id="cb74-3369"><a href="#cb74-3369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3370"><a href="#cb74-3370" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">&lt;=</span> <span class="dv">60</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb74-3371"><a href="#cb74-3371" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"APY"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> vecAPY[t] })<span class="op">;</span></span>
<span id="cb74-3372"><a href="#cb74-3372" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">"APR"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> vecAPR[t] })<span class="op">;</span></span>
<span id="cb74-3373"><a href="#cb74-3373" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-3374"><a href="#cb74-3374" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb74-3375"><a href="#cb74-3375" aria-hidden="true" tabindex="-1"></a>    vecSupplyIncentives<span class="op">,</span></span>
<span id="cb74-3376"><a href="#cb74-3376" aria-hidden="true" tabindex="-1"></a>    vecSupplyCirculating<span class="op">,</span></span>
<span id="cb74-3377"><a href="#cb74-3377" aria-hidden="true" tabindex="-1"></a>    supplyData<span class="op">,</span></span>
<span id="cb74-3378"><a href="#cb74-3378" aria-hidden="true" tabindex="-1"></a>    vecAPY<span class="op">,</span></span>
<span id="cb74-3379"><a href="#cb74-3379" aria-hidden="true" tabindex="-1"></a>    vecAPR<span class="op">,</span></span>
<span id="cb74-3380"><a href="#cb74-3380" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb74-3381"><a href="#cb74-3381" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-3382"><a href="#cb74-3382" aria-hidden="true" tabindex="-1"></a>vecSupplyIncentives <span class="op">=</span> supplyDataAll[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb74-3383"><a href="#cb74-3383" aria-hidden="true" tabindex="-1"></a>vecSupplyCirculating <span class="op">=</span> supplyDataAll[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb74-3384"><a href="#cb74-3384" aria-hidden="true" tabindex="-1"></a>supplyData <span class="op">=</span> supplyDataAll[<span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb74-3385"><a href="#cb74-3385" aria-hidden="true" tabindex="-1"></a>vecAPY <span class="op">=</span> supplyDataAll[<span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb74-3386"><a href="#cb74-3386" aria-hidden="true" tabindex="-1"></a>vecAPR <span class="op">=</span> supplyDataAll[<span class="dv">4</span>]<span class="op">;</span></span>
<span id="cb74-3387"><a href="#cb74-3387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3388"><a href="#cb74-3388" aria-hidden="true" tabindex="-1"></a>getLogisticCurve <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Proportion of Supply"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3389"><a href="#cb74-3389" aria-hidden="true" tabindex="-1"></a>getRateOfChange <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Rate of Change"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3390"><a href="#cb74-3390" aria-hidden="true" tabindex="-1"></a>getCirculatingStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb74-3391"><a href="#cb74-3391" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3392"><a href="#cb74-3392" aria-hidden="true" tabindex="-1"></a>getCirculatingUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb74-3393"><a href="#cb74-3393" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3394"><a href="#cb74-3394" aria-hidden="true" tabindex="-1"></a>getTotalStacked <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3395"><a href="#cb74-3395" aria-hidden="true" tabindex="-1"></a>getTotalUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3396"><a href="#cb74-3396" aria-hidden="true" tabindex="-1"></a>getDiffUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb74-3397"><a href="#cb74-3397" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply Differential (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3398"><a href="#cb74-3398" aria-hidden="true" tabindex="-1"></a>getCohortCirculatingStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb74-3399"><a href="#cb74-3399" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3400"><a href="#cb74-3400" aria-hidden="true" tabindex="-1"></a>getCohortCirculatingUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb74-3401"><a href="#cb74-3401" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Circulating Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3402"><a href="#cb74-3402" aria-hidden="true" tabindex="-1"></a>getCohortTotalStacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb74-3403"><a href="#cb74-3403" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Stacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3404"><a href="#cb74-3404" aria-hidden="true" tabindex="-1"></a>getCohortTotalUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb74-3405"><a href="#cb74-3405" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3406"><a href="#cb74-3406" aria-hidden="true" tabindex="-1"></a>getCohortDiffUnstacked <span class="op">=</span> d <span class="kw">=&gt;</span></span>
<span id="cb74-3407"><a href="#cb74-3407" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"Total Supply Differential (Unstacked)"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">cohort</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3408"><a href="#cb74-3408" aria-hidden="true" tabindex="-1"></a>getAPY <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"APY"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3409"><a href="#cb74-3409" aria-hidden="true" tabindex="-1"></a>getAPR <span class="op">=</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"APR"</span> <span class="op">?</span> d<span class="op">.</span><span class="at">y</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">;</span></span>
<span id="cb74-3410"><a href="#cb74-3410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3411"><a href="#cb74-3411" aria-hidden="true" tabindex="-1"></a>domainRateOfChange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(supplyData<span class="op">,</span> getRateOfChange)]<span class="op">;</span></span>
<span id="cb74-3412"><a href="#cb74-3412" aria-hidden="true" tabindex="-1"></a>scaleRateOfChange <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>(domainRateOfChange<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb74-3413"><a href="#cb74-3413" aria-hidden="true" tabindex="-1"></a>mapScaleRateOfChange <span class="op">=</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>(scaleRateOfChange)<span class="op">;</span></span>
<span id="cb74-3414"><a href="#cb74-3414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3415"><a href="#cb74-3415" aria-hidden="true" tabindex="-1"></a>stringP0 <span class="op">=</span> <span class="st">"Initial Issuance P₀ = "</span> <span class="op">+</span> inputP0<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb74-3416"><a href="#cb74-3416" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb74-3417"><a href="#cb74-3417" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb74-3418"><a href="#cb74-3418" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb74-3419"><a href="#cb74-3419" aria-hidden="true" tabindex="-1"></a>stringT <span class="op">=</span> <span class="st">"Inflection Point Time T = "</span> <span class="op">+</span> inputT<span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb74-3420"><a href="#cb74-3420" aria-hidden="true" tabindex="-1"></a>  <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb74-3421"><a href="#cb74-3421" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb74-3422"><a href="#cb74-3422" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="st">" months"</span><span class="op">;</span></span>
<span id="cb74-3423"><a href="#cb74-3423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3424"><a href="#cb74-3424" aria-hidden="true" tabindex="-1"></a>supplyParams <span class="op">=</span> [</span>
<span id="cb74-3425"><a href="#cb74-3425" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringP0<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">100</span> <span class="op">*</span> inputP0 }<span class="op">,</span></span>
<span id="cb74-3426"><a href="#cb74-3426" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> stringT<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> inputT<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">50</span> }<span class="op">,</span></span>
<span id="cb74-3427"><a href="#cb74-3427" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-73-31" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb75" data-startfrom="3430" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3429;"><span id="cb75-3430"><a href="#cb75-3430" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb75-3431"><a href="#cb75-3431" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb75-3432"><a href="#cb75-3432" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb75-3433"><a href="#cb75-3433" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="at">schemeCategory10</span>[i])<span class="op">,</span></span>
<span id="cb75-3434"><a href="#cb75-3434" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="st">"Proportion of Supply"</span><span class="op">,</span> <span class="st">"Rate of Change"</span><span class="op">,</span> stringP0<span class="op">,</span> stringT]<span class="op">,</span></span>
<span id="cb75-3435"><a href="#cb75-3435" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb75-3436"><a href="#cb75-3436" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb75-3437"><a href="#cb75-3437" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span></span>
<span id="cb75-3438"><a href="#cb75-3438" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"‘Life’ Span (Months)"</span><span class="op">,</span></span>
<span id="cb75-3439"><a href="#cb75-3439" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb75-3440"><a href="#cb75-3440" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb75-3441"><a href="#cb75-3441" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>] }<span class="op">,</span></span>
<span id="cb75-3442"><a href="#cb75-3442" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb75-3443"><a href="#cb75-3443" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb75-3444"><a href="#cb75-3444" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb75-3445"><a href="#cb75-3445" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb75-3446"><a href="#cb75-3446" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">anchor</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Proportion of Supply (%)"</span> })<span class="op">,</span></span>
<span id="cb75-3447"><a href="#cb75-3447" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">axisY</span>(scaleRateOfChange<span class="op">.</span><span class="fu">ticks</span>()<span class="op">,</span> {</span>
<span id="cb75-3448"><a href="#cb75-3448" aria-hidden="true" tabindex="-1"></a>      <span class="dt">anchor</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb75-3449"><a href="#cb75-3449" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> scaleRateOfChange<span class="op">.</span><span class="fu">tickFormat</span>()<span class="op">,</span></span>
<span id="cb75-3450"><a href="#cb75-3450" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Rate of Change (%/Month)"</span><span class="op">,</span></span>
<span id="cb75-3451"><a href="#cb75-3451" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> scaleRateOfChange</span>
<span id="cb75-3452"><a href="#cb75-3452" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb75-3453"><a href="#cb75-3453" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleRateOfChange<span class="op">,</span> {</span>
<span id="cb75-3454"><a href="#cb75-3454" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb75-3455"><a href="#cb75-3455" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getRateOfChange<span class="op">,</span></span>
<span id="cb75-3456"><a href="#cb75-3456" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb75-3457"><a href="#cb75-3457" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb75-3458"><a href="#cb75-3458" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb75-3459"><a href="#cb75-3459" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb75-3460"><a href="#cb75-3460" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb75-3461"><a href="#cb75-3461" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb75-3462"><a href="#cb75-3462" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLogisticCurve<span class="op">,</span></span>
<span id="cb75-3463"><a href="#cb75-3463" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb75-3464"><a href="#cb75-3464" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb75-3465"><a href="#cb75-3465" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb75-3466"><a href="#cb75-3466" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> Plot<span class="op">.</span><span class="fu">mapY</span>(mapScaleRateOfChange<span class="op">,</span> {</span>
<span id="cb75-3467"><a href="#cb75-3467" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb75-3468"><a href="#cb75-3468" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getRateOfChange<span class="op">,</span></span>
<span id="cb75-3469"><a href="#cb75-3469" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb75-3470"><a href="#cb75-3470" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb75-3471"><a href="#cb75-3471" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb75-3472"><a href="#cb75-3472" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb75-3473"><a href="#cb75-3473" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb75-3474"><a href="#cb75-3474" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getLogisticCurve<span class="op">,</span></span>
<span id="cb75-3475"><a href="#cb75-3475" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb75-3476"><a href="#cb75-3476" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb75-3477"><a href="#cb75-3477" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb75-3478"><a href="#cb75-3478" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(supplyParams<span class="op">,</span> {</span>
<span id="cb75-3479"><a href="#cb75-3479" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span> <span class="op">===</span> stringT <span class="op">?</span> d<span class="op">.</span><span class="at">x</span> <span class="op">:</span> <span class="kw">NaN</span><span class="op">,</span></span>
<span id="cb75-3480"><a href="#cb75-3480" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb75-3481"><a href="#cb75-3481" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb75-3482"><a href="#cb75-3482" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb75-3483"><a href="#cb75-3483" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb75-3484"><a href="#cb75-3484" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb75-3485"><a href="#cb75-3485" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dotY</span>(supplyParams<span class="op">,</span> {</span>
<span id="cb75-3486"><a href="#cb75-3486" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb75-3487"><a href="#cb75-3487" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb75-3488"><a href="#cb75-3488" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb75-3489"><a href="#cb75-3489" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb75-3490"><a href="#cb75-3490" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb75-3491"><a href="#cb75-3491" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb75-3492"><a href="#cb75-3492" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-74" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentive-issuance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22: Incentive Issuance
</figcaption>
</figure>
</div>
<div id="fig-k2-token-supply-circulating" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token circulating supply over time.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-supply-circulating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb76" data-startfrom="3506" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3505;"><span id="cb76-3506"><a href="#cb76-3506" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb76-3507"><a href="#cb76-3507" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb76-3508"><a href="#cb76-3508" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb76-3509"><a href="#cb76-3509" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Circulating Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb76-3510"><a href="#cb76-3510" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb76-3511"><a href="#cb76-3511" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb76-3512"><a href="#cb76-3512" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb76-3513"><a href="#cb76-3513" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb76-3514"><a href="#cb76-3514" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb76-3515"><a href="#cb76-3515" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCirculatingStacked<span class="op">,</span></span>
<span id="cb76-3516"><a href="#cb76-3516" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortCirculatingStacked<span class="op">,</span></span>
<span id="cb76-3517"><a href="#cb76-3517" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb76-3518"><a href="#cb76-3518" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb76-3519"><a href="#cb76-3519" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb76-3520"><a href="#cb76-3520" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb76-3521"><a href="#cb76-3521" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getCirculatingUnstacked<span class="op">,</span></span>
<span id="cb76-3522"><a href="#cb76-3522" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortCirculatingUnstacked<span class="op">,</span></span>
<span id="cb76-3523"><a href="#cb76-3523" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb76-3524"><a href="#cb76-3524" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb76-3525"><a href="#cb76-3525" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb76-3526"><a href="#cb76-3526" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-75" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-supply-circulating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23: <strong>K2</strong> token circulating supply over time.
</figcaption>
</figure>
</div>
<div id="fig-k2-token-supply-total" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-token-supply-total-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb77" data-startfrom="3541" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3540;"><span id="cb77-3541"><a href="#cb77-3541" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb77-3542"><a href="#cb77-3542" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb77-3543"><a href="#cb77-3543" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb77-3544"><a href="#cb77-3544" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Total Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb77-3545"><a href="#cb77-3545" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb77-3546"><a href="#cb77-3546" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb77-3547"><a href="#cb77-3547" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb77-3548"><a href="#cb77-3548" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb77-3549"><a href="#cb77-3549" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb77-3550"><a href="#cb77-3550" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalStacked<span class="op">,</span></span>
<span id="cb77-3551"><a href="#cb77-3551" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortTotalStacked<span class="op">,</span></span>
<span id="cb77-3552"><a href="#cb77-3552" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb77-3553"><a href="#cb77-3553" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb77-3554"><a href="#cb77-3554" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb77-3555"><a href="#cb77-3555" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb77-3556"><a href="#cb77-3556" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb77-3557"><a href="#cb77-3557" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb77-3558"><a href="#cb77-3558" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb77-3559"><a href="#cb77-3559" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb77-3560"><a href="#cb77-3560" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb77-3561"><a href="#cb77-3561" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-76" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-76-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-76" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-76-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Total supply (stacked).
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb78" data-startfrom="3566" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3565;"><span id="cb78-3566"><a href="#cb78-3566" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb78-3567"><a href="#cb78-3567" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb78-3568"><a href="#cb78-3568" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb78-3569"><a href="#cb78-3569" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Total Supply (%)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb78-3570"><a href="#cb78-3570" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb78-3571"><a href="#cb78-3571" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb78-3572"><a href="#cb78-3572" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb78-3573"><a href="#cb78-3573" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb78-3574"><a href="#cb78-3574" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">lineY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb78-3575"><a href="#cb78-3575" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb78-3576"><a href="#cb78-3576" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb78-3577"><a href="#cb78-3577" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb78-3578"><a href="#cb78-3578" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb78-3579"><a href="#cb78-3579" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb78-3580"><a href="#cb78-3580" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">areaY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb78-3581"><a href="#cb78-3581" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb78-3582"><a href="#cb78-3582" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb78-3583"><a href="#cb78-3583" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> getTotalUnstacked<span class="op">,</span></span>
<span id="cb78-3584"><a href="#cb78-3584" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortTotalUnstacked<span class="op">,</span></span>
<span id="cb78-3585"><a href="#cb78-3585" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span></span>
<span id="cb78-3586"><a href="#cb78-3586" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb78-3587"><a href="#cb78-3587" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb78-3588"><a href="#cb78-3588" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-77" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-77-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-77" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-77-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Total supply (unstacked).
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-token-supply-total-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24: <strong>K2</strong> token total supply over time.
</figcaption>
</figure>
</div>
<div id="fig-k2-supply-differential" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 supply differential (stacked).">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-supply-differential-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb79" data-startfrom="3610" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3609;"><span id="cb79-3610"><a href="#cb79-3610" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb79-3611"><a href="#cb79-3611" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">range</span><span class="op">:</span> d3<span class="op">.</span><span class="at">schemeCategory10</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> cohortsDomain }<span class="op">,</span></span>
<span id="cb79-3612"><a href="#cb79-3612" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">60.1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Time (Months)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb79-3613"><a href="#cb79-3613" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Rate of Growth (%/Month)"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb79-3614"><a href="#cb79-3614" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb79-3615"><a href="#cb79-3615" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetLeft</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb79-3616"><a href="#cb79-3616" aria-hidden="true" tabindex="-1"></a>  <span class="dt">insetRight</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb79-3617"><a href="#cb79-3617" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb79-3618"><a href="#cb79-3618" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb79-3619"><a href="#cb79-3619" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb79-3620"><a href="#cb79-3620" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(supplyData<span class="op">,</span> {</span>
<span id="cb79-3621"><a href="#cb79-3621" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb79-3622"><a href="#cb79-3622" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="fl">0.45</span><span class="op">,</span></span>
<span id="cb79-3623"><a href="#cb79-3623" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> getDiffUnstacked<span class="op">,</span></span>
<span id="cb79-3624"><a href="#cb79-3624" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> getCohortDiffUnstacked<span class="op">,</span></span>
<span id="cb79-3625"><a href="#cb79-3625" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb79-3626"><a href="#cb79-3626" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb79-3627"><a href="#cb79-3627" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-78" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-supply-differential-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25: <strong>K2</strong> supply differential (stacked).
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-share-of-k2-incentives" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="sec-share-of-k2-incentives"><span class="header-section-number">4.3</span> Share of K2 Incentives</h3>
<div id="fig-k2-incentive-distribution" class="quarto-float quarto-figure quarto-figure-center anchored" alt="K2 token incentive distribution structure">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-k2-incentive-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="figures/k2-incentive-distribution.svg" class="img-fluid figure-img"></p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-k2-incentive-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26: <strong>K2</strong> token incentive distribution structure.
</figcaption>
</figure>
</div>
<p>The <strong>relative utilisation</strong> measurement factor <span class="math inline">\upsilon</span> is calculated as follows.</p>
<p>Defining initially:</p>
<ul>
<li><p><span class="math inline">G</span>: Total <strong>G</strong> tokens staked expressed as a proportion of the circulating supply, <span class="math inline">G \in [0, 1]</span>.</p></li>
<li><p><span class="math inline">L</span>: Total <strong>G</strong> tokens held in the <span class="overline"><strong>AG</strong></span> pool expressed as a proportion of circulating supply, <span class="math inline">L \in (0, 1]</span>.</p></li>
</ul>
<p>Where <span class="math inline">\upsilon = 0</span> if <span class="math inline">G + L = 0</span>, otherwise:</p>
<p><span id="eq-relative-utilisation"><span class="math display">
\upsilon = \left( \frac{2 G L}{G^2 + L^2} \right)^2
\tag{32}</span></span></p>
<div id="fig-relative-utilisation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Upsilon range of values.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-relative-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb80" data-startfrom="3678" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3677;"><span id="cb80-3678"><a href="#cb80-3678" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeUpsilon</span>(G<span class="op">,</span> L) {</span>
<span id="cb80-3679"><a href="#cb80-3679" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb80-3680"><a href="#cb80-3680" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb80-3681"><a href="#cb80-3681" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb80-3682"><a href="#cb80-3682" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">2</span> <span class="op">*</span> G <span class="op">*</span> L <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>))<span class="op">**</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb80-3683"><a href="#cb80-3683" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-3684"><a href="#cb80-3684" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-79" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb81" data-startfrom="3688" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3687;"><span id="cb81-3688"><a href="#cb81-3688" aria-hidden="true" tabindex="-1"></a>upsilonData <span class="op">=</span> {</span>
<span id="cb81-3689"><a href="#cb81-3689" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> upsilonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb81-3690"><a href="#cb81-3690" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb81-3691"><a href="#cb81-3691" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb81-3692"><a href="#cb81-3692" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb81-3693"><a href="#cb81-3693" aria-hidden="true" tabindex="-1"></a>        upsilonData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb81-3694"><a href="#cb81-3694" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"υ"</span><span class="op">,</span></span>
<span id="cb81-3695"><a href="#cb81-3695" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb81-3696"><a href="#cb81-3696" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb81-3697"><a href="#cb81-3697" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeUpsilon</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb81-3698"><a href="#cb81-3698" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb81-3699"><a href="#cb81-3699" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb81-3700"><a href="#cb81-3700" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-3701"><a href="#cb81-3701" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-3702"><a href="#cb81-3702" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> upsilonData<span class="op">;</span></span>
<span id="cb81-3703"><a href="#cb81-3703" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-80" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb82" data-startfrom="3707" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3706;"><span id="cb82-3707"><a href="#cb82-3707" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb82-3708"><a href="#cb82-3708" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb82-3709"><a href="#cb82-3709" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb82-3710"><a href="#cb82-3710" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb82-3711"><a href="#cb82-3711" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb82-3712"><a href="#cb82-3712" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb82-3713"><a href="#cb82-3713" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb82-3714"><a href="#cb82-3714" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Relative Utilisation υ"</span><span class="op">,</span></span>
<span id="cb82-3715"><a href="#cb82-3715" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb82-3716"><a href="#cb82-3716" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb82-3717"><a href="#cb82-3717" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb82-3718"><a href="#cb82-3718" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb82-3719"><a href="#cb82-3719" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb82-3720"><a href="#cb82-3720" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb82-3721"><a href="#cb82-3721" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb82-3722"><a href="#cb82-3722" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb82-3723"><a href="#cb82-3723" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb82-3724"><a href="#cb82-3724" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(upsilonData<span class="op">,</span> {</span>
<span id="cb82-3725"><a href="#cb82-3725" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb82-3726"><a href="#cb82-3726" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb82-3727"><a href="#cb82-3727" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb82-3728"><a href="#cb82-3728" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb82-3729"><a href="#cb82-3729" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb82-3730"><a href="#cb82-3730" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb82-3731"><a href="#cb82-3731" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(upsilonData<span class="op">,</span> {</span>
<span id="cb82-3732"><a href="#cb82-3732" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb82-3733"><a href="#cb82-3733" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb82-3734"><a href="#cb82-3734" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb82-3735"><a href="#cb82-3735" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb82-3736"><a href="#cb82-3736" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb82-3737"><a href="#cb82-3737" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb82-3738"><a href="#cb82-3738" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb82-3739"><a href="#cb82-3739" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb82-3740"><a href="#cb82-3740" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb82-3741"><a href="#cb82-3741" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb82-3742"><a href="#cb82-3742" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb82-3743"><a href="#cb82-3743" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-81" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-relative-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27: Upsilon <span class="math inline">\upsilon</span> range of values.
</figcaption>
</figure>
</div>
<p>The <strong>absolute utilisation</strong> parameter <span class="math inline">\eta</span> is defined as <span class="math inline">\eta = 0</span> if <span class="math inline">G + L = 0</span>, otherwise:</p>
<p><span id="eq-absolute-utilisation"><span class="math display">
\eta = \frac{2 G L}{G (1 - G) + L ( 1 - L)}
\tag{33}</span></span></p>
<div id="fig-absolute-utilisation" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Eta range of values.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-absolute-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb83" data-startfrom="3764" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3763;"><span id="cb83-3764"><a href="#cb83-3764" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeEta</span>(G<span class="op">,</span> L) {</span>
<span id="cb83-3765"><a href="#cb83-3765" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb83-3766"><a href="#cb83-3766" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb83-3767"><a href="#cb83-3767" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb83-3768"><a href="#cb83-3768" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> G <span class="op">*</span> L <span class="op">/</span> (G <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> G) <span class="op">+</span> L <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> L))<span class="op">;</span></span>
<span id="cb83-3769"><a href="#cb83-3769" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-3770"><a href="#cb83-3770" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-82" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb84" data-startfrom="3774" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3773;"><span id="cb84-3774"><a href="#cb84-3774" aria-hidden="true" tabindex="-1"></a>etaData <span class="op">=</span> {</span>
<span id="cb84-3775"><a href="#cb84-3775" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> etaData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb84-3776"><a href="#cb84-3776" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb84-3777"><a href="#cb84-3777" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb84-3778"><a href="#cb84-3778" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb84-3779"><a href="#cb84-3779" aria-hidden="true" tabindex="-1"></a>        etaData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb84-3780"><a href="#cb84-3780" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"η"</span><span class="op">,</span></span>
<span id="cb84-3781"><a href="#cb84-3781" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb84-3782"><a href="#cb84-3782" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb84-3783"><a href="#cb84-3783" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeEta</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb84-3784"><a href="#cb84-3784" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb84-3785"><a href="#cb84-3785" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb84-3786"><a href="#cb84-3786" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-3787"><a href="#cb84-3787" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-3788"><a href="#cb84-3788" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> etaData<span class="op">;</span></span>
<span id="cb84-3789"><a href="#cb84-3789" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-83" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb85" data-startfrom="3793" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3792;"><span id="cb85-3793"><a href="#cb85-3793" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb85-3794"><a href="#cb85-3794" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb85-3795"><a href="#cb85-3795" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb85-3796"><a href="#cb85-3796" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb85-3797"><a href="#cb85-3797" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb85-3798"><a href="#cb85-3798" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb85-3799"><a href="#cb85-3799" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb85-3800"><a href="#cb85-3800" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Absolute Utilisation η"</span><span class="op">,</span></span>
<span id="cb85-3801"><a href="#cb85-3801" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb85-3802"><a href="#cb85-3802" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb85-3803"><a href="#cb85-3803" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb85-3804"><a href="#cb85-3804" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb85-3805"><a href="#cb85-3805" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb85-3806"><a href="#cb85-3806" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb85-3807"><a href="#cb85-3807" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb85-3808"><a href="#cb85-3808" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb85-3809"><a href="#cb85-3809" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb85-3810"><a href="#cb85-3810" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(etaData<span class="op">,</span> {</span>
<span id="cb85-3811"><a href="#cb85-3811" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb85-3812"><a href="#cb85-3812" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb85-3813"><a href="#cb85-3813" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb85-3814"><a href="#cb85-3814" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb85-3815"><a href="#cb85-3815" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb85-3816"><a href="#cb85-3816" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb85-3817"><a href="#cb85-3817" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(etaData<span class="op">,</span> {</span>
<span id="cb85-3818"><a href="#cb85-3818" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb85-3819"><a href="#cb85-3819" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb85-3820"><a href="#cb85-3820" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb85-3821"><a href="#cb85-3821" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb85-3822"><a href="#cb85-3822" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb85-3823"><a href="#cb85-3823" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb85-3824"><a href="#cb85-3824" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb85-3825"><a href="#cb85-3825" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb85-3826"><a href="#cb85-3826" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb85-3827"><a href="#cb85-3827" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb85-3828"><a href="#cb85-3828" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb85-3829"><a href="#cb85-3829" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-84" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-absolute-utilisation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28: Eta <span class="math inline">\eta</span> range of values.
</figcaption>
</figure>
</div>
<p>Incentives <span class="math inline">I</span> are allocated as follows:</p>
<section id="treasury" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="treasury"><span class="header-section-number">4.3.1</span> Treasury</h4>
<p>The allocation to the Treasury <span class="math inline">I_T</span> is the imbalance generated from <span class="math inline">\upsilon</span>:</p>
<p><span id="eq-allocation-treasury"><span class="math display">
I_T = 1 - \upsilon \, \eta
\tag{34}</span></span></p>
</section>
<section id="post-treasury" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="post-treasury"><span class="header-section-number">4.3.2</span> Post Treasury</h4>
<p>The residual post-treasury allocation is shared four ways within 2 buckets:</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong> &amp; user-locked <strong>G</strong> tokens</p>
<p>Where <span class="math inline">S</span> is the proportion of time-locked <strong>A</strong> tokens&nbsp;(as defined previously in <a href="#sec-base-accrual" class="quarto-xref">Section&nbsp;3.1.1</a>):</p>
<ol type="1">
<li><p>Time-locked <strong>A</strong>, <span class="math inline">I_S</span>:</p>
<p><span id="eq-allocation-locked-a"><span class="math display">
I_S = S \, \frac{L^2}{G^2 + L^2}
  \tag{35}</span></span></p></li>
<li><p>User-locked <strong>G</strong>, <span class="math inline">I_G</span>:</p>
<p><span id="eq-allocation-locked-g"><span class="math display">
I_G = (1 - S) \, \frac{L^2}{G^2 + L^2}
  \tag{36}</span></span></p></li>
</ol></li>
<li><p>Liquidity</p>
<p>With <span class="math inline">\lambda_G</span>, <span class="math inline">\lambda_Q</span>, <span class="math inline">\lambda_{GG}</span> as defined in <a href="#sec-share-of-kvcm-incentives" class="quarto-xref">Section&nbsp;3.3.4</a>:</p>
<ol start="3" type="1">
<li><p><span class="overline"><strong>AG</strong></span> pool <span class="math inline">I_{AG}</span>:</p>
<p><span id="eq-allocation-pool-ag"><span class="math display">
I_{AG} = \frac{\lambda_G}{1 - \lambda_{GG}} \, \frac{G^2}{G^2 + L^2}
  \tag{37}</span></span></p></li>
<li><p><span class="overline"><strong>AQ</strong></span> pool <span class="math inline">I_{AQ}</span>:</p>
<p><span id="eq-allocation-pool-aq"><span class="math display">
I_{AQ} = \frac{\lambda_Q}{1 - \lambda_{GG}} \, \frac{G^2}{G^2 + L^2}
  \tag{38}</span></span></p></li>
</ol></li>
</ol>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb86" data-startfrom="3902" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3901;"><span id="cb86-3902"><a href="#cb86-3902" aria-hidden="true" tabindex="-1"></a>viewof inputS_ <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb86-3903"><a href="#cb86-3903" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{Time-Locked } S`</span><span class="op">,</span></span>
<span id="cb86-3904"><a href="#cb86-3904" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb86-3905"><a href="#cb86-3905" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb86-3906"><a href="#cb86-3906" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb86-3907"><a href="#cb86-3907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3908"><a href="#cb86-3908" aria-hidden="true" tabindex="-1"></a>viewof inputWeightAG <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb86-3909"><a href="#cb86-3909" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">ext{LP split}`</span><span class="op">,</span></span>
<span id="cb86-3910"><a href="#cb86-3910" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span></span>
<span id="cb86-3911"><a href="#cb86-3911" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb86-3912"><a href="#cb86-3912" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb86-3913"><a href="#cb86-3913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3914"><a href="#cb86-3914" aria-hidden="true" tabindex="-1"></a>paramWeightAQ <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> inputWeightAG<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-85-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-85-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-85-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="panel-fill">
<div id="fig-incentives-non-treasury" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentives-non-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb87" data-startfrom="3925" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3924;"><span id="cb87-3925"><a href="#cb87-3925" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeTreasury</span>(G<span class="op">,</span> L) {</span>
<span id="cb87-3926"><a href="#cb87-3926" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> <span class="fu">computeUpsilon</span>(G<span class="op">,</span> L) <span class="op">*</span> <span class="fu">computeEta</span>(G<span class="op">,</span> L))<span class="op">;</span></span>
<span id="cb87-3927"><a href="#cb87-3927" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-86" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb88" data-startfrom="3932" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3931;"><span id="cb88-3932"><a href="#cb88-3932" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIBonds</span>(G<span class="op">,</span> L<span class="op">,</span> S) {</span>
<span id="cb88-3933"><a href="#cb88-3933" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb88-3934"><a href="#cb88-3934" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb88-3935"><a href="#cb88-3935" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb88-3936"><a href="#cb88-3936" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S <span class="op">*</span> L<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb88-3937"><a href="#cb88-3937" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-3938"><a href="#cb88-3938" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-3939"><a href="#cb88-3939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3940"><a href="#cb88-3940" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIStaking</span>(G<span class="op">,</span> L<span class="op">,</span> S) {</span>
<span id="cb88-3941"><a href="#cb88-3941" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb88-3942"><a href="#cb88-3942" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb88-3943"><a href="#cb88-3943" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb88-3944"><a href="#cb88-3944" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> S) <span class="op">*</span> L<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb88-3945"><a href="#cb88-3945" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-3946"><a href="#cb88-3946" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-87-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-87-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb89" data-startfrom="3949" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3948;"><span id="cb89-3949"><a href="#cb89-3949" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">computeIPool</span>(G<span class="op">,</span> L<span class="op">,</span> weight) {</span>
<span id="cb89-3950"><a href="#cb89-3950" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (G <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> L <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb89-3951"><a href="#cb89-3951" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb89-3952"><a href="#cb89-3952" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb89-3953"><a href="#cb89-3953" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weight <span class="op">*</span> G<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (G<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> L<span class="op">**</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb89-3954"><a href="#cb89-3954" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb89-3955"><a href="#cb89-3955" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-88" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb90" data-startfrom="3959" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3958;"><span id="cb90-3959"><a href="#cb90-3959" aria-hidden="true" tabindex="-1"></a>allocationSQData <span class="op">=</span> {</span>
<span id="cb90-3960"><a href="#cb90-3960" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocationSQData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb90-3961"><a href="#cb90-3961" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb90-3962"><a href="#cb90-3962" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb90-3963"><a href="#cb90-3963" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb90-3964"><a href="#cb90-3964" aria-hidden="true" tabindex="-1"></a>        allocationSQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb90-3965"><a href="#cb90-3965" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔 Time-locks Allocation"</span><span class="op">,</span></span>
<span id="cb90-3966"><a href="#cb90-3966" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb90-3967"><a href="#cb90-3967" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb90-3968"><a href="#cb90-3968" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIBonds</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputS_)<span class="op">,</span></span>
<span id="cb90-3969"><a href="#cb90-3969" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb90-3970"><a href="#cb90-3970" aria-hidden="true" tabindex="-1"></a>        allocationSQData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb90-3971"><a href="#cb90-3971" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗚 User-locks Allocation"</span><span class="op">,</span></span>
<span id="cb90-3972"><a href="#cb90-3972" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb90-3973"><a href="#cb90-3973" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb90-3974"><a href="#cb90-3974" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIStaking</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputS_)<span class="op">,</span></span>
<span id="cb90-3975"><a href="#cb90-3975" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb90-3976"><a href="#cb90-3976" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-3977"><a href="#cb90-3977" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-3978"><a href="#cb90-3978" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-3979"><a href="#cb90-3979" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocationSQData<span class="op">;</span></span>
<span id="cb90-3980"><a href="#cb90-3980" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-89" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb91" data-startfrom="3985" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3984;"><span id="cb91-3985"><a href="#cb91-3985" aria-hidden="true" tabindex="-1"></a>plotAllocationSQ <span class="op">=</span> {</span>
<span id="cb91-3986"><a href="#cb91-3986" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotAllocationSQ <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb91-3987"><a href="#cb91-3987" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb91-3988"><a href="#cb91-3988" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb91-3989"><a href="#cb91-3989" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb91-3990"><a href="#cb91-3990" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb91-3991"><a href="#cb91-3991" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb91-3992"><a href="#cb91-3992" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb91-3993"><a href="#cb91-3993" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb91-3994"><a href="#cb91-3994" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb91-3995"><a href="#cb91-3995" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb91-3996"><a href="#cb91-3996" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb91-3997"><a href="#cb91-3997" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb91-3998"><a href="#cb91-3998" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb91-3999"><a href="#cb91-3999" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb91-4000"><a href="#cb91-4000" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb91-4001"><a href="#cb91-4001" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb91-4002"><a href="#cb91-4002" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb91-4003"><a href="#cb91-4003" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb91-4004"><a href="#cb91-4004" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(allocationSQData<span class="op">,</span> {</span>
<span id="cb91-4005"><a href="#cb91-4005" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb91-4006"><a href="#cb91-4006" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb91-4007"><a href="#cb91-4007" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb91-4008"><a href="#cb91-4008" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb91-4009"><a href="#cb91-4009" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb91-4010"><a href="#cb91-4010" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb91-4011"><a href="#cb91-4011" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb91-4012"><a href="#cb91-4012" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(allocationSQData<span class="op">,</span> {</span>
<span id="cb91-4013"><a href="#cb91-4013" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb91-4014"><a href="#cb91-4014" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb91-4015"><a href="#cb91-4015" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb91-4016"><a href="#cb91-4016" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb91-4017"><a href="#cb91-4017" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb91-4018"><a href="#cb91-4018" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb91-4019"><a href="#cb91-4019" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb91-4020"><a href="#cb91-4020" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb91-4021"><a href="#cb91-4021" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb91-4022"><a href="#cb91-4022" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb91-4023"><a href="#cb91-4023" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb91-4024"><a href="#cb91-4024" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb91-4025"><a href="#cb91-4025" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb91-4026"><a href="#cb91-4026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4027"><a href="#cb91-4027" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotAllocationSQ)</span>
<span id="cb91-4028"><a href="#cb91-4028" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb91-4029"><a href="#cb91-4029" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb91-4030"><a href="#cb91-4030" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb91-4031"><a href="#cb91-4031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4032"><a href="#cb91-4032" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotAllocationSQ<span class="op">;</span></span>
<span id="cb91-4033"><a href="#cb91-4033" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-90" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-90-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-90" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-90-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Time-locked <strong>A</strong> and user-locked <strong>G</strong> allocations.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb92" data-startfrom="4037" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4036;"><span id="cb92-4037"><a href="#cb92-4037" aria-hidden="true" tabindex="-1"></a>allocationPoolData <span class="op">=</span> {</span>
<span id="cb92-4038"><a href="#cb92-4038" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allocationPoolData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb92-4039"><a href="#cb92-4039" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb92-4040"><a href="#cb92-4040" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.1</span>) {</span>
<span id="cb92-4041"><a href="#cb92-4041" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb92-4042"><a href="#cb92-4042" aria-hidden="true" tabindex="-1"></a>        allocationPoolData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb92-4043"><a href="#cb92-4043" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔𝗚 Pool Allocation"</span><span class="op">,</span></span>
<span id="cb92-4044"><a href="#cb92-4044" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb92-4045"><a href="#cb92-4045" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb92-4046"><a href="#cb92-4046" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIPool</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> inputWeightAG)<span class="op">,</span></span>
<span id="cb92-4047"><a href="#cb92-4047" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb92-4048"><a href="#cb92-4048" aria-hidden="true" tabindex="-1"></a>        allocationPoolData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb92-4049"><a href="#cb92-4049" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"𝗔𝗤 Pool Allocation"</span><span class="op">,</span></span>
<span id="cb92-4050"><a href="#cb92-4050" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb92-4051"><a href="#cb92-4051" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb92-4052"><a href="#cb92-4052" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeIPool</span>(paramG<span class="op">,</span> paramL<span class="op">,</span> paramWeightAQ)<span class="op">,</span></span>
<span id="cb92-4053"><a href="#cb92-4053" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb92-4054"><a href="#cb92-4054" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb92-4055"><a href="#cb92-4055" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb92-4056"><a href="#cb92-4056" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-4057"><a href="#cb92-4057" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> allocationPoolData<span class="op">;</span></span>
<span id="cb92-4058"><a href="#cb92-4058" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-91" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb93" data-startfrom="4063" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4062;"><span id="cb93-4063"><a href="#cb93-4063" aria-hidden="true" tabindex="-1"></a>plotAllocationPool <span class="op">=</span> {</span>
<span id="cb93-4064"><a href="#cb93-4064" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotAllocationPool <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb93-4065"><a href="#cb93-4065" aria-hidden="true" tabindex="-1"></a>    <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb93-4066"><a href="#cb93-4066" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb93-4067"><a href="#cb93-4067" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb93-4068"><a href="#cb93-4068" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb93-4069"><a href="#cb93-4069" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb93-4070"><a href="#cb93-4070" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb93-4071"><a href="#cb93-4071" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb93-4072"><a href="#cb93-4072" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb93-4073"><a href="#cb93-4073" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb93-4074"><a href="#cb93-4074" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb93-4075"><a href="#cb93-4075" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb93-4076"><a href="#cb93-4076" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.05</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span>]<span class="op">,</span></span>
<span id="cb93-4077"><a href="#cb93-4077" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb93-4078"><a href="#cb93-4078" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb93-4079"><a href="#cb93-4079" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fx</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb93-4080"><a href="#cb93-4080" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb93-4081"><a href="#cb93-4081" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb93-4082"><a href="#cb93-4082" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rect</span>(allocationPoolData<span class="op">,</span> {</span>
<span id="cb93-4083"><a href="#cb93-4083" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb93-4084"><a href="#cb93-4084" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb93-4085"><a href="#cb93-4085" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb93-4086"><a href="#cb93-4086" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb93-4087"><a href="#cb93-4087" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb93-4088"><a href="#cb93-4088" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb93-4089"><a href="#cb93-4089" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb93-4090"><a href="#cb93-4090" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(allocationPoolData<span class="op">,</span> {</span>
<span id="cb93-4091"><a href="#cb93-4091" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb93-4092"><a href="#cb93-4092" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb93-4093"><a href="#cb93-4093" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> <span class="st">"key"</span><span class="op">,</span></span>
<span id="cb93-4094"><a href="#cb93-4094" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb93-4095"><a href="#cb93-4095" aria-hidden="true" tabindex="-1"></a>          <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb93-4096"><a href="#cb93-4096" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb93-4097"><a href="#cb93-4097" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb93-4098"><a href="#cb93-4098" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb93-4099"><a href="#cb93-4099" aria-hidden="true" tabindex="-1"></a>          d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb93-4100"><a href="#cb93-4100" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb93-4101"><a href="#cb93-4101" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb93-4102"><a href="#cb93-4102" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb93-4103"><a href="#cb93-4103" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb93-4104"><a href="#cb93-4104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4105"><a href="#cb93-4105" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(plotAllocationPool)</span>
<span id="cb93-4106"><a href="#cb93-4106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"g[aria-label='y-axis label']"</span>)</span>
<span id="cb93-4107"><a href="#cb93-4107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb93-4108"><a href="#cb93-4108" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="fu">changeTranslation</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb93-4109"><a href="#cb93-4109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4110"><a href="#cb93-4110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plotAllocationPool<span class="op">;</span></span>
<span id="cb93-4111"><a href="#cb93-4111" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-92" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ojs-cell-92-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-92" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ojs-cell-92-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Liquidity pools allocations.
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentives-non-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;29: Share of non-treasury incentives <span class="math inline">I_S</span>, <span class="math inline">I_G</span>, <span class="math inline">I_{AG}</span> and <span class="math inline">I_{AQ}</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<div id="fig-incentives-treasury" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Treasury incentives.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-incentives-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb94" data-startfrom="4136" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4135;"><span id="cb94-4136"><a href="#cb94-4136" aria-hidden="true" tabindex="-1"></a>treasuryData <span class="op">=</span> {</span>
<span id="cb94-4137"><a href="#cb94-4137" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> treasuryData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb94-4138"><a href="#cb94-4138" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> paramG <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramG <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramG <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb94-4139"><a href="#cb94-4139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> paramL <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span><span class="op">;</span> paramL <span class="op">+=</span> <span class="fl">0.05</span>) {</span>
<span id="cb94-4140"><a href="#cb94-4140" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (paramG <span class="op">+</span> paramL <span class="op">&lt;</span> <span class="fl">1.01</span>) {</span>
<span id="cb94-4141"><a href="#cb94-4141" aria-hidden="true" tabindex="-1"></a>        treasuryData<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb94-4142"><a href="#cb94-4142" aria-hidden="true" tabindex="-1"></a>          <span class="dt">key</span><span class="op">:</span> <span class="st">"I_T"</span><span class="op">,</span></span>
<span id="cb94-4143"><a href="#cb94-4143" aria-hidden="true" tabindex="-1"></a>          <span class="dt">l</span><span class="op">:</span> paramL<span class="op">,</span></span>
<span id="cb94-4144"><a href="#cb94-4144" aria-hidden="true" tabindex="-1"></a>          <span class="dt">g</span><span class="op">:</span> paramG<span class="op">,</span></span>
<span id="cb94-4145"><a href="#cb94-4145" aria-hidden="true" tabindex="-1"></a>          <span class="dt">value</span><span class="op">:</span> <span class="fu">computeTreasury</span>(paramG<span class="op">,</span> paramL)<span class="op">,</span></span>
<span id="cb94-4146"><a href="#cb94-4146" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb94-4147"><a href="#cb94-4147" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb94-4148"><a href="#cb94-4148" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-4149"><a href="#cb94-4149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb94-4150"><a href="#cb94-4150" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> treasuryData<span class="op">;</span></span>
<span id="cb94-4151"><a href="#cb94-4151" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-93" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb95" data-startfrom="4155" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 4154;"><span id="cb95-4155"><a href="#cb95-4155" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb95-4156"><a href="#cb95-4156" aria-hidden="true" tabindex="-1"></a>  <span class="dt">aspectRatio</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb95-4157"><a href="#cb95-4157" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb95-4158"><a href="#cb95-4158" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb95-4159"><a href="#cb95-4159" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"Spectral"</span><span class="op">,</span></span>
<span id="cb95-4160"><a href="#cb95-4160" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb95-4161"><a href="#cb95-4161" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"sequential"</span><span class="op">,</span></span>
<span id="cb95-4162"><a href="#cb95-4162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Allocation I"</span><span class="op">,</span></span>
<span id="cb95-4163"><a href="#cb95-4163" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb95-4164"><a href="#cb95-4164" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Liquidity L"</span> }<span class="op">,</span></span>
<span id="cb95-4165"><a href="#cb95-4165" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb95-4166"><a href="#cb95-4166" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.01</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb95-4167"><a href="#cb95-4167" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="fl">1.025</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.025</span>]<span class="op">,</span></span>
<span id="cb95-4168"><a href="#cb95-4168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Stake G"</span><span class="op">,</span></span>
<span id="cb95-4169"><a href="#cb95-4169" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb95-4170"><a href="#cb95-4170" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb95-4171"><a href="#cb95-4171" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">frame</span>()<span class="op">,</span></span>
<span id="cb95-4172"><a href="#cb95-4172" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(treasuryData<span class="op">,</span> {</span>
<span id="cb95-4173"><a href="#cb95-4173" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4174"><a href="#cb95-4174" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">l</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4175"><a href="#cb95-4175" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">-</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4176"><a href="#cb95-4176" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">g</span> <span class="op">+</span> <span class="fl">0.025</span><span class="op">,</span></span>
<span id="cb95-4177"><a href="#cb95-4177" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb95-4178"><a href="#cb95-4178" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb95-4179"><a href="#cb95-4179" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>(treasuryData<span class="op">,</span> {</span>
<span id="cb95-4180"><a href="#cb95-4180" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"l"</span><span class="op">,</span></span>
<span id="cb95-4181"><a href="#cb95-4181" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"g"</span><span class="op">,</span></span>
<span id="cb95-4182"><a href="#cb95-4182" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isNaN</span>(d<span class="op">.</span><span class="at">value</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> d<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="fu">toLocaleString</span>(</span>
<span id="cb95-4183"><a href="#cb95-4183" aria-hidden="true" tabindex="-1"></a>        <span class="st">"en-GB"</span><span class="op">,</span></span>
<span id="cb95-4184"><a href="#cb95-4184" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb95-4185"><a href="#cb95-4185" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb95-4186"><a href="#cb95-4186" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">contrastingTextColor</span>(</span>
<span id="cb95-4187"><a href="#cb95-4187" aria-hidden="true" tabindex="-1"></a>        d3<span class="op">.</span><span class="fu">scaleSequential</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> d3<span class="op">.</span><span class="at">interpolateSpectral</span>)(d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb95-4188"><a href="#cb95-4188" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb95-4189"><a href="#cb95-4189" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb95-4190"><a href="#cb95-4190" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb95-4191"><a href="#cb95-4191" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-94" data-nodetype="expression">

</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-incentives-treasury-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;30: Treasury incentives <span class="math inline">I_T</span>.
</figcaption>
</figure>
</div>


<div class="ojs-auto-generated hidden">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nU308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0l9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdBU3VwcGx5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMyJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nUHJlc2VudFRvbm5lc308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0FFbWl0dGVkfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nRGVsdGFUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC02In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdBUHJpY2V9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdCYXJDaVByaWNlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQVN1cHBseV99PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC05In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdMaXF1aWRUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQUJ1cm50fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0RlbHRhQ2lUb25uZXN9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nQVByaWNlX308L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEzIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzdHJpbmdDaVByaWNlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3N0cmluZ0lucHV0UDB9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c3RyaW5nSW5wdXRUfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTYifV19
</script>
</div>
</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note the development of liquidity pool pricing functionality may be applicable.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dFMgPSBJbnB1dHMucmFuZ2UoWzFlLTQsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1RpbWUtTG9ja2VkIH0gU2AsXG4gIHN0ZXA6IDFlLTQsXG4gIHZhbHVlOiAwLjU1LFxufSk7XG52aWV3b2YgaW5wdXREID0gSW5wdXRzLnJhbmdlKFswLjI1LCAxMF0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UGFyYW1ldGVyIH0gRGAsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiA0LjY5LFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb25zdEFyZWFMaW5lYXIocmFuZ2UsIGFyZWEsIGlucHV0U2xvcGUsIHNsb3BlRmFjdG9yID0gMC4wMDcpIHtcbiAgaWYgKHJhbmdlLmxlbmd0aCA9PT0gMSkge1xuICAgIHJldHVybiBbYXJlYV07XG4gIH1cblxuICBsZXQgeTEgPSAwO1xuICBsZXQgeTIgPSByYW5nZS5sZW5ndGggLSAxO1xuICBsZXQgc2xvcGUgPSBzbG9wZUZhY3RvciAqIE1hdGguYXRhbmgoaW5wdXRTbG9wZSk7XG4gIGxldCBpbnRlcmNlcHQgPSBhcmVhIC8gcmFuZ2UubGVuZ3RoO1xuXG4gIGlmIChNYXRoLmFicyhzbG9wZSkgPiAyICogaW50ZXJjZXB0IC8gKHkyIC0geTEgLSAxKSkge1xuICAgIGNvbnN0IHlFeGFjdFNoaWZ0ID0gTWF0aC5zcXJ0KE1hdGguYWJzKDIgKiBhcmVhIC8gc2xvcGUpKTtcbiAgICBjb25zdCB5Um91bmRTaGlmdCA9IE1hdGgubWF4KDEsIE1hdGgucm91bmQoeUV4YWN0U2hpZnQpKTtcbiAgICBpZiAoc2xvcGUgPiAwKSB7XG4gICAgICB5MSA9IHkyIC0geVJvdW5kU2hpZnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHkyID0geTEgKyB5Um91bmRTaGlmdDtcbiAgICB9XG4gICAgc2xvcGUgPSBNYXRoLnNpZ24oc2xvcGUpICogMiAqIGFyZWEgLyBNYXRoLnBvdygoeTIgLSB5MSksIDIpO1xuICAgIGludGVyY2VwdCA9IE1hdGguYWJzKHNsb3BlKSAqICh5MiAtIHkxIC0gMSkgLyAyO1xuICB9XG5cbiAgY29uc3QgeUNvbnN0QXJlYSA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHJhbmdlLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgeSA9IGkgLSAoeTEgKyB5MikgLyAyO1xuICAgIHlDb25zdEFyZWEucHVzaChNYXRoLm1heCgwLCBzbG9wZSAqIHkgKyBpbnRlcmNlcHQpKTtcbiAgfVxuXG4gIHJldHVybiB5Q29uc3RBcmVhO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjRSA9IGQzLnJhbmdlKDAuMjUsIDEwLjEsIDAuMjUpO1xuXG5zY2FsZUUgPSBkMy5zY2FsZUxpbmVhcihkMy5leHRlbnQodmVjRSksIFstMSwgMV0pO1xuXG52ZWNTID0gY29uc3RBcmVhTGluZWFyKHZlY0UsIDAuNTUsIHNjYWxlRShpbnB1dEQpKS5tYXAoXG4gIHggPT4geCAqIGlucHV0UyAvIDAuNTUsXG4pO1xuXG52ZWNSZXZlcnNlQ3Vtc3VtUyA9IGQzLmN1bXN1bSh2ZWNTLnNsaWNlKCkucmV2ZXJzZSgpKS5yZXZlcnNlKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBkb3RQcm9kdWN0KHYsIHcpIHtcbiAgaWYgKHYubGVuZ3RoICE9PSB3Lmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlZlY3RvcnMgbXVzdCBoYXZlIHRoZSBzYW1lIGxlbmd0aFwiKTtcbiAgfVxuICByZXR1cm4gdi5yZWR1Y2UoKGFjYywgdmFsLCBpKSA9PiBhY2MgKyB2YWwgKiB3W2ldLCAwKTtcbn1cblxuZnVuY3Rpb24gd2VpZ2h0ZWRBcml0aG1ldGljTWVhbih2LCB3ZWlnaHRzKSB7XG4gIHJldHVybiBkb3RQcm9kdWN0KHYsIHdlaWdodHMpIC8gZDMuc3VtKHdlaWdodHMpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1EID0gd2VpZ2h0ZWRBcml0aG1ldGljTWVhbih2ZWNFLCB2ZWNTKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBhcmFtQyA9IHdlaWdodGVkQXJpdGhtZXRpY01lYW4odmVjRS5tYXAoZSA9PiBlICogZSksIHZlY1MpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUdhbW1hKHZlY0UsIHBhcmFtRCwgcGFyYW1DKSB7XG4gIGNvbnN0IHR3b0MgPSAyICogcGFyYW1DO1xuICByZXR1cm4gdmVjRS5tYXAoZSA9PiBNYXRoLm1heCgwLCBlL3BhcmFtRCAtIGUqZS90d29DKSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNHYW1tYSA9IGNvbXB1dGVHYW1tYSh2ZWNFLCBwYXJhbUQsIHBhcmFtQyk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBub3JtYWxpemUodikge1xuICBjb25zdCBzdW0gPSBkMy5zdW0odik7XG4gIHJldHVybiB2Lm1hcCh2YWwgPT4gdmFsIC8gc3VtKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNOb3JtR2FtbWEgPSBub3JtYWxpemUodmVjR2FtbWEpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZlY0N1bVN1bUdhbW1hID0gZDMuY3Vtc3VtKHZlY05vcm1HYW1tYSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVoocGFyYW1TLCB2ZWNDdW1TdW1HYW1tYSwgdmVjRSkge1xuICByZXR1cm4gdmVjQ3VtU3VtR2FtbWEubWFwKChnLCB0KSA9PiAoMSAtIHBhcmFtUykgKiBnIC8gdmVjRVt0XSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmVjWiA9IGNvbXB1dGVaKGlucHV0UywgdmVjQ3VtU3VtR2FtbWEsIHZlY0UpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVCKHZlY1osIHZlY0UpIHtcbiAgcmV0dXJuIHZlY1oubWFwKCh6LCB0KSA9PiBNYXRoLmV4cCgteiAqIHZlY0VbdF0pKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNCID0gY29tcHV0ZUIodmVjWiwgdmVjRSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVkodmVjWikge1xuICByZXR1cm4gdmVjWi5tYXAoeiA9PiBNYXRoLmV4cG0xKHopKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZWNZID0gY29tcHV0ZVkodmVjWik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFyYW1JID0gZG90UHJvZHVjdCh2ZWNTLCB2ZWNZKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ5aWVsZERhdGEgPSB7XG4gICBjb25zdCB5aWVsZERhdGEgPSBbXTtcbiAgIGZvciAobGV0IHQgPSAzOyB0IDwgdmVjRS5sZW5ndGg7IHQgKz0gNCkge1xuICAgICAgeWllbGREYXRhLnB1c2goe1xuICAgICAgICAga2V5OiBcIlN0YWtlIEFcIixcbiAgICAgICAgIHZhbHVlOiAxMDAgKiBkMy5zdW0odmVjUy5zbGljZSh0IC0gMywgdCArIDEpKSxcbiAgICAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgICB9KTtcbiAgICAgIHlpZWxkRGF0YS5wdXNoKHtcbiAgICAgICAgIGtleTogXCJCYXNlIEFjY3J1YWxcIixcbiAgICAgICAgIHZhbHVlOiAxMDAgKiB2ZWNaW3RdLFxuICAgICAgICAgdGltZTogdmVjRVt0XSxcbiAgICAgIH0pO1xuICAgICAgeWllbGREYXRhLnB1c2goe1xuICAgICAgICAga2V5OiBcIkdyb3d0aC1hZGp1c3RlZCBCYXNlIEFjY3J1YWxcIixcbiAgICAgICAgIHZhbHVlOiAxMDAgKiAodmVjWlt0XSAtIHBhcmFtSSksXG4gICAgICAgICB0aW1lOiB2ZWNFW3RdLFxuICAgICAgfSk7XG4gICAgICB5aWVsZERhdGEucHVzaCh7XG4gICAgICAgICBrZXk6IFwiRGlzY291bnQgQ3VydmVcIixcbiAgICAgICAgIHZhbHVlOiAxMDAgKiB2ZWNCW3RdLFxuICAgICAgICAgdGltZTogdmVjRVt0XSxcbiAgICAgIH0pO1xuICAgICAgeWllbGREYXRhLnB1c2goe1xuICAgICAgICAga2V5OiBcIkN1bXVsYXRpdmUgU3Rha2UgQVwiLFxuICAgICAgICAgdmFsdWU6IDEwMCAqIHZlY1JldmVyc2VDdW1zdW1TW3QgLSAzXSxcbiAgICAgICAgIHRpbWU6IHZlY0VbdF0sXG4gICAgICB9KTtcbiAgIH1cbiAgIHJldHVybiB5aWVsZERhdGE7XG59O1xuZ2V0U3Rha2UgPSBkID0+IGQua2V5ID09PSBcIlN0YWtlIEFcIiA/IGQudmFsdWUgOiBOYU47XG5nZXRZaWVsZFRlcm0gPSBkID0+IGQua2V5ID09PSBcIkJhc2UgQWNjcnVhbFwiID8gZC52YWx1ZSA6IE5hTjtcbmdldFJlYWxZaWVsZCA9IGQgPT4gZC5rZXkgPT09IFwiR3Jvd3RoLWFkanVzdGVkIEJhc2UgQWNjcnVhbFwiID8gZC52YWx1ZSA6IE5hTjtcbmdldERpc2NvdW50ID0gZCA9PiBkLmtleSA9PT0gXCJEaXNjb3VudCBDdXJ2ZVwiID8gZC52YWx1ZSA6IE5hTjtcbmdldEN1bVN0YWtlID0gZCA9PiBkLmtleSA9PT0gXCJDdW11bGF0aXZlIFN0YWtlIEFcIiA/IGQudmFsdWUgOiBOYU47XG5cbnN0cmluZ1MgPSBcIlRvdGFsIFN0YWtlID0gXCIgKyBpbnB1dFMudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4pO1xuc3RyaW5nSSA9IFwiR3Jvd3RoID0gXCIgKyBwYXJhbUkudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4pICsgXCIvWWVhclwiO1xuc3RyaW5nRCA9IGBEID0gJHtwYXJhbUQudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuKX0geWVhcnNgO1xuc3RyaW5nQyA9IGDiiJpDID0gJHtNYXRoLnNxcnQocGFyYW1DKS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4pfSB5ZWFyc2A7XG5cbnlpZWxkUGFyYW1zID0gW1xuICB7IGtleTogc3RyaW5nRCwgdGltZTogcGFyYW1EIH0sXG4gIHsga2V5OiBzdHJpbmdDLCB0aW1lOiBNYXRoLnNxcnQocGFyYW1DKSB9LFxuXTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogZDMuc2NoZW1lQ2F0ZWdvcnkxMCxcbiAgICBkb21haW46IFtcbiAgICAgIFwiU3Rha2UgQVwiLFxuICAgICAgXCJCYXNlIEFjY3J1YWxcIixcbiAgICAgIFwiR3Jvd3RoLWFkanVzdGVkIEJhc2UgQWNjcnVhbFwiLFxuICAgICAgc3RyaW5nRCxcbiAgICAgIHN0cmluZ0MsXG4gICAgXSxcbiAgfSxcbiAgeDoge1xuICAgIHRpY2tzOiBkMy5yYW5nZSgxLCAxMSksXG4gICAgZG9tYWluOiBbMC4yNSwgMTAuNDVdLFxuICAgIGxhYmVsOiBcIkR1cmF0aW9uIEUgKFllYXJzKVwiLFxuICB9LFxuICB5OiB7XG4gICAgZG9tYWluOiBbXG4gICAgICAwLFxuICAgICAgTWF0aC5tYXgoZDMubWF4KHlpZWxkRGF0YSwgZ2V0U3Rha2UpLCBkMy5tYXgoeWllbGREYXRhLCBnZXRZaWVsZFRlcm0pKSxcbiAgICBdLFxuICAgIGdyaWQ6IHRydWUsXG4gIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcImxlZnRcIiwgbGFiZWw6IFwiU3Rha2UgQSAoJSlcIiB9KSxcbiAgICBQbG90LmF4aXNZKHsgYW5jaG9yOiBcInJpZ2h0XCIsIGxhYmVsOiBcIkFjY3J1YWwgUmF0ZSAoJS9ZZWFyKVwiIH0pLFxuICAgIFBsb3QucmVjdFkoeWllbGREYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLnRpbWUgLSAwLjQ1LFxuICAgICAgeDI6IGQgPT4gZC50aW1lICsgMC40NSxcbiAgICAgIHk6IGdldFN0YWtlLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgICBQbG90LnJ1bGVYKHlpZWxkUGFyYW1zLCB7XG4gICAgICB4OiBcInRpbWVcIixcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSxcbiAgICBQbG90LmxpbmVZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0WWllbGRUZXJtLCBzdHJva2U6IFwia2V5XCIgfSksXG4gICAgUGxvdC5kb3RZKHlpZWxkRGF0YSwgeyB4OiBcInRpbWVcIiwgeTogZ2V0WWllbGRUZXJtLCBmaWxsOiBcImtleVwiIH0pLFxuICAgIFBsb3QubGluZVkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXRSZWFsWWllbGQsIHN0cm9rZTogXCJrZXlcIiB9KSxcbiAgICBQbG90LmRvdFkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXRSZWFsWWllbGQsIGZpbGw6IFwia2V5XCIgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICByYW5nZTogWzgsIDUsIDMsIDRdLm1hcChpID0+IGQzLnNjaGVtZUNhdGVnb3J5MTBbaV0pLFxuICAgIGRvbWFpbjogW1wiQ3VtdWxhdGl2ZSBTdGFrZSBBXCIsIFwiRGlzY291bnQgQ3VydmVcIiwgc3RyaW5nRCwgc3RyaW5nQ10sXG4gIH0sXG4gIHg6IHtcbiAgICB0aWNrczogZDMucmFuZ2UoMSwgMTEpLFxuICAgIGRvbWFpbjogWzAuMjUsIDEwLjQ1XSxcbiAgICBsYWJlbDogXCJEdXJhdGlvbiBFIChZZWFycylcIlxuICB9LFxuICB5OiB7IGRvbWFpbjogWzAsIDEwMF0sIGdyaWQ6IHRydWUgfSxcbiAgY2xpcDogdHJ1ZSxcbiAgaW5zZXRUb3A6IDE2LFxuICBpbnNldExlZnQ6IDgsXG4gIGluc2V0UmlnaHQ6IDgsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwibGVmdFwiLCBsYWJlbDogXCJDdW11bGF0aXZlIFN0YWtlICglKVwiIH0pLFxuICAgIFBsb3QuYXhpc1koeyBhbmNob3I6IFwicmlnaHRcIiwgbGFiZWw6IFwiRGlzY291bnQgKCUpXCIgfSksXG4gICAgUGxvdC5yZWN0WSh5aWVsZERhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQudGltZSAtIDAuNDUsXG4gICAgICB4MjogZCA9PiBkLnRpbWUgKyAwLjQ1LFxuICAgICAgeTogZ2V0Q3VtU3Rha2UsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgIH0pLFxuICAgIFBsb3QucnVsZVgoeWllbGRQYXJhbXMsIHtcbiAgICAgIHg6IFwidGltZVwiLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxuICAgIH0pLFxuICAgIFBsb3QubGluZVkoeWllbGREYXRhLCB7IHg6IFwidGltZVwiLCB5OiBnZXREaXNjb3VudCwgc3Ryb2tlOiBcImtleVwiIH0pLFxuICAgIFBsb3QuZG90WSh5aWVsZERhdGEsIHsgeDogXCJ0aW1lXCIsIHk6IGdldERpc2NvdW50LCBmaWxsOiBcImtleVwiIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29udHJhc3RpbmdUZXh0Q29sb3IoYmFja2dyb3VuZENvbG9yKSB7XG4gIGlmIChkMy5oc2woYmFja2dyb3VuZENvbG9yKS5sIDwgMC41KSB7XG4gICAgcmV0dXJuIFwid2hpdGVcIjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gXCJibGFja1wiO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUFwcHJveERlbHRhQShwYXJhbVMsIHBhcmFtRSkge1xuICByZXR1cm4gcGFyYW1TICogKDEgLSBwYXJhbVMpIC8gcGFyYW1FO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imdyb3d0aERhdGEgPSB7XG4gIGNvbnN0IGdyb3d0aERhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1TID0gMDsgcGFyYW1TIDwgMS4wMTsgcGFyYW1TICs9IDAuMSkge1xuICAgIGZvciAobGV0IHBhcmFtRSA9IDE7IHBhcmFtRSA8PSAxMDsgcGFyYW1FKyspIHtcbiAgICAgIGdyb3d0aERhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCLOlEFcIixcbiAgICAgICAgZTogcGFyYW1FLFxuICAgICAgICBzOiBwYXJhbVMsXG4gICAgICAgIHZhbHVlOiBjb21wdXRlQXBwcm94RGVsdGFBKHBhcmFtUywgcGFyYW1FKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZ3Jvd3RoRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHsgbGVnZW5kOiB0cnVlLCBzY2hlbWU6IFwiU3BlY3RyYWxcIiwgdHlwZTogXCJzZXF1ZW50aWFsXCIsIGxhYmVsOiBcIkFubnVhbCBHcm93dGggzpRTXCIgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMSwgMTAuMSwgMSksIGRvbWFpbjogWzEwLjUsIDAuNV0sIGxhYmVsOiBcIkR1cmF0aW9uIEUgKFllYXJzKVwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiU3Rha2luZyBTXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KGdyb3d0aERhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuZSAtIDAuNSxcbiAgICAgIHgyOiBkID0+IGQuZSArIDAuNSxcbiAgICAgIHkxOiBkID0+IGQucyAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLnMgKyAwLjA1LFxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChncm93dGhEYXRhLCB7XG4gICAgICB4OiBcImVcIixcbiAgICAgIHk6IFwic1wiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFswLCBjb21wdXRlQXBwcm94RGVsdGFBKDAuNSwgMSldLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0RGVsdGFCYXJDaSA9IElucHV0cy5yYW5nZShbMC4wMSwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UHVyY2hhc2VkIH0gXFxEZWx0YSBDX2lgLFxuICBzdGVwOiAwLjAxLFxuICB2YWx1ZTogMSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVEZWx0YUEoQWksIEdpLCBkZWx0YUNpKSB7XG4gIHJldHVybiBNYXRoLmV4cG0xKChBaSAtIChBaSoqMiAqICgxIC0gR2kpKioyIC8gMikpICogTWF0aC5sb2cxcChkZWx0YUNpKSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicHJpY2luZ0RhdGEgPSB7XG4gIGNvbnN0IHByaWNpbmdEYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtR2kgPSAwOyBwYXJhbUdpIDwgMS4wMTsgcGFyYW1HaSArPSAwLjEpIHtcbiAgICBwcmljaW5nRGF0YS5wdXNoKHtcbiAgICAgIGtleTogXCLOlEFcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIHByaWNpbmdEYXRhLnB1c2goe1xuICAgICAga2V5OiBcIk5vcm1hbGlzZWQgzpRBXCIsXG4gICAgICBhaTogMCxcbiAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgdmFsdWU6IE5hTixcbiAgICB9KTtcbiAgICBmb3IgKGxldCBwYXJhbUFpID0gMC4xOyBwYXJhbUFpIDwgMS4wMTsgcGFyYW1BaSArPSAwLjEpIHtcbiAgICAgIHByaWNpbmdEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwizpRBXCIsXG4gICAgICAgIGFpOiBwYXJhbUFpLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVEZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUJhckNpKSxcbiAgICAgIH0pO1xuICAgICAgcHJpY2luZ0RhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJOb3JtYWxpc2VkIM6UQVwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlRGVsdGFBKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFCYXJDaSkgL1xuICAgICAgICAgICAgICAgIChpbnB1dERlbHRhQmFyQ2kgKiBwYXJhbUFpKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcHJpY2luZ0RhdGE7XG59O1xuZ2V0RGVsdGFBID0gZCA9PiBkLmtleSA9PT0gXCLOlEFcIiA/IGQudmFsdWUgOiBOYU47XG5nZXROb3JtRGVsdGFBID0gZCA9PiBkLmtleSA9PT0gXCJOb3JtYWxpc2VkIM6UQVwiID8gZC52YWx1ZSA6IE5hTjtcblxuc3RyaW5nSW5wdXREZWx0YUJhckNpID0gaW5wdXREZWx0YUJhckNpLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGDOlEEsIHdoZXJlIM6UQ+G1oiA9ICR7c3RyaW5nSW5wdXREZWx0YUJhckNpfWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QocHJpY2luZ0RhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0RGVsdGFBLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChwcmljaW5nRGF0YSwge1xuICAgICAgeDogXCJhaVwiLFxuICAgICAgeTogXCJnaVwiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0RGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXG4gICAgICAgICAgW1xuICAgICAgICAgICAgY29tcHV0ZURlbHRhQSgwLjEsIDEsIGlucHV0RGVsdGFCYXJDaSksXG4gICAgICAgICAgICBjb21wdXRlRGVsdGFBKDEsIDEsIGlucHV0RGVsdGFCYXJDaSksXG4gICAgICAgICAgXSxcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxuICAgICAgICApKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBgTm9ybWFsaXNlZCDOlEEsIHdoZXJlIM6UQ+G1oiA9ICR7c3RyaW5nSW5wdXREZWx0YUJhckNpfWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QocHJpY2luZ0RhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0Tm9ybURlbHRhQSxcbiAgICB9KSxcbiAgICBQbG90LnRleHQocHJpY2luZ0RhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldE5vcm1EZWx0YUEoZCkpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcbiAgICAgICAgICBbXG4gICAgICAgICAgICBjb21wdXRlRGVsdGFBKDEsIDAsIGlucHV0RGVsdGFCYXJDaSkgLyBpbnB1dERlbHRhQmFyQ2ksXG4gICAgICAgICAgICBjb21wdXRlRGVsdGFBKDEsIDEsIGlucHV0RGVsdGFCYXJDaSkgLyBpbnB1dERlbHRhQmFyQ2ksXG4gICAgICAgICAgXSxcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsLFxuICAgICAgICApKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dERlbHRhQmFyQ251bGwgPSBJbnB1dHMucmFuZ2UoWzFlLTEsIDFlNV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7UHVyY2hhc2VkIH0gXFxEZWx0YSBDX1xcZW1wdHlzZXRgLFxuICBzdGVwOiAxZS0xLFxuICB2YWx1ZTogMWUyLFxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVplcm9DYXJib25EZWx0YUEoQWksIEdpLCBkZWx0YUNudWxsKSB7XG4gIHJldHVybiAoZGVsdGFDbnVsbCAvICgxICsgZGVsdGFDbnVsbCkpICogKEFpIC0gKEFpKioyICogKDEgLSBHaSkqKjIgLyAyKSkqKjI7XG59XG5cbmZ1bmN0aW9uIGNvbXB1dGVUcnVlRGVsdGFBKEFpLCBHaSwgYmFyQ2lUb25uZXMsIGRlbHRhQmFyQ2lUb25uZXMpIHtcbiAgaWYgKGJhckNpVG9ubmVzID09PSAwKSB7XG4gICAgcmV0dXJuIGNvbXB1dGVaZXJvQ2FyYm9uRGVsdGFBKEFpLCBHaSwgZGVsdGFCYXJDaVRvbm5lcyk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgZGVsdGFCYXJDaSA9IGRlbHRhQmFyQ2lUb25uZXMgLyBiYXJDaVRvbm5lcztcbiAgICByZXR1cm4gY29tcHV0ZURlbHRhQShBaSwgR2ksIGRlbHRhQmFyQ2kpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG51bWJlck9mRGlnaXRzKHgpIHtcbiAgcmV0dXJuIHggPT09IDAgPyAxIDogKDEgKyBNYXRoLmZsb29yKE1hdGgubG9nMTAoeCkpKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ6ZXJvQ2FyYm9uRGF0YSA9IHtcbiAgY29uc3QgemVyb0NhcmJvbkRhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HaSA9IDA7IHBhcmFtR2kgPCAxLjAxOyBwYXJhbUdpICs9IDAuMSkge1xuICAgIHplcm9DYXJib25EYXRhLnB1c2goe1xuICAgICAga2V5OiBcIs6UQVwiLFxuICAgICAgYWk6IDAsXG4gICAgICBnaTogcGFyYW1HaSxcbiAgICAgIHZhbHVlOiBOYU4sXG4gICAgfSk7XG4gICAgemVyb0NhcmJvbkRhdGEucHVzaCh7XG4gICAgICBrZXk6IFwiTm9ybWFsaXNlZCDOlEFcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xuICAgICAgemVyb0NhcmJvbkRhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCLOlEFcIixcbiAgICAgICAgYWk6IHBhcmFtQWksXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZVplcm9DYXJib25EZWx0YUEocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUJhckNudWxsKSxcbiAgICAgIH0pO1xuICAgICAgemVyb0NhcmJvbkRhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJOb3JtYWxpc2VkIM6UQVwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlWmVyb0NhcmJvbkRlbHRhQShwYXJhbUFpLCBwYXJhbUdpLCBpbnB1dERlbHRhQmFyQ251bGwpIC9cbiAgICAgICAgICAgICAgICAoKGlucHV0RGVsdGFCYXJDbnVsbCAvICgxICsgaW5wdXREZWx0YUJhckNudWxsKSkgKiBwYXJhbUFpKioyKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gemVyb0NhcmJvbkRhdGE7XG59O1xuXG5zdHJpbmdEZWx0YUJhckNudWxsID0gaW5wdXREZWx0YUJhckNudWxsLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDEsIG51bWJlck9mRGlnaXRzKGlucHV0RGVsdGFCYXJDbnVsbCkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMSwgbnVtYmVyT2ZEaWdpdHMoaW5wdXREZWx0YUJhckNudWxsKSksXG4gIH0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBgzpRBLCB3aGVyZSDOlEPiiIUgPSAke3N0cmluZ0RlbHRhQmFyQ251bGx9IHRDTzJlcWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QoemVyb0NhcmJvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0RGVsdGFBLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dCh6ZXJvQ2FyYm9uRGF0YSwge1xuICAgICAgeDogXCJhaVwiLFxuICAgICAgeTogXCJnaVwiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0RGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiA0LCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDQgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXG4gICAgICAgICAgW1xuICAgICAgICAgICAgY29tcHV0ZVplcm9DYXJib25EZWx0YUEoMC4xLCAxLCBpbnB1dERlbHRhQmFyQ251bGwpLFxuICAgICAgICAgICAgY29tcHV0ZVplcm9DYXJib25EZWx0YUEoMSwgMSwgaW5wdXREZWx0YUJhckNudWxsKSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGBOb3JtYWxpc2VkIM6UQSwgd2hlcmUgzpRD4oiFID0gJHtzdHJpbmdEZWx0YUJhckNudWxsfSB0Q08yZXFgLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KHplcm9DYXJib25EYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IGdldE5vcm1EZWx0YUEsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KHplcm9DYXJib25EYXRhLCB7XG4gICAgICB4OiBcImFpXCIsXG4gICAgICB5OiBcImdpXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihnZXROb3JtRGVsdGFBKGQpKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoXG4gICAgICAgICAgW1xuICAgICAgICAgICAgY29tcHV0ZVplcm9DYXJib25EZWx0YUEoMSwgMCwgaW5wdXREZWx0YUJhckNudWxsKSAvXG4gICAgICAgICAgICAgICAgICAgIChpbnB1dERlbHRhQmFyQ251bGwgLyAoMSArIGlucHV0RGVsdGFCYXJDbnVsbCkpLFxuICAgICAgICAgICAgY29tcHV0ZVplcm9DYXJib25EZWx0YUEoMSwgMSwgaW5wdXREZWx0YUJhckNudWxsKSAvXG4gICAgICAgICAgICAgICAgICAgIChpbnB1dERlbHRhQmFyQ251bGwgLyAoMSArIGlucHV0RGVsdGFCYXJDbnVsbCkpLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCxcbiAgICAgICAgKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXREZWx0YUEgPSBJbnB1dHMucmFuZ2UoWzAuMDAxLCAwLjk5OV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7QnVybnQgfSBcXERlbHRhIEFgLFxuICBzdGVwOiAwLjAwMSxcbiAgdmFsdWU6IDAuMSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVEZWx0YUNpKEFpLCBHaSwgZGVsdGFBKSB7XG4gIHJldHVybiBNYXRoLmV4cG0xKC1NYXRoLmxvZzFwKGRlbHRhQSkgLyAoQWkgKyAoQWkqKjIgKiAoMSAtIEdpKSoqMiAvIDIpKSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmV0aXJlbWVudERhdGEgPSB7XG4gIGNvbnN0IHJldGlyZW1lbnREYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtR2kgPSAwOyBwYXJhbUdpIDwgMS4wMTsgcGFyYW1HaSArPSAwLjEpIHtcbiAgICByZXRpcmVtZW50RGF0YS5wdXNoKHtcbiAgICAgIGtleTogXCItzpRD4bWiXCIsXG4gICAgICBhaTogMCxcbiAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgdmFsdWU6IE5hTixcbiAgICB9KTtcbiAgICBmb3IgKGxldCBwYXJhbUFpID0gMC4xOyBwYXJhbUFpIDwgMS4wMTsgcGFyYW1BaSArPSAwLjEpIHtcbiAgICAgIHJldGlyZW1lbnREYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiLc6UQ+G1olwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiAtY29tcHV0ZURlbHRhQ2kocGFyYW1BaSwgcGFyYW1HaSwgaW5wdXREZWx0YUEpLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXRpcmVtZW50RGF0YTtcbn07XG5cbnN0cmluZ0lucHV0RGVsdGFBID0gaW5wdXREZWx0YUEudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMSwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAxIH0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBgLc6UQ+G1oiwgd2hlcmUgzpRBID0gJHtzdHJpbmdJbnB1dERlbHRhQX1gLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KHJldGlyZW1lbnREYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICB9KSxcbiAgICBQbG90LnRleHQocmV0aXJlbWVudERhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChcbiAgICAgICAgICBbXG4gICAgICAgICAgICAtY29tcHV0ZURlbHRhQ2koMSwgMCwgaW5wdXREZWx0YUEpLFxuICAgICAgICAgICAgLWNvbXB1dGVEZWx0YUNpKDAuMSwgMSwgaW5wdXREZWx0YUEpLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCxcbiAgICAgICAgKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXREZWx0YUNpbml0aWFsID0gSW5wdXRzLnJhbmdlKFswLjAwMSwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7SW5pdGlhbCB9XFxEZWx0YSBDYCxcbiAgc3RlcDogMC4wMDEsXG4gIHZhbHVlOiAwLjEsXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlU3ByZWFkKEFpLCBHaSwgZGVsdGFDaW5pdGlhbCkge1xuICBjb25zdCBkZWx0YUEgPSBjb21wdXRlRGVsdGFBKEFpLCBHaSwgZGVsdGFDaW5pdGlhbCk7XG4gIGNvbnN0IGRlbHRhQ2ZpbmFsID0gLWNvbXB1dGVEZWx0YUNpKEFpLCBHaSwgZGVsdGFBKTtcbiAgcmV0dXJuIChkZWx0YUNpbml0aWFsIC0gZGVsdGFDZmluYWwpIC8gZGVsdGFDaW5pdGlhbDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJsaXF1aWRhdGlvbkRhdGEgPSB7XG4gIGNvbnN0IGxpcXVpZGF0aW9uRGF0YSA9IFtdO1xuICBmb3IgKGxldCBwYXJhbUdpID0gMDsgcGFyYW1HaSA8IDEuMDE7IHBhcmFtR2kgKz0gMC4xKSB7XG4gICAgbGlxdWlkYXRpb25EYXRhLnB1c2goeyBrZXk6IFwiZGVsdGFhXCIsIGFpOiAwLCBnaTogcGFyYW1HaSwgdmFsdWU6IE5hTiB9KTtcbiAgICBsaXF1aWRhdGlvbkRhdGEucHVzaCh7IGtleTogXCJkZWx0YWNcIiwgYWk6IDAsIGdpOiBwYXJhbUdpLCB2YWx1ZTogTmFOIH0pO1xuICAgIGxpcXVpZGF0aW9uRGF0YS5wdXNoKHsga2V5OiBcInNwcmVhZFwiLCBhaTogMCwgZ2k6IHBhcmFtR2ksIHZhbHVlOiBOYU4gfSk7XG4gICAgZm9yIChsZXQgcGFyYW1BaSA9IDAuMTsgcGFyYW1BaSA8IDEuMDE7IHBhcmFtQWkgKz0gMC4xKSB7XG4gICAgICBjb25zdCBkZWx0YUEgPSBjb21wdXRlRGVsdGFBKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFDaW5pdGlhbClcbiAgICAgIGxpcXVpZGF0aW9uRGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcImRlbHRhYVwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlRGVsdGFBKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFDaW5pdGlhbCkgL1xuICAgICAgICAgICAgICAgIGlucHV0RGVsdGFDaW5pdGlhbCxcbiAgICAgIH0pO1xuICAgICAgbGlxdWlkYXRpb25EYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiZGVsdGFjXCIsXG4gICAgICAgIGFpOiBwYXJhbUFpLFxuICAgICAgICBnaTogcGFyYW1HaSxcbiAgICAgICAgdmFsdWU6IGNvbXB1dGVEZWx0YUNpKHBhcmFtQWksIHBhcmFtR2ksIGRlbHRhQSkgLyBpbnB1dERlbHRhQ2luaXRpYWwsXG4gICAgICB9KTtcbiAgICAgIGxpcXVpZGF0aW9uRGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcInNwcmVhZFwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlU3ByZWFkKHBhcmFtQWksIHBhcmFtR2ksIGlucHV0RGVsdGFDaW5pdGlhbCksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGxpcXVpZGF0aW9uRGF0YTtcbn07XG5nZXRMaXFEZWx0YUEgPSBkID0+IGQua2V5ID09PSBcImRlbHRhYVwiID8gZC52YWx1ZSA6IE5hTjtcbmdldExpcURlbHRhQ2kgPSBkID0+IGQua2V5ID09PSBcImRlbHRhY1wiID8gZC52YWx1ZSA6IE5hTjtcbmdldExpcVNwcmVhZCA9IGQgPT4gZC5rZXkgPT09IFwic3ByZWFkXCIgPyBkLnZhbHVlIDogTmFOO1xuXG5zdHJpbmdJbnB1dERlbHRhQ2luaXRpYWwgPSBpbnB1dERlbHRhQ2luaXRpYWwudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAgeyBzdHlsZTogXCJwZXJjZW50XCIsIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMSwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAxIH0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgIGRvbWFpbjogWzAsIGNvbXB1dGVTcHJlYWQoMSwgMCwgMSldLFxuICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgIGxhYmVsOiBgQ2FyYm9uIERpZmZlcmVuY2UgzrUsIHdoZXJlIGluaXRpYWwgzpRDID0gJHtzdHJpbmdJbnB1dERlbHRhQ2luaXRpYWx9YCxcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0TGlxU3ByZWFkLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldExpcVNwcmVhZChkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFswLCBjb21wdXRlU3ByZWFkKDEsIDAsIGlucHV0RGVsdGFDaW5pdGlhbCldLFxuICAgICAgICAgIGQzLmludGVycG9sYXRlU3BlY3RyYWwsXG4gICAgICAgICkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiSW5wdXRzLmJpbmQoXG4gIElucHV0cy5yYW5nZShbMC4wMDEsIDFdLCB7XG4gICAgbGFiZWw6IHRleGBcXHRleHR7SW5pdGlhbCB9XFxEZWx0YSBDYCxcbiAgICBzdGVwOiAwLjAwMSxcbiAgICB2YWx1ZTogMC4xLFxuICB9KSxcbiAgdmlld29mIGlucHV0RGVsdGFDaW5pdGlhbCxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgZG9tYWluOiBbMCwgMV0sXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IGBDb21wb25lbnQgzpRBLCB3aGVyZSBpbml0aWFsIM6UQyA9ICR7XG4gICAgICBzdHJpbmdJbnB1dERlbHRhQ2luaXRpYWxcbiAgICB9YCxcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiQeG1olwiIH0sXG4gIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QucmVjdChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQuYWkgLSAwLjA1LFxuICAgICAgeDI6IGQgPT4gZC5haSArIDAuMDUsXG4gICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgIHkyOiBkID0+IGQuZ2kgKyAwLjA1LFxuICAgICAgZmlsbDogZ2V0TGlxRGVsdGFBLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dChsaXF1aWRhdGlvbkRhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGdldExpcURlbHRhQShkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKGQudmFsdWUpKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHNjaGVtZTogXCJHcmV5c1wiLFxuICAgIGRvbWFpbjogW1xuICAgICAgLTEsXG4gICAgICBjb21wdXRlRGVsdGFDaShcbiAgICAgICAgMSxcbiAgICAgICAgMCxcbiAgICAgICAgY29tcHV0ZURlbHRhQSgxLCAwLCBpbnB1dERlbHRhQ2luaXRpYWwpIC8gaW5wdXREZWx0YUNpbml0aWFsLFxuICAgICAgKSxcbiAgICBdLFxuICAgIGxhYmVsOiBgQ29tcG9uZW50IM6UQywgd2hlcmUgaW5pdGlhbCDOlEMgPSAke1xuICAgICAgc3RyaW5nSW5wdXREZWx0YUNpbml0aWFsXG4gICAgfWAsXG4gIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGxhYmVsOiBcIkHhtaJcIiB9LFxuICB5OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBkb21haW46IFsxLjA1LCAtMC4wNV0sIGxhYmVsOiBcIkfhtaJcIiB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QobGlxdWlkYXRpb25EYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IGdldExpcURlbHRhQ2ksXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KGxpcXVpZGF0aW9uRGF0YSwge1xuICAgICAgeDogXCJhaVwiLFxuICAgICAgeTogXCJnaVwiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZ2V0TGlxRGVsdGFDaShkKSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIC0xLFxuICAgICAgICAgICAgY29tcHV0ZURlbHRhQ2koXG4gICAgICAgICAgICAgIDEsXG4gICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgIGNvbXB1dGVEZWx0YUEoMSwgMCwgaW5wdXREZWx0YUNpbml0aWFsKSAvIGlucHV0RGVsdGFDaW5pdGlhbCxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgXSxcbiAgICAgICAgICBkMy5pbnRlcnBvbGF0ZUdyZXlzLFxuICAgICAgICApKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVCZXRhKHZlY0FpLCB2ZWNHaSkge1xuICBjb25zdCBiZXRhMiA9IHZlY0FpLnJlZHVjZShcbiAgICAoYWNjLCBBaSwgaSkgPT4gYWNjICsgQWkgLSBBaSAqICgxIC0gdmVjR2lbaV0pKioyLFxuICAgIDAsXG4gICk7XG4gIHJldHVybiBNYXRoLnNxcnQoYmV0YTIpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVCZXRhaShBaSwgR2kpIHtcbiAgcmV0dXJuIE1hdGguc3FydChBaSAtIEFpICogKDEgLSBHaSkqKjIpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJldGFEYXRhID0ge1xuICBjb25zdCBiZXRhRGF0YSA9IFtdO1xuICBmb3IgKGxldCBwYXJhbUdpID0gMDsgcGFyYW1HaSA8IDEuMDE7IHBhcmFtR2kgKz0gMC4xKSB7XG4gICAgYmV0YURhdGEucHVzaCh7XG4gICAgICBrZXk6IFwizrLhtaJcIixcbiAgICAgIGFpOiAwLFxuICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICB2YWx1ZTogTmFOLFxuICAgIH0pO1xuICAgIGZvciAobGV0IHBhcmFtQWkgPSAwLjE7IHBhcmFtQWkgPCAxLjAxOyBwYXJhbUFpICs9IDAuMSkge1xuICAgICAgYmV0YURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCLOsuG1olwiLFxuICAgICAgICBhaTogcGFyYW1BaSxcbiAgICAgICAgZ2k6IHBhcmFtR2ksXG4gICAgICAgIHZhbHVlOiBjb21wdXRlQmV0YWkocGFyYW1BaSwgcGFyYW1HaSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGJldGFEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogXCLOsuG1olwiLFxuICB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJB4bWiXCIgfSxcbiAgeTogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgZG9tYWluOiBbMS4wNSwgLTAuMDVdLCBsYWJlbDogXCJH4bWiXCIgfSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5yZWN0KGJldGFEYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmFpIC0gMC4wNSxcbiAgICAgIHgyOiBkID0+IGQuYWkgKyAwLjA1LFxuICAgICAgeTE6IGQgPT4gZC5naSAtIDAuMDUsXG4gICAgICB5MjogZCA9PiBkLmdpICsgMC4wNSxcbiAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICB9KSxcbiAgICBQbG90LnRleHQoYmV0YURhdGEsIHtcbiAgICAgIHg6IFwiYWlcIixcbiAgICAgIHk6IFwiZ2lcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoZDMuaW50ZXJwb2xhdGVTcGVjdHJhbChkLnZhbHVlKSksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJhcnJheUFpID0gWzAuNSwgMC4yLCAwLjEsIDAuMDVdO1xuYXJyYXlJbml0aWFsR2kgPSBbMC4zLCAwLjEsIDAuMDUsIDAuMDFdO1xuYXJyYXlOZXdHaSA9IGFycmF5SW5pdGlhbEdpLnRvUmV2ZXJzZWQoKTtcbmJldGFDb250cmliRGF0YSA9IHtcbiAgY29uc3QgYmV0YUNvbnRyaWJEYXRhID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXlBaS5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IEFpID0gYXJyYXlBaVtpXTtcbiAgICBjb25zdCBpbml0aWFsR2kgPSBhcnJheUluaXRpYWxHaVtpXTtcbiAgICBjb25zdCBpbml0aWFsQmV0YTIgPSBjb21wdXRlQmV0YWkoQWksIGluaXRpYWxHaSkqKjI7XG4gICAgY29uc3QgbmV3R2kgPSBhcnJheU5ld0dpW2ldO1xuICAgIGNvbnN0IG5ld0JldGEyID0gY29tcHV0ZUJldGFpKEFpLCBuZXdHaSkqKjI7XG4gICAgYmV0YUNvbnRyaWJEYXRhLnB1c2goeyBrZXk6IFwiSW5pdGlhbCBH4bWiXCIsIGNsYXNzOiBpLCB2YWx1ZTogaW5pdGlhbEdpIH0pO1xuICAgIGJldGFDb250cmliRGF0YS5wdXNoKHsga2V5OiBcIkluaXRpYWwgzrLhtaLCslwiLCBjbGFzczogaSwgdmFsdWU6IGluaXRpYWxCZXRhMiB9KTtcbiAgICBiZXRhQ29udHJpYkRhdGEucHVzaCh7IGtleTogXCJOZXcgR+G1olwiLCBjbGFzczogaSwgdmFsdWU6IG5ld0dpIH0pO1xuICAgIGJldGFDb250cmliRGF0YS5wdXNoKHsga2V5OiBcIk5ldyDOsuG1osKyXCIsIGNsYXNzOiBpLCB2YWx1ZTogbmV3QmV0YTIgfSk7XG4gIH1cbiAgcmV0dXJuIGJldGFDb250cmliRGF0YTtcbn07XG5nZXRJbml0aWFsRyA9IGQgPT4gZC5rZXkgPT09IFwiSW5pdGlhbCBH4bWiXCIgPyBkLnZhbHVlIDogTmFOO1xuZ2V0SW5pdGlhbEJldGEyID0gZCA9PiBkLmtleSA9PT0gXCJJbml0aWFsIM6y4bWiwrJcIiA/IGQudmFsdWUgOiBOYU47XG5nZXROZXdHID0gZCA9PiBkLmtleSA9PT0gXCJOZXcgR+G1olwiID8gZC52YWx1ZSA6IE5hTjtcbmdldE5ld0JldGEyID0gZCA9PiBkLmtleSA9PT0gXCJOZXcgzrLhtaLCslwiID8gZC52YWx1ZSA6IE5hTjtcblxuZG9tYWluRyA9IFswLCBNYXRoLm1heChkMy5tYXgoYXJyYXlJbml0aWFsR2kpLCBkMy5tYXgoYXJyYXlOZXdHaSkpXTtcbnJhbmdlQmV0YTIgPSBbXG4gIDAsXG4gIE1hdGgubWF4KFxuICAgIGQzLm1heChiZXRhQ29udHJpYkRhdGEsIGdldEluaXRpYWxCZXRhMiksXG4gICAgZDMubWF4KGJldGFDb250cmliRGF0YSwgZ2V0TmV3QmV0YTIpLFxuICApLFxuXTtcbnNjYWxlRyA9IGQzLnNjYWxlTGluZWFyKGRvbWFpbkcsIHJhbmdlQmV0YTIpO1xubWFwU2NhbGVHID0geCA9PiB4Lm1hcChzY2FsZUcpO1xuXG5wYXJhbUluaXRpYWxCZXRhID0gY29tcHV0ZUJldGEoYXJyYXlBaSwgYXJyYXlJbml0aWFsR2kpO1xucGFyYW1OZXdCZXRhID0gY29tcHV0ZUJldGEoYXJyYXlBaSwgYXJyYXlOZXdHaSk7XG5cbnN0cmluZ0luaXRpYWxCZXRhID0gXCJJbml0aWFsIM6yID0gXCIgKyBwYXJhbUluaXRpYWxCZXRhLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiA0LCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDQgfSxcbik7XG5zdHJpbmdOZXdCZXRhID0gXCJOZXcgzrIgPSBcIiArIHBhcmFtTmV3QmV0YS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogNCwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiA0IH0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHJhbmdlOiBbXCJncmF5XCIsIFwiYmxhY2tcIiwgXCJibHVlXCIsIFwicmVkXCJdLFxuICAgIGRvbWFpbjogW1wiSW5pdGlhbCDOsuG1osKyXCIsIFwiTmV3IM6y4bWiwrJcIiwgXCJJbml0aWFsIEfhtaJcIiwgXCJOZXcgR+G1olwiXSxcbiAgfSxcbiAgeDoge1xuICAgIHRpY2tzOiBkMy5yYW5nZSg0KSxcbiAgICBsYWJlbDogXCJB4bWiIE92ZXIgNCBDbGFzc2VzXCIsXG4gICAgdGlja0Zvcm1hdDogZCA9PiBhcnJheUFpW2RdLFxuICB9LFxuICB5OiB7IGRvbWFpbjogcmFuZ2VCZXRhMiB9LFxuICBpbnNldFRvcDogMTYsXG4gIGluc2V0TGVmdDogOCxcbiAgaW5zZXRSaWdodDogOCxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJsZWZ0XCIsIGxhYmVsOiBcIs6y4bWiwrJcIiB9KSxcbiAgICBQbG90LmF4aXNZKHNjYWxlRy50aWNrcygpLCB7IGFuY2hvcjogXCJyaWdodFwiLCBsYWJlbDogXCJH4bWiXCIsIHk6IHNjYWxlRyB9KSxcbiAgICBQbG90LnJlY3RZKGJldGFDb250cmliRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5jbGFzcyAtIDAuNDUsXG4gICAgICB4MjogZCA9PiBkLmNsYXNzLFxuICAgICAgeTogZ2V0SW5pdGlhbEJldGEyLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgICBQbG90LnJlY3RZKGJldGFDb250cmliRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5jbGFzcyxcbiAgICAgIHgyOiBkID0+IGQuY2xhc3MgKyAwLjQ1LFxuICAgICAgeTogZ2V0TmV3QmV0YTIsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgIH0pLFxuICAgIFBsb3QubGluZVkoYmV0YUNvbnRyaWJEYXRhLCBQbG90Lm1hcFkobWFwU2NhbGVHLCB7XG4gICAgICB4OiBcImNsYXNzXCIsXG4gICAgICB5OiBnZXRJbml0aWFsRyxcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSksXG4gICAgUGxvdC5kb3RZKGJldGFDb250cmliRGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlRywge1xuICAgICAgeDogXCJjbGFzc1wiLFxuICAgICAgeTogZ2V0SW5pdGlhbEcsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgIH0pKSxcbiAgICBQbG90LmxpbmVZKGJldGFDb250cmliRGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlRywge1xuICAgICAgeDogXCJjbGFzc1wiLFxuICAgICAgeTogZ2V0TmV3RyxcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZURhc2hhcnJheTogNCxcbiAgICB9KSksXG4gICAgUGxvdC5kb3RZKGJldGFDb250cmliRGF0YSwgUGxvdC5tYXBZKG1hcFNjYWxlRywge1xuICAgICAgeDogXCJjbGFzc1wiLFxuICAgICAgeTogZ2V0TmV3RyxcbiAgICAgIGZpbGw6IFwia2V5XCIsXG4gICAgfSkpLFxuICAgIFBsb3QudGV4dChbc3RyaW5nSW5pdGlhbEJldGFdLCB7IHg6IDAuNSwgeTogMC4yMywgZmlsbDogZCA9PiBcImJsdWVcIiB9KSxcbiAgICBQbG90LnRleHQoW3N0cmluZ05ld0JldGFdLCB7IHg6IDIuNSwgeTogMC4yMywgZmlsbDogZCA9PiBcInJlZFwiIH0pLFxuICBdLFxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUxhbWJkYUdHKEFRLCBHaSwgR0cpIHtcbiAgcmV0dXJuICgxIC0gQVEpIC8gKDEgKyAoR2kgLyBHRykqKjIpO1xufVxuXG5mdW5jdGlvbiBjaGFuZ2VUcmFuc2xhdGlvbihkeCwgZHkpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBzdmdUcmFuc2Zvcm1MaXN0ID0gdGhpcy50cmFuc2Zvcm0uYmFzZVZhbDtcbiAgICBpZiAoc3ZnVHJhbnNmb3JtTGlzdC5sZW5ndGggPiAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTVkdUcmFuc2Zvcm1MaXN0IG11c3Qgb25seSBjb250YWluIG9uZSB0cmFuc2xhdGlvblwiKTtcbiAgICB9XG4gICAgY29uc3Qge2UsIGZ9ID0gc3ZnVHJhbnNmb3JtTGlzdC5jb25zb2xpZGF0ZSgpLm1hdHJpeDtcbiAgICByZXR1cm4gYHRyYW5zbGF0ZSgke2UgKyBkeH0sJHtmICsgZHl9KWA7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJsYW1iZGFHR0RhdGEgPSB7XG4gIGNvbnN0IGxhbWJkYUdHRGF0YSA9IFtdO1xuICBmb3IgKGxldCBwYXJhbUdpID0gMDsgcGFyYW1HaSA8IDEuMDE7IHBhcmFtR2kgKz0gMC4xKSB7XG4gICAgZm9yIChsZXQgcGFyYW1BUSA9IDA7IHBhcmFtQVEgPCAxLjAxOyBwYXJhbUFRICs9IDAuMSkge1xuICAgICAgbGFtYmRhR0dEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwizrtcIixcbiAgICAgICAgYXE6IHBhcmFtQVEsXG4gICAgICAgIGdpOiBwYXJhbUdpLFxuICAgICAgICB2YWx1ZTogY29tcHV0ZUxhbWJkYUdHKHBhcmFtQVEsIHBhcmFtR2ksIDEgLSBwYXJhbUdpKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbGFtYmRhR0dEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwbG90TGFtYmRhR0cgPSB7XG4gIGNvbnN0IHBsb3RMYW1iZGFHRyA9IFBsb3QucGxvdCh7XG4gICAgY29sb3I6IHtcbiAgICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgICAgZG9tYWluOiBbMCwgMV0sXG4gICAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICAgIGxhYmVsOiBcIs67XCIsXG4gICAgfSxcbiAgICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJBICBcIiB9LFxuICAgIHk6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksIGRvbWFpbjogWzEuMDUsIC0wLjA1XSwgbGFiZWw6IFwiR+G1olwiIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QuZnJhbWUoKSxcbiAgICAgIFBsb3QucmVjdChsYW1iZGFHR0RhdGEsIHtcbiAgICAgICAgeDE6IGQgPT4gZC5hcSAtIDAuMDUsXG4gICAgICAgIHgyOiBkID0+IGQuYXEgKyAwLjA1LFxuICAgICAgICB5MTogZCA9PiBkLmdpIC0gMC4wNSxcbiAgICAgICAgeTI6IGQgPT4gZC5naSArIDAuMDUsXG4gICAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICAgIH0pLFxuICAgICAgUGxvdC50ZXh0KGxhbWJkYUdHRGF0YSwge1xuICAgICAgICB4OiBcImFxXCIsXG4gICAgICAgIHk6IFwiZ2lcIixcbiAgICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgICApLFxuICAgICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxuICAgICAgICApLFxuICAgICAgfSksXG4gICAgXSxcbiAgfSk7XG5cbiAgZDMuc2VsZWN0KHBsb3RMYW1iZGFHRylcbiAgICAuc2VsZWN0KFwiZ1thcmlhLWxhYmVsPSd4LWF4aXMgbGFiZWwnXVwiKVxuICAgIC5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAuY2xvbmUoZmFsc2UpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigtMTIsIDEuNSkpXG4gICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjAuNmVtXCIpXG4gICAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiNjAwXCIpXG4gICAgICAudGV4dChcIlFcIik7XG5cbiAgcmV0dXJuIHBsb3RMYW1iZGFHRztcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZUxhbWJkYUcoQVEsIEFHKSB7XG4gIHJldHVybiAyICogQUcgLyAoMiAqIEFHICsgQVEgKiBNYXRoLnNxcnQoMikpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVMYW1iZGFRKEFRLCBBRykge1xuICByZXR1cm4gMSAtIGNvbXB1dGVMYW1iZGFHKEFRLCBBRyk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibGFtYmRhR1FEYXRhID0ge1xuICBjb25zdCBsYW1iZGFHUURhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1BRyA9IDA7IHBhcmFtQUcgPCAxLjAxOyBwYXJhbUFHICs9IDAuMSkge1xuICAgIGZvciAobGV0IHBhcmFtQVEgPSAwOyBwYXJhbUFRIDwgMS4wMTsgcGFyYW1BUSArPSAwLjEpIHtcbiAgICAgIGlmIChwYXJhbUFHICsgcGFyYW1BUSA8IDEuMDEpIHtcbiAgICAgICAgbGFtYmRhR1FEYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCJSZWxhdGl2ZSDwnZeU8J2XmiBMaXF1aWRpdHkgUG9vbCBTaGFyZVwiLFxuICAgICAgICAgIGFxOiBwYXJhbUFRLFxuICAgICAgICAgIGFnOiBwYXJhbUFHLFxuICAgICAgICAgIHZhbHVlOiBjb21wdXRlTGFtYmRhRyhwYXJhbUFRLCBwYXJhbUFHKSxcbiAgICAgICAgfSk7XG4gICAgICAgIGxhbWJkYUdRRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwiUmVsYXRpdmUg8J2XlPCdl6QgTGlxdWlkaXR5IFBvb2wgU2hhcmVcIixcbiAgICAgICAgICBhcTogcGFyYW1BUSxcbiAgICAgICAgICBhZzogcGFyYW1BRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUxhbWJkYVEocGFyYW1BUSwgcGFyYW1BRyksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gbGFtYmRhR1FEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwbG90TGFtYmRhR1EgPSB7XG4gIGNvbnN0IHBsb3RMYW1iZGFHUSA9IFBsb3QucGxvdCh7XG4gICAgYXNwZWN0UmF0aW86IDEsXG4gICAgY29sb3I6IHtcbiAgICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgICAgZG9tYWluOiBbMCwgMV0sXG4gICAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICAgIGxhYmVsOiBcIs67XCIsXG4gICAgfSxcbiAgICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJBICBcIiB9LFxuICAgIHk6IHtcbiAgICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxuICAgICAgZG9tYWluOiBbMS4wNSwgLTAuMDVdLFxuICAgICAgbGFiZWw6IFwiQVwiLFxuICAgIH0sXG4gICAgZng6IHsgbGFiZWw6IG51bGwgfSxcbiAgICBjbGFzc05hbWU6IFwiTGFtYmRhR1FcIixcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5mcmFtZSgpLFxuICAgICAgUGxvdC5yZWN0KGxhbWJkYUdRRGF0YSwge1xuICAgICAgICB4MTogZCA9PiBkLmFxIC0gMC4wNSxcbiAgICAgICAgeDI6IGQgPT4gZC5hcSArIDAuMDUsXG4gICAgICAgIHkxOiBkID0+IGQuYWcgLSAwLjA1LFxuICAgICAgICB5MjogZCA9PiBkLmFnICsgMC4wNSxcbiAgICAgICAgZng6IFwia2V5XCIsXG4gICAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICAgIH0pLFxuICAgICAgUGxvdC50ZXh0KGxhbWJkYUdRRGF0YSwge1xuICAgICAgICB4OiBcImFxXCIsXG4gICAgICAgIHk6IFwiYWdcIixcbiAgICAgICAgZng6IFwia2V5XCIsXG4gICAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICAgKSxcbiAgICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICAgKSxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIGQzLnNlbGVjdChwbG90TGFtYmRhR1EpXG4gICAgLnNlbGVjdChcImdbYXJpYS1sYWJlbD0neC1heGlzIGxhYmVsJ11cIilcbiAgICAuc2VsZWN0KFwidGV4dFwiKVxuICAgIC5jbG9uZShmYWxzZSlcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGNoYW5nZVRyYW5zbGF0aW9uKC0xMiwgMS41KSlcbiAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMC42ZW1cIilcbiAgICAgIC5hdHRyKFwiZm9udC13ZWlnaHRcIiwgXCI2MDBcIilcbiAgICAgIC50ZXh0KFwiUVwiKTtcblxuICBkMy5zZWxlY3QocGxvdExhbWJkYUdRKVxuICAgIC5zZWxlY3QoXCJnW2FyaWEtbGFiZWw9J3ktYXhpcyBsYWJlbCddXCIpXG4gICAgLnNlbGVjdChcInRleHRcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGNoYW5nZVRyYW5zbGF0aW9uKDAsIDEwKSlcbiAgICAuY2xvbmUoZmFsc2UpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigxNCwgNC4xKSlcbiAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMC42ZW1cIilcbiAgICAgIC5hdHRyKFwiZm9udC13ZWlnaHRcIiwgXCI2MDBcIilcbiAgICAgIC50ZXh0KFwiR1wiKTtcblxuICByZXR1cm4gcGxvdExhbWJkYUdRO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBwaWVjZXdpc2VMb2dUcmFuc2Zvcm0oeFRyYW4gPSAxKSB7XG4gIHJldHVybiB4ID0+IHggPiB4VHJhbiA/IE1hdGgubG9nKHgpIDogeCAtIHhUcmFuICsgTWF0aC5sb2coeFRyYW4pO1xufVxuXG5mdW5jdGlvbiBwaWVjZXdpc2VMb2dJbnZlcnQoeFRyYW4gPSAxKSB7XG4gIHJldHVybiB5ID0+IHkgPiBNYXRoLmxvZyh4VHJhbikgPyBNYXRoLmV4cCh5KSA6IHkgLSBNYXRoLmxvZzEwKHhUcmFuKSArIHhUcmFuO1xufVxuXG5mdW5jdGlvbiBzZXRJbnB1dChpbnB1dCwgdmFsdWUpIHtcbiAgaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xufVxuXG5mdW5jdGlvbiBudW1EaWdpdHMoeCkge1xuICByZXR1cm4geCA9PT0gMCA/IDEgOiAoMSArIE1hdGguZmxvb3IoTWF0aC5sb2cxMCh4KSkpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRlZmF1bHRBVmFsdWUgPSAyZTY7XG5kZWZhdWx0QVN1cHBseSA9IDJlNztcbmRlZmF1bHRQcmVzZW50VG9ubmVzID0gMWU3O1xuZGVmYXVsdERlbHRhVG9ubmVzID0gMWUyO1xuZGVmYXVsdEFpID0gMC41O1xuZGVmYXVsdEdpID0gMC41O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IklucHV0cy5idXR0b24oXG4gIFtbXCJSZXNldFwiLCAoKSA9PiB7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QVZhbHVlLCBkZWZhdWx0QVZhbHVlKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBU3VwcGx5LCBkZWZhdWx0QVN1cHBseSk7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0UHJlc2VudFRvbm5lcywgZGVmYXVsdFByZXNlbnRUb25uZXMpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dERlbHRhVG9ubmVzLCBkZWZhdWx0RGVsdGFUb25uZXMpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dEFpLCBkZWZhdWx0QWkpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dEdpLCBkZWZhdWx0R2kpO1xuICB9XV0sXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpbnB1dEFWYWx1ZSA9IElucHV0cy5yYW5nZShbMWU1LCAxZTldLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e01hcmtldCBjYXAuIG9mIFxcdGV4dGJme0F9fWAsXG4gIHN0ZXA6IDEsXG4gIHZhbHVlOiBkZWZhdWx0QVZhbHVlLFxuICB0cmFuc2Zvcm06IE1hdGgubG9nLFxufSk7XG52aWV3b2YgaW5wdXRBU3VwcGx5ID0gSW5wdXRzLnJhbmdlKFsxZTYsIDFlMTBdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1N1cHBseSBvZiBcXHRleHRiZntBfX1gLFxuICBzdGVwOiAxLFxuICB2YWx1ZTogZGVmYXVsdEFTdXBwbHksXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbnZpZXdvZiBpbnB1dFByZXNlbnRUb25uZXMgPSBJbnB1dHMucmFuZ2UoWzAsIDFlOV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7SW52ZW50b3J5IH0gQ19pYCxcbiAgc3RlcDogMWUtMyxcbiAgdmFsdWU6IGRlZmF1bHRQcmVzZW50VG9ubmVzLFxuICB0cmFuc2Zvcm06IHBpZWNld2lzZUxvZ1RyYW5zZm9ybSgxZS0zKSxcbiAgaW52ZXJ0OiBwaWVjZXdpc2VMb2dJbnZlcnQoMWUtMyksXG59KTtcbnZpZXdvZiBpbnB1dERlbHRhVG9ubmVzID0gSW5wdXRzLnJhbmdlKFsxZS0zLCAxZTddLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1B1cmNoYXNlZCB0b25uZXN9YCxcbiAgc3RlcDogMWUtMyxcbiAgdmFsdWU6IGRlZmF1bHREZWx0YVRvbm5lcyxcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcbn0pO1xudmlld29mIGlucHV0QWkgPSBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e0FsbG9jYXRpb24gfSBBX2lgLFxuICBzdGVwOiAxZS02LFxuICB2YWx1ZTogZGVmYXVsdEFpLFxuICB0cmFuc2Zvcm06IHBpZWNld2lzZUxvZ1RyYW5zZm9ybSgxZS02KSxcbiAgaW52ZXJ0OiBwaWVjZXdpc2VMb2dJbnZlcnQoMWUtNiksXG59KTtcbnZpZXdvZiBpbnB1dEdpID0gSW5wdXRzLnJhbmdlKFswLCAxXSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtBbGxvY2F0aW9uIH0gR19pYCxcbiAgc3RlcDogMWUtNixcbiAgdmFsdWU6IGRlZmF1bHRHaSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBhcmFtRGVsdGFBID0gY29tcHV0ZVRydWVEZWx0YUEoXG4gIGlucHV0QWksXG4gIGlucHV0R2ksXG4gIGlucHV0UHJlc2VudFRvbm5lcyxcbiAgaW5wdXREZWx0YVRvbm5lcyxcbik7XG5wYXJhbURlbHRhVG9ubmVzID0gcGFyYW1EZWx0YUEgPT09IDAgPyAwIDogaW5wdXREZWx0YVRvbm5lcztcbnBhcmFtQUVtaXR0ZWQgPSBwYXJhbURlbHRhQSAqIGlucHV0QVN1cHBseTtcbnBhcmFtQVByaWNlID0gaW5wdXRBVmFsdWUgLyBpbnB1dEFTdXBwbHk7XG5wYXJhbUJhckNpUHJpY2UgPSBpbnB1dEFWYWx1ZSAqIHBhcmFtRGVsdGFBIC8gaW5wdXREZWx0YVRvbm5lcztcblxuc3RyaW5nQVN1cHBseSA9IGlucHV0QVN1cHBseS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAyIC0gbnVtRGlnaXRzKHBhcmFtQUVtaXR0ZWQpKSxcbiAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1BRW1pdHRlZCkpLFxuICB9LFxuKSArIFwiIGtWQ01cIjtcbnN0cmluZ1ByZXNlbnRUb25uZXMgPSBpbnB1dFByZXNlbnRUb25uZXMudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMyAtIG51bURpZ2l0cyhwYXJhbURlbHRhVG9ubmVzKSksXG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAzIC0gbnVtRGlnaXRzKHBhcmFtRGVsdGFUb25uZXMpKSxcbiAgfSxcbikgKyBcIiB0Q08yZXFcIjtcbnN0cmluZ0FFbWl0dGVkID0gXCIrXCIgKyBwYXJhbUFFbWl0dGVkLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbUFFbWl0dGVkKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCBudW1EaWdpdHMocGFyYW1BRW1pdHRlZCkpLFxuICB9LFxuKSArIFwiIGtWQ01cIjtcbnN0cmluZ0RlbHRhVG9ubmVzID0gXCIrXCIgKyBwYXJhbURlbHRhVG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDMsIG51bURpZ2l0cyhwYXJhbURlbHRhVG9ubmVzKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgzLCBudW1EaWdpdHMocGFyYW1EZWx0YVRvbm5lcykpLFxuICB9LFxuKSArIFwiIHRDTzJlcVwiO1xuc3RyaW5nQVByaWNlID0gXCIkXCIgKyBwYXJhbUFQcmljZS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQVByaWNlKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQVByaWNlKSksXG4gIH0sXG4pO1xuc3RyaW5nQmFyQ2lQcmljZSA9IFwiJFwiICsgcGFyYW1CYXJDaVByaWNlLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1CYXJDaVByaWNlKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQmFyQ2lQcmljZSkpLFxuICB9LFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkZWZhdWx0TGlxdWlkVG9ubmVzID0gMWU3O1xuZGVmYXVsdEFCdXJudCA9IDFlMjtcbmRlZmF1bHRHbnVsbCA9IDAuNTtcbmRlZmF1bHRBID0gMC41O1xuZGVmYXVsdFMgPSAwLjU7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiSW5wdXRzLmJ1dHRvbihcbiAgW1tcIlJlc2V0XCIsICgpID0+IHtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBVmFsdWVfLCBkZWZhdWx0QVZhbHVlKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBU3VwcGx5XywgZGVmYXVsdEFTdXBwbHkpO1xuICAgIHNldElucHV0KHZpZXdvZiBpbnB1dExpcXVpZFRvbm5lcywgZGVmYXVsdExpcXVpZFRvbm5lcyk7XG4gICAgc2V0SW5wdXQodmlld29mIGlucHV0QUJ1cm50LCBkZWZhdWx0QUJ1cm50KTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRBaSwgZGVmYXVsdEFpKTtcbiAgICBzZXRJbnB1dCh2aWV3b2YgaW5wdXRHaSwgZGVmYXVsdEdpKTtcbiAgfV1dLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXRBVmFsdWVfID0gSW5wdXRzLnJhbmdlKFsxZTUsIDFlOV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7TWFya2V0IGNhcC4gb2YgXFx0ZXh0YmZ7QX19YCxcbiAgc3RlcDogMSxcbiAgdmFsdWU6IGRlZmF1bHRBVmFsdWUsXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbnZpZXdvZiBpbnB1dEFTdXBwbHlfID0gSW5wdXRzLnJhbmdlKFsxZTYsIDFlMTBdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1N1cHBseSBvZiBcXHRleHRiZntBfX1gLFxuICBzdGVwOiAxLFxuICB2YWx1ZTogZGVmYXVsdEFTdXBwbHksXG4gIHRyYW5zZm9ybTogTWF0aC5sb2csXG59KTtcbnZpZXdvZiBpbnB1dExpcXVpZFRvbm5lcyA9IElucHV0cy5yYW5nZShbMWUtMywgMWU5XSwge1xuICBsYWJlbDogdGV4YFxcdGV4dHtJbnZlbnRvcnkgfSBDX2lgLFxuICBzdGVwOiAxZS0zLFxuICB2YWx1ZTogZGVmYXVsdExpcXVpZFRvbm5lcyxcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcbn0pO1xudmlld29mIGlucHV0QUJ1cm50ID0gSW5wdXRzLnJhbmdlKFsxZS0xLCAxZTZdLCB7XG4gIGxhYmVsOiB0ZXhgXFx0ZXh0e1xcdGV4dGJme0F9IHRva2VucyBidXJudH1gLFxuICBzdGVwOiAxZS0xLFxuICB2YWx1ZTogZGVmYXVsdEFCdXJudCxcbiAgdHJhbnNmb3JtOiBNYXRoLmxvZyxcbn0pO1xuSW5wdXRzLmJpbmQoXG4gIElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgICBsYWJlbDogdGV4YFxcdGV4dHtBbGxvY2F0aW9uIH0gQV9pYCxcbiAgICBzdGVwOiAxZS02LFxuICAgIHZhbHVlOiBkZWZhdWx0QWksXG4gICAgdHJhbnNmb3JtOiBwaWVjZXdpc2VMb2dUcmFuc2Zvcm0oMWUtNiksXG4gICAgaW52ZXJ0OiBwaWVjZXdpc2VMb2dJbnZlcnQoMWUtNiksXG4gIH0pLFxuICB2aWV3b2YgaW5wdXRBaSxcbik7XG5JbnB1dHMuYmluZChcbiAgSW5wdXRzLnJhbmdlKFswLCAxXSwge1xuICAgIGxhYmVsOiB0ZXhgXFx0ZXh0e0FsbG9jYXRpb24gfSBHX2lgLFxuICAgIHN0ZXA6IDFlLTYsXG4gICAgdmFsdWU6IGRlZmF1bHRHaSxcbiAgfSksXG4gIHZpZXdvZiBpbnB1dEdpLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwYXJhbUFCdXJudCA9IGlucHV0QWkgPT09IDAgPyAwIDogaW5wdXRBQnVybnRcbnBhcmFtRGVsdGFBXyA9IHBhcmFtQUJ1cm50IC8gaW5wdXRBU3VwcGx5XztcbnBhcmFtRGVsdGFDaSA9IGlucHV0QWkgPT09IDAgPyAtMCA6IGNvbXB1dGVEZWx0YUNpKFxuICBpbnB1dEFpLFxuICBpbnB1dEdpLFxuICBwYXJhbURlbHRhQV8sXG4pO1xucGFyYW1EZWx0YUNpVG9ubmVzID0gLXBhcmFtRGVsdGFDaSAqIGlucHV0TGlxdWlkVG9ubmVzO1xucGFyYW1BUHJpY2VfID0gaW5wdXRBVmFsdWVfIC8gaW5wdXRBU3VwcGx5XztcbnBhcmFtQ2lQcmljZSA9IGlucHV0QWkgPT09IDAgPyAwIDogaW5wdXRBVmFsdWVfICogcGFyYW1EZWx0YUFfIC8gcGFyYW1EZWx0YUNpVG9ubmVzO1xuXG5zdHJpbmdBU3VwcGx5XyA9IGlucHV0QVN1cHBseV8udG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMiAtIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogTWF0aC5tYXgoMCwgMiAtIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxuICB9LFxuKSArIFwiIGtWQ01cIjtcbnN0cmluZ0xpcXVpZFRvbm5lcyA9IGlucHV0TGlxdWlkVG9ubmVzLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IE1hdGgubWF4KDAsIDIgLSBudW1EaWdpdHMocGFyYW1EZWx0YUNpVG9ubmVzKSksXG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiBNYXRoLm1heCgwLCAyIC0gbnVtRGlnaXRzKHBhcmFtRGVsdGFDaVRvbm5lcykpLFxuICB9LFxuKSArIFwiIHRDTzJlcVwiO1xuc3RyaW5nQUJ1cm50ID0gXCLiiJJcIiArIHBhcmFtQUJ1cm50LnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIG51bURpZ2l0cyhwYXJhbUFCdXJudCkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtQUJ1cm50KSksXG4gIH0sXG4pICsgXCIga1ZDTVwiO1xuc3RyaW5nRGVsdGFDaVRvbm5lcyA9IFwi4oiSXCIgKyBwYXJhbURlbHRhQ2lUb25uZXMudG9Mb2NhbGVTdHJpbmcoXG4gIFwiZW4tR0JcIixcbiAge1xuICAgIG1pbmltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtRGVsdGFDaVRvbm5lcykpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgbnVtRGlnaXRzKHBhcmFtRGVsdGFDaVRvbm5lcykpLFxuICB9LFxuKSArIFwiIHRDTzJlcVwiO1xuc3RyaW5nQVByaWNlXyA9IFwiJFwiICsgcGFyYW1BUHJpY2VfLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHtcbiAgICBtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHM6IE1hdGgubWF4KDIsIDIgKyBudW1EaWdpdHMocGFyYW1BUHJpY2VfKSksXG4gICAgbWF4aW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQVByaWNlXykpLFxuICB9LFxuKTtcbnN0cmluZ0NpUHJpY2UgPSBcIiRcIiArIHBhcmFtQ2lQcmljZS50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7XG4gICAgbWluaW11bVNpZ25pZmljYW50RGlnaXRzOiBNYXRoLm1heCgyLCAyICsgbnVtRGlnaXRzKHBhcmFtQ2lQcmljZSkpLFxuICAgIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogTWF0aC5tYXgoMiwgMiArIG51bURpZ2l0cyhwYXJhbUNpUHJpY2UpKSxcbiAgfSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYWxsb2NJbml0R0RhdGEgPSB7XG4gIGNvbnN0IGFsbG9jSW5pdEdEYXRhID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwLjAxOyBpICs9IDAuMjUpIHtcbiAgICBpZiAoaSA8IDIuNTEpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiMDFYXCIsIHZhbHVlOiBpIH0pO1xuICAgIH1cbiAgICBpZiAoMi40OSA8IGkgJiYgaSA8IDUuNTEpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwicEtsaW1hIEhvbGRlcnNcIiwgdmFsdWU6IGkgfSk7XG4gICAgfVxuICAgIGlmICg1LjQ5IDwgaSAmJiBpIDwgMTAuMDEpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiREFPL1RyZWFzdXJ5XCIsIHZhbHVlOiBpIH0pO1xuICAgIH1cbiAgICBpZiAoOS45OSA8IGkgJiYgaSA8IDE1LjAxKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIkVjb3N5c3RlbSBHcmFudFwiLCB2YWx1ZTogaSB9KTtcbiAgICB9XG4gICAgaWYgKDE0Ljk5IDwgaSAmJiBpIDwgMjAuMDEpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiUHJvZHVjdCBEZXNpZ25cIiwgdmFsdWU6IGkgfSk7XG4gICAgfVxuICAgIGlmICgxOS45OSA8IGkgJiYgaSA8IDYwLjAxKSB7XG4gICAgICBhbGxvY0luaXRHRGF0YS5wdXNoKHsga2V5OiBcIktsaW1hIEhvbGRlcnNcIiwgdmFsdWU6IGkgfSk7XG4gICAgfVxuICAgIGlmICg1OS45OSA8IGkpIHtcbiAgICAgIGFsbG9jSW5pdEdEYXRhLnB1c2goeyBrZXk6IFwiSW5jZW50aXZlc1wiLCB2YWx1ZTogaSB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFsbG9jSW5pdEdEYXRhO1xufTtcbmxvbmdpdHVkZVNjYWxlID0gZDMuc2NhbGVMaW5lYXIoWzE4MCwgLTE4MF0pO1xuZ2V0Q2VudGVyID0gZCA9PlxuICAgICAgICBbMS4yNSwgNCwgNy43NSwgMTIuNSwgMTcuNSwgNDAsIDgwXS5pbmNsdWRlcyhkLnZhbHVlKSA/IGQudmFsdWUgOiBOYU47XG5cbmNvaG9ydHNEb21haW4gPSBbXG4gIFwiSW5jZW50aXZlc1wiLFxuICBcIktsaW1hIEhvbGRlcnNcIixcbiAgXCJQcm9kdWN0IERlc2lnblwiLFxuICBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICBcIkRBTy9UcmVhc3VyeVwiLFxuICBcInBLbGltYSBIb2xkZXJzXCIsXG4gIFwiMDFYXCIsXG5dO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIHByb2plY3Rpb246IHsgdHlwZTogXCJhemltdXRoYWwtZXF1aWRpc3RhbnRcIiwgcm90YXRlOiBbMCwgLTkwXSwgc2NhbGU6IDIgfSxcbiAgY29sb3I6IHsgbGVnZW5kOiB0cnVlLCByYW5nZTogZDMuc2NoZW1lQ2F0ZWdvcnkxMCwgZG9tYWluOiBjb2hvcnRzRG9tYWluIH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5hcmVhKGFsbG9jSW5pdEdEYXRhLCB7XG4gICAgICB4MTogKHsgdmFsdWUgfSkgPT4gbG9uZ2l0dWRlU2NhbGUodmFsdWUgLyAxMDApLFxuICAgICAgeTE6IC0yMCxcbiAgICAgIHgyOiAoeyB2YWx1ZSB9KSA9PiBsb25naXR1ZGVTY2FsZSh2YWx1ZSAvIDEwMCksXG4gICAgICB5MjogLTcwLFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgXVxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTcxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGlucHV0UDAgPSBJbnB1dHMucmFuZ2UoWzAuMDEsIDAuNV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7SW5pdGlhbCBpc3N1YW5jZSB9IFBfMGAsXG4gIHN0ZXA6IDAuMDEsXG4gIHZhbHVlOiAwLjA3LFxufSk7XG52aWV3b2YgaW5wdXRUID0gSW5wdXRzLnJhbmdlKFsyLCA2MF0sIHtcbiAgbGFiZWw6IHRleGBUIFxcdGV4dHsgKG1vbnRocyl9YCxcbiAgc3RlcDogMSxcbiAgdmFsdWU6IDI0LFxufSk7XG5cbnN0cmluZ0lucHV0UDAgPSBpbnB1dFAwLnRvTG9jYWxlU3RyaW5nKFxuICBcImVuLUdCXCIsXG4gIHsgc3R5bGU6IFwicGVyY2VudFwiLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSxcbik7XG5zdHJpbmdJbnB1dFQgPSBpbnB1dFQudG9Mb2NhbGVTdHJpbmcoXCJlbi1HQlwiLCB7IG1heGltdW1GcmFjdGlvbkRpZ2l0czogMCB9KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBjb21wdXRlUCh0LCBQMCwgVCkge1xuICBjb25zdCB4MCA9IE1hdGgubG9nKFAwIC8gKDEgLSBQMCkpO1xuICBjb25zdCB4dCA9IHgwICogKDEgLSB0IC8gVCk7XG4gIGNvbnN0IGV4cCA9IE1hdGguZXhwKHh0KTtcbiAgcmV0dXJuIGV4cCAvIChleHAgKyAxKTtcbn1cblxuZnVuY3Rpb24gY29tcHV0ZURlcml2UCh0LCBQMCwgVCkge1xuICBjb25zdCB4MCA9IE1hdGgubG9nKFAwIC8gKDEgLSBQMCkpO1xuICBjb25zdCB4dCA9IHgwICogKDEgLSB0IC8gVCk7XG4gIGNvbnN0IGV4cCA9IE1hdGguZXhwKHh0KTtcbiAgY29uc3QgUCA9IGV4cCAvICgxICsgZXhwKTtcbiAgcmV0dXJuIC0oeDAgLyBUKSAqIFAgKiAoMSAtIFApO1xufVxuXG5mdW5jdGlvbiBnZXRWZXN0aW5nKHZlY1Zlc3RpbmcsIHQsIHRTdGFydCwgdEVuZCkge1xuICBpZiAodCA8IHRTdGFydClcbiAgICByZXR1cm4gMDtcbiAgZWxzZSBpZiAodCA8IHRFbmQpIHtcbiAgICByZXR1cm4gdmVjVmVzdGluZ1t0IC0gdFN0YXJ0XTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdmVjVmVzdGluZ1t0RW5kIC0gdFN0YXJ0IC0gMV07XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ0VmVzdFN0YXJ0ID0gMztcbnRWZXN0RW5kID0gMiAqIGlucHV0VDtcbnRWZXN0aW5nID0gZDMucmFuZ2UodFZlc3RTdGFydCwgdFZlc3RFbmQpO1xudmVjVmVzdGluZ0Rlcml2ID0gbm9ybWFsaXplKHRWZXN0aW5nLm1hcCh0ID0+XG4gIGNvbXB1dGVEZXJpdlAodCwgaW5wdXRQMCwgaW5wdXRUKVxuKSk7XG52ZWNWZXN0aW5nID0gZDMuY3Vtc3VtKHZlY1Zlc3RpbmdEZXJpdik7XG5cbnN1cHBseURhdGFBbGwgPSB7XG4gIGxldCBwYXJhbVZlc3RpbmdQcmV2aW91cyA9IDA7XG4gIGNvbnN0IHZlY1N1cHBseUluY2VudGl2ZXMgPSBbXTtcbiAgY29uc3QgdmVjU3VwcGx5Q2lyY3VsYXRpbmcgPSBbXTtcbiAgY29uc3Qgc3VwcGx5RGF0YSA9IFtdO1xuICBmb3IgKGxldCB0ID0gMDsgdCA8PSA3MjsgdCsrKSB7XG4gICAgY29uc3QgcGFyYW1QID0gY29tcHV0ZVAodCwgaW5wdXRQMCwgaW5wdXRUKTtcbiAgICBjb25zdCBwYXJhbURlcml2UCA9IGNvbXB1dGVEZXJpdlAodCwgaW5wdXRQMCwgaW5wdXRUKTtcbiAgICBjb25zdCBwYXJhbVZlc3RpbmcgPSBnZXRWZXN0aW5nKHZlY1Zlc3RpbmcsIHQsIHRWZXN0U3RhcnQsIHRWZXN0RW5kKTtcbiAgICBjb25zdCBwYXJhbVZlc3RpbmdEaWZmID0gcGFyYW1WZXN0aW5nIC0gcGFyYW1WZXN0aW5nUHJldmlvdXM7XG4gICAgcGFyYW1WZXN0aW5nUHJldmlvdXMgPSBwYXJhbVZlc3Rpbmc7XG5cbiAgICBjb25zdCBzdXBwbHkwMVggPSAyLjU7XG4gICAgY29uc3Qgc3VwcGx5UEtsaW1hID0gMyAqIHBhcmFtVmVzdGluZztcbiAgICBjb25zdCBzdXBwbHlUcmVhc3VyeSA9IDQuNTtcbiAgICBjb25zdCBzdXBwbHlHcmFudCA9IDUgKiBwYXJhbVZlc3Rpbmc7XG4gICAgY29uc3Qgc3VwcGx5UHJvZHVjdCA9IDUgKiBwYXJhbVZlc3Rpbmc7XG4gICAgY29uc3Qgc3VwcGx5S2xpbWEgPSA0MCAqIHBhcmFtVmVzdGluZztcbiAgICBjb25zdCBzdXBwbHlJbmNlbnRpdmVzID0gNDAgKiBwYXJhbVA7XG4gICAgdmVjU3VwcGx5SW5jZW50aXZlcy5wdXNoKHN1cHBseUluY2VudGl2ZXMpO1xuXG4gICAgY29uc3Qgc3VwcGx5MDFYU3RhY2tlZCA9IHN1cHBseTAxWDtcbiAgICBjb25zdCBzdXBwbHlQS2xpbWFTdGFja2VkID0gc3VwcGx5UEtsaW1hICsgc3VwcGx5MDFYU3RhY2tlZDtcbiAgICBjb25zdCBzdXBwbHlUcmVhc3VyeVN0YWNrZWQgPSBzdXBwbHlUcmVhc3VyeSArIHN1cHBseVBLbGltYVN0YWNrZWQ7XG4gICAgY29uc3Qgc3VwcGx5R3JhbnRTdGFja2VkID0gc3VwcGx5R3JhbnQgKyBzdXBwbHlUcmVhc3VyeVN0YWNrZWQ7XG4gICAgY29uc3Qgc3VwcGx5UHJvZHVjdFN0YWNrZWQgPSBzdXBwbHlQcm9kdWN0ICsgc3VwcGx5R3JhbnRTdGFja2VkO1xuICAgIGNvbnN0IHN1cHBseUtsaW1hU3RhY2tlZCA9IHN1cHBseUtsaW1hICsgc3VwcGx5UHJvZHVjdFN0YWNrZWQ7XG4gICAgY29uc3Qgc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQgPSBzdXBwbHlJbmNlbnRpdmVzICsgc3VwcGx5S2xpbWFTdGFja2VkO1xuICAgIGNvbnN0IHN1cHBseUNpcmN1bGF0aW5nID0gc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQgLyAxMDA7XG4gICAgdmVjU3VwcGx5Q2lyY3VsYXRpbmcucHVzaChzdXBwbHlJbmNlbnRpdmVzU3RhY2tlZCk7XG5cbiAgICBpZiAodCA8PSA2MCkge1xuICAgICAgY29uc3QgZGlmZkluY2VudGl2ZXMgPSA0MCAqICh0ID09PSAwID8gaW5wdXRQMCA6IHBhcmFtRGVyaXZQKTtcbiAgICAgIGNvbnN0IGRpZmZLbGltYSA9IDQwICogcGFyYW1WZXN0aW5nRGlmZjtcbiAgICAgIGNvbnN0IGRpZmZQcm9kdWN0ID0gNSAqIHBhcmFtVmVzdGluZ0RpZmY7XG4gICAgICBjb25zdCBkaWZmR3JhbnQgPSA1ICogcGFyYW1WZXN0aW5nRGlmZjtcbiAgICAgIGNvbnN0IGRpZmZQS2xpbWEgPSAzICogcGFyYW1WZXN0aW5nRGlmZjtcbiAgICAgIGNvbnN0IGRpZmZUcmVhc3VyeSA9IHQgPT09IDAgPyA0LjU6IDA7XG4gICAgICBjb25zdCBkaWZmMDFYID0gdCA9PT0gMCA/IDIuNSA6IDA7XG5cbiAgICAgIGNvbnN0IGRpZmZJbmNlbnRpdmVzU3RhY2tlZCA9IGRpZmZJbmNlbnRpdmVzO1xuICAgICAgY29uc3QgZGlmZktsaW1hU3RhY2tlZCA9IGRpZmZLbGltYSArIGRpZmZJbmNlbnRpdmVzU3RhY2tlZDtcbiAgICAgIGNvbnN0IGRpZmZQcm9kdWN0U3RhY2tlZCA9IGRpZmZQcm9kdWN0ICsgZGlmZktsaW1hU3RhY2tlZDtcbiAgICAgIGNvbnN0IGRpZmZHcmFudFN0YWNrZWQgPSBkaWZmR3JhbnQgKyBkaWZmUHJvZHVjdFN0YWNrZWQ7XG4gICAgICBjb25zdCBkaWZmUEtsaW1hU3RhY2tlZCA9IGRpZmZQS2xpbWEgKyBkaWZmR3JhbnRTdGFja2VkO1xuICAgICAgY29uc3QgZGlmZlRyZWFzdXJ5U3RhY2tlZCA9IGRpZmZUcmVhc3VyeSArIGRpZmZQS2xpbWFTdGFja2VkO1xuICAgICAgY29uc3QgZGlmZjAxWFN0YWNrZWQgPSBkaWZmMDFYICsgZGlmZlRyZWFzdXJ5U3RhY2tlZDtcblxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlByb3BvcnRpb24gb2YgU3VwcGx5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IDEwMCAqIHBhcmFtUCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlJhdGUgb2YgQ2hhbmdlXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IDEwMCAqIHBhcmFtRGVyaXZQLFxuICAgICAgfSk7XG5cbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCIwMVhcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5MDFYU3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwicEtsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hU3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVRyZWFzdXJ5U3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiRWNvc3lzdGVtIEdyYW50XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUdyYW50U3RhY2tlZCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdFN0YWNrZWQgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5S2xpbWFTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJJbmNlbnRpdmVzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUluY2VudGl2ZXNTdGFja2VkIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcblxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiMDFYXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseTAxWCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJwS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlQS2xpbWEgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseVRyZWFzdXJ5IC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlHcmFudCAvIHN1cHBseUNpcmN1bGF0aW5nLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJQcm9kdWN0IERlc2lnblwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlQcm9kdWN0IC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJDaXJjdWxhdGluZyBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIktsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5S2xpbWEgLyBzdXBwbHlDaXJjdWxhdGluZyxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIkNpcmN1bGF0aW5nIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlJbmNlbnRpdmVzIC8gc3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgICB9KTtcblxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIjAxWFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHkwMVhTdGFja2VkLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwicEtsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hU3RhY2tlZCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkRBTy9UcmVhc3VyeVwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlUcmVhc3VyeVN0YWNrZWQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJFY29zeXN0ZW0gR3JhbnRcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5R3JhbnRTdGFja2VkLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdFN0YWNrZWQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJLbGltYSBIb2xkZXJzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseUtsaW1hU3RhY2tlZCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkluY2VudGl2ZXNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5SW5jZW50aXZlc1N0YWNrZWQsXG4gICAgICB9KTtcblxuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiMDFYXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IHN1cHBseTAxWCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwicEtsaW1hIEhvbGRlcnNcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UEtsaW1hLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJEQU8vVHJlYXN1cnlcIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5VHJlYXN1cnksXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlHcmFudCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiUHJvZHVjdCBEZXNpZ25cIixcbiAgICAgICAgeDogdCxcbiAgICAgICAgeTogc3VwcGx5UHJvZHVjdCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlLbGltYSxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiSW5jZW50aXZlc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBzdXBwbHlJbmNlbnRpdmVzLFxuICAgICAgfSk7XG5cbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJJbmNlbnRpdmVzXCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IGRpZmZJbmNlbnRpdmVzLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmS2xpbWEsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJQcm9kdWN0IERlc2lnblwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmUHJvZHVjdCxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIkVjb3N5c3RlbSBHcmFudFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmR3JhbnQsXG4gICAgICB9KTtcbiAgICAgIHN1cHBseURhdGEucHVzaCh7XG4gICAgICAgIGtleTogXCJUb3RhbCBTdXBwbHkgRGlmZmVyZW50aWFsIChVbnN0YWNrZWQpXCIsXG4gICAgICAgIGNvaG9ydDogXCJwS2xpbWEgSG9sZGVyc1wiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmUEtsaW1hLFxuICAgICAgfSk7XG4gICAgICBzdXBwbHlEYXRhLnB1c2goe1xuICAgICAgICBrZXk6IFwiVG90YWwgU3VwcGx5IERpZmZlcmVudGlhbCAoVW5zdGFja2VkKVwiLFxuICAgICAgICBjb2hvcnQ6IFwiREFPL1RyZWFzdXJ5XCIsXG4gICAgICAgIHg6IHQsXG4gICAgICAgIHk6IGRpZmZUcmVhc3VyeSxcbiAgICAgIH0pO1xuICAgICAgc3VwcGx5RGF0YS5wdXNoKHtcbiAgICAgICAga2V5OiBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIixcbiAgICAgICAgY29ob3J0OiBcIjAxWFwiLFxuICAgICAgICB4OiB0LFxuICAgICAgICB5OiBkaWZmMDFYLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgdmVjTmV4dFllYXJJbmNlbnRpdmVzID0gdmVjU3VwcGx5SW5jZW50aXZlcy5tYXAoKHZhbCwgdCkgPT5cbiAgICB2ZWNTdXBwbHlJbmNlbnRpdmVzW3QgKyAxMl0gLSB2YWwpO1xuICBjb25zdCB2ZWNBUFkgPSB2ZWNTdXBwbHlDaXJjdWxhdGluZy5tYXAoKHZhbCwgdCkgPT5cbiAgICAxMDAgKiAodmVjU3VwcGx5Q2lyY3VsYXRpbmdbdCArIDEyXSAtIHZhbCkgLyB2YWwpO1xuICBjb25zdCB2ZWNBUFIgPSB2ZWNTdXBwbHlDaXJjdWxhdGluZy5tYXAoKHZhbCwgdCkgPT5cbiAgICAxMDAgKiAodmVjU3VwcGx5Q2lyY3VsYXRpbmdbdCArIDEyXSAtIHZlY05leHRZZWFySW5jZW50aXZlc1t0XSAtIHZhbCkgLyB2YWwpO1xuXG4gIGZvciAobGV0IHQgPSAwOyB0IDw9IDYwOyB0KyspIHtcbiAgICBzdXBwbHlEYXRhLnB1c2goeyBrZXk6IFwiQVBZXCIsIHg6IHQsIHk6IHZlY0FQWVt0XSB9KTtcbiAgICBzdXBwbHlEYXRhLnB1c2goeyBrZXk6IFwiQVBSXCIsIHg6IHQsIHk6IHZlY0FQUlt0XSB9KTtcbiAgfVxuICByZXR1cm4gW1xuICAgIHZlY1N1cHBseUluY2VudGl2ZXMsXG4gICAgdmVjU3VwcGx5Q2lyY3VsYXRpbmcsXG4gICAgc3VwcGx5RGF0YSxcbiAgICB2ZWNBUFksXG4gICAgdmVjQVBSLFxuICBdO1xufVxudmVjU3VwcGx5SW5jZW50aXZlcyA9IHN1cHBseURhdGFBbGxbMF07XG52ZWNTdXBwbHlDaXJjdWxhdGluZyA9IHN1cHBseURhdGFBbGxbMV07XG5zdXBwbHlEYXRhID0gc3VwcGx5RGF0YUFsbFsyXTtcbnZlY0FQWSA9IHN1cHBseURhdGFBbGxbM107XG52ZWNBUFIgPSBzdXBwbHlEYXRhQWxsWzRdO1xuXG5nZXRMb2dpc3RpY0N1cnZlID0gZCA9PiBkLmtleSA9PT0gXCJQcm9wb3J0aW9uIG9mIFN1cHBseVwiID8gZC55IDogTmFOO1xuZ2V0UmF0ZU9mQ2hhbmdlID0gZCA9PiBkLmtleSA9PT0gXCJSYXRlIG9mIENoYW5nZVwiID8gZC55IDogTmFOO1xuZ2V0Q2lyY3VsYXRpbmdTdGFja2VkID0gZCA9PlxuICAgICAgICBkLmtleSA9PT0gXCJDaXJjdWxhdGluZyBTdXBwbHkgKFN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XG5nZXRDaXJjdWxhdGluZ1Vuc3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIgPyBkLnkgOiBOYU47XG5nZXRUb3RhbFN0YWNrZWQgPSBkID0+IGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSAoU3RhY2tlZClcIiA/IGQueSA6IE5hTjtcbmdldFRvdGFsVW5zdGFja2VkID0gZCA9PiBkLmtleSA9PT0gXCJUb3RhbCBTdXBwbHkgKFVuc3RhY2tlZClcIiA/IGQueSA6IE5hTjtcbmdldERpZmZVbnN0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIiA/IGQueSA6IE5hTjtcbmdldENvaG9ydENpcmN1bGF0aW5nU3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChTdGFja2VkKVwiID8gZC5jb2hvcnQgOiBOYU47XG5nZXRDb2hvcnRDaXJjdWxhdGluZ1Vuc3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiQ2lyY3VsYXRpbmcgU3VwcGx5IChVbnN0YWNrZWQpXCIgPyBkLmNvaG9ydCA6IE5hTjtcbmdldENvaG9ydFRvdGFsU3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiVG90YWwgU3VwcGx5IChTdGFja2VkKVwiID8gZC5jb2hvcnQgOiBOYU47XG5nZXRDb2hvcnRUb3RhbFVuc3RhY2tlZCA9IGQgPT5cbiAgICAgICAgZC5rZXkgPT09IFwiVG90YWwgU3VwcGx5IChVbnN0YWNrZWQpXCIgPyBkLmNvaG9ydCA6IE5hTjtcbmdldENvaG9ydERpZmZVbnN0YWNrZWQgPSBkID0+XG4gICAgICAgIGQua2V5ID09PSBcIlRvdGFsIFN1cHBseSBEaWZmZXJlbnRpYWwgKFVuc3RhY2tlZClcIiA/IGQuY29ob3J0IDogTmFOO1xuZ2V0QVBZID0gZCA9PiBkLmtleSA9PT0gXCJBUFlcIiA/IGQueSA6IE5hTjtcbmdldEFQUiA9IGQgPT4gZC5rZXkgPT09IFwiQVBSXCIgPyBkLnkgOiBOYU47XG5cbmRvbWFpblJhdGVPZkNoYW5nZSA9IFswLCBkMy5tYXgoc3VwcGx5RGF0YSwgZ2V0UmF0ZU9mQ2hhbmdlKV07XG5zY2FsZVJhdGVPZkNoYW5nZSA9IGQzLnNjYWxlTGluZWFyKGRvbWFpblJhdGVPZkNoYW5nZSwgWzAsIDEwMF0pO1xubWFwU2NhbGVSYXRlT2ZDaGFuZ2UgPSB4ID0+IHgubWFwKHNjYWxlUmF0ZU9mQ2hhbmdlKTtcblxuc3RyaW5nUDAgPSBcIkluaXRpYWwgSXNzdWFuY2UgUOKCgCA9IFwiICsgaW5wdXRQMC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IHN0eWxlOiBcInBlcmNlbnRcIiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwIH0sXG4pO1xuc3RyaW5nVCA9IFwiSW5mbGVjdGlvbiBQb2ludCBUaW1lIFQgPSBcIiArIGlucHV0VC50b0xvY2FsZVN0cmluZyhcbiAgXCJlbi1HQlwiLFxuICB7IG1heGltdW1GcmFjdGlvbkRpZ2l0czogMCB9LFxuKSArIFwiIG1vbnRoc1wiO1xuXG5zdXBwbHlQYXJhbXMgPSBbXG4gIHsga2V5OiBzdHJpbmdQMCwgeDogMC41LCB5OiAxMDAgKiBpbnB1dFAwIH0sXG4gIHsga2V5OiBzdHJpbmdULCB4OiBpbnB1dFQsIHk6IDUwIH0sXG5dO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7XG4gICAgbGVnZW5kOiB0cnVlLFxuICAgIHJhbmdlOiBbNSwgNywgMCwgMl0ubWFwKGkgPT4gZDMuc2NoZW1lQ2F0ZWdvcnkxMFtpXSksXG4gICAgZG9tYWluOiBbXCJQcm9wb3J0aW9uIG9mIFN1cHBseVwiLCBcIlJhdGUgb2YgQ2hhbmdlXCIsIHN0cmluZ1AwLCBzdHJpbmdUXSxcbiAgfSxcbiAgeDoge1xuICAgIHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksXG4gICAgbGFiZWw6IFwi4oCYTGlmZeKAmSBTcGFuIChNb250aHMpXCIsXG4gICAgZ3JpZDogdHJ1ZSxcbiAgfSxcbiAgeTogeyBkb21haW46IFswLCAxMDBdIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgY2xpcDogdHJ1ZSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmZyYW1lKCksXG4gICAgUGxvdC5heGlzWSh7IGFuY2hvcjogXCJsZWZ0XCIsIGxhYmVsOiBcIlByb3BvcnRpb24gb2YgU3VwcGx5ICglKVwiIH0pLFxuICAgIFBsb3QuYXhpc1koc2NhbGVSYXRlT2ZDaGFuZ2UudGlja3MoKSwge1xuICAgICAgYW5jaG9yOiBcInJpZ2h0XCIsXG4gICAgICB0aWNrRm9ybWF0OiBzY2FsZVJhdGVPZkNoYW5nZS50aWNrRm9ybWF0KCksXG4gICAgICBsYWJlbDogXCJSYXRlIG9mIENoYW5nZSAoJS9Nb250aClcIixcbiAgICAgIHk6IHNjYWxlUmF0ZU9mQ2hhbmdlXG4gICAgfSksXG4gICAgUGxvdC5saW5lWShzdXBwbHlEYXRhLCBQbG90Lm1hcFkobWFwU2NhbGVSYXRlT2ZDaGFuZ2UsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0UmF0ZU9mQ2hhbmdlLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxuICAgIH0pKSxcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0TG9naXN0aWNDdXJ2ZSxcbiAgICAgIHN0cm9rZTogXCJrZXlcIixcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICB9KSxcbiAgICBQbG90LmFyZWFZKHN1cHBseURhdGEsIFBsb3QubWFwWShtYXBTY2FsZVJhdGVPZkNoYW5nZSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRSYXRlT2ZDaGFuZ2UsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuMyxcbiAgICB9KSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IGdldExvZ2lzdGljQ3VydmUsXG4gICAgICBmaWxsOiBcImtleVwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuMyxcbiAgICB9KSxcbiAgICBQbG90LnJ1bGVYKHN1cHBseVBhcmFtcywge1xuICAgICAgeDogZCA9PiBkLmtleSA9PT0gc3RyaW5nVCA/IGQueCA6IE5hTixcbiAgICAgIHk6IFwieVwiLFxuICAgICAgc3Ryb2tlOiBcImtleVwiLFxuICAgICAgc3Ryb2tlV2lkdGggOiAyLFxuICAgICAgc3Ryb2tlRGFzaGFycmF5OiA0LFxuICAgIH0pLFxuICAgIFBsb3QuZG90WShzdXBwbHlQYXJhbXMsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogXCJ5XCIsXG4gICAgICByOiA1LFxuICAgICAgZmlsbDogXCJrZXlcIixcbiAgICB9KSxcbiAgXVxufSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiUGxvdC5wbG90KHtcbiAgY29sb3I6IHsgbGVnZW5kOiB0cnVlLCByYW5nZTogZDMuc2NoZW1lQ2F0ZWdvcnkxMCwgZG9tYWluOiBjb2hvcnRzRG9tYWluIH0sXG4gIHg6IHsgdGlja3M6IGQzLnJhbmdlKDAsIDYwLjEsIDEyKSwgbGFiZWw6IFwiVGltZSAoTW9udGhzKVwiLCBncmlkOiB0cnVlIH0sXG4gIHk6IHsgZG9tYWluOiBbMCwgMTAwXSwgbGFiZWw6IFwiQ2lyY3VsYXRpbmcgU3VwcGx5ICglKVwiLCBncmlkOiB0cnVlIH0sXG4gIGNsaXA6IHRydWUsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRDaXJjdWxhdGluZ1N0YWNrZWQsXG4gICAgICBzdHJva2U6IGdldENvaG9ydENpcmN1bGF0aW5nU3RhY2tlZCxcbiAgICAgIHN0cm9rZVdpZHRoIDogMixcbiAgICB9KSxcbiAgICBQbG90LmFyZWFZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0Q2lyY3VsYXRpbmdVbnN0YWNrZWQsXG4gICAgICBmaWxsOiBnZXRDb2hvcnRDaXJjdWxhdGluZ1Vuc3RhY2tlZCxcbiAgICAgIGZpbGxPcGFjaXR5OiAwLjUsXG4gICAgfSksXG4gIF1cbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxuICB5OiB7IGRvbWFpbjogWzAsIDEwMF0sIGxhYmVsOiBcIlRvdGFsIFN1cHBseSAoJSlcIiwgZ3JpZDogdHJ1ZSB9LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LmxpbmVZKHN1cHBseURhdGEsIHtcbiAgICAgIHg6IFwieFwiLFxuICAgICAgeTogZ2V0VG90YWxTdGFja2VkLFxuICAgICAgc3Ryb2tlOiBnZXRDb2hvcnRUb3RhbFN0YWNrZWQsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgfSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHk6IGdldFRvdGFsVW5zdGFja2VkLFxuICAgICAgZmlsbDogZ2V0Q29ob3J0VG90YWxVbnN0YWNrZWQsXG4gICAgICBmaWxsT3BhY2l0eTogMC41LFxuICAgIH0pLFxuICBdXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxuICB5OiB7IGxhYmVsOiBcIlRvdGFsIFN1cHBseSAoJSlcIiwgZ3JpZDogdHJ1ZSB9LFxuICBpbnNldFRvcDogMTYsXG4gIGNsaXA6IHRydWUsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5mcmFtZSgpLFxuICAgIFBsb3QubGluZVkoc3VwcGx5RGF0YSwge1xuICAgICAgeDogXCJ4XCIsXG4gICAgICB5OiBnZXRUb3RhbFVuc3RhY2tlZCxcbiAgICAgIHN0cm9rZTogZ2V0Q29ob3J0VG90YWxVbnN0YWNrZWQsXG4gICAgICBzdHJva2VXaWR0aCA6IDIsXG4gICAgfSksXG4gICAgUGxvdC5hcmVhWShzdXBwbHlEYXRhLCB7XG4gICAgICB4OiBcInhcIixcbiAgICAgIHkxOiAwLFxuICAgICAgeTI6IGdldFRvdGFsVW5zdGFja2VkLFxuICAgICAgZmlsbDogZ2V0Q29ob3J0VG90YWxVbnN0YWNrZWQsXG4gICAgICBmaWxsT3BhY2l0eTogMC4yLFxuICAgIH0pLFxuICBdXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSwgcmFuZ2U6IGQzLnNjaGVtZUNhdGVnb3J5MTAsIGRvbWFpbjogY29ob3J0c0RvbWFpbiB9LFxuICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCA2MC4xLCAxMiksIGxhYmVsOiBcIlRpbWUgKE1vbnRocylcIiwgZ3JpZDogdHJ1ZSB9LFxuICB5OiB7IGxhYmVsOiBcIlJhdGUgb2YgR3Jvd3RoICglL01vbnRoKVwiLCBncmlkOiB0cnVlIH0sXG4gIGluc2V0VG9wOiAxNixcbiAgaW5zZXRMZWZ0OiA4LFxuICBpbnNldFJpZ2h0OiA4LFxuICBjbGlwOiB0cnVlLFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3RZKHN1cHBseURhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQueCAtIDAuNDUsXG4gICAgICB4MjogZCA9PiBkLnggKyAwLjQ1LFxuICAgICAgeTogZ2V0RGlmZlVuc3RhY2tlZCxcbiAgICAgIGZpbGw6IGdldENvaG9ydERpZmZVbnN0YWNrZWQsXG4gICAgfSksXG4gIF1cbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVVcHNpbG9uKEcsIEwpIHtcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAoMiAqIEcgKiBMIC8gKEcqKjIgKyBMKioyKSkqKjI7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ1cHNpbG9uRGF0YSA9IHtcbiAgY29uc3QgdXBzaWxvbkRhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMDUpIHtcbiAgICBmb3IgKGxldCBwYXJhbUwgPSAwOyBwYXJhbUwgPCAxLjAxOyBwYXJhbUwgKz0gMC4wNSkge1xuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcbiAgICAgICAgdXBzaWxvbkRhdGEucHVzaCh7XG4gICAgICAgICAga2V5OiBcIs+FXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZVVwc2lsb24ocGFyYW1HLCBwYXJhbUwpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVwc2lsb25EYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBhc3BlY3RSYXRpbzogMSxcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgZG9tYWluOiBbMCwgMV0sXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IFwiUmVsYXRpdmUgVXRpbGlzYXRpb24gz4VcIixcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxuICB5OiB7XG4gICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXG4gICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxuICB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QodXBzaWxvbkRhdGEsIHtcbiAgICAgIHgxOiBkID0+IGQubCAtIDAuMDI1LFxuICAgICAgeDI6IGQgPT4gZC5sICsgMC4wMjUsXG4gICAgICB5MTogZCA9PiBkLmcgLSAwLjAyNSxcbiAgICAgIHkyOiBkID0+IGQuZyArIDAuMDI1LFxuICAgICAgZmlsbDogXCJ2YWx1ZVwiLFxuICAgIH0pLFxuICAgIFBsb3QudGV4dCh1cHNpbG9uRGF0YSwge1xuICAgICAgeDogXCJsXCIsXG4gICAgICB5OiBcImdcIixcbiAgICAgIHRleHQ6IGQgPT4gTnVtYmVyLmlzTmFOKGQudmFsdWUpID8gXCJcIiA6IGQudmFsdWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgIFwiZW4tR0JcIixcbiAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgKSxcbiAgICAgIGZpbGw6IGQgPT4gY29udHJhc3RpbmdUZXh0Q29sb3IoXG4gICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxuICAgICAgKSxcbiAgICB9KSxcbiAgXSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVFdGEoRywgTCkge1xuICBpZiAoRyA9PT0gMCAmJiBMID09PSAwKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIDIgKiBHICogTCAvIChHICogKDEgLSBHKSArIEwgKiAoMSAtIEwpKTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImV0YURhdGEgPSB7XG4gIGNvbnN0IGV0YURhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMDUpIHtcbiAgICBmb3IgKGxldCBwYXJhbUwgPSAwOyBwYXJhbUwgPCAxLjAxOyBwYXJhbUwgKz0gMC4wNSkge1xuICAgICAgaWYgKHBhcmFtRyArIHBhcmFtTCA8IDEuMDEpIHtcbiAgICAgICAgZXRhRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwizrdcIixcbiAgICAgICAgICBsOiBwYXJhbUwsXG4gICAgICAgICAgZzogcGFyYW1HLFxuICAgICAgICAgIHZhbHVlOiBjb21wdXRlRXRhKHBhcmFtRywgcGFyYW1MKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBldGFEYXRhO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJQbG90LnBsb3Qoe1xuICBhc3BlY3RSYXRpbzogMSxcbiAgY29sb3I6IHtcbiAgICBsZWdlbmQ6IHRydWUsXG4gICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgZG9tYWluOiBbMCwgMV0sXG4gICAgdHlwZTogXCJzZXF1ZW50aWFsXCIsXG4gICAgbGFiZWw6IFwiQWJzb2x1dGUgVXRpbGlzYXRpb24gzrdcIixcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxuICB5OiB7XG4gICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXG4gICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxuICB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QoZXRhRGF0YSwge1xuICAgICAgeDE6IGQgPT4gZC5sIC0gMC4wMjUsXG4gICAgICB4MjogZCA9PiBkLmwgKyAwLjAyNSxcbiAgICAgIHkxOiBkID0+IGQuZyAtIDAuMDI1LFxuICAgICAgeTI6IGQgPT4gZC5nICsgMC4wMjUsXG4gICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgfSksXG4gICAgUGxvdC50ZXh0KGV0YURhdGEsIHtcbiAgICAgIHg6IFwibFwiLFxuICAgICAgeTogXCJnXCIsXG4gICAgICB0ZXh0OiBkID0+IE51bWJlci5pc05hTihkLnZhbHVlKSA/IFwiXCIgOiBkLnZhbHVlLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDIgfSxcbiAgICAgICksXG4gICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICBkMy5zY2FsZVNlcXVlbnRpYWwoWzAsIDFdLCBkMy5pbnRlcnBvbGF0ZVNwZWN0cmFsKShkLnZhbHVlKSxcbiAgICAgICksXG4gICAgfSksXG4gIF0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgaW5wdXRTXyA9IElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7VGltZS1Mb2NrZWQgfSBTYCxcbiAgc3RlcDogMC4wMSxcbiAgdmFsdWU6IDAuNSxcbn0pO1xuXG52aWV3b2YgaW5wdXRXZWlnaHRBRyA9IElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgbGFiZWw6IHRleGBcXHRleHR7TFAgc3BsaXR9YCxcbiAgc3RlcDogMC4wMSxcbiAgdmFsdWU6IDAuNSxcbn0pO1xuXG5wYXJhbVdlaWdodEFRID0gMSAtIGlucHV0V2VpZ2h0QUc7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTg2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY29tcHV0ZVRyZWFzdXJ5KEcsIEwpIHtcbiAgcmV0dXJuIE1hdGgubWF4KDAsIDEgLSBjb21wdXRlVXBzaWxvbihHLCBMKSAqIGNvbXB1dGVFdGEoRywgTCkpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVJQm9uZHMoRywgTCwgUykge1xuICBpZiAoRyA9PT0gMCAmJiBMID09PSAwKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFMgKiBMKioyIC8gKEcqKjIgKyBMKioyKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb21wdXRlSVN0YWtpbmcoRywgTCwgUykge1xuICBpZiAoRyA9PT0gMCAmJiBMID09PSAwKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuICgxIC0gUykgKiBMKioyIC8gKEcqKjIgKyBMKioyKTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGNvbXB1dGVJUG9vbChHLCBMLCB3ZWlnaHQpIHtcbiAgaWYgKEcgPT09IDAgJiYgTCA9PT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB3ZWlnaHQgKiBHKioyIC8gKEcqKjIgKyBMKioyKTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFsbG9jYXRpb25TUURhdGEgPSB7XG4gIGNvbnN0IGFsbG9jYXRpb25TUURhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMSkge1xuICAgIGZvciAobGV0IHBhcmFtTCA9IDA7IHBhcmFtTCA8IDEuMDE7IHBhcmFtTCArPSAwLjEpIHtcbiAgICAgIGlmIChwYXJhbUcgKyBwYXJhbUwgPCAxLjAxKSB7XG4gICAgICAgIGFsbG9jYXRpb25TUURhdGEucHVzaCh7XG4gICAgICAgICAga2V5OiBcIvCdl5QgVGltZS1sb2NrcyBBbGxvY2F0aW9uXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlCb25kcyhwYXJhbUcsIHBhcmFtTCwgaW5wdXRTXyksXG4gICAgICAgIH0pO1xuICAgICAgICBhbGxvY2F0aW9uU1FEYXRhLnB1c2goe1xuICAgICAgICAgIGtleTogXCLwnZeaIFVzZXItbG9ja3MgQWxsb2NhdGlvblwiLFxuICAgICAgICAgIGw6IHBhcmFtTCxcbiAgICAgICAgICBnOiBwYXJhbUcsXG4gICAgICAgICAgdmFsdWU6IGNvbXB1dGVJU3Rha2luZyhwYXJhbUcsIHBhcmFtTCwgaW5wdXRTXyksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gYWxsb2NhdGlvblNRRGF0YTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGxvdEFsbG9jYXRpb25TUSA9IHtcbiAgY29uc3QgcGxvdEFsbG9jYXRpb25TUSA9IFBsb3QucGxvdCh7XG4gICAgYXNwZWN0UmF0aW86IDEsXG4gICAgY29sb3I6IHtcbiAgICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICAgIHNjaGVtZTogXCJTcGVjdHJhbFwiLFxuICAgICAgZG9tYWluOiBbMCwgMV0sXG4gICAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICAgIGxhYmVsOiBcIkFsbG9jYXRpb24gSVwiLFxuICAgIH0sXG4gICAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxuICAgIHk6IHtcbiAgICAgIHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLFxuICAgICAgZG9tYWluOiBbMS4wNSwgLTAuMDVdLFxuICAgICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxuICAgIH0sXG4gICAgZng6IHsgbGFiZWw6IG51bGwgfSxcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5mcmFtZSgpLFxuICAgICAgUGxvdC5yZWN0KGFsbG9jYXRpb25TUURhdGEsIHtcbiAgICAgICAgeDE6IGQgPT4gZC5sIC0gMC4wNSxcbiAgICAgICAgeDI6IGQgPT4gZC5sICsgMC4wNSxcbiAgICAgICAgeTE6IGQgPT4gZC5nIC0gMC4wNSxcbiAgICAgICAgeTI6IGQgPT4gZC5nICsgMC4wNSxcbiAgICAgICAgZng6IFwia2V5XCIsXG4gICAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICAgIH0pLFxuICAgICAgUGxvdC50ZXh0KGFsbG9jYXRpb25TUURhdGEsIHtcbiAgICAgICAgeDogXCJsXCIsXG4gICAgICAgIHk6IFwiZ1wiLFxuICAgICAgICBmeDogXCJrZXlcIixcbiAgICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgICApLFxuICAgICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxuICAgICAgICApLFxuICAgICAgfSksXG4gICAgXSxcbiAgfSk7XG5cbiAgZDMuc2VsZWN0KHBsb3RBbGxvY2F0aW9uU1EpXG4gICAgLnNlbGVjdChcImdbYXJpYS1sYWJlbD0neS1heGlzIGxhYmVsJ11cIilcbiAgICAuc2VsZWN0KFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY2hhbmdlVHJhbnNsYXRpb24oMCwgMTApKTtcblxuICByZXR1cm4gcGxvdEFsbG9jYXRpb25TUTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYWxsb2NhdGlvblBvb2xEYXRhID0ge1xuICBjb25zdCBhbGxvY2F0aW9uUG9vbERhdGEgPSBbXTtcbiAgZm9yIChsZXQgcGFyYW1HID0gMDsgcGFyYW1HIDwgMS4wMTsgcGFyYW1HICs9IDAuMSkge1xuICAgIGZvciAobGV0IHBhcmFtTCA9IDA7IHBhcmFtTCA8IDEuMDE7IHBhcmFtTCArPSAwLjEpIHtcbiAgICAgIGlmIChwYXJhbUcgKyBwYXJhbUwgPCAxLjAxKSB7XG4gICAgICAgIGFsbG9jYXRpb25Qb29sRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwi8J2XlPCdl5ogUG9vbCBBbGxvY2F0aW9uXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlQb29sKHBhcmFtRywgcGFyYW1MLCBpbnB1dFdlaWdodEFHKSxcbiAgICAgICAgfSk7XG4gICAgICAgIGFsbG9jYXRpb25Qb29sRGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwi8J2XlPCdl6QgUG9vbCBBbGxvY2F0aW9uXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZUlQb29sKHBhcmFtRywgcGFyYW1MLCBwYXJhbVdlaWdodEFRKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBhbGxvY2F0aW9uUG9vbERhdGE7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBsb3RBbGxvY2F0aW9uUG9vbCA9IHtcbiAgY29uc3QgcGxvdEFsbG9jYXRpb25Qb29sID0gUGxvdC5wbG90KHtcbiAgICBhc3BlY3RSYXRpbzogMSxcbiAgICBjb2xvcjoge1xuICAgICAgbGVnZW5kOiB0cnVlLFxuICAgICAgc2NoZW1lOiBcIlNwZWN0cmFsXCIsXG4gICAgICBkb21haW46IFswLCAxXSxcbiAgICAgIHR5cGU6IFwic2VxdWVudGlhbFwiLFxuICAgICAgbGFiZWw6IFwiQWxsb2NhdGlvbiBJXCIsXG4gICAgfSxcbiAgICB4OiB7IHRpY2tzOiBkMy5yYW5nZSgwLCAxLjAxLCAwLjEpLCBsYWJlbDogXCJMaXF1aWRpdHkgTFwiIH0sXG4gICAgeToge1xuICAgICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgICBkb21haW46IFsxLjA1LCAtMC4wNV0sXG4gICAgICBsYWJlbDogXCJTdGFrZSBHXCIsXG4gICAgfSxcbiAgICBmeDogeyBsYWJlbDogbnVsbCB9LFxuICAgIG1hcmtzOiBbXG4gICAgICBQbG90LmZyYW1lKCksXG4gICAgICBQbG90LnJlY3QoYWxsb2NhdGlvblBvb2xEYXRhLCB7XG4gICAgICAgIHgxOiBkID0+IGQubCAtIDAuMDUsXG4gICAgICAgIHgyOiBkID0+IGQubCArIDAuMDUsXG4gICAgICAgIHkxOiBkID0+IGQuZyAtIDAuMDUsXG4gICAgICAgIHkyOiBkID0+IGQuZyArIDAuMDUsXG4gICAgICAgIGZ4OiBcImtleVwiLFxuICAgICAgICBmaWxsOiBcInZhbHVlXCIsXG4gICAgICB9KSxcbiAgICAgIFBsb3QudGV4dChhbGxvY2F0aW9uUG9vbERhdGEsIHtcbiAgICAgICAgeDogXCJsXCIsXG4gICAgICAgIHk6IFwiZ1wiLFxuICAgICAgICBmeDogXCJrZXlcIixcbiAgICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgICBcImVuLUdCXCIsXG4gICAgICAgICAgeyBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDIsIG1heGltdW1GcmFjdGlvbkRpZ2l0czogMiB9LFxuICAgICAgICApLFxuICAgICAgICBmaWxsOiBkID0+IGNvbnRyYXN0aW5nVGV4dENvbG9yKFxuICAgICAgICAgIGQzLnNjYWxlU2VxdWVudGlhbChbMCwgMV0sIGQzLmludGVycG9sYXRlU3BlY3RyYWwpKGQudmFsdWUpLFxuICAgICAgICApLFxuICAgICAgfSksXG4gICAgXSxcbiAgfSk7XG5cbiAgZDMuc2VsZWN0KHBsb3RBbGxvY2F0aW9uUG9vbClcbiAgICAuc2VsZWN0KFwiZ1thcmlhLWxhYmVsPSd5LWF4aXMgbGFiZWwnXVwiKVxuICAgIC5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBjaGFuZ2VUcmFuc2xhdGlvbigwLCAxMCkpO1xuXG4gIHJldHVybiBwbG90QWxsb2NhdGlvblBvb2w7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InRyZWFzdXJ5RGF0YSA9IHtcbiAgY29uc3QgdHJlYXN1cnlEYXRhID0gW107XG4gIGZvciAobGV0IHBhcmFtRyA9IDA7IHBhcmFtRyA8IDEuMDE7IHBhcmFtRyArPSAwLjA1KSB7XG4gICAgZm9yIChsZXQgcGFyYW1MID0gMDsgcGFyYW1MIDwgMS4wMTsgcGFyYW1MICs9IDAuMDUpIHtcbiAgICAgIGlmIChwYXJhbUcgKyBwYXJhbUwgPCAxLjAxKSB7XG4gICAgICAgIHRyZWFzdXJ5RGF0YS5wdXNoKHtcbiAgICAgICAgICBrZXk6IFwiSV9UXCIsXG4gICAgICAgICAgbDogcGFyYW1MLFxuICAgICAgICAgIGc6IHBhcmFtRyxcbiAgICAgICAgICB2YWx1ZTogY29tcHV0ZVRyZWFzdXJ5KHBhcmFtRywgcGFyYW1MKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB0cmVhc3VyeURhdGE7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QucGxvdCh7XG4gIGFzcGVjdFJhdGlvOiAxLFxuICBjb2xvcjoge1xuICAgIGxlZ2VuZDogdHJ1ZSxcbiAgICBzY2hlbWU6IFwiU3BlY3RyYWxcIixcbiAgICBkb21haW46IFswLCAxXSxcbiAgICB0eXBlOiBcInNlcXVlbnRpYWxcIixcbiAgICBsYWJlbDogXCJBbGxvY2F0aW9uIElcIixcbiAgfSxcbiAgeDogeyB0aWNrczogZDMucmFuZ2UoMCwgMS4wMSwgMC4xKSwgbGFiZWw6IFwiTGlxdWlkaXR5IExcIiB9LFxuICB5OiB7XG4gICAgdGlja3M6IGQzLnJhbmdlKDAsIDEuMDEsIDAuMSksXG4gICAgZG9tYWluOiBbMS4wMjUsIC0wLjAyNV0sXG4gICAgbGFiZWw6IFwiU3Rha2UgR1wiLFxuICB9LFxuICBtYXJrczogW1xuICAgIFBsb3QuZnJhbWUoKSxcbiAgICBQbG90LnJlY3QodHJlYXN1cnlEYXRhLCB7XG4gICAgICB4MTogZCA9PiBkLmwgLSAwLjAyNSxcbiAgICAgIHgyOiBkID0+IGQubCArIDAuMDI1LFxuICAgICAgeTE6IGQgPT4gZC5nIC0gMC4wMjUsXG4gICAgICB5MjogZCA9PiBkLmcgKyAwLjAyNSxcbiAgICAgIGZpbGw6IFwidmFsdWVcIixcbiAgICB9KSxcbiAgICBQbG90LnRleHQodHJlYXN1cnlEYXRhLCB7XG4gICAgICB4OiBcImxcIixcbiAgICAgIHk6IFwiZ1wiLFxuICAgICAgdGV4dDogZCA9PiBOdW1iZXIuaXNOYU4oZC52YWx1ZSkgPyBcIlwiIDogZC52YWx1ZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgXCJlbi1HQlwiLFxuICAgICAgICB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiwgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyIH0sXG4gICAgICApLFxuICAgICAgZmlsbDogZCA9PiBjb250cmFzdGluZ1RleHRDb2xvcihcbiAgICAgICAgZDMuc2NhbGVTZXF1ZW50aWFsKFswLCAxXSwgZDMuaW50ZXJwb2xhdGVTcGVjdHJhbCkoZC52YWx1ZSksXG4gICAgICApLFxuICAgIH0pLFxuICBdLFxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRTJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dERlbHRhQmFyQ2knKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXREZWx0YUJhckNudWxsJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RGVsdGFBJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RGVsdGFDaW5pdGlhbCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEFWYWx1ZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEFTdXBwbHknKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRQcmVzZW50VG9ubmVzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0RGVsdGFUb25uZXMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRBaScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEdpJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0QVZhbHVlXycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpbnB1dEFTdXBwbHlfJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0TGlxdWlkVG9ubmVzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0QUJ1cm50JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0UDAnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRUJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2lucHV0U18nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaW5wdXRXZWlnaHRBRycpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/whitepaper\.klima\.leodesouza\.net");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>